<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="VariablesErrConnDone 在已经提交或回滚的连接上执行的任何操作都会返回 ErrConnDone。  1var ErrConnDone &#x3D; errors.New(&quot;database&#x2F;sql: connection is already closed&quot;)  ErrNoRows 当 QueryRow 没有返回行时，Scan 返回 ErrNoRows。在这种情况下，Q">
<meta property="og:type" content="article">
<meta property="og:title" content="sql">
<meta property="og:url" content="http://blog.lujinkai.cn/Golang/%E6%A0%87%E5%87%86%E5%BA%93/database/sql/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="VariablesErrConnDone 在已经提交或回滚的连接上执行的任何操作都会返回 ErrConnDone。  1var ErrConnDone &#x3D; errors.New(&quot;database&#x2F;sql: connection is already closed&quot;)  ErrNoRows 当 QueryRow 没有返回行时，Scan 返回 ErrNoRows。在这种情况下，Q">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-09-24T06:38:46.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.474Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="golang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/Golang/%E6%A0%87%E5%87%86%E5%BA%93/database/sql/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/Golang/%E6%A0%87%E5%87%86%E5%BA%93/database/sql/","path":"Golang/标准库/database/sql/","title":"sql"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>sql | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Variables"><span class="nav-number">1.</span> <span class="nav-text">Variables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ErrConnDone"><span class="nav-number">1.1.</span> <span class="nav-text">ErrConnDone</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ErrNoRows"><span class="nav-number">1.2.</span> <span class="nav-text">ErrNoRows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ErrTxDone"><span class="nav-number">1.3.</span> <span class="nav-text">ErrTxDone</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#func-Drivers-string"><span class="nav-number">2.</span> <span class="nav-text">func Drivers() []string</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#func-Register-name-string-driver-driver-Driver"><span class="nav-number">3.</span> <span class="nav-text">func Register(name string, driver driver.Driver)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-ColumnType"><span class="nav-number">4.</span> <span class="nav-text">type ColumnType</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-DatabaseTypeName"><span class="nav-number">4.1.</span> <span class="nav-text">func (*ColumnType) DatabaseTypeName</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-DecimalSize"><span class="nav-number">4.2.</span> <span class="nav-text">func (*ColumnType) DecimalSize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-Length"><span class="nav-number">4.3.</span> <span class="nav-text">func (*ColumnType) Length</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-Name"><span class="nav-number">4.4.</span> <span class="nav-text">func (*ColumnType) Name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-Nullable"><span class="nav-number">4.5.</span> <span class="nav-text">func (*ColumnType) Nullable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ColumnType-ScanType"><span class="nav-number">4.6.</span> <span class="nav-text">func (*ColumnType) ScanType</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Conn"><span class="nav-number">5.</span> <span class="nav-text">type Conn</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-BeginTx"><span class="nav-number">5.1.</span> <span class="nav-text">func (*Conn) BeginTx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-Close"><span class="nav-number">5.2.</span> <span class="nav-text">func (*Conn) Close</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-ExecContext"><span class="nav-number">5.3.</span> <span class="nav-text">func (*Conn) ExecContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-PingContext"><span class="nav-number">5.4.</span> <span class="nav-text">func (*Conn) PingContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-PrepareContext"><span class="nav-number">5.5.</span> <span class="nav-text">func (*Conn) PrepareContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-QueryContext"><span class="nav-number">5.6.</span> <span class="nav-text">func (*Conn) QueryContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Conn-QueryRowContext"><span class="nav-number">5.7.</span> <span class="nav-text">func (*Conn) QueryRowContext</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#func-Conn-Raw"><span class="nav-number">5.7.1.</span> <span class="nav-text">func (*Conn) Raw</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-DB-%E2%98%85%E2%98%85%E2%98%85%E2%98%85%E2%98%85"><span class="nav-number">6.</span> <span class="nav-text">type DB  ★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Open"><span class="nav-number">6.1.</span> <span class="nav-text">func Open</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-DB-Begin"><span class="nav-number">6.2.</span> <span class="nav-text">func (*DB) Begin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-DB-BeginTx"><span class="nav-number">6.3.</span> <span class="nav-text">func (*DB) BeginTx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-DB-Close"><span class="nav-number">6.4.</span> <span class="nav-text">func (*DB) Close</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Conn"><span class="nav-number">6.5.</span> <span class="nav-text">func (db *DB) Conn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Driver"><span class="nav-number">6.6.</span> <span class="nav-text">func (db *DB) Driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Exec"><span class="nav-number">6.7.</span> <span class="nav-text">func (db *DB) Exec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-ExecContext"><span class="nav-number">6.8.</span> <span class="nav-text">func (db *DB) ExecContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Ping"><span class="nav-number">6.9.</span> <span class="nav-text">func (db *DB) Ping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-PingContext"><span class="nav-number">6.10.</span> <span class="nav-text">func (db *DB) PingContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Prepare"><span class="nav-number">6.11.</span> <span class="nav-text">func (db *DB) Prepare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-PrepareContext"><span class="nav-number">6.12.</span> <span class="nav-text">func (db *DB) PrepareContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Query"><span class="nav-number">6.13.</span> <span class="nav-text">func (db *DB) Query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-QueryContext"><span class="nav-number">6.14.</span> <span class="nav-text">func (db *DB) QueryContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-QueryRow"><span class="nav-number">6.15.</span> <span class="nav-text">func (db *DB) QueryRow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-QueryRowContext"><span class="nav-number">6.16.</span> <span class="nav-text">func (db *DB) QueryRowContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-SetConnMaxIdleTime"><span class="nav-number">6.17.</span> <span class="nav-text">func (db *DB) SetConnMaxIdleTime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-SetConnMaxLifetime"><span class="nav-number">6.18.</span> <span class="nav-text">func (db *DB) SetConnMaxLifetime</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-SetMaxIdleConns"><span class="nav-number">6.19.</span> <span class="nav-text">func (db *DB) SetMaxIdleConns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-SetMaxOpenConns"><span class="nav-number">6.20.</span> <span class="nav-text">func (db *DB) SetMaxOpenConns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-db-DB-Stats-DBStats"><span class="nav-number">6.21.</span> <span class="nav-text">func (db *DB) Stats() DBStats</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-Conn-%E5%92%8C-DB"><span class="nav-number">7.</span> <span class="nav-text">关于 Conn 和 DB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-DBStats"><span class="nav-number">8.</span> <span class="nav-text">type DBStats</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-IsolationLevel"><span class="nav-number">9.</span> <span class="nav-text">type IsolationLevel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-i-IsolationLevel-String-string"><span class="nav-number">9.1.</span> <span class="nav-text">func (i IsolationLevel) String() string</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NamedArg"><span class="nav-number">10.</span> <span class="nav-text">type NamedArg</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-Named"><span class="nav-number">10.1.</span> <span class="nav-text">func Named</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullBool"><span class="nav-number">11.</span> <span class="nav-text">type NullBool</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullBool-Scan-value-interface-error"><span class="nav-number">11.1.</span> <span class="nav-text">func (n *NullBool) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullBool-Value-driver-Value-error"><span class="nav-number">11.2.</span> <span class="nav-text">func (n NullBool) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullByte"><span class="nav-number">12.</span> <span class="nav-text">type NullByte</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullByte-Scan-value-interface-error"><span class="nav-number">12.1.</span> <span class="nav-text">func (n *NullByte) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullByte-Value-driver-Value-error"><span class="nav-number">12.2.</span> <span class="nav-text">func (n NullByte) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullFloat64"><span class="nav-number">13.</span> <span class="nav-text">type NullFloat64</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullFloat64-Scan-value-interface-error"><span class="nav-number">13.1.</span> <span class="nav-text">func (n *NullFloat64) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullFloat64-Value-driver-Value-error"><span class="nav-number">13.2.</span> <span class="nav-text">func (n NullFloat64) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullInt16"><span class="nav-number">14.</span> <span class="nav-text">type NullInt16</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt16-Scan-value-interface-error"><span class="nav-number">14.1.</span> <span class="nav-text">func (n *NullInt16) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt16-Value-driver-Value-error"><span class="nav-number">14.2.</span> <span class="nav-text">func (n NullInt16) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullInt32"><span class="nav-number">15.</span> <span class="nav-text">type NullInt32</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt32-Scan-value-interface-error"><span class="nav-number">15.1.</span> <span class="nav-text">func (n *NullInt32) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt32-Value-driver-Value-error"><span class="nav-number">15.2.</span> <span class="nav-text">func (n NullInt32) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullInt64"><span class="nav-number">16.</span> <span class="nav-text">type NullInt64</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt64-Scan-value-interface-error"><span class="nav-number">16.1.</span> <span class="nav-text">func (n *NullInt64) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullInt64-Value-driver-Value-error"><span class="nav-number">16.2.</span> <span class="nav-text">func (n NullInt64) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullString"><span class="nav-number">17.</span> <span class="nav-text">type NullString</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ns-NullString-Scan-value-interface-error"><span class="nav-number">17.1.</span> <span class="nav-text">func (ns *NullString) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-ns-NullString-Value-driver-Value-error"><span class="nav-number">17.2.</span> <span class="nav-text">func (ns NullString) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-NullTime"><span class="nav-number">18.</span> <span class="nav-text">type NullTime</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullTime-Scan-value-interface-error"><span class="nav-number">18.1.</span> <span class="nav-text">func (n *NullTime) Scan(value interface{}) error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-n-NullTime-Value-driver-Value-error"><span class="nav-number">18.2.</span> <span class="nav-text">func (n NullTime) Value() (driver.Value, error)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Out"><span class="nav-number">19.</span> <span class="nav-text">type Out</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-RawBytes"><span class="nav-number">20.</span> <span class="nav-text">type RawBytes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Result"><span class="nav-number">21.</span> <span class="nav-text">type Result</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Row"><span class="nav-number">22.</span> <span class="nav-text">type Row</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-r-Row-Err-error"><span class="nav-number">22.1.</span> <span class="nav-text">func (r *Row) Err() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-r-Row-Scan-dest-%E2%80%A6interface-error"><span class="nav-number">22.2.</span> <span class="nav-text">func (r *Row) Scan(dest …interface{}) error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Rows"><span class="nav-number">23.</span> <span class="nav-text">type Rows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-Close-error"><span class="nav-number">23.1.</span> <span class="nav-text">func (rs *Rows) Close() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-ColumnTypes-ColumnType-error"><span class="nav-number">23.2.</span> <span class="nav-text">func (rs *Rows) ColumnTypes() ([]*ColumnType, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-Columns-string-error"><span class="nav-number">23.3.</span> <span class="nav-text">func (rs *Rows) Columns() ([]string, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-Err-error"><span class="nav-number">23.4.</span> <span class="nav-text">func (rs *Rows) Err() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-Next-bool"><span class="nav-number">23.5.</span> <span class="nav-text">func (rs *Rows) Next() bool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-NextResultSet-bool"><span class="nav-number">23.6.</span> <span class="nav-text">func (rs *Rows) NextResultSet() bool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-rs-Rows-Scan-dest-%E2%80%A6interface-error"><span class="nav-number">23.7.</span> <span class="nav-text">func (rs *Rows) Scan(dest …interface{}) error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Scanner"><span class="nav-number">24.</span> <span class="nav-text">type Scanner</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Stmt-%E2%98%85%E2%98%85%E2%98%85"><span class="nav-number">25.</span> <span class="nav-text">type Stmt ★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-Close-error"><span class="nav-number">25.1.</span> <span class="nav-text">func (s *Stmt) Close() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-Exec-args-%E2%80%A6interface-Result-error"><span class="nav-number">25.2.</span> <span class="nav-text">func (s *Stmt) Exec(args …interface{}) (Result, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-ExecContext-ctx-context-Context-args-%E2%80%A6interface-Result-error"><span class="nav-number">25.3.</span> <span class="nav-text">func (s *Stmt) ExecContext(ctx context.Context, args …interface{}) (Result, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-Query-args-%E2%80%A6interface-Rows-error"><span class="nav-number">25.4.</span> <span class="nav-text">func (s *Stmt) Query(args …interface{}) (*Rows, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-QueryContext-ctx-context-Context-args-%E2%80%A6interface-Rows-error"><span class="nav-number">25.5.</span> <span class="nav-text">func (s *Stmt) QueryContext(ctx context.Context, args …interface{}) (*Rows, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-QueryRow-args-%E2%80%A6interface-Row"><span class="nav-number">25.6.</span> <span class="nav-text">func (s *Stmt) QueryRow(args …interface{}) *Row</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-s-Stmt-QueryRowContext-ctx-context-Context-args-%E2%80%A6interface-Row"><span class="nav-number">25.7.</span> <span class="nav-text">func (s *Stmt) QueryRowContext(ctx context.Context, args …interface{}) *Row</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-Tx-%E2%98%85%E2%98%85%E2%98%85%E2%98%85%E2%98%85"><span class="nav-number">26.</span> <span class="nav-text">type Tx ★★★★★</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Commit-error"><span class="nav-number">26.1.</span> <span class="nav-text">func (tx *Tx) Commit() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Exec-query-string-args-%E2%80%A6interface-Result-error"><span class="nav-number">26.2.</span> <span class="nav-text">func (tx *Tx) Exec(query string, args …interface{}) (Result, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-ExecContext-ctx-context-Context-query-string-args-%E2%80%A6interface-Result-error"><span class="nav-number">26.3.</span> <span class="nav-text">func (tx *Tx) ExecContext(ctx context.Context, query string, args …interface{}) (Result, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Prepare-query-string-Stmt-error"><span class="nav-number">26.4.</span> <span class="nav-text">func (tx *Tx) Prepare(query string) (*Stmt, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-PrepareContext-ctx-context-Context-query-string-Stmt-error"><span class="nav-number">26.5.</span> <span class="nav-text">func (tx *Tx) PrepareContext(ctx context.Context, query string) (*Stmt, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Query-query-string-args-%E2%80%A6interface-Rows-error"><span class="nav-number">26.6.</span> <span class="nav-text">func (tx *Tx) Query(query string, args …interface{}) (*Rows, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-QueryContext-ctx-context-Context-query-string-args-%E2%80%A6interface-Rows-error"><span class="nav-number">26.7.</span> <span class="nav-text">func (tx *Tx) QueryContext(ctx context.Context, query string, args …interface{}) (*Rows, error)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-QueryRow-query-string-args-%E2%80%A6interface-Row"><span class="nav-number">26.8.</span> <span class="nav-text">func (tx *Tx) QueryRow(query string, args …interface{}) *Row</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-QueryRowContext-ctx-context-Context-query-string-args-%E2%80%A6interface-Row"><span class="nav-number">26.9.</span> <span class="nav-text">func (tx *Tx) QueryRowContext(ctx context.Context, query string, args …interface{}) *Row</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Rollback-error"><span class="nav-number">26.10.</span> <span class="nav-text">func (tx *Tx) Rollback() error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-Stmt-stmt-Stmt-Stmt"><span class="nav-number">26.11.</span> <span class="nav-text">func (tx *Tx) Stmt(stmt *Stmt) *Stmt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#func-tx-Tx-StmtContext-ctx-context-Context-stmt-Stmt-Stmt"><span class="nav-number">26.12.</span> <span class="nav-text">func (tx *Tx) StmtContext(ctx context.Context, stmt *Stmt) *Stmt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type-TxOptions"><span class="nav-number">27.</span> <span class="nav-text">type TxOptions</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E6%A0%87%E5%87%86%E5%BA%93/database/sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="sql | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          sql
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:38:46" itemprop="dateCreated datePublished" datetime="2022-09-24T14:38:46+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/%E6%A0%87%E5%87%86%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">标准库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/%E6%A0%87%E5%87%86%E5%BA%93/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2><h3 id="ErrConnDone"><a href="#ErrConnDone" class="headerlink" title="ErrConnDone"></a>ErrConnDone</h3><p> 在已经提交或回滚的连接上执行的任何操作都会返回 ErrConnDone。 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ErrConnDone = errors.New(<span class="string">&quot;database/sql: connection is already closed&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ErrNoRows"><a href="#ErrNoRows" class="headerlink" title="ErrNoRows"></a>ErrNoRows</h3><p> 当 QueryRow 没有返回行时，Scan 返回 ErrNoRows。在这种情况下，QueryRow 会返回一个占位符* Row 值，该值将推迟发生此错误直到扫描。 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ErrNoRows = errors.New(<span class="string">&quot;sql: no rows in result set&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ErrTxDone"><a href="#ErrTxDone" class="headerlink" title="ErrTxDone"></a>ErrTxDone</h3><p> 对已经提交或回滚的事务执行的任何操作都会返回 ErrTxDone。 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ErrTxDone = errors.New(<span class="string">&quot;sql: Transaction has already been committed or rolled back&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="func-Drivers-string"><a href="#func-Drivers-string" class="headerlink" title="func Drivers() []string"></a>func Drivers() []string</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Drivers</span><span class="params">()</span></span> []<span class="type">string</span></span><br></pre></td></tr></table></figure>

<p> 驱动程序返回已注册驱动程序名称的排序列表。 </p>
<h2 id="func-Register-name-string-driver-driver-Driver"><a href="#func-Register-name-string-driver-driver-Driver" class="headerlink" title="func Register(name string, driver driver.Driver)"></a>func Register(name string, driver driver.Driver)</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Register</span><span class="params">(name <span class="type">string</span>, driver driver.Driver)</span></span></span><br></pre></td></tr></table></figure>

<p> Register 使用提供的名称提供数据库驱动程序。如果使用相同的名称调用 Register 两次，或者驱动程序为零，则会发生混乱。 </p>
<h2 id="type-ColumnType"><a href="#type-ColumnType" class="headerlink" title="type ColumnType"></a>type ColumnType</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rs *Rows)</span></span> ColumnTypes() ([]*ColumnType, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ColumnType <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// 包含过滤或未导出的字段</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ColumnType 包含列的名称和类型。 </p>
<h3 id="func-ColumnType-DatabaseTypeName"><a href="#func-ColumnType-DatabaseTypeName" class="headerlink" title="func (*ColumnType) DatabaseTypeName"></a>func (*ColumnType) DatabaseTypeName</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ci *ColumnType)</span></span> DatabaseTypeName() <span class="type">string</span></span><br></pre></td></tr></table></figure>

<p>DatabaseTypeName 返回列类型的数据库系统名称。如果返回空字符串，则不支持驱动程序类型名称。请查阅您的驱动程序文档以获取驱动程序数据类型列表 不包括长度说明符。常见类型包括 “VARCHAR”，“TEXT”，“NVARCHAR”，“DECIMAL”，“BOOL”，“INT”，“BIGINT”。</p>
<h3 id="func-ColumnType-DecimalSize"><a href="#func-ColumnType-DecimalSize" class="headerlink" title="func (*ColumnType) DecimalSize"></a>func (*ColumnType) DecimalSize</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ci *ColumnType)</span></span> DecimalSize() (precision, scale <span class="type">int64</span>, ok <span class="type">bool</span>)</span><br></pre></td></tr></table></figure>

<p> DecimalSize 返回小数类型的比例和精度。如果不适用或者不支持，那么ok 是错误的。 </p>
<h3 id="func-ColumnType-Length"><a href="#func-ColumnType-Length" class="headerlink" title="func (*ColumnType) Length"></a>func (*ColumnType) Length</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ci *ColumnType)</span></span> Length() (length <span class="type">int64</span>, ok <span class="type">bool</span>)</span><br></pre></td></tr></table></figure>

<p> Length 返回可变长度列类型（如文本和二进制字段类型）的列类型长度。如果类型长度没有限制，则数值为 math.MaxInt64（任何数据库限制仍将适用）。如果列类型不是可变长度，例如 int，或者如果驱动程序不支持，那么 ok 是 false。 </p>
<h3 id="func-ColumnType-Name"><a href="#func-ColumnType-Name" class="headerlink" title="func (*ColumnType) Name"></a>func (*ColumnType) Name</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (ci *<span class="title class_">ColumnType</span>) <span class="title class_">Name</span>() string</span><br></pre></td></tr></table></figure>

<p>Name 返回列的名称或别名。</p>
<h3 id="func-ColumnType-Nullable"><a href="#func-ColumnType-Nullable" class="headerlink" title="func (*ColumnType) Nullable"></a>func (*ColumnType) Nullable</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (ci *<span class="title class_">ColumnType</span>) <span class="title class_">Nullable</span>() (nullable, ok bool)</span><br></pre></td></tr></table></figure>

<p>Nullable 返回列是否可以为 null。如果一个驱动程序不支持这个属性，ok 将会是 false。</p>
<h3 id="func-ColumnType-ScanType"><a href="#func-ColumnType-ScanType" class="headerlink" title="func (*ColumnType) ScanType"></a>func (*ColumnType) ScanType</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (ci *<span class="title class_">ColumnType</span>) <span class="title class_">ScanType</span>() reflect.<span class="property">Type</span></span><br></pre></td></tr></table></figure>

<p>ScanType 使用 Rows.Scan 返回适合扫描的 Go 类型。如果驱动程序不支持此属性，ScanType 将返回空接口的类型。</p>
<h2 id="type-Conn"><a href="#type-Conn" class="headerlink" title="type Conn"></a>type Conn</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Conn(ctx context.Context) (*Conn, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Conn <span class="keyword">struct</span> &#123;        </span><br><span class="line">    <span class="comment">// 包含过滤或未导出的字段</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Conn 代表一个数据库会话而不是一个数据库会话池。除非特别需要连续的单个数据库会话，否则首选运行 DB 查询。</strong></p>
<p>Conn 必须调用 Close 来将连接返回到数据库池，并且可以与正在运行的查询同时进行。</p>
<p>在调用 Close 之后，连接上的所有操作都会因 ErrConnDone 而失败。</p>
<h3 id="func-Conn-BeginTx"><a href="#func-Conn-BeginTx" class="headerlink" title="func (*Conn) BeginTx"></a>func (*Conn) BeginTx</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">BeginTx</span>(ctx context.<span class="property">Context</span>, opts *<span class="title class_">TxOptions</span>) (*<span class="title class_">Tx</span>, error)</span><br></pre></td></tr></table></figure>

<p>BeginTx 开始一个事务。</p>
<p>提供的上下文用于事务提交或回滚之前。如果上下文被取消，sql包将回滚事务。如果提供给 BeginTx 的上下文被取消，则Tx.Commit 将返回错误。</p>
<p>提供的 TxOptions 是可选的，如果应该使用默认值，则可能为零。如果使用驱动程序不支持的非默认隔离级别，则会返回错误。</p>
<h3 id="func-Conn-Close"><a href="#func-Conn-Close" class="headerlink" title="func (*Conn) Close"></a>func (*Conn) Close</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">Close</span>() error</span><br></pre></td></tr></table></figure>

<p>Close 将连接返回到连接池。Close 后的所有操作都将返回ErrConnDone。Close 是安全地与其他操作同时进行，并会阻止，直到所有其他操作完成。首先取消使用的上下文，然后直接调用 close 可能会很有用。</p>
<h3 id="func-Conn-ExecContext"><a href="#func-Conn-ExecContext" class="headerlink" title="func (*Conn) ExecContext"></a>func (*Conn) ExecContext</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">ExecContext</span>(ctx context.<span class="property">Context</span>, query string, args ...interface&#123;&#125;) (<span class="title class_">Result</span>, error)</span><br></pre></td></tr></table></figure>

<p> ExecContext 执行查询而不返回任何行。这些参数用于查询中的任何占位符参数。 </p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"> <span class="string">&quot;context&quot;</span></span><br><span class="line"> <span class="string">&quot;database/sql&quot;</span></span><br><span class="line"> <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line"> ctx context.Context</span><br><span class="line"> db  *sql.DB</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"> <span class="comment">// A *DB is a pool of connections. Call Conn to reserve a connection for</span></span><br><span class="line"> <span class="comment">// exclusive use.</span></span><br><span class="line"> conn, err := db.Conn(ctx)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Fatal(err)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> conn.Close() <span class="comment">// Return the connection to the pool.</span></span><br><span class="line"> id := <span class="number">41</span></span><br><span class="line"> result, err := conn.ExecContext(ctx, <span class="string">`UPDATE balances SET balance = balance + 10 WHERE user_id = ?;`</span>, id)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Fatal(err)</span><br><span class="line"> &#125;</span><br><span class="line"> rows, err := result.RowsAffected()</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Fatal(err)</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> rows != <span class="number">1</span> &#123;</span><br><span class="line">  log.Fatalf(<span class="string">&quot;expected single row affected, got %d rows affected&quot;</span>, rows)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="func-Conn-PingContext"><a href="#func-Conn-PingContext" class="headerlink" title="func (*Conn) PingContext"></a>func (*Conn) PingContext</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">PingContext</span>(ctx context.<span class="property">Context</span>) error</span><br></pre></td></tr></table></figure>

<p>PingContext 验证到数据库的连接是否仍然存在。</p>
<h3 id="func-Conn-PrepareContext"><a href="#func-Conn-PrepareContext" class="headerlink" title="func (*Conn) PrepareContext"></a>func (*Conn) PrepareContext</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">PrepareContext</span>(ctx context.<span class="property">Context</span>, query string) (*<span class="title class_">Stmt</span>, error)</span><br></pre></td></tr></table></figure>

<p>PrepareContext 为以后的查询或执行创建一个准备好的语句。可以从返回的语句中同时运行多个查询或执行。当语句不再需要时，调用者必须调用语句的 Close 方法。</p>
<p>提供的上下文用于编写声明，而不用于执行声明。</p>
<h3 id="func-Conn-QueryContext"><a href="#func-Conn-QueryContext" class="headerlink" title="func (*Conn) QueryContext"></a>func (*Conn) QueryContext</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">QueryContext</span>(ctx context.<span class="property">Context</span>, query string, args ...interface&#123;&#125;) (*<span class="title class_">Rows</span>, error)</span><br></pre></td></tr></table></figure>

<p>QueryContext 执行一个返回行的查询，通常是一个 SELECT。该参数适用于查询中的任何占位符参数。</p>
<h3 id="func-Conn-QueryRowContext"><a href="#func-Conn-QueryRowContext" class="headerlink" title="func (*Conn) QueryRowContext"></a>func (*Conn) QueryRowContext</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *<span class="title class_">Conn</span>) <span class="title class_">QueryRowContext</span>(ctx context.<span class="property">Context</span>, query string, args ...interface&#123;&#125;) *<span class="title class_">Row</span></span><br></pre></td></tr></table></figure>

<p>QueryRowContext 执行一个预计最多只返回一行的查询。QueryRowContext 总是返回一个非零值。错误被推迟到行的扫描方法被调用。如果查询未选择行，则*Row 的扫描将返回错误号。否则，*Row 的扫描将扫描第一个选定的行并丢弃其余行。</p>
<h4 id="func-Conn-Raw"><a href="#func-Conn-Raw" class="headerlink" title="func (*Conn) Raw"></a>func (*Conn) Raw</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (c *Conn) Raw(f func(driverConn interface&#123;&#125;) error) (err error)</span><br></pre></td></tr></table></figure>

<p>Raw executes f exposing the underlying driver connection for the duration of f. The driverConn must not be used outside of f. </p>
<p>Once f returns and err is nil, the Conn will continue to be usable until Conn.Close is called. </p>
<p>Raw执行f暴露底层驱动连接的持续时间。driverConn不能在f之外使用。一旦f返回并且err为nil, Conn将继续可用，直到Conn. close被调用。</p>
<h2 id="type-DB-★★★★★"><a href="#type-DB-★★★★★" class="headerlink" title="type DB  ★★★★★"></a>type DB  ★★★★★</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DB <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DB是一个数据库句柄，表示一个包含零个或多个底层连接的池。多个 goroutine 并发使用是安全的。</p>
<p>sql 包自动创建并释放连接；它也保持空闲连接的空闲池。如果数据库具有每个连接状态的概念，则只能在事务内可靠地观察到这种状态。一旦 DB.Begin  被调用，返回的 Tx 就绑定到单个连接。在事务上调用 Commit 或 Rollback  后，该事务的连接将返回到数据库的空闲连接池。池的大小可以通过  SetMaxIdleConns 进行控制。</p>
<h3 id="func-Open"><a href="#func-Open" class="headerlink" title="func Open"></a>func Open</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(driverName, dataSourceName <span class="type">string</span>)</span></span> (*DB, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<p>Open 打开一个由其数据库驱动程序名称和驱动程序特定的数据源名称指定的数据库，通常由至少一个数据库名称和连接信息组成。</p>
<p>大多数用户将通过驱动程序特定的连接帮助程序函数打开数据库，该函数返回一个 *DB。Go标准库中不包含数据库驱动程序。有关第三方驱动程序的列表，请参阅<a target="_blank" rel="noopener" href="https://golang.org/s/sqldrivers%E3%80%82">https://golang.org/s/sqldrivers。</a></p>
<p>Open 可能只是验证其参数而不创建与数据库的连接。要验证数据源名称是否有效，请调用 Ping。</p>
<p>返回的数据库对于多个 goroutine 的并发使用是安全的，并保持其自己的空闲连接池。因此，Open 函数应该只调用一次。很少有必要关闭数据库。</p>
<h3 id="func-DB-Begin"><a href="#func-DB-Begin" class="headerlink" title="func (*DB) Begin"></a>func (*DB) Begin</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Begin() (*Tx, <span class="type">error</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> db.BeginTx(context.Background(), <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> Begin 开始一个事务。默认隔离级别取决于驱动程序。 </p>
<h3 id="func-DB-BeginTx"><a href="#func-DB-BeginTx" class="headerlink" title="func (*DB) BeginTx"></a>func (*DB) BeginTx</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> BeginTx(ctx context.Context, opts *TxOptions) (*Tx, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<p>BeginTx 开始一个事务。</p>
<p>提供的上下文用于事务提交或回滚之前。如果上下文被取消，sql包将回滚事务。如果提供给 BeginTx 的上下文被取消，则Tx.Commit 将返回错误。</p>
<p>提供的 TxOptions 是可选的，如果应该使用默认值，则可能为零。如果使用驱动程序不支持的非默认隔离级别，则会返回错误。</p>
<h3 id="func-DB-Close"><a href="#func-DB-Close" class="headerlink" title="func (*DB) Close"></a>func (*DB) Close</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Close() <span class="type">error</span></span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-Conn"><a href="#func-db-DB-Conn" class="headerlink" title="func (db *DB) Conn"></a>func (db *DB) Conn</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Conn(ctx context.Context) (*Conn, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<p>返回单个连接。</p>
<h3 id="func-db-DB-Driver"><a href="#func-db-DB-Driver" class="headerlink" title="func (db *DB) Driver"></a>func (db *DB) Driver</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Driver() driver.Driver</span><br></pre></td></tr></table></figure>

<p> Driver 返回数据库的底层驱动程序。 </p>
<h3 id="func-db-DB-Exec"><a href="#func-db-DB-Exec" class="headerlink" title="func (db *DB) Exec"></a>func (db *DB) Exec</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Exec(query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) (Result, <span class="type">error</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> db.ExecContext(context.Background(), query, args...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Exec 执行写语句，不返回任何rows。该参数适用于查询中的任何占位符参数。 </p>
<h3 id="func-db-DB-ExecContext"><a href="#func-db-DB-ExecContext" class="headerlink" title="func (db *DB) ExecContext"></a>func (db *DB) ExecContext</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> ExecContext(ctx context.Context, query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) (Result, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-Ping"><a href="#func-db-DB-Ping" class="headerlink" title="func (db *DB) Ping"></a>func (db *DB) Ping</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Ping() <span class="type">error</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> db.PingContext(context.Background())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ping 验证与数据库的连接仍然存在，并在必要时建立连接。 </p>
<h3 id="func-db-DB-PingContext"><a href="#func-db-DB-PingContext" class="headerlink" title="func (db *DB) PingContext"></a>func (db *DB) PingContext</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> PingContext(ctx context.Context) <span class="type">error</span></span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-Prepare"><a href="#func-db-DB-Prepare" class="headerlink" title="func (db *DB) Prepare"></a>func (db *DB) Prepare</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Prepare(query <span class="type">string</span>) (*Stmt, <span class="type">error</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> db.PrepareContext(context.Background(), query)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Prepare</code> 方法实现<strong>预处理</strong>操作：先将sql语句发送给MySQL服务端，返回一个准备好的状态用于之后的查询和命令。返回值可以同时执行多个查询和命令。 </p>
<p>读操作 预处理示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预处理查询示例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prepareQueryDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line"> sqlStr := <span class="string">&quot;select id, name, age from user where id &gt; ?&quot;</span></span><br><span class="line"> stmt, err := db.Prepare(sqlStr)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;prepare failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> stmt.Close()</span><br><span class="line"> rows, err := stmt.Query(<span class="number">0</span>)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;query failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> rows.Close()</span><br><span class="line"> <span class="comment">// 循环读取结果集中的数据</span></span><br><span class="line"> <span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">  <span class="keyword">var</span> u user</span><br><span class="line">  err := rows.Scan(&amp;u.id, &amp;u.name, &amp;u.age)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;scan failed, err:%v\n&quot;</span>, err)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;id:%d name:%s age:%d\n&quot;</span>, u.id, u.name, u.age)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写操作 预处理也时分类似，示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预处理插入示例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prepareInsertDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line"> sqlStr := <span class="string">&quot;insert into user(name, age) values (?,?)&quot;</span></span><br><span class="line"> stmt, err := db.Prepare(sqlStr)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;prepare failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">defer</span> stmt.Close()</span><br><span class="line"> _, err = stmt.Exec(<span class="string">&quot;小王子&quot;</span>, <span class="number">18</span>)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;insert failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> _, err = stmt.Exec(<span class="string">&quot;沙河娜扎&quot;</span>, <span class="number">18</span>)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;insert failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> fmt.Println(<span class="string">&quot;insert success.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-PrepareContext"><a href="#func-db-DB-PrepareContext" class="headerlink" title="func (db *DB) PrepareContext"></a>func (db *DB) PrepareContext</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> PrepareContext(ctx context.Context, query <span class="type">string</span>) (*Stmt, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-Query"><a href="#func-db-DB-Query" class="headerlink" title="func (db *DB) Query"></a>func (db *DB) Query</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Query(query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) (*Rows, <span class="type">error</span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> db.QueryContext(context.Background(), query, args...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>多行查询</strong>：执行一次查询，返回多行结果（即Rows），一般用于执行select命令。参数args表示query中的占位参数。 </p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询多条数据示例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryMultiRowDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line"> sqlStr := <span class="string">&quot;select id, name, age from user where id &gt; ?&quot;</span></span><br><span class="line"> rows, err := db.Query(sqlStr, <span class="number">0</span>)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;query failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// 非常重要：关闭rows释放持有的数据库链接</span></span><br><span class="line"> <span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 循环读取结果集中的数据</span></span><br><span class="line"> <span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">  <span class="keyword">var</span> u user</span><br><span class="line">  err := rows.Scan(&amp;u.id, &amp;u.name, &amp;u.age)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;scan failed, err:%v\n&quot;</span>, err)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;id:%d name:%s age:%d\n&quot;</span>, u.id, u.name, u.age)</span><br><span class="line"> &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-QueryContext"><a href="#func-db-DB-QueryContext" class="headerlink" title="func (db *DB) QueryContext"></a>func (db *DB) QueryContext</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> QueryContext(ctx context.Context, query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) (*Rows, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-QueryRow"><a href="#func-db-DB-QueryRow" class="headerlink" title="func (db *DB) QueryRow"></a>func (db *DB) QueryRow</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> QueryRowContext(ctx context.Context, query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) *Row &#123;</span><br><span class="line"> rows, err := db.QueryContext(ctx, query, args...)</span><br><span class="line"> <span class="keyword">return</span> &amp;Row&#123;rows: rows, err: err&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>单行查询</strong>：执行一次查询，并期望返回最多一行结果（即Row）。QueryRow总是返回非nil的值，直到返回值的Scan方法被调用时，才会返回被延迟的错误。（如：未找到结果） </p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询单条数据示例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">queryRowDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line"> sqlStr := <span class="string">&quot;select id, name, age from user where id=?&quot;</span></span><br><span class="line"> <span class="keyword">var</span> u user</span><br><span class="line"> <span class="comment">// 非常重要：确保QueryRow之后调用Scan方法，否则持有的数据库链接不会被释放</span></span><br><span class="line"> err := db.QueryRow(sqlStr, <span class="number">1</span>).Scan(&amp;u.id, &amp;u.name, &amp;u.age)</span><br><span class="line"> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;scan failed, err:%v\n&quot;</span>, err)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br><span class="line"> fmt.Printf(<span class="string">&quot;id:%d name:%s age:%d\n&quot;</span>, u.id, u.name, u.age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-QueryRowContext"><a href="#func-db-DB-QueryRowContext" class="headerlink" title="func (db *DB) QueryRowContext"></a>func (db *DB) QueryRowContext</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> QueryRowContext(ctx context.Context, query <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) *Row</span><br></pre></td></tr></table></figure>

<h3 id="func-db-DB-SetConnMaxIdleTime"><a href="#func-db-DB-SetConnMaxIdleTime" class="headerlink" title="func (db *DB) SetConnMaxIdleTime"></a>func (db *DB) SetConnMaxIdleTime</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> SetConnMaxIdleTime(d time.Duration)</span><br></pre></td></tr></table></figure>

<p>设置连接空闲的最大时间。过期的连接在复用之前可能会被延迟关闭。如果d &lt;&#x3D; 0，则连接不会因为空闲时间而关闭。</p>
<h3 id="func-db-DB-SetConnMaxLifetime"><a href="#func-db-DB-SetConnMaxLifetime" class="headerlink" title="func (db *DB) SetConnMaxLifetime"></a>func (db *DB) SetConnMaxLifetime</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> SetConnMaxLifetime(d time.Duration)</span><br></pre></td></tr></table></figure>

<p>设置连接的存活时间。过期的连接在复用之前可能会被延迟关闭。如果d &lt;&#x3D; 0，则连接不会因为连接的年龄而关闭。</p>
<h3 id="func-db-DB-SetMaxIdleConns"><a href="#func-db-DB-SetMaxIdleConns" class="headerlink" title="func (db *DB) SetMaxIdleConns"></a>func (db *DB) SetMaxIdleConns</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> SetMaxIdleConns(n <span class="type">int</span>)</span><br></pre></td></tr></table></figure>

<p>设置空闲连接池中的最大连接数。如果MaxOpenConns大于0但小于新的MaxIdleConns，那么新的MaxIdleConns将被减少以匹配MaxOpenConns限制。</p>
<p>如果n &lt;&#x3D; 0，则不保留空闲连接。</p>
<p>缺省的最大空闲连接数是2。这可能会在未来的版本中改变。</p>
<h3 id="func-db-DB-SetMaxOpenConns"><a href="#func-db-DB-SetMaxOpenConns" class="headerlink" title="func (db *DB) SetMaxOpenConns"></a>func (db *DB) SetMaxOpenConns</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> SetMaxOpenConns(n <span class="type">int</span>)</span><br></pre></td></tr></table></figure>

<p>设置到数据库的最大打开连接数。</p>
<p>如果MaxIdleConns大于0并且新的MaxOpenConns小于MaxIdleConns，那么MaxIdleConns将被减少以匹配新的MaxOpenConns限制。</p>
<p>如果n &lt;&#x3D; 0，则没有打开连接的数量限制。默认值是0(无限)。</p>
<h3 id="func-db-DB-Stats-DBStats"><a href="#func-db-DB-Stats-DBStats" class="headerlink" title="func (db *DB) Stats() DBStats"></a>func (db *DB) Stats() DBStats</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Stats() DBStats</span><br></pre></td></tr></table></figure>

<p> Stats 返回数据库统计信息 </p>
<h2 id="关于-Conn-和-DB"><a href="#关于-Conn-和-DB" class="headerlink" title="关于 Conn 和 DB"></a>关于 Conn 和 DB</h2><p>Conn是一个连接，而DB是一个连接池，一般情况下使用DB就行，例如 <code>db.Begin()</code> ，查看源码实现可知：等同于 <code>conn.BeginTx(Context.Background(), nil)</code> ，后者需要手动调用<code>conn.Close()</code>，前者会自动调用<code>conn.Close()</code>。</p>
<h2 id="type-DBStats"><a href="#type-DBStats" class="headerlink" title="type DBStats"></a>type DBStats</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(db *DB)</span></span> Stats() DBStats</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DBStats <span class="keyword">struct</span> &#123;</span><br><span class="line"> MaxOpenConnections <span class="type">int</span> <span class="comment">// Maximum number of open connections to the database.</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// Pool Status</span></span><br><span class="line"> OpenConnections <span class="type">int</span> <span class="comment">// The number of established connections both in use and idle.</span></span><br><span class="line"> InUse           <span class="type">int</span> <span class="comment">// The number of connections currently in use.</span></span><br><span class="line"> Idle            <span class="type">int</span> <span class="comment">// The number of idle connections.</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// Counters</span></span><br><span class="line"> WaitCount         <span class="type">int64</span>         <span class="comment">// The total number of connections waited for.</span></span><br><span class="line"> WaitDuration      time.Duration <span class="comment">// The total time blocked waiting for a new connection.</span></span><br><span class="line"> MaxIdleClosed     <span class="type">int64</span>         <span class="comment">// The total number of connections closed due to SetMaxIdleConns.</span></span><br><span class="line"> MaxIdleTimeClosed <span class="type">int64</span>         <span class="comment">// The total number of connections closed due to SetConnMaxIdleTime.</span></span><br><span class="line"> MaxLifetimeClosed <span class="type">int64</span>         <span class="comment">// The total number of connections closed due to SetConnMaxLifetime.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> DBStats 包含数据库统计信息。 </p>
<h2 id="type-IsolationLevel"><a href="#type-IsolationLevel" class="headerlink" title="type IsolationLevel"></a>type IsolationLevel</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IsolationLevel <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line"> LevelDefault IsolationLevel = <span class="literal">iota</span></span><br><span class="line"> LevelReadUncommitted</span><br><span class="line"> LevelReadCommitted</span><br><span class="line"> LevelWriteCommitted</span><br><span class="line"> LevelRepeatableRead</span><br><span class="line"> LevelSnapshot</span><br><span class="line"> LevelSerializable</span><br><span class="line"> LevelLinearizable</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p> IsolationLevel 是 TxOptions 中使用的事务隔离级别。 </p>
<p> BeginTx 中驱动程序可能支持的各种隔离级别。如果驱动程序不支持给定的隔离级别，则可能会返回错误。 </p>
<p> <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Isolation_levels">https://en.wikipedia.org/wiki/Isolation_(database_systems)#Isolation_levels</a>.  </p>
<h3 id="func-i-IsolationLevel-String-string"><a href="#func-i-IsolationLevel-String-string" class="headerlink" title="func (i IsolationLevel) String() string"></a>func (i IsolationLevel) String() string</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i IsolationLevel)</span></span> String() <span class="type">string</span></span><br></pre></td></tr></table></figure>

<p>返回事务隔离级别的名称。 </p>
<h2 id="type-NamedArg"><a href="#type-NamedArg" class="headerlink" title="type NamedArg"></a>type NamedArg</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NamedArg <span class="keyword">struct</span> &#123;</span><br><span class="line"> Name <span class="type">string</span></span><br><span class="line"> Value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>NamedArg 是一个命名参数。NamedArg 值可以用作 Query 或Exec 的参数，并绑定到 SQL 语句中的相应命名参数。 </p>
<h3 id="func-Named"><a href="#func-Named" class="headerlink" title="func Named"></a>func Named</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Named</span><span class="params">(name <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> NamedArg</span><br></pre></td></tr></table></figure>

<p>Named 提供了一种更简洁的方式来创建 NamedArg 值。 </p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.ExecContext(ctx, <span class="string">`</span></span><br><span class="line"><span class="string">    delete from Invoice</span></span><br><span class="line"><span class="string">    where</span></span><br><span class="line"><span class="string">        TimeCreated &lt; @end</span></span><br><span class="line"><span class="string">        and TimeCreated &gt;= @start;`</span>,</span><br><span class="line">    sql.Named(<span class="string">&quot;start&quot;</span>, startTime),</span><br><span class="line">    sql.Named(<span class="string">&quot;end&quot;</span>, endTime),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="type-NullBool"><a href="#type-NullBool" class="headerlink" title="type NullBool"></a>type NullBool</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NullBool <span class="keyword">struct</span> &#123;</span><br><span class="line"> Bool  <span class="type">bool</span></span><br><span class="line"> Valid <span class="type">bool</span> <span class="comment">// Valid is true if Bool is not NULL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="func-n-NullBool-Scan-value-interface-error"><a href="#func-n-NullBool-Scan-value-interface-error" class="headerlink" title="func (n *NullBool) Scan(value interface{}) error"></a>func (n *NullBool) Scan(value interface{}) error</h3><h3 id="func-n-NullBool-Value-driver-Value-error"><a href="#func-n-NullBool-Value-driver-Value-error" class="headerlink" title="func (n NullBool) Value() (driver.Value, error)"></a>func (n NullBool) Value() (driver.Value, error)</h3><h2 id="type-NullByte"><a href="#type-NullByte" class="headerlink" title="type NullByte"></a>type NullByte</h2><h3 id="func-n-NullByte-Scan-value-interface-error"><a href="#func-n-NullByte-Scan-value-interface-error" class="headerlink" title="func (n *NullByte) Scan(value interface{}) error"></a>func (n *NullByte) Scan(value interface{}) error</h3><h3 id="func-n-NullByte-Value-driver-Value-error"><a href="#func-n-NullByte-Value-driver-Value-error" class="headerlink" title="func (n NullByte) Value() (driver.Value, error)"></a>func (n NullByte) Value() (driver.Value, error)</h3><h2 id="type-NullFloat64"><a href="#type-NullFloat64" class="headerlink" title="type NullFloat64"></a>type NullFloat64</h2><h3 id="func-n-NullFloat64-Scan-value-interface-error"><a href="#func-n-NullFloat64-Scan-value-interface-error" class="headerlink" title="func (n *NullFloat64) Scan(value interface{}) error"></a>func (n *NullFloat64) Scan(value interface{}) error</h3><h3 id="func-n-NullFloat64-Value-driver-Value-error"><a href="#func-n-NullFloat64-Value-driver-Value-error" class="headerlink" title="func (n NullFloat64) Value() (driver.Value, error)"></a>func (n NullFloat64) Value() (driver.Value, error)</h3><h2 id="type-NullInt16"><a href="#type-NullInt16" class="headerlink" title="type NullInt16"></a>type NullInt16</h2><h3 id="func-n-NullInt16-Scan-value-interface-error"><a href="#func-n-NullInt16-Scan-value-interface-error" class="headerlink" title="func (n *NullInt16) Scan(value interface{}) error"></a>func (n *NullInt16) Scan(value interface{}) error</h3><h3 id="func-n-NullInt16-Value-driver-Value-error"><a href="#func-n-NullInt16-Value-driver-Value-error" class="headerlink" title="func (n NullInt16) Value() (driver.Value, error)"></a>func (n NullInt16) Value() (driver.Value, error)</h3><h2 id="type-NullInt32"><a href="#type-NullInt32" class="headerlink" title="type NullInt32"></a>type NullInt32</h2><h3 id="func-n-NullInt32-Scan-value-interface-error"><a href="#func-n-NullInt32-Scan-value-interface-error" class="headerlink" title="func (n *NullInt32) Scan(value interface{}) error"></a>func (n *NullInt32) Scan(value interface{}) error</h3><h3 id="func-n-NullInt32-Value-driver-Value-error"><a href="#func-n-NullInt32-Value-driver-Value-error" class="headerlink" title="func (n NullInt32) Value() (driver.Value, error)"></a>func (n NullInt32) Value() (driver.Value, error)</h3><h2 id="type-NullInt64"><a href="#type-NullInt64" class="headerlink" title="type NullInt64"></a>type NullInt64</h2><h3 id="func-n-NullInt64-Scan-value-interface-error"><a href="#func-n-NullInt64-Scan-value-interface-error" class="headerlink" title="func (n *NullInt64) Scan(value interface{}) error"></a>func (n *NullInt64) Scan(value interface{}) error</h3><h3 id="func-n-NullInt64-Value-driver-Value-error"><a href="#func-n-NullInt64-Value-driver-Value-error" class="headerlink" title="func (n NullInt64) Value() (driver.Value, error)"></a>func (n NullInt64) Value() (driver.Value, error)</h3><h2 id="type-NullString"><a href="#type-NullString" class="headerlink" title="type NullString"></a>type NullString</h2><h3 id="func-ns-NullString-Scan-value-interface-error"><a href="#func-ns-NullString-Scan-value-interface-error" class="headerlink" title="func (ns *NullString) Scan(value interface{}) error"></a>func (ns *NullString) Scan(value interface{}) error</h3><h3 id="func-ns-NullString-Value-driver-Value-error"><a href="#func-ns-NullString-Value-driver-Value-error" class="headerlink" title="func (ns NullString) Value() (driver.Value, error)"></a>func (ns NullString) Value() (driver.Value, error)</h3><h2 id="type-NullTime"><a href="#type-NullTime" class="headerlink" title="type NullTime"></a>type NullTime</h2><h3 id="func-n-NullTime-Scan-value-interface-error"><a href="#func-n-NullTime-Scan-value-interface-error" class="headerlink" title="func (n *NullTime) Scan(value interface{}) error"></a>func (n *NullTime) Scan(value interface{}) error</h3><h3 id="func-n-NullTime-Value-driver-Value-error"><a href="#func-n-NullTime-Value-driver-Value-error" class="headerlink" title="func (n NullTime) Value() (driver.Value, error)"></a>func (n NullTime) Value() (driver.Value, error)</h3><h2 id="type-Out"><a href="#type-Out" class="headerlink" title="type Out"></a>type Out</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Out <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Dest is a pointer to the value that will be set to the result of the</span></span><br><span class="line"> <span class="comment">// stored procedure&#x27;s OUTPUT parameter.</span></span><br><span class="line"> Dest <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// In is whether the parameter is an INOUT parameter. If so, the input value to the stored</span></span><br><span class="line"> <span class="comment">// procedure is the dereferenced value of Dest&#x27;s pointer, which is then replaced with</span></span><br><span class="line"> <span class="comment">// the output value.</span></span><br><span class="line"> In <span class="type">bool</span></span><br><span class="line"> <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Out 可用于从存储过程中检索 OUTPUT 值参数。</p>
<p>并非所有驱动程序和数据库都支持 OUTPUT 值参数。</p>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> outArg <span class="type">string</span></span><br><span class="line">_, err := db.ExecContext(ctx, <span class="string">&quot;ProcName&quot;</span>, sql.Named(<span class="string">&quot;Arg1&quot;</span>, sql.Out&#123;Dest: &amp;outArg&#125;))</span><br></pre></td></tr></table></figure>

<h2 id="type-RawBytes"><a href="#type-RawBytes" class="headerlink" title="type RawBytes"></a>type RawBytes</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> RawBytes []<span class="type">byte</span></span><br></pre></td></tr></table></figure>

<p>RawBytes 保存对数据库本身拥有的内存的引用。在扫描到RawBytes后，该切片只有在下一次调用next、Scan或Close时才有效。 </p>
<h2 id="type-Result"><a href="#type-Result" class="headerlink" title="type Result"></a>type Result</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Result <span class="keyword">interface</span> &#123;</span><br><span class="line"> <span class="comment">// LastInsertId returns the integer generated by the database</span></span><br><span class="line"> <span class="comment">// in response to a command. Typically this will be from an</span></span><br><span class="line"> <span class="comment">// &quot;auto increment&quot; column when inserting a new row. Not all</span></span><br><span class="line"> <span class="comment">// databases support this feature, and the syntax of such</span></span><br><span class="line"> <span class="comment">// statements varies.</span></span><br><span class="line"> LastInsertId() (<span class="type">int64</span>, <span class="type">error</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// RowsAffected returns the number of rows affected by an</span></span><br><span class="line"> <span class="comment">// update, insert, or delete. Not every database or database</span></span><br><span class="line"> <span class="comment">// driver may support this.</span></span><br><span class="line"> RowsAffected() (<span class="type">int64</span>, <span class="type">error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> Result  汇总了已执行的SQL语句。</p>
<h2 id="type-Row"><a href="#type-Row" class="headerlink" title="type Row"></a>type Row</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Row <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// One of these two will be non-nil:</span></span><br><span class="line"> err  <span class="type">error</span> <span class="comment">// deferred error for easy chaining</span></span><br><span class="line"> rows *Rows</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单行查询<code>db.QueryRow()</code>执行一次查询，并期望返回最多一行结果（即Row）。QueryRow总是返回非nil的值，直到返回值的Scan方法被调用时，才会返回被延迟的错误。（如：未找到结果） </p>
<h3 id="func-r-Row-Err-error"><a href="#func-r-Row-Err-error" class="headerlink" title="func (r *Row) Err() error"></a>func (r *Row) Err() error</h3><h3 id="func-r-Row-Scan-dest-…interface-error"><a href="#func-r-Row-Scan-dest-…interface-error" class="headerlink" title="func (r *Row) Scan(dest …interface{}) error"></a>func (r *Row) Scan(dest …interface{}) error</h3><h2 id="type-Rows"><a href="#type-Rows" class="headerlink" title="type Rows"></a>type Rows</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Rows <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// 包含过滤或未导出的字段</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>多行查询<code>db.Query()</code>执行一次查询，返回多行结果（即Rows），一般用于执行select命令。参数args表示query中的占位参数。 </p>
<p>Rows is the result of a query. It’s cursor starts before the first row of the result set. Use Next to advance from row to row.  </p>
<h3 id="func-rs-Rows-Close-error"><a href="#func-rs-Rows-Close-error" class="headerlink" title="func (rs *Rows) Close() error"></a>func (rs *Rows) Close() error</h3><h3 id="func-rs-Rows-ColumnTypes-ColumnType-error"><a href="#func-rs-Rows-ColumnTypes-ColumnType-error" class="headerlink" title="func (rs *Rows) ColumnTypes() ([]*ColumnType, error)"></a>func (rs *Rows) ColumnTypes() ([]*ColumnType, error)</h3><h3 id="func-rs-Rows-Columns-string-error"><a href="#func-rs-Rows-Columns-string-error" class="headerlink" title="func (rs *Rows) Columns() ([]string, error)"></a>func (rs *Rows) Columns() ([]string, error)</h3><h3 id="func-rs-Rows-Err-error"><a href="#func-rs-Rows-Err-error" class="headerlink" title="func (rs *Rows) Err() error"></a>func (rs *Rows) Err() error</h3><h3 id="func-rs-Rows-Next-bool"><a href="#func-rs-Rows-Next-bool" class="headerlink" title="func (rs *Rows) Next() bool"></a>func (rs *Rows) Next() bool</h3><h3 id="func-rs-Rows-NextResultSet-bool"><a href="#func-rs-Rows-NextResultSet-bool" class="headerlink" title="func (rs *Rows) NextResultSet() bool"></a>func (rs *Rows) NextResultSet() bool</h3><h3 id="func-rs-Rows-Scan-dest-…interface-error"><a href="#func-rs-Rows-Scan-dest-…interface-error" class="headerlink" title="func (rs *Rows) Scan(dest …interface{}) error"></a>func (rs *Rows) Scan(dest …interface{}) error</h3><h2 id="type-Scanner"><a href="#type-Scanner" class="headerlink" title="type Scanner"></a>type Scanner</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Scanner <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// Scan方法从数据库驱动获取一个值。</span></span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// 参数src的类型保证为如下类型之一：</span></span><br><span class="line">    <span class="comment">//    int64</span></span><br><span class="line">    <span class="comment">//    float64</span></span><br><span class="line">    <span class="comment">//    bool</span></span><br><span class="line">    <span class="comment">//    []byte</span></span><br><span class="line">    <span class="comment">//    string</span></span><br><span class="line">    <span class="comment">//    time.Time</span></span><br><span class="line">    <span class="comment">//    nil - 表示NULL值</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 如果不能不丢失信息的保存一个值，应返回错误。</span></span><br><span class="line"> Scan(src <span class="keyword">interface</span>&#123;&#125;) <span class="type">error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Scanner接口会被Rows或Row等的Scan方法使用。</p>
<p>任何实现了Scanner接口的类型，都可以通过定义自己的Scan函数来处理空值问题，比如：</p>
<ul>
<li>Rows或Row的Scan方法其实就是实现从数据库驱动中获取一个值(该值会转换成src的类型)，并将其存储到src，src满足driver.Value类型</li>
<li>而NullString、NullBool等的Scan方法则是将输入的值转换成对应的NullString、NullBool类型并存储下来</li>
</ul>
<h2 id="type-Stmt-★★★"><a href="#type-Stmt-★★★" class="headerlink" title="type Stmt ★★★"></a>type Stmt ★★★</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Stmt <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>stmt &#x3D; statement，声明，Stmt是一个准备好的声明。Stmt 对于多个 goroutines 并发使用是安全的。 </p>
<h3 id="func-s-Stmt-Close-error"><a href="#func-s-Stmt-Close-error" class="headerlink" title="func (s *Stmt) Close() error"></a>func (s *Stmt) Close() error</h3><h3 id="func-s-Stmt-Exec-args-…interface-Result-error"><a href="#func-s-Stmt-Exec-args-…interface-Result-error" class="headerlink" title="func (s *Stmt) Exec(args …interface{}) (Result, error)"></a>func (s *Stmt) Exec(args …interface{}) (Result, error)</h3><h3 id="func-s-Stmt-ExecContext-ctx-context-Context-args-…interface-Result-error"><a href="#func-s-Stmt-ExecContext-ctx-context-Context-args-…interface-Result-error" class="headerlink" title="func (s *Stmt) ExecContext(ctx context.Context, args …interface{}) (Result, error)"></a>func (s *Stmt) ExecContext(ctx context.Context, args …interface{}) (Result, error)</h3><h3 id="func-s-Stmt-Query-args-…interface-Rows-error"><a href="#func-s-Stmt-Query-args-…interface-Rows-error" class="headerlink" title="func (s *Stmt) Query(args …interface{}) (*Rows, error)"></a>func (s *Stmt) Query(args …interface{}) (*Rows, error)</h3><h3 id="func-s-Stmt-QueryContext-ctx-context-Context-args-…interface-Rows-error"><a href="#func-s-Stmt-QueryContext-ctx-context-Context-args-…interface-Rows-error" class="headerlink" title="func (s *Stmt) QueryContext(ctx context.Context, args …interface{}) (*Rows, error)"></a>func (s *Stmt) QueryContext(ctx context.Context, args …interface{}) (*Rows, error)</h3><h3 id="func-s-Stmt-QueryRow-args-…interface-Row"><a href="#func-s-Stmt-QueryRow-args-…interface-Row" class="headerlink" title="func (s *Stmt) QueryRow(args …interface{}) *Row"></a>func (s *Stmt) QueryRow(args …interface{}) *Row</h3><h3 id="func-s-Stmt-QueryRowContext-ctx-context-Context-args-…interface-Row"><a href="#func-s-Stmt-QueryRowContext-ctx-context-Context-args-…interface-Row" class="headerlink" title="func (s *Stmt) QueryRowContext(ctx context.Context, args …interface{}) *Row"></a>func (s *Stmt) QueryRowContext(ctx context.Context, args …interface{}) *Row</h3><h2 id="type-Tx-★★★★★"><a href="#type-Tx-★★★★★" class="headerlink" title="type Tx ★★★★★"></a>type Tx ★★★★★</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Tx <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// contains filtered or unexported fields</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Tx 是正在进行的数据库事务。</p>
<p>Transaction 必须以对 Commit 或 Rollback 的调用结束。</p>
<p>在调用 Commit 或 Rollback 之后，事务上的所有操作都会因ErrTxDone而失败。</p>
<h3 id="func-tx-Tx-Commit-error"><a href="#func-tx-Tx-Commit-error" class="headerlink" title="func (tx *Tx) Commit() error"></a>func (tx *Tx) Commit() error</h3><h3 id="func-tx-Tx-Exec-query-string-args-…interface-Result-error"><a href="#func-tx-Tx-Exec-query-string-args-…interface-Result-error" class="headerlink" title="func (tx *Tx) Exec(query string, args …interface{}) (Result, error)"></a>func (tx *Tx) Exec(query string, args …interface{}) (Result, error)</h3><h3 id="func-tx-Tx-ExecContext-ctx-context-Context-query-string-args-…interface-Result-error"><a href="#func-tx-Tx-ExecContext-ctx-context-Context-query-string-args-…interface-Result-error" class="headerlink" title="func (tx *Tx) ExecContext(ctx context.Context, query string, args …interface{}) (Result, error)"></a>func (tx *Tx) ExecContext(ctx context.Context, query string, args …interface{}) (Result, error)</h3><h3 id="func-tx-Tx-Prepare-query-string-Stmt-error"><a href="#func-tx-Tx-Prepare-query-string-Stmt-error" class="headerlink" title="func (tx *Tx) Prepare(query string) (*Stmt, error)"></a>func (tx *Tx) Prepare(query string) (*Stmt, error)</h3><h3 id="func-tx-Tx-PrepareContext-ctx-context-Context-query-string-Stmt-error"><a href="#func-tx-Tx-PrepareContext-ctx-context-Context-query-string-Stmt-error" class="headerlink" title="func (tx *Tx) PrepareContext(ctx context.Context, query string) (*Stmt, error)"></a>func (tx *Tx) PrepareContext(ctx context.Context, query string) (*Stmt, error)</h3><h3 id="func-tx-Tx-Query-query-string-args-…interface-Rows-error"><a href="#func-tx-Tx-Query-query-string-args-…interface-Rows-error" class="headerlink" title="func (tx *Tx) Query(query string, args …interface{}) (*Rows, error)"></a>func (tx *Tx) Query(query string, args …interface{}) (*Rows, error)</h3><h3 id="func-tx-Tx-QueryContext-ctx-context-Context-query-string-args-…interface-Rows-error"><a href="#func-tx-Tx-QueryContext-ctx-context-Context-query-string-args-…interface-Rows-error" class="headerlink" title="func (tx *Tx) QueryContext(ctx context.Context, query string, args …interface{}) (*Rows, error)"></a>func (tx *Tx) QueryContext(ctx context.Context, query string, args …interface{}) (*Rows, error)</h3><h3 id="func-tx-Tx-QueryRow-query-string-args-…interface-Row"><a href="#func-tx-Tx-QueryRow-query-string-args-…interface-Row" class="headerlink" title="func (tx *Tx) QueryRow(query string, args …interface{}) *Row"></a>func (tx *Tx) QueryRow(query string, args …interface{}) *Row</h3><h3 id="func-tx-Tx-QueryRowContext-ctx-context-Context-query-string-args-…interface-Row"><a href="#func-tx-Tx-QueryRowContext-ctx-context-Context-query-string-args-…interface-Row" class="headerlink" title="func (tx *Tx) QueryRowContext(ctx context.Context, query string, args …interface{}) *Row"></a>func (tx *Tx) QueryRowContext(ctx context.Context, query string, args …interface{}) *Row</h3><h3 id="func-tx-Tx-Rollback-error"><a href="#func-tx-Tx-Rollback-error" class="headerlink" title="func (tx *Tx) Rollback() error"></a>func (tx *Tx) Rollback() error</h3><h3 id="func-tx-Tx-Stmt-stmt-Stmt-Stmt"><a href="#func-tx-Tx-Stmt-stmt-Stmt-Stmt" class="headerlink" title="func (tx *Tx) Stmt(stmt *Stmt) *Stmt"></a>func (tx *Tx) Stmt(stmt *Stmt) *Stmt</h3><h3 id="func-tx-Tx-StmtContext-ctx-context-Context-stmt-Stmt-Stmt"><a href="#func-tx-Tx-StmtContext-ctx-context-Context-stmt-Stmt-Stmt" class="headerlink" title="func (tx *Tx) StmtContext(ctx context.Context, stmt *Stmt) *Stmt"></a>func (tx *Tx) StmtContext(ctx context.Context, stmt *Stmt) *Stmt</h3><h2 id="type-TxOptions"><a href="#type-TxOptions" class="headerlink" title="type TxOptions"></a>type TxOptions</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TxOptions <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// Isolation is the transaction isolation level.</span></span><br><span class="line"> <span class="comment">// If zero, the driver or database&#x27;s default level is used.</span></span><br><span class="line"> Isolation IsolationLevel</span><br><span class="line"> ReadOnly  <span class="type">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> TxOptions保存要在DB.BeginTx中使用的事务选项。 </p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/golang/" rel="tag"><i class="fa fa-tag"></i> golang</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E5%89%8D%E7%AB%AF/React/git%20commit%E8%A7%84%E8%8C%83/" rel="prev" title="git commit规范">
                  <i class="fa fa-chevron-left"></i> git commit规范
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Golang/%E6%A0%87%E5%87%86%E5%BA%93/sync/atomic/" rel="next" title="atomic">
                  atomic <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
