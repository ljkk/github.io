<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="LJKのBlog">
<meta property="og:url" content="http://blog.lujinkai.cn/page/16/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="像方便面一样的男子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/page/16/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/16/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LJKのBlog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E6%95%B0%E7%BB%84_zend_array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E6%95%B0%E7%BB%84_zend_array/" class="post-title-link" itemprop="url">数组_zend_array</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:17:27" itemprop="dateCreated datePublished" datetime="2020-12-09T13:17:27+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>zend_array 和 HashTable 都是 _zend_array 结构体的别名。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">185</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_array</span> &#123;</span></span><br><span class="line"><span class="number">186</span>     zend_refcounted_h gc;	<span class="comment">// 垃圾回收相关</span></span><br><span class="line"><span class="number">187</span>     <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="number">188</span>         <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="number">189</span>             ZEND_ENDIAN_LOHI_4(</span><br><span class="line"><span class="number">190</span>                 zend_uchar    flags,</span><br><span class="line"><span class="number">191</span>                 zend_uchar    nApplyCount,</span><br><span class="line"><span class="number">192</span>                 zend_uchar    nIteratorsCount,</span><br><span class="line"><span class="number">193</span>                 zend_uchar    consistency)</span><br><span class="line"><span class="number">194</span>         &#125; v;</span><br><span class="line"><span class="number">195</span>         <span class="type">uint32_t</span> flags;</span><br><span class="line"><span class="number">196</span>     &#125; u;	<span class="comment">// 主要是flags</span></span><br><span class="line"><span class="number">197</span>     <span class="type">uint32_t</span>          nTableMask;	<span class="comment">// 它本身的值就是几个桶, 和h进行或运算可以计算最终落在哪个桶里</span></span><br><span class="line"><span class="number">198</span>     Bucket           *arData;	<span class="comment">// 指向一个数组, 数组中的每一个元素都是一个bucket, buket是一个结构体, 其中存储key-value对，*arData表示这个数组的内存首地址</span></span><br><span class="line"><span class="number">199</span>     <span class="type">uint32_t</span>          nNumUsed;	<span class="comment">// bucket中有多少个被使用了</span></span><br><span class="line"><span class="number">200</span>     <span class="type">uint32_t</span>          nNumOfElements;	<span class="comment">// 真正有意义的值</span></span><br><span class="line"><span class="number">201</span>     <span class="type">uint32_t</span>          nTableSize;	<span class="comment">// bucket的大小, 初始值是8</span></span><br><span class="line"><span class="number">202</span>     <span class="type">uint32_t</span>          nInternalPointer;	<span class="comment">// 内部指针</span></span><br><span class="line"><span class="number">203</span>     zend_long         nNextFreeElement;	<span class="comment">// 不指定key赋值value的时候, key就从这里获取, 初始化为0</span></span><br><span class="line"><span class="number">204</span>     <span class="type">dtor_func_t</span>       pDestructor;	<span class="comment">// 函数指针, 用来析构用的</span></span><br><span class="line"><span class="number">205</span> &#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">Bucket</span> &#123;</span></span><br><span class="line">    zval              val; 	<span class="comment">// key-value的value</span></span><br><span class="line">    zend_ulong        h;                <span class="comment">/* hash value (or numeric index)   */</span>	<span class="comment">// 通过hash算法算出来的hash值</span></span><br><span class="line">    zend_string      *key;              <span class="comment">/* string key or NULL for numerics */</span>	<span class="comment">// key-value的key</span></span><br><span class="line">&#125; Bucket;</span><br></pre></td></tr></table></figure>

<p>数组初始化:</p>
<p>数组添加数据:</p>
<p>数组删除数据:</p>
<p>数组获取数据:</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/gc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/gc/" class="post-title-link" itemprop="url">gc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:15:11" itemprop="dateCreated datePublished" datetime="2020-12-09T13:15:11+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>数组初始化<code>$arr = [1,2,3];</code>,打印 gc 发现 refcount&#x3D;2;</p>
<p>数组初始化<code>$arr = [&#39;time&#39;=&gt;time()];</code>, 打印 gc 发现 refcount&#x3D;1;</p>
<p>这是为什么呢?</p>
<p>这牵扯到 PHP7 中的另一个概念，叫做 immutable array （不可变数组），在不可变数组下，使用一个伪计数值 2。类型是这种直接申明规定数组</p>
<p>摘抄一段 PHP7 数组开发成员的一段原话:</p>
<blockquote>
<p>For arrays the not-refcounted variant is called an “immutable array”. If you use opcache, then constant array literals in your code will be converted into immutable arrays. Once again, these live in shared memory and as such must not use refcounting. Immutable arrays have a dummy refcount of 2, as it allows us to optimize certain separation paths.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%AD%97%E7%AC%A6%E4%B8%B2_zend_string/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%AD%97%E7%AC%A6%E4%B8%B2_zend_string/" class="post-title-link" itemprop="url">字符串_zend_string</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:13:56" itemprop="dateCreated datePublished" datetime="2020-12-09T13:13:56+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>写时复制:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;this is string&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<p>此时,$a和$b 在内存中指向同一地址, 当修改$a或者$b 的时候, 才会复制一份, 然后对复制的这份进行修改</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">146</span> <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted_h</span> &#123;</span></span><br><span class="line"><span class="number">147</span>     <span class="type">uint32_t</span>         refcount;          <span class="comment">/* reference counter 32-bit</span></span><br><span class="line"><span class="comment">148     php7.1中常量字符串refcount=0，依靠u来标记常量，在7.3中已经改掉了*/</span></span><br><span class="line"><span class="number">149</span>     <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="number">150</span>         <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="number">151</span>             ZEND_ENDIAN_LOHI_3(</span><br><span class="line"><span class="number">152</span>                 zend_uchar    type,</span><br><span class="line"><span class="number">153</span>                 zend_uchar    flags,    <span class="comment">/* used for strings &amp; objects</span></span><br><span class="line"><span class="comment">154                 存储字符串的类型，例如：常量字符串2，变量字符串0 */</span></span><br><span class="line"><span class="number">155</span>                 <span class="type">uint16_t</span>      gc_info)  <span class="comment">/* keeps GC root number (or 0) and color */</span></span><br><span class="line"><span class="number">156</span>         &#125; v;</span><br><span class="line"><span class="number">157</span>         <span class="type">uint32_t</span> type_info;</span><br><span class="line"><span class="number">158</span>     &#125; u;</span><br><span class="line"><span class="number">159</span> &#125; zend_refcounted_h;</span><br><span class="line"><span class="number">160</span></span><br><span class="line"><span class="number">161</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted</span> &#123;</span></span><br><span class="line"><span class="number">162</span>     zend_refcounted_h gc;</span><br><span class="line"><span class="number">163</span> &#125;;</span><br><span class="line"><span class="number">165</span> <span class="comment">// 写时复制：对于整型或者其他简单类型的，因为zval 16个字节就可以表示了，所以是直接复制的</span></span><br><span class="line"><span class="number">166</span> <span class="comment">// 而对于zend_string, `$a = &#x27;string&#x27;; $b = $a;` $a和$b的zval指向的是同一个zend_string,用zend_string中的</span></span><br><span class="line"><span class="number">167</span> <span class="comment">// gc中的refcount进行标记，2，表示这个zeng_string被两个zval引用了，当我们修改$b的时候，就是修改$b指向的zval，</span></span><br><span class="line"><span class="number">168</span> <span class="comment">// $b指向zval的地址没变，但是zval的内容变了</span></span><br><span class="line"><span class="number">169</span> <span class="comment">// 同时原先的zend_string的gc也会修改，refcount减1</span></span><br><span class="line"><span class="number">170</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_string</span> &#123;</span></span><br><span class="line"><span class="number">171</span>     zend_refcounted_h gc;</span><br><span class="line"><span class="number">172</span>     zend_ulong        h;                <span class="comment">/* hash value 以空间换时间 */</span></span><br><span class="line"><span class="number">173</span>     <span class="type">size_t</span>            len;</span><br><span class="line"><span class="number">174</span>     <span class="type">char</span>              val[<span class="number">1</span>];   <span class="comment">// 柔性数组一定放在结构体的尾部</span></span><br><span class="line"><span class="number">175</span> &#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B_zend_reference/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B_zend_reference/" class="post-title-link" itemprop="url">引用类型_zend_reference</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:11:23" itemprop="dateCreated datePublished" datetime="2020-12-09T13:11:23+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;string&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = &amp;<span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<p>4、5 行输出$a和$b 都是引用类型，$b引用$a，但是$a也会变成引用类型 zend_reference，$a 和$b 的 zval 都指向同一个 zend_reference。zend_reference 中的 zval 中的 u1.type&#x3D;6,表示字符串类型, <code>p *z.value.ref.val.value.str.val@6</code> string</p>
<p>8、9 行$a和$b 指向的 zend_reference 中的 zval 类型还是字符串,但是打印出来已经都是 helle!了</p>
<p>12 行 $b 指向的 zval 显示类型是 0,也就是 IS_UNDEF</p>
<p>13 行 $a 的 zval 的 type 依然是 10(引用类型), 打印仍然是 hello!</p>
<p>可以看出, 11 行 unset($b)的操作,仅仅是把$b 的 zval 中的 type 由 10 改成 0, 其他的完全不动。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%B0%8F%E8%80%8C%E5%B7%A7%E7%9A%84zval/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%B0%8F%E8%80%8C%E5%B7%A7%E7%9A%84zval/" class="post-title-link" itemprop="url">小而巧的zval</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:09:57" itemprop="dateCreated datePublished" datetime="2020-12-09T13:09:57+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>zval 是一个结构体，其中包含三个联合体(共同体)：value、u1、u2；vaule8 字节，u1 和 u2 都是 4 个字节，正好 8 字节对其，所以 zval 的大小是 16 字节。</p>
<p>zval 用 16 字节可以表示 PHP 中的任意一个变量。</p>
<p>如何表示的呢?</p>
<p>line84 <code>typedef struct _zval_struct zval;</code> 为_zval_struct 这个结构体定义别名为 zval, ctrl + ] 跳转到 line121 查看_zval_struct:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zval_struct</span> &#123;</span></span><br><span class="line">    zend_value        value;            <span class="comment">/* value */</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ZEND_ENDIAN_LOHI_4(</span><br><span class="line">                zend_uchar    type,         <span class="comment">/* active type */</span> <span class="comment">// unsigned char 占用一个字节，v这个结构体中有四个，所以v占用4个字节</span></span><br><span class="line">                zend_uchar    type_flags,</span><br><span class="line">                zend_uchar    const_flags,</span><br><span class="line">                zend_uchar    reserved)     <span class="comment">/* call info for EX(This) */</span></span><br><span class="line">        &#125; v;</span><br><span class="line">        <span class="type">uint32_t</span> type_info;   <span class="comment">// unsigned int 占用4个字节</span></span><br><span class="line">    &#125; u1; <span class="comment">// v四个字节, type_info也是四个字节，所以u1占用4个字节</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="type">uint32_t</span>     next;                 <span class="comment">/* hash collision chain */</span></span><br><span class="line">        <span class="type">uint32_t</span>     cache_slot;           <span class="comment">/* literal cache slot */</span></span><br><span class="line">        <span class="type">uint32_t</span>     lineno;               <span class="comment">/* line number (for ast nodes) */</span></span><br><span class="line">        <span class="type">uint32_t</span>     num_args;             <span class="comment">/* arguments number for EX(This) */</span></span><br><span class="line">        <span class="type">uint32_t</span>     fe_pos;               <span class="comment">/* foreach position */</span></span><br><span class="line">        <span class="type">uint32_t</span>     fe_iter_idx;          <span class="comment">/* foreach iterator index */</span></span><br><span class="line">        <span class="type">uint32_t</span>     access_flags;         <span class="comment">/* class constant access flags */</span></span><br><span class="line">        <span class="type">uint32_t</span>     property_guard;       <span class="comment">/* single property guard */</span></span><br><span class="line">        <span class="type">uint32_t</span>     extra;                <span class="comment">/* not further specified */</span></span><br><span class="line">    &#125; u2; <span class="comment">// 所有的值都是 unsigned int 所以u2占用4个字节</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后定位 zend_value, ctrl+]跳转:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> _<span class="title">zend_value</span> &#123;</span></span><br><span class="line">    zend_long         lval;             <span class="comment">/* long value  64位 8字节*/</span></span><br><span class="line">    <span class="type">double</span>            dval;             <span class="comment">/* double value  64位 8字节*/</span></span><br><span class="line">    zend_refcounted  *counted;				<span class="comment">/*  */</span></span><br><span class="line">    zend_string      *str;				<span class="comment">/*  */</span></span><br><span class="line">    zend_array       *arr;				<span class="comment">/*  */</span></span><br><span class="line">    zend_object      *obj;				<span class="comment">/*  */</span></span><br><span class="line">    zend_resource    *res;				<span class="comment">/*  */</span></span><br><span class="line">    zend_reference   *ref;				<span class="comment">/*  */</span></span><br><span class="line">    zend_ast_ref     *ast;				<span class="comment">/*  */</span>				<span class="comment">/*  */</span></span><br><span class="line">    zval             *zv; 				<span class="comment">/*  */</span></span><br><span class="line">    <span class="type">void</span>             *ptr;				<span class="comment">/*  */</span>				<span class="comment">/*  */</span></span><br><span class="line">    zend_class_entry *ce; 				<span class="comment">/*  */</span></span><br><span class="line">    zend_function    *func;				<span class="comment">/*  */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="type">uint32_t</span> w1;</span><br><span class="line">        <span class="type">uint32_t</span> w2;</span><br><span class="line">    &#125; ww;				<span class="comment">/* 显然4字节 */</span></span><br><span class="line">&#125; zend_value;</span><br></pre></td></tr></table></figure>

<p>接下来我们详细说明一下 zval 的结构: 显然, 它是一个结构体,包含三个值, 其类型都是联合体。</p>
<p>先看 value 的这个联合体 zend_value, 包含 14 个值, 经过 tags 的 ctrl+]跳转,我们发现:</p>
<ol>
<li><p>zend_long 是 int64_t 的别名, 而 int64_t 又是__int64 的别名(关于__int64 可以查看笔记: 备忘&#x2F;bit B(byte) KB.md)。</p>
</li>
<li><p>zend_refcounted 是_zend_refcounted 的别名，而_zend_refcounted 是一个结构体，其中只有一个值 gc，gc 是 zend_refcounted_h 类型的数据，而 zend_refcounted_h 是一个结构体：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted_h</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>         refcount;          <span class="comment">/* reference counter 32-bit */</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ZEND_ENDIAN_LOHI_3(</span><br><span class="line">                zend_uchar    type,</span><br><span class="line">                zend_uchar    flags,    <span class="comment">/* used for strings &amp; objects */</span></span><br><span class="line">                <span class="type">uint16_t</span>      gc_info)  <span class="comment">/* keeps GC root number (or 0) and color */</span></span><br><span class="line">        &#125; v;</span><br><span class="line">        <span class="type">uint32_t</span> type_info;</span><br><span class="line">    &#125; u;</span><br><span class="line">&#125; zend_refcounted_h;</span><br></pre></td></tr></table></figure>

<p>uint32_t 是 unsigned int 的别名。refcount 表示。。。，u 这个联合体中包含一个结构体 v 和一个 32 位正整型 type_info。</p>
<p>zend_uchar 是 unsigned char 的别名。</p>
<p>。。。未完待续</p>
</li>
<li><p>str 是指针，zend_string 是_zend_string 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_string</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    zend_ulong        h;                <span class="comment">/* hash value */</span></span><br><span class="line">    <span class="type">size_t</span>            len;</span><br><span class="line">    <span class="type">char</span>              val[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>gc 和垃圾回收有关。zend_ulong 是 uint32_t 的别名，表示 hash 值，防止冲突。</p>
<p>关于 size_t：</p>
<p>size_t 是一些 C&#x2F;C++标准在 stddef.h 中定义的。这个类型足以用来表示对象的大小。size_t 的真实类型与操作系统有关。</p>
<p>在 32 位架构中被普遍定义为：typedef unsigned int size_t;</p>
<p>而在 64 位架构中被定义为：typedef unsigned long size_t;</p>
<p><strong>为什么有时候不用 int，而是用 size_type 或者 size_t:</strong> 与 int 固定四个字节不同有所不同,size_t 的取值 range 是目标平台下最大可能的数组尺寸,一些平台下 size_t 的范围小于 int 的正数范围,又或者大于 unsigned int. 使用 Int 既有可能浪费，又有可能范围不够大。</p>
<p>len 用来储存字符串的长度。</p>
<p>val 是一个柔性数组，用来储存字符串。</p>
</li>
<li><p>arr 是指针，zend_array 是_zend_array 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_array</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ZEND_ENDIAN_LOHI_4(</span><br><span class="line">                zend_uchar    flags,</span><br><span class="line">                zend_uchar    nApplyCount,</span><br><span class="line">                zend_uchar    nIteratorsCount,</span><br><span class="line">                zend_uchar    consistency)</span><br><span class="line">        &#125; v;</span><br><span class="line">        <span class="type">uint32_t</span> flags;</span><br><span class="line">    &#125; u;</span><br><span class="line">    <span class="type">uint32_t</span>          nTableMask;</span><br><span class="line">    Bucket           *arData;</span><br><span class="line">    <span class="type">uint32_t</span>          nNumUsed;</span><br><span class="line">    <span class="type">uint32_t</span>          nNumOfElements;</span><br><span class="line">    <span class="type">uint32_t</span>          nTableSize;</span><br><span class="line">    <span class="type">uint32_t</span>          nInternalPointer;</span><br><span class="line">    zend_long         nNextFreeElement;</span><br><span class="line">    <span class="type">dtor_func_t</span>       pDestructor;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>gc 与垃圾回收有关。</p>
<p>联合体 v。。。</p>
<p>。。。未完待续</p>
</li>
<li><p>obj 是指针，zend_object 是_zend_object 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_object</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    <span class="type">uint32_t</span>          handle; <span class="comment">// <span class="doctag">TODO:</span> may be removed ???</span></span><br><span class="line">    zend_class_entry *ce;</span><br><span class="line">    <span class="type">const</span> zend_object_handlers *handlers;</span><br><span class="line">    HashTable        *properties;</span><br><span class="line">    zval              properties_table[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>res 是指针，zend_resource 是_zend_resource 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_resource</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    <span class="type">int</span>               handle; <span class="comment">// <span class="doctag">TODO:</span> may be removed ???</span></span><br><span class="line">    <span class="type">int</span>               type;</span><br><span class="line">    <span class="type">void</span>             *ptr;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>ref 是指针，zend_reference 是_zend_reference 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_reference</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    zval              val;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>ast 是指针，zend_ast_ref 是_zend_ast_ref 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_ast_ref</span> &#123;</span></span><br><span class="line">    zend_refcounted_h gc;</span><br><span class="line">    zend_ast         *ast;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>zend_ast 是_zend_ast 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> zend_ast_kind;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> zend_ast_attr;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_ast</span> &#123;</span></span><br><span class="line">    zend_ast_kind kind; <span class="comment">/* Type of the node (ZEND_AST_* enum constant) */</span></span><br><span class="line">    zend_ast_attr attr; <span class="comment">/* Additional attribute, use depending on node type */</span></span><br><span class="line">    <span class="type">uint32_t</span> lineno;    <span class="comment">/* Line number */</span></span><br><span class="line">    zend_ast *child[<span class="number">1</span>]; <span class="comment">/* Array of children (using struct hack) */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>zv 是指针</p>
<p>。。。未完待续</p>
</li>
<li><p>ptr 是指针</p>
<p>。。。未完待续</p>
</li>
<li><p>ce 是指针，zend_class_entry 是_zend_class_entry 的别名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_class_entry</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> type;</span><br><span class="line">    zend_string *name;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">zend_class_entry</span> *<span class="title">parent</span>;</span></span><br><span class="line">    <span class="type">int</span> refcount;</span><br><span class="line">    <span class="type">uint32_t</span> ce_flags;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> default_properties_count;</span><br><span class="line">    <span class="type">int</span> default_static_members_count;</span><br><span class="line">    zval *default_properties_table;</span><br><span class="line">    zval *default_static_members_table;</span><br><span class="line">    zval *static_members_table;</span><br><span class="line">    HashTable function_table;</span><br><span class="line">    HashTable properties_info;</span><br><span class="line">    HashTable constants_table;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">constructor</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">destructor</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">clone</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">get</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">set</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">unset</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">isset</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">call</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">callstatic</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">tostring</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *__<span class="title">debugInfo</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">serialize_func</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">unserialize_func</span>;</span></span><br><span class="line"></span><br><span class="line">    zend_class_iterator_funcs iterator_funcs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* handlers */</span></span><br><span class="line">    zend_object* (*create_object)(zend_class_entry *class_type);</span><br><span class="line">    zend_object_iterator *(*get_iterator)(zend_class_entry *ce, zval *object, <span class="type">int</span> by_ref);</span><br><span class="line">    <span class="type">int</span> (*interface_gets_implemented)(zend_class_entry *iface, zend_class_entry *class_type); <span class="comment">/* a class implements this interface */</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *(*<span class="title">get_static_method</span>)(<span class="title">zend_class_entry</span> *<span class="title">ce</span>, <span class="title">zend_string</span>* <span class="title">method</span>);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* serializer callbacks */</span></span><br><span class="line">    <span class="type">int</span> (*serialize)(zval *object, <span class="type">unsigned</span> <span class="type">char</span> **buffer, <span class="type">size_t</span> *buf_len, zend_serialize_data *data);</span><br><span class="line">    <span class="type">int</span> (*unserialize)(zval *object, zend_class_entry *ce, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *buf, <span class="type">size_t</span> buf_len, zend_unserialize_data *data);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> num_interfaces;</span><br><span class="line">    <span class="type">uint32_t</span> num_traits;</span><br><span class="line">    zend_class_entry **interfaces;</span><br><span class="line"></span><br><span class="line">    zend_class_entry **traits;</span><br><span class="line">    zend_trait_alias **trait_aliases;</span><br><span class="line">    zend_trait_precedence **trait_precedences;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            zend_string *filename;</span><br><span class="line">            <span class="type">uint32_t</span> line_start;</span><br><span class="line">            <span class="type">uint32_t</span> line_end;</span><br><span class="line">            zend_string *doc_comment;</span><br><span class="line">        &#125; user;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_function_entry</span> *<span class="title">builtin_functions</span>;</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> _<span class="title">zend_module_entry</span> *<span class="title">module</span>;</span></span><br><span class="line">        &#125; internal;</span><br><span class="line">    &#125; info;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>func 是指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> &#123;</span></span><br><span class="line">    zend_uchar type;    <span class="comment">/* MUST be the first element of this struct! */</span></span><br><span class="line">    <span class="type">uint32_t</span>   quick_arg_flags;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        zend_uchar type;  <span class="comment">/* never used */</span></span><br><span class="line">        zend_uchar arg_flags[<span class="number">3</span>]; <span class="comment">/* bitset of arg_info.pass_by_reference */</span></span><br><span class="line">        <span class="type">uint32_t</span> fn_flags;</span><br><span class="line">        zend_string *function_name;</span><br><span class="line">        zend_class_entry *scope;</span><br><span class="line">        <span class="class"><span class="keyword">union</span> _<span class="title">zend_function</span> *<span class="title">prototype</span>;</span></span><br><span class="line">        <span class="type">uint32_t</span> num_args;</span><br><span class="line">        <span class="type">uint32_t</span> required_num_args;</span><br><span class="line">        zend_arg_info *arg_info;</span><br><span class="line">    &#125; common;</span><br><span class="line"></span><br><span class="line">    zend_op_array op_array;</span><br><span class="line">    zend_internal_function internal_function;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>。。。未完待续</p>
</li>
<li><p>ww 结构体</p>
</li>
</ol>
<p>综上可以看出，value 中存储的是变量内容，接下来我们看两个联合体 u1 和 u2。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        ZEND_ENDIAN_LOHI_4(</span><br><span class="line">            zend_uchar    type,         <span class="comment">/* active type */</span></span><br><span class="line">            zend_uchar    type_flags,</span><br><span class="line">            zend_uchar    const_flags,</span><br><span class="line">            zend_uchar    reserved)     <span class="comment">/* call info for EX(This) */</span></span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="type">uint32_t</span> type_info;</span><br><span class="line">&#125; u1;</span><br></pre></td></tr></table></figure>

<p>u1 中有一个结构体 v 和一个 32 位整型 type_info,这个 type_info 的作用就是获取 v 的值。这么写是一个小技巧。</p>
<p>zend_uchar 是 unsigned char 的别名，type 这个值表示不同的变量类型，有：</p>
<p>#define IS_UNDEF 0<br>#define IS_NULL 1<br>#define IS_FALSE 2<br>#define IS_TRUE 3<br>#define IS_LONG 4<br>#define IS_DOUBLE 5<br>#define IS_STRING 6<br>#define IS_ARRAY 7<br>#define IS_OBJECT 8<br>#define IS_RESOURCE 9<br>#define IS_REFERENCE 10</p>
<p>以上，整型就是 IS_LONG。</p>
<p>。。。未完待续</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span>     next;                 <span class="comment">/* hash collision chain */</span></span><br><span class="line">    <span class="type">uint32_t</span>     cache_slot;           <span class="comment">/* literal cache slot */</span></span><br><span class="line">    <span class="type">uint32_t</span>     lineno;               <span class="comment">/* line number (for ast nodes) */</span></span><br><span class="line">    <span class="type">uint32_t</span>     num_args;             <span class="comment">/* arguments number for EX(This) */</span></span><br><span class="line">    <span class="type">uint32_t</span>     fe_pos;               <span class="comment">/* foreach position */</span></span><br><span class="line">    <span class="type">uint32_t</span>     fe_iter_idx;          <span class="comment">/* foreach iterator index */</span></span><br><span class="line">    <span class="type">uint32_t</span>     access_flags;         <span class="comment">/* class constant access flags */</span></span><br><span class="line">    <span class="type">uint32_t</span>     property_guard;       <span class="comment">/* single property guard */</span></span><br><span class="line">    <span class="type">uint32_t</span>     extra;                <span class="comment">/* not further specified */</span></span><br><span class="line">&#125; u2;</span><br></pre></td></tr></table></figure>

<p>u2 中的 next 用来解决数组中的冲突。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%A6%82%E4%BD%95%E4%B8%80%E7%9C%BC%E5%B0%B1%E7%9C%8B%E5%87%BA%E5%86%85%E5%AD%98%E5%A4%9A%E5%A4%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%A6%82%E4%BD%95%E4%B8%80%E7%9C%BC%E5%B0%B1%E7%9C%8B%E5%87%BA%E5%86%85%E5%AD%98%E5%A4%9A%E5%A4%A7/" class="post-title-link" itemprop="url">如何一眼就看出内存多大</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:08:06" itemprop="dateCreated datePublished" datetime="2020-12-09T13:08:06+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="通过内存地址快速知道内存大小"><a href="#通过内存地址快速知道内存大小" class="headerlink" title="通过内存地址快速知道内存大小"></a>通过内存地址快速知道内存大小</h2><p>通过内存管理申请一个内存地址，这个内存地址属于 small 或 large 或 huge 内存，那如何判断呢？</p>
<p>page 4KB</p>
<p>chunk 2MB</p>
<p>small 小于等于 3KB 的内存。</p>
<p>large 大于 3KB 且小于等于（2MB-4KB）的内存，可以对应整数倍的 page。</p>
<p>huge 大于 2MB-4KB 的内存，可以对应整数倍的 chunk。</p>
<p>如果是 0x8 打头，</p>
<p>如果是 0xc 打头的，看两段</p>
<p>0x4 打头的是 large 内存。</p>
<p>如果一个内存是 2M 的整数倍，一定是 huge 内存。</p>
<p>2MB&#x3D;2×1024*1024&#x3D;2×2^10×2^10&#x3D;2×2^20</p>
<p>16&#x3D;2^4</p>
<p>(2×2^20) &#x2F; 2^4</p>
<p>最终得到 2MB 的 16 进制是 200000</p>
<p>所以看到 0x…00000 这种后面是 5 个 0 的，然后看一看倒数第六位能否被 2 整除，就一定是 huge 内存。</p>
<p>例如：0x7ffff5e00000，它属于 huge 内存。</p>
<p>如果一个内存地址不是 2MB 的整数倍，那我们根据地址，去掉偏移，找到一个 chunk，另外我们也可以知道，它属于哪个 page（偏移除以 4K）。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">内存管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:04:36" itemprop="dateCreated datePublished" datetime="2020-12-09T13:04:36+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>malloc 函数申请内存, 返回指针;</p>
<p>free 释放内存</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> * ptr = <span class="built_in">malloc</span>(size);</span><br><span class="line"><span class="built_in">free</span>(ptr)</span><br></pre></td></tr></table></figure>

<p>问题: 申请内存的时候需要传入 size, 为什么 free 的时候没有传入 size, 那么是怎么做到准确释放 size 大小的内存的呢?</p>
<p>其实呢, malloc 在分配内存的时候, 返回的地址的指针指向了程序可用内存的位置, 在 ptr 前面会多分配 32 位的头部, 头部的低三位表示是否分配。</p>
<p><img data-src="//img.lujinkai.cn/note/malloc.png"></p>
<p>当 free 的时候，会向前搜寻 32 的头，取高 29 位为块的大小，所以 free 的时候就不需要传递 size 了，当然这只是一种 malloc 的实现，当前的 linux 的 malloc 事件已经不是这样了，但原理是一样的，也是维护了一个头部。</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ol>
<li>chunk</li>
<li>page</li>
<li>各种规格的内存</li>
</ol>
<p>chunk：2MB 大小的内存；</p>
<p>page：4KB 大小的内存；</p>
<p>一个 chunk 可以分成 512 个 page。</p>
<h2 id="内存规格"><a href="#内存规格" class="headerlink" title="内存规格"></a>内存规格</h2><ol>
<li>small (size &lt;&#x3D; 3KB）30 个规格</li>
<li>large (3KB &lt; size &lt; 2MB-4KB) large 是 4K 的整数倍</li>
<li>huge (size &gt; 2MB - 4KB) huge 一定是 2M 的整数倍, 例如申请 3M 内存, 那么返回的一定是比 3M 大,且是 2M 的整数倍, 是 4M</li>
</ol>
<h2 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h2><p><img data-src="//img.lujinkai.cn/note/%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.png"></p>
<p>zend_mm_alloc_heap 判断申请内存的大小；</p>
<p>申请内存大于 2M-4K, 则属于 huge, 执行 zend_mm_alloc_huge, 调用 zend_mm_chunk_alloc, 最终调用 mmap 取申请大内存;</p>
<p>申请内存大于 3K 且小于 2M-4K, 则属于 large, 执行 zend_mm_alloc_large, 调用 zend_mm_alloc_pages</p>
<p>申请内存小于等于 3K, 则属于 small, 执行 zend_mm_alloc_small 函数, 如果当前有 small 内存, 则直接返回, 如果没有, 则执行 zend_mm_alloc_small_slow, 需要先去 zend_mm_alloc_pages 看看, 如果 large 也没有余量了, 就去 zend_mm_chunk_alloc 开辟新的内存。</p>
<h2 id="small-内存管理"><a href="#small-内存管理" class="headerlink" title="small 内存管理"></a>small 内存管理</h2><h2 id="chunk-内存对齐"><a href="#chunk-内存对齐" class="headerlink" title="chunk 内存对齐"></a>chunk 内存对齐</h2><p>4k 对其：申请的内存只能是 4K 的整数倍；</p>
<p>内存对其的好处，当已知一个内存地址，就可以算出此内存（page）的起始地址；例如有一内存地址 0x103c61120，4k 对齐，通过宏计算，此内存所在 page 的起始地址为 0x103c61000，在此 page 的偏移量是 0x120，能过快速定位内存地址所在的 page，提高效率。</p>
<p>内存管理的代码比较多，但是我们只需要掌握两个核心：当我们 free 的时候，不需要传递 size，</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E6%BA%90%E7%A0%81/%E5%A4%A7%E5%B0%8F%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E6%BA%90%E7%A0%81/%E5%A4%A7%E5%B0%8F%E7%AB%AF/" class="post-title-link" itemprop="url">大小端</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 13:03:07" itemprop="dateCreated datePublished" datetime="2020-12-09T13:03:07+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E6%BA%90%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">源码</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuyuegb2312/archive/2013/06/08/3126510.html">https://www.cnblogs.com/wuyuegb2312/archive/2013/06/08/3126510.html</a></p>
<p>大端 &#x3D;&gt; 高尾端</p>
<p>小端 &#x3D;&gt; 低尾端</p>
<p>计算机系统中，以字节为单位，每个地址单元都对应这一个字节，一个字节为 8bit。</p>
<p>大端：（Big-Endian）：就是把数值的高位字节放在内存的低位地址上，把数值的低位字节放在内存的高位地址上。</p>
<p>小端：（Little-Endian）：就是把数值的高位字节放在高位的地址上，低位字节放在低位地址上。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0x12345678</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;内存地址：%p\n&quot;</span>, &amp;i);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：0x7fff86f78684</p>
<p>【注】不管是大端法还是小端法存储，计算机在内存中存放数据的顺序都是从低地址到高地址。</p>
<h2 id="大小端比较"><a href="#大小端比较" class="headerlink" title="大小端比较"></a>大小端比较</h2><ol>
<li><p>小端规则</p>
<table>
<thead>
<tr>
<th>地址</th>
<th>0x7fff86f78684</th>
<th>0x7fff86f78685</th>
<th>0x7fff86f78686</th>
<th>0x7fff86f78687</th>
</tr>
</thead>
<tbody><tr>
<td>数值</td>
<td>0x78</td>
<td>0x56</td>
<td>0x34</td>
<td>0x12</td>
</tr>
</tbody></table>
</li>
<li><p>大端规则</p>
<table>
<thead>
<tr>
<th>地址</th>
<th>0x7fff86f78684</th>
<th>0x7fff86f78685</th>
<th>0x7fff86f78686</th>
<th>0x7fff86f78687</th>
</tr>
</thead>
<tbody><tr>
<td>数值</td>
<td>0x12</td>
<td>0x34</td>
<td>0x56</td>
<td>0x78</td>
</tr>
</tbody></table>
</li>
</ol>
<p>通过上面的表格，可以看出来大小端的不同。（注：其实在计算机内存中并不存在所谓的数据类型，比如 char，int 等的。这个类型在代码中的作用就是让编译器知道每次应该从那个地址起始读取多少位的数据，赋值给相应的变量。）</p>
<h2 id="PHP-源码部分宏函数"><a href="#PHP-源码部分宏函数" class="headerlink" title="PHP 源码部分宏函数"></a>PHP 源码部分宏函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> WORDS_BIGENDIAN</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI(lo, hi)          hi; lo;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_3(lo, mi, hi)    hi; mi; lo;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_4(a, b, c, d)    d; c; b; a;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C(lo, hi)        hi, lo</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C_3(lo, mi, hi)  hi, mi, lo,</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C_4(a, b, c, d)  d, c, b, a</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI(lo, hi)          lo; hi;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_3(lo, mi, hi)    lo; mi; hi;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_4(a, b, c, d)    a; b; c; d;</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C(lo, hi)        lo, hi</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C_3(lo, mi, hi)  lo, mi, hi,</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> ZEND_ENDIAN_LOHI_C_4(a, b, c, d)  a, b, c, d</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>以<code># define ZEND_ENDIAN_LOHI_4(a, b, c, d) d; c; b; a;</code>为例，这里涉及到一个大小端的问题：</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/LVS/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/LVS/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" class="post-title-link" itemprop="url">正向代理和反向代理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 09:24:12" itemprop="dateCreated datePublished" datetime="2020-12-09T09:24:12+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/LVS/" itemprop="url" rel="index"><span itemprop="name">LVS</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>正向代理和反向代理的本质区别是是什么？</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/36412304">https://www.zhihu.com/question/36412304</a></p>
<p>正向代理：客户机必须指定代理服务器，并将本来要直接发送到 Web 服务器上的 http 请求发送到代理服务器中</p>
<p>反向代理：代理服务器接受 Internet 上的连接请求，然后将请求转发给内部网络的服务器；并将从服务器上得到的结果返回给 Internet 上请求连接的客户端，此时代理服务器对外就表现为一个服务器</p>
<p>正向代理对客户端负责，反向代理对其代理的服务器负责，搭梯子就是典型的正向代理，而 LVS、haproxy、nginx 等都是反向代理</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/MySQL/mysql5.7%20datetime%20%E9%BB%98%E8%AE%A4%E5%80%BC%E4%B8%BA'0000-00-00%20000000'%E6%97%A0%E6%B3%95%E5%88%9B%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/MySQL/mysql5.7%20datetime%20%E9%BB%98%E8%AE%A4%E5%80%BC%E4%B8%BA'0000-00-00%20000000'%E6%97%A0%E6%B3%95%E5%88%9B%E5%BB%BA/" class="post-title-link" itemprop="url">mysql5.7 datetime 默认值为'0000-00-00 000000'无法创建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:41:26" itemprop="dateCreated datePublished" datetime="2020-12-07T21:41:26+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我数据库版本为 5.7.16</p>
<p>新建表结构：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS `yx_test`;</span><br><span class="line">CREATE TABLE `yx_test` (</span><br><span class="line">      `mobile` char(11) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">      `is_delete` tinyint(4) NOT NULL DEFAULT <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;状态,0.删除，1.正常&#x27;</span>,</span><br><span class="line">      `deleted_at` datetime NOT NULL DEFAULT <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;删除时间&#x27;</span>,</span><br><span class="line">      `created_at` datetime NOT NULL DEFAULT <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">      `updated_at` datetime NOT NULL DEFAULT <span class="string">&#x27;0000-00-00 00:00:00&#x27;</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span></span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10000043 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=<span class="string">&#x27;测试表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>报错信息：<code>ERROR 1067 (42000): Invalid default value for &#39;deleted_at&#39;</code></p>
<p>解决方案：</p>
<p>使用 root 登陆数据库</p>
<ol>
<li>查看 sql_mode：</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@sql_mode;</span><br></pre></td></tr></table></figure>

<p>获得结果：</p>
<p><code>ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code></p>
<p>NO_ZERO_IN_DATE, NO_ZERO_DATE 是无法默认为‘0000-00-00 00:00:00’的根源，去掉之后再次新建表就可以了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL sql_mode=<span class="string">&#x27;ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>注：</p>
<p>NO_ZERO_IN_DATE：在严格模式下，不允许日期和月份为零</p>
<p>NO_ZERO_DATE：设置该值，mysql 数据库不允许插入零日期，插入零日期会抛出错误而不是警告。</p>
<p>测试新建表，ok</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%B7%A5%E5%85%B7/ubuntu/ubuntu18.04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B7%A5%E5%85%B7/ubuntu/ubuntu18.04/" class="post-title-link" itemprop="url">ubuntu18.04</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:37:10" itemprop="dateCreated datePublished" datetime="2020-12-07T21:37:10+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-安装系统"><a href="#1-安装系统" class="headerlink" title="1. 安装系统"></a>1. 安装系统</h2><p>分区</p>
<p> &#x2F;boot 300MB 逻辑分区</p>
<p> &#x2F; 自动补全 主分区</p>
<p> 其他的不用设置</p>
<p>更新</p>
<p> 不要勾选更新，等安装完系统，更新源之后再更新比较快</p>
<h2 id="2-更新源"><a href="#2-更新源" class="headerlink" title="2. 更新源"></a>2. 更新源</h2><p>装完系统后<strong>第一件事</strong>就是更新国内源</p>
<p>将 apt 的源更换为国内的源，我选择的是阿里云</p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11OyziSW">https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11OyziSW</a></p>
<p>让更新后的源生效</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update		// 更新软件列表</span><br><span class="line">sudo apt-get upgrade	// 更新软件</span><br></pre></td></tr></table></figure>

<h2 id="3-安装常用软件"><a href="#3-安装常用软件" class="headerlink" title="3. 安装常用软件"></a>3. 安装常用软件</h2><h3 id="1-gnome-tweaks"><a href="#1-gnome-tweaks" class="headerlink" title="1. gnome-tweaks"></a>1. <strong>gnome-tweaks</strong></h3><p>可以通过 ubuntu 软件 搜索安装，或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt  install    gnome-tweaks</span><br></pre></td></tr></table></figure>

<h3 id="2-WPS"><a href="#2-WPS" class="headerlink" title="2. WPS"></a>2. WPS</h3><p><a target="_blank" rel="noopener" href="https://www.wps.cn/product/wpslinux/">https://www.wps.cn/product/wpslinux/</a></p>
<p>下载.dep 包，然后双击安装即可</p>
<h3 id="3-chrome"><a href="#3-chrome" class="headerlink" title="3. chrome"></a>3. chrome</h3><p><a target="_blank" rel="noopener" href="https://www.google.cn/chrome/">https://www.google.cn/chrome/</a></p>
<p>下载.dep 包，然后双击安装即可</p>
<h3 id="4-vscode"><a href="#4-vscode" class="headerlink" title="4. vscode"></a>4. vscode</h3><p><a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p>
<p>下载.dep 包，然后双击安装即可</p>
<h3 id="5-typora"><a href="#5-typora" class="headerlink" title="5. typora"></a>5. typora</h3><p><a target="_blank" rel="noopener" href="https://www.typora.io/">https://www.typora.io/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># or run:</span></span><br><span class="line"><span class="comment"># sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BA300B7755AFCFAE</span></span><br><span class="line">wget -qO - https://typora.io/linux/public-key.asc | sudo apt-key add -</span><br><span class="line"><span class="comment"># add Typora&#x27;s repository</span></span><br><span class="line">sudo add-apt-repository <span class="string">&#x27;deb https://typora.io/linux ./&#x27;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"><span class="comment"># install typora</span></span><br><span class="line">sudo apt-get install typora</span><br></pre></td></tr></table></figure>

<h3 id="6-sublime-text3"><a href="#6-sublime-text3" class="headerlink" title="6. sublime_text3"></a>6. sublime_text3</h3><p><a target="_blank" rel="noopener" href="https://www.sublimetext.com/docs/3/linux_repositories.html">https://www.sublimetext.com/docs/3/linux_repositories.html</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add -</span><br><span class="line">sudo apt-get install apt-transport-https</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://download.sublimetext.com/ apt/stable/&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/sublime-text.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install sublime-text</span><br></pre></td></tr></table></figure>

<h3 id="7-phpstorm"><a href="#7-phpstorm" class="headerlink" title="7. phpstorm"></a>7. phpstorm</h3><p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/phpstorm/download/#section=linux">https://www.jetbrains.com/phpstorm/download/#section=linux</a></p>
<p>两种安装方式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install phpstorm --classic</span><br></pre></td></tr></table></figure>

<p>或者直接下载 .tar.gz 包，然后将解压后的目录移动到 &#x2F;opt 下，再执行 phpstorm.sh 即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf PhpStorm-2019.2.3.tar.gz</span><br><span class="line">sudo <span class="built_in">mv</span> PhpStorm-2019.2.3.tar.gz /opt/PhpStorm</span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">./PhpStorm/bin/phpstorm.sh</span><br></pre></td></tr></table></figure>

<p>激活码：百度搜一个</p>
<p>删除： 删除 &#x2F;opt&#x2F;PhpStorm 和 ~&#x2F;.PhpStorm2019.2 即可</p>
<p>重装：删除~&#x2F;.PhpStorm2019.2 然后重新执行 phpstorm.sh 即可</p>
<h3 id="8-PyCharm"><a href="#8-PyCharm" class="headerlink" title="8. PyCharm"></a>8. PyCharm</h3><p>两种安装方式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install pycharm-professional --classic</span><br></pre></td></tr></table></figure>

<p>或者</p>
<p>或者直接下载 .tar.gz 包，然后将解压后的目录移动到 &#x2F;opt 下，再执行 pycharm.sh 即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf pycharm-professional-2019.2.3.tar.gz</span><br><span class="line">sudo <span class="built_in">mv</span> pycharm-2019.2.3/ /opt/pycharm</span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">./pycharm/bin/pycharm.sh</span><br></pre></td></tr></table></figure>

<p>激活码：百度搜一个</p>
<p>删除： 删除 &#x2F;opt&#x2F;pycharm 和 ~&#x2F;.PyCharm2019.2 即可</p>
<p>重装：删除~&#x2F;.PyCharm2019.2 然后重新执行 pycharm.sh 即可</p>
<p>奇怪的是，pycharm 不会自己生成快捷方式，所以需要自己手动添加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/applications/</span><br><span class="line">sudo vim PyCharm.desktop</span><br></pre></td></tr></table></figure>

<p>将以下代码添加到 PyCharm.desktop</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Type=Application</span><br><span class="line">Name=PyCharm</span><br><span class="line">GenericName=pycharm-2019.2</span><br><span class="line">Comment=Pycharm3:The Python IDE</span><br><span class="line">Exec=sh /opt/pycharm/bin/pycharm.sh</span><br><span class="line">Icon=/opt/pycharm/bin/pycharm.png</span><br><span class="line">Terminal=pycharm</span><br><span class="line">Categories=PyCharm;</span><br></pre></td></tr></table></figure>

<h3 id="9-SecureCRT"><a href="#9-SecureCRT" class="headerlink" title="9. SecureCRT"></a>9. SecureCRT</h3><p><a target="_blank" rel="noopener" href="https://www.vandyke.com/cgi-bin/releases.php?product=securecrt">https://www.vandyke.com/cgi-bin/releases.php?product=securecrt</a></p>
<p>下载之前需要先注册，这个有点麻烦</p>
<p>两种安装方式，.dep 或者.tar.gz，这里选择 .tar.gz，将下载的 scrt-8.5.4.1942.ubuntu18-64.tar.gz 解压到&#x2F;opt 下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf scrt-8.5.4.1942.ubuntu18-64.tar.gz</span><br><span class="line">sudo <span class="built_in">mv</span> scrt-8.5.4 /opt/</span><br><span class="line">/opt/scrt-8.5.4/SecureCRT		// 启动软件</span><br></pre></td></tr></table></figure>

<p>添加快捷方式到启动器</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> /opt/scrt-8.5.4/SecureCRT.desktop /usr/share/applications/</span><br><span class="line">sudo vim /usr/share/applications/SecureCRT.desktop</span><br><span class="line">// 修改   Exec=/opt/scrt-8.5.4/SecureCRT</span><br><span class="line">//             Icon=/opt/scrt-8.5.4/securecrt_64.png</span><br></pre></td></tr></table></figure>

<p>安装完毕</p>
<p>如果采用双击.dep 安装包的方式，安装完成后，双击 SecureCTR 图标, 打不开也不报错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@lujinkai-TM1703:/usr/lib/x86_64-linux-gnu$ whereis SecureCRT</span><br><span class="line">SecureCRT: /usr/bin/SecureCRT</span><br></pre></td></tr></table></figure>

<p>回车执行:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/SecureCRT</span><br></pre></td></tr></table></figure>

<p>报错: <code>error while loading shared libraries: libpython2.7.so.1.0: cannot open shared object file: No such file or directory</code></p>
<p>检测:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate libpython2.7.so.1.0</span><br></pre></td></tr></table></figure>

<p>显示正常: <code>/usr/lib/x86_64-linux-gnu/libpython2.7.so.1.0</code></p>
<p>奇怪, 但是查找不到这文件</p>
<p>所以直接安装这个库:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libpython2.7-dev</span><br></pre></td></tr></table></figure>

<p>问题解决</p>
<h3 id="10-搜狗输入法"><a href="#10-搜狗输入法" class="headerlink" title="10. 搜狗输入法"></a>10. 搜狗输入法</h3><p><a target="_blank" rel="noopener" href="https://pinyin.sogou.com/linux/?r=pinyin">https://pinyin.sogou.com/linux/?r=pinyin</a></p>
<p>因为搜狗输入法依赖 fcitx，所以要先安装 fcitx</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fcitx</span><br></pre></td></tr></table></figure>

<p>下载搜狗输入法，使用 dpkg 安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i sogoupinyin_2.2.0.0108_amd64.deb</span><br></pre></td></tr></table></figure>

<p>报错，解决依赖关系</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt --fix-broken install</span><br></pre></td></tr></table></figure>

<p>启动器打开 输入法，配置为 fcitx。</p>
<p>设置 -&gt; 区域和语言 -&gt; 输入源：删除多余语言，只保留一个 汉语-&gt; 管理已安装的语言 -&gt; 添加或删除语言… ：只安装一个 中文简体</p>
<p>重启</p>
<p>注：搜狗输入法目前支持 ubuntu18.04，在 ubuntu20.04 上推荐使用谷歌输入法</p>
<h3 id="11-网易云音乐"><a href="#11-网易云音乐" class="headerlink" title="11. 网易云音乐"></a>11. 网易云音乐</h3><p><a target="_blank" rel="noopener" href="https://music.163.com/#/download">https://music.163.com/#/download</a></p>
<p>下载全部客户端，选择 Linux 版，双击下载的.dep 安装包即可</p>
<h3 id="12-百度网盘"><a href="#12-百度网盘" class="headerlink" title="12. 百度网盘"></a>12. 百度网盘</h3><p><a target="_blank" rel="noopener" href="https://pan.baidu.com/download">https://pan.baidu.com/download</a></p>
<p>下载.dep 包，然后双击安装即可</p>
<h3 id="13-Remmina"><a href="#13-Remmina" class="headerlink" title="13. Remmina"></a>13. Remmina</h3><p>软件中心搜索 “Remmina”</p>
<h3 id="14-Rhythmbox"><a href="#14-Rhythmbox" class="headerlink" title="14. Rhythmbox"></a>14. Rhythmbox</h3><p>软件中心搜索 “Rhythmbox”</p>
<h3 id="15-SVN"><a href="#15-SVN" class="headerlink" title="15. SVN"></a>15. SVN</h3><p>这个有点麻烦，没有可视化客户端，只能用命令行了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install subversion</span><br></pre></td></tr></table></figure>

<p>先略过。。。</p>
<h3 id="16-nfs"><a href="#16-nfs" class="headerlink" title="16. nfs"></a>16. nfs</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nfs-common</span><br></pre></td></tr></table></figure>

<p>这个有点麻烦，暂时略过，用坚果云代替先</p>
<h3 id="17-坚果云"><a href="#17-坚果云" class="headerlink" title="17. 坚果云"></a>17. 坚果云</h3><p><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/s/downloads">https://www.jianguoyun.com/s/downloads</a></p>
<p>下载 Linux 版，双击.dep 安装包即可</p>
<h3 id="18-配置-ssh"><a href="#18-配置-ssh" class="headerlink" title="18. 配置 ssh"></a>18. 配置 ssh</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/ssh/ssh_config	// 修改配置文件</span><br></pre></td></tr></table></figure>

<p>修改&amp;&amp;添加</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GSSAPIAuthentication no		// 默认<span class="built_in">yes</span>，修改为no</span><br><span class="line"></span><br><span class="line">ServerAliveInterval 55		// 每隔55秒发送一次请求</span><br><span class="line">ServerAliveCountMax 9		// 9次没有响应就断开连接</span><br></pre></td></tr></table></figure>

<p>重启</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ssh restart</span><br></pre></td></tr></table></figure>

<p>如果无法重启，则安装<code>openssh-server</code>后再重启</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>

<h3 id="19-phpMyAdmin"><a href="#19-phpMyAdmin" class="headerlink" title="19. phpMyAdmin"></a>19. phpMyAdmin</h3><p>因为 phpMyAdimin 默认只能访问本地数据库，但是我们的需求是可以连接远程服务器的数据库。</p>
<p>打开&#x2F;phpmyadmin&#x2F;libraries 目录，</p>
<p>修改 config.default.php 文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cfg</span>[<span class="string">&#x27;AllowArbitraryServer&#x27;</span>] = <span class="literal">false</span>;  修改成：<span class="variable">$cfg</span>[<span class="string">&#x27;AllowArbitraryServer&#x27;</span>] = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>然后把 phpMyAdmin 目录移动到&#x2F;data&#x2F;wwwroot 下，单独给它配置访问域名，因为如果通过二级目录去访问，有时候会报如下的错误：</p>
<p><img data-src="//img.lujinkai.cn/note/phpMyAdmin.png"></p>
<h3 id="20-postman"><a href="#20-postman" class="headerlink" title="20. postman"></a>20. postman</h3><p><a target="_blank" rel="noopener" href="https://www.getpostman.com/downloads/">https://www.getpostman.com/downloads/</a></p>
<p>解压，进入解压后的目录，直接执行 Postman 即可</p>
<p>但是没有桌面图标，这个我就不添加图标了，只在 &#x2F;ust&#x2F;local&#x2F;bin 目录下添加一个软链接指向 &#x2F;opt&#x2F;Postman&#x2F;Postman</p>
<p>未完待续。。。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%B7%A5%E5%85%B7/ubuntu/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E4%BF%AE%E6%94%B9%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B7%A5%E5%85%B7/ubuntu/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E4%BF%AE%E6%94%B9%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F/" class="post-title-link" itemprop="url">双系统修改引导启动顺序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:29:47" itemprop="dateCreated datePublished" datetime="2020-12-07T21:29:47+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>安装为双系统后，默认为 ubuntu 启动</p>
<p>现在将其设为，默认启动上次选择启动的系统（让 grub 记住上次启动时选择的系统）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br></pre></td></tr></table></figure>

<p>GRUB_DEFAULT&#x3D;0（0 为 ubuntu 启动）改为 GRUB_DEFAULT&#x3D;saved</p>
<p>文件末尾添加 GRUB_SAVEDEFAULT&#x3D;true（这行命令可以修复只修改“grub_deault&#x3D;saved”，但是启动时依然不能记住上次的启动的 GRUB2 的 bug）</p>
<p>保存退出</p>
<p>终端更新配置文件：sudo update-grub</p>
<p>sudo reboot 重启</p>
<p><strong>注：</strong></p>
<p>GRUB_TIMEOUT&#x3D;10 可调整自动进入时间</p>
<p>要固定默认启动系统，只需调整 GRUB_DEFAULT&#x3D;0 为 windows10 所在序号（ubuntu 为 0 以此类推），然后更新配置文件</p>
<p>附&#x2F;etc&#x2F;default&#x2F;grub 配置文件详解：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设定默认启动项，推荐使用数字</span></span><br><span class="line"><span class="attr">GRUB_DEFAULT</span>=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释掉下面这行将会显示引导菜单</span></span><br><span class="line"><span class="comment">#GRUB_HIDDEN_TIMEOUT=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 黑屏，并且不显示GRUB_HIDDEN_TIMEOUT过程中的倒计时</span></span><br><span class="line"><span class="attr">GRUB_HIDDEN_TIMEOUT_QUIET</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定超时时间，默认为10秒</span></span><br><span class="line"><span class="comment"># 设定为-1取消倒计时</span></span><br><span class="line"><span class="attr">GRUB_TIMEOUT</span>=<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获得发行版名称（比如Ubuntu, Debian）</span></span><br><span class="line"><span class="attr">GRUB_DISTRIBUTOR</span>=`lsb_release -i -s <span class="number">2</span>&gt; /dev/null || echo Debian`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将会导入到每个启动项（包括recovery mode启动项)的&#x27;linux&#x27;命令行</span></span><br><span class="line"><span class="attr">GRUB_CMDLINE_LINUX</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同上，但是只会添加到 normal mode 的启动项</span></span><br><span class="line"><span class="attr">GRUB_CMDLINE_LINUX_DEFAULT</span>=<span class="string">&quot;quiet splash&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消注释以允许图形终端（只适合grub-pc）</span></span><br><span class="line"><span class="comment">#GRUB_TERMINAL=console</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分辨率设定，否则采用默认值</span></span><br><span class="line"><span class="comment">#GRUB_GFXMODE=640x480</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消注释以阻止GRUB将传递参数 &quot;root=UUID=xxx&quot; 传递给 Linux</span></span><br><span class="line"><span class="comment">#GRUB_DISABLE_LINUX_UUID=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消启动菜单中的“Recovery Mode”选项</span></span><br><span class="line"><span class="comment">#GRUB_DISABLE_LINUX_RECOVERY=&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当GRUB菜单出现时发出鸣音提醒</span></span><br><span class="line"><span class="comment">#GRUB_INIT_TUNE=&quot;480 440 1&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/MySQL/cmake%E5%AE%89%E8%A3%85mysql%E5%8F%82%E6%95%B0%E5%A4%A7%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/MySQL/cmake%E5%AE%89%E8%A3%85mysql%E5%8F%82%E6%95%B0%E5%A4%A7%E5%85%A8/" class="post-title-link" itemprop="url">cmake安装mysql参数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:27:39" itemprop="dateCreated datePublished" datetime="2020-12-07T21:27:39+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考资料:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liu3292011/article/details/77993402">https://blog.csdn.net/liu3292011/article/details/77993402</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.codetd.com/article/2998816">https://www.codetd.com/article/2998816</a></p>
</li>
</ul>
<h2 id="CMAKE-BUILD-TYPE"><a href="#CMAKE-BUILD-TYPE" class="headerlink" title="CMAKE_BUILD_TYPE"></a>CMAKE_BUILD_TYPE</h2><p>cmake 的构建模式</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">CMAKE_BUILD_TYPE</span>=Debug | Release | RelWithDebInfo | MinSizeRel</span><br></pre></td></tr></table></figure>

<h2 id="CMAKE-INSTALL-PREFIX"><a href="#CMAKE-INSTALL-PREFIX" class="headerlink" title="CMAKE_INSTALL_PREFIX"></a>CMAKE_INSTALL_PREFIX</h2><p>mysql 的安装目录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">CMAKE_INSTALL_PREFIX</span> = /usr/local/mysql</span><br></pre></td></tr></table></figure>

<h2 id="COMMUNITY-BUILD"><a href="#COMMUNITY-BUILD" class="headerlink" title="COMMUNITY_BUILD"></a>COMMUNITY_BUILD</h2><p>是否为社区版本</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">COMMUNITY_BUILD</span> = <span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="DOWNLOAD-BOOST"><a href="#DOWNLOAD-BOOST" class="headerlink" title="DOWNLOAD_BOOST"></a>DOWNLOAD_BOOST</h2><p>是否从下载开源 boost</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DOWNLOAD_BOOST</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="DWITH-BOOST"><a href="#DWITH-BOOST" class="headerlink" title="DWITH_BOOST"></a>DWITH_BOOST</h2><p>This CMake script will look for boost in <directory>.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DWITH_BOOST</span> = &lt;directory&gt;</span><br></pre></td></tr></table></figure>

<h2 id="DOWNLOAD-BOOST-TIMEOUT"><a href="#DOWNLOAD-BOOST-TIMEOUT" class="headerlink" title="DOWNLOAD_BOOST_TIMEOUT"></a>DOWNLOAD_BOOST_TIMEOUT</h2><p>下载 boost 的超时时间, 单位 秒</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">DOWNLOAD_BOOST_TIMEOUT</span> = <span class="number">600</span></span><br></pre></td></tr></table></figure>

<h2 id="ENABLED-PROFILING"><a href="#ENABLED-PROFILING" class="headerlink" title="ENABLED_PROFILING"></a>ENABLED_PROFILING</h2><p>是否启用查询分析代码 参考</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ENABLED_PROFILING</span> = <span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="ENABLE-GCOV"><a href="#ENABLE-GCOV" class="headerlink" title="ENABLE_GCOV"></a>ENABLE_GCOV</h2><p>是否包括 gcov 支持, 不太懂这是什么, 默认关闭.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ENABLE_GCOV</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="ENABLE-GPROF"><a href="#ENABLE-GPROF" class="headerlink" title="ENABLE_GPROF"></a>ENABLE_GPROF</h2><p>启用 gprof, (仅优化 Linux 版本), 不太懂, 默认关闭</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ENABLE_GPROF</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="ENABLE-MEMCACHED-SASL"><a href="#ENABLE-MEMCACHED-SASL" class="headerlink" title="ENABLE_MEMCACHED_SASL"></a>ENABLE_MEMCACHED_SASL</h2><p>不太懂, 默认关闭</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ENABLE_MEMCACHED_SASL</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="ENABLE-MEMCACHED-SASL-PWDB"><a href="#ENABLE-MEMCACHED-SASL-PWDB" class="headerlink" title="ENABLE_MEMCACHED_SASL_PWDB"></a>ENABLE_MEMCACHED_SASL_PWDB</h2><p>不太懂, 看起来和上面一起是配套的, 也默认关闭</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENABLE_MEMCACHED_SASL_PWDB:<span class="attr">BOOL</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="FEATURE-SET"><a href="#FEATURE-SET" class="headerlink" title="FEATURE_SET"></a>FEATURE_SET</h2><p>这也不太懂, 默认就好了, 它的注释说这个选项好像已经被弃用了</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">FEATURE_SET</span>=community</span><br></pre></td></tr></table></figure>

<h2 id="INSTALL-LAYOUT"><a href="#INSTALL-LAYOUT" class="headerlink" title="INSTALL_LAYOUT"></a>INSTALL_LAYOUT</h2><p>选择预定义的安装布局, STANDALONE</p>
<ul>
<li><code>STANDALONE</code>：与用于<code>.tar.gz</code>和<code>.zip</code> 包的布局相同 。这是默认值。</li>
<li><code>RPM</code>：布局类似于 RPM 包</li>
<li><code>SVR4</code>：Solaris 包布局</li>
<li><code>DEB</code>：DEB 封装布局（实验）</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">INSTALL_LAYOUT</span> = STANDALONE</span><br></pre></td></tr></table></figure>

<h2 id="MYSQL-DATADIR"><a href="#MYSQL-DATADIR" class="headerlink" title="MYSQL_DATADIR"></a>MYSQL_DATADIR</h2><p>默认的 mysql 数据目录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MYSQL_DATADIR</span> = /usr/local/mysql/data</span><br></pre></td></tr></table></figure>

<h2 id="MYSQL-KEYRINGDIR"><a href="#MYSQL-KEYRINGDIR" class="headerlink" title="MYSQL_KEYRINGDIR"></a>MYSQL_KEYRINGDIR</h2><p>默认的 mysql 手册目录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MYSQL_KEYRINGDIR</span>=/usr/local/mysql/keyring</span><br></pre></td></tr></table></figure>

<h2 id="OPTIMIZER-TRACE"><a href="#OPTIMIZER-TRACE" class="headerlink" title="OPTIMIZER_TRACE"></a>OPTIMIZER_TRACE</h2><p>optimizer_trace 是 mysql5.6 之后加入的新功能, explain 是各种执行计划选择的结果, 如果想看整个执行计划以及对于多种索引方案之间是如何选择的, 就使用 optimizer_trace 这个功能</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">OPTIMIZER_TRACE</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="REPRODUCIBLE-BUILD"><a href="#REPRODUCIBLE-BUILD" class="headerlink" title="REPRODUCIBLE_BUILD"></a>REPRODUCIBLE_BUILD</h2><p>不太懂, 默认关闭</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">REPRODUCIBLE_BUILD</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="TMPDIR"><a href="#TMPDIR" class="headerlink" title="TMPDIR"></a>TMPDIR</h2><p>临时文件的目录，P_tmpdir 的值可以在 &#x2F;usr&#x2F;include&#x2F;stdio.h 中查看，默认 &#x2F;tmp</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TMPDIR</span> = P_tmpdir</span><br></pre></td></tr></table></figure>

<h2 id="WITH-xxx-STORAGE-ENGINE"><a href="#WITH-xxx-STORAGE-ENGINE" class="headerlink" title="WITH_xxx_STORAGE_ENGINE"></a>WITH_xxx_STORAGE_ENGINE</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_ARCHIVE_STORAGE_ENGINE</span>=<span class="literal">ON</span></span><br><span class="line"><span class="attr">WITH_BLACKHOLE_STORAGE_ENGINE</span>=<span class="literal">ON</span></span><br><span class="line"><span class="attr">WITH_FEDERATED_STORAGE_ENGINE</span>=<span class="literal">ON</span></span><br><span class="line"><span class="attr">WITH_INNOBASE_STORAGE_ENGINE</span>=<span class="literal">ON</span></span><br><span class="line"><span class="attr">WITH_PARTITION_STORAGE_ENGINE</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<p>分别开启 ARCHIVE 、BLACKHOLE 、FEDERATED、INNOBASE、PARTITION 引擎，默认都是开启的</p>
<h2 id="WITH-ASAN"><a href="#WITH-ASAN" class="headerlink" title="WITH_ASAN"></a>WITH_ASAN</h2><p>是否启用 AddressSanitizer , 不太懂, 默认是关闭的</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_ASAN</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-ASAN-SCOPE"><a href="#WITH-ASAN-SCOPE" class="headerlink" title="WITH_ASAN_SCOPE"></a>WITH_ASAN_SCOPE</h2><p>不太懂, 看起来像是和上面一个选项是配套的, 默认关闭</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_ASAN_SCOPE</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-CLIENT-PROTOCOL-TRACING"><a href="#WITH-CLIENT-PROTOCOL-TRACING" class="headerlink" title="WITH_CLIENT_PROTOCOL_TRACING"></a>WITH_CLIENT_PROTOCOL_TRACING</h2><p>是否将客户端协议跟踪框架构建到客户端库中。默认情况下，此选项被启用</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_CLIENT_PROTOCOL_TRACING</span> = <span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-DEBUG-BOOL"><a href="#WITH-DEBUG-BOOL" class="headerlink" title="WITH_DEBUG:BOOL"></a>WITH_DEBUG:BOOL</h2><p>是否包括调试支持，默认关闭</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WITH_DEBUG=OFF</span><br></pre></td></tr></table></figure>

<h2 id="WITH-DEFAULT-COMPILER-OPTIONS"><a href="#WITH-DEFAULT-COMPILER-OPTIONS" class="headerlink" title="WITH_DEFAULT_COMPILER_OPTIONS"></a>WITH_DEFAULT_COMPILER_OPTIONS</h2><p>是否使用默认的编译器来编译, 也就是 cmake</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_DEFAULT_COMPILER_OPTIONS</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-DEFAULT-FEATURE-SET"><a href="#WITH-DEFAULT-FEATURE-SET" class="headerlink" title="WITH_DEFAULT_FEATURE_SET"></a>WITH_DEFAULT_FEATURE_SET</h2><p>是否使用 cmake 的特性集</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_DEFAULT_FEATURE_SET</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-EDITLINE"><a href="#WITH-EDITLINE" class="headerlink" title="WITH_EDITLINE"></a>WITH_EDITLINE</h2><p>要使用 哪个<code>libedit</code>&#x2F; <code>editline</code>库。允许的值为 <code>bundled</code>（默认值）和 <code>system</code>。<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_editline"><code>WITH_EDITLINE</code></a>被添加到 MySQL 5.7.2 中。它取而代之<code>WITH_LIBEDIT</code>，已被删除</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_EDITLINE</span> = bundled</span><br></pre></td></tr></table></figure>

<h2 id="WITH-EMBEDDED-SERVER"><a href="#WITH-EMBEDDED-SERVER" class="headerlink" title="WITH_EMBEDDED_SERVER"></a>WITH_EMBEDDED_SERVER</h2><p>是否构建<code>libmysqld</code>嵌入式服务器库。 注意: 从<code>libmysqld</code>MySQL 5.7.17 起，嵌入式服务器库已被弃用，MySQL 8.0 中将被删除</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_EMBEDDED_SERVER</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-EXTRA-CHARSETS"><a href="#WITH-EXTRA-CHARSETS" class="headerlink" title="WITH_EXTRA_CHARSETS"></a>WITH_EXTRA_CHARSETS</h2><p>哪些额外的字符集包括： all, complex, none</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_EXTRA_CHARSETS</span>=all</span><br></pre></td></tr></table></figure>

<h2 id="WITH-INNODB-MEMCACHED"><a href="#WITH-INNODB-MEMCACHED" class="headerlink" title="WITH_INNODB_MEMCACHED"></a>WITH_INNODB_MEMCACHED</h2><p>是否生成 memcached 共享库（<code>libmemcached.so</code>和 <code>innodb_engine.so</code>）</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_INNODB_MEMCACHED</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-LZ4-STRING"><a href="#WITH-LZ4-STRING" class="headerlink" title="WITH_LZ4:STRING"></a>WITH_LZ4:STRING</h2><ul>
<li>bundled：使用 LZ4 与发行版捆绑在一起的库。这是默认值</li>
<li>system：使用系统 LZ4 库。如果 WITH_LZ4 设置为此值，则不构建 lz4_decompress 实用程序。在这种情况下， 可以使用系统 lz4 命令</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_LZ4</span> = bundled</span><br></pre></td></tr></table></figure>

<h2 id="WITH-MSAN"><a href="#WITH-MSAN" class="headerlink" title="WITH_MSAN"></a>WITH_MSAN</h2><p>是否启用 MemorySanitizer，支持它的编译器。默认是关闭。对于此选项，如果启用该功能，则所有连接到 MySQL 的库也必须已经通过启用该选项进行编译。此选项已添加到 MySQL 5.7.4 中</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_MSAN</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-RAPID"><a href="#WITH-RAPID" class="headerlink" title="WITH_RAPID"></a>WITH_RAPID</h2><p>是否构建快速开发周期插件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_RAPID</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-SASL"><a href="#WITH-SASL" class="headerlink" title="WITH_SASL"></a>WITH_SASL</h2><p>不太懂</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_SASL</span> = system</span><br></pre></td></tr></table></figure>

<h2 id="WITH-SSL"><a href="#WITH-SSL" class="headerlink" title="WITH_SSL"></a>WITH_SSL</h2><p>要包含的 SSL 支持类型或要使用的 OpenSSL 安装的路径名。</p>
<ul>
<li><code>ssl_type</code> 可以是以下值之一：<ul>
<li><code>yes</code>：使用系统 SSL 库（如果存在），否则与发行版捆绑在一起的库</li>
<li><code>bundled</code>：使用与发行版捆绑在一起的 SSL 库。这是默认值</li>
<li><code>system</code>：使用系统 SSL 库</li>
</ul>
</li>
<li><code>path_name</code>是要使用的 OpenSSL 安装的路径名。使用这个可能比使用这个<code>ssl_type</code>值 更好 <code>system</code>，因为它可以防止 CMake 检测并使用系统上安装的较旧或不正确的 OpenSSL 版本。（另一个允许的方式做同样的事情是设置 <code>CMAKE_PREFIX_PATH</code>选项 <code>path_name</code>。）</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_SSL</span> = ssl_type | path_name</span><br></pre></td></tr></table></figure>

<h2 id="WITH-TEST-TRACE-PLUGIN"><a href="#WITH-TEST-TRACE-PLUGIN" class="headerlink" title="WITH_TEST_TRACE_PLUGIN"></a>WITH_TEST_TRACE_PLUGIN</h2><p>是否构建测试协议跟踪客户端插件. 默认情况下，此选项被禁用。启用此选项不起作用，除非该<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_client_protocol_tracing"><code>WITH_CLIENT_PROTOCOL_TRACING</code></a> 选项被启用。如果 MySQL 配置启用了这两个选项，<code>libmysqlclient</code>客户端库将内置测试协议跟踪插件构建，所有标准的 MySQL 客户端都会加载该插件。但是，即使启用测试插件，默认情况下也不起作用。使用环境变量来控制插件; 请参见<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/writing-protocol-trace-plugins.html#test-protocol-trace-plugin">第 28.2.4.11.1 节“使用测试协议跟踪插件”</a>。</p>
<blockquote>
<p>不要启用 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_test_trace_plugin"><code>WITH_TEST_TRACE_PLUGIN</code></a>，如果你想使用自己的协议跟踪的插件，因为只有一个这样的插件可以在同一时间被加载并出现错误尝试加载第二个选项。如果您已经使用启用了测试协议跟踪插件的 MySQL 来构建 MySQL，以了解它是如何工作的，那么在使用自己的插件之前，您必须重新构建 MySQL。</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_TEST_TRACE_PLUGIN</span> = <span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-UBSAN"><a href="#WITH-UBSAN" class="headerlink" title="WITH_UBSAN"></a>WITH_UBSAN</h2><p>是否为支持它的编译器启用 Undefined Behavior Sanitizer。默认是关闭。此选项已添加到 MySQL 5.7.6</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_UBSAN</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-UNIT-TESTS"><a href="#WITH-UNIT-TESTS" class="headerlink" title="WITH_UNIT_TESTS"></a>WITH_UNIT_TESTS</h2><p>如果启用，则使用单元测试编译 MySQL。默认值为 ON，除非服务器未被编译</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_UNIT_TESTS</span>=<span class="literal">ON</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-VALGRIND"><a href="#WITH-VALGRIND" class="headerlink" title="WITH_VALGRIND"></a>WITH_VALGRIND</h2><p>是否在 Valgrind 头文件中编译，这将 Valgrind API 暴露给 MySQL 代码。默认是 <code>OFF</code></p>
<p>要生成一个 Valgrind 感知的调试构建， <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_valgrind"><code>-DWITH_VALGRIND=1</code></a>通常与之结合<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_debug"><code>-DWITH_DEBUG=1</code></a>。请参阅 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/internals/en/debug-configurations.html">构建调试配置</a></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_VALGRIND</span>=<span class="literal">OFF</span></span><br></pre></td></tr></table></figure>

<h2 id="WITH-ZLIB"><a href="#WITH-ZLIB" class="headerlink" title="WITH_ZLIB"></a>WITH_ZLIB</h2><p>某些功能要求服务器使用压缩库支持（如功能<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/encryption-functions.html#function_compress"><code>COMPRESS()</code></a>和 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/encryption-functions.html#function_uncompress"><code>UNCOMPRESS()</code></a>功能）以及客户端&#x2F;服务器协议的压缩来构建 。这 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/source-configuration-options.html#option_cmake_with_zlib"><code>WITH_ZLIB</code></a>表明<code>zlib</code>支持的来源：</p>
<ul>
<li><code>bundled</code>：使用<code>zlib</code>与发行版捆绑在一起的 库。这是默认值。</li>
<li><code>system</code>：使用系统 <code>zlib</code>库。</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">WITH_ZLIB</span>=bundled</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/restful%E9%A3%8E%E6%A0%BC%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/restful%E9%A3%8E%E6%A0%BC%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">restful 风格设计接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:23:01" itemprop="dateCreated datePublished" datetime="2020-12-07T21:23:01+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>按 resful 风格设计接口: 按资源来设置接口的请求地址, 通过不同的请求类型来区分要对这个资源进行什么操作</p>
<p>get 语义是获取数据</p>
<p>post 语义是添加信息</p>
<p>delete 语义是删除数据</p>
<p>put 语义是更新数据（是更新这个数据的【所有信息】）</p>
<p>patch 语义是更新数据（是更新数据的【部分信息】）</p>
<p>假如要做注册</p>
<p>请求类型: post</p>
<p>请求地址: ‘&#x2F;users’ (必须表示的是资源)</p>
<p>假如要做登录</p>
<p>请求类型: post (因为登录之后服务器的变化就添加了一个 session)</p>
<p>请求地址: ‘&#x2F;sessions’</p>
<p>假如要做退出登录</p>
<p>请求类型: delete</p>
<p>请求地址: ‘&#x2F;sessions&#x2F;id’ (退出登录就是服务器删除 session)</p>
<p>假如要判断用户有没有登录</p>
<p>请求类型: get</p>
<p>请求地址 ‘&#x2F;sessions’</p>
<p>总结: restful 风格 api</p>
<ol>
<li><p>我们使用一个能够表示资源的地址(资源是数据库里的一条数据, 或是数组里的一个元素, 或者文件夹中的一个文件)</p>
</li>
<li><p>我们通过不同的请求类型(get, post, delete, put, patch), 对这个地址对应的资源进行 CRUL, 让后端代码根据不同的请求类型, 对数据做不同的操作</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 路由处理</span></span><br><span class="line"><span class="comment"> * 最终这里我们只配置路由, 不实现对应回调函数的具体代码(放到controllers文件夹中)</span></span><br><span class="line"><span class="comment"> * 按 restful 风格设计接口:</span></span><br><span class="line"><span class="comment"> * 按资源来设计我们的接口的请求地址， 通过不同的请求类型，来区分要对这个资源进行什么操作</span></span><br><span class="line"><span class="comment"> * 示例:</span></span><br><span class="line"><span class="comment"> * &#x27;/gamerooms/998&#x27; 对应998这个房间号</span></span><br><span class="line"><span class="comment"> * // 获取房间的信息</span></span><br><span class="line"><span class="comment"> * router.get(&#x27;/gamerooms/998&#x27;, handler001)</span></span><br><span class="line"><span class="comment"> * // 删除该房间</span></span><br><span class="line"><span class="comment"> * router.delete(&#x27;/gamerooms/998, handler002)</span></span><br><span class="line"><span class="comment"> * // 修改房间信息</span></span><br><span class="line"><span class="comment"> * router.put(&#x27;/gamerooms/998, handler003)</span></span><br><span class="line"><span class="comment"> * // 添加新房间</span></span><br><span class="line"><span class="comment"> * router.post(&#x27;/gamerooms&#x27;, handler004)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * // get 语义是获取数据</span></span><br><span class="line"><span class="comment"> * // delete 语义是删除数据</span></span><br><span class="line"><span class="comment"> * // put 语义是更新数据(是更新这个数据的【所有信息】)</span></span><br><span class="line"><span class="comment"> * // patch 语义是更数据(是更【新部分信息】)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> gameRoomController = <span class="built_in">require</span>(<span class="string">&quot;../controllers/gameRoomController.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> friendController = <span class="built_in">require</span>(<span class="string">&quot;../controllers/friendController.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> userController = <span class="built_in">require</span>(<span class="string">&quot;../controllers/userController.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = (<span class="variable language_">module</span>.<span class="property">exports</span> = express.<span class="title class_">Router</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/users&quot;</span>, userController.<span class="property">postSignUp</span>);</span><br><span class="line"><span class="comment">// 登陆</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/session&quot;</span>, userController.<span class="property">postSignIn</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 游戏房间</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/gamerooms&quot;</span>, gameRoomController.<span class="property">postGameRooms</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/gamerooms&quot;</span>, gameRoomController.<span class="property">getGameRooms</span>);</span><br><span class="line"><span class="comment">// 搜索用户, 和获取好友</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/users&quot;</span>, userController.<span class="property">getUsers</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/friends&quot;</span>, friendController.<span class="property">getFriends</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/friends&quot;</span>, friendController.<span class="property">postFirends</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 游戏房间创建，删除，修改，查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// router.post(&#x27;/gamerooms&#x27;, gameRoomController.postGameRooms)</span></span><br><span class="line"><span class="comment">// router.get(&#x27;/gamerooms&#x27;, gameRoomController.getGameRooms)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 游戏记录，查询游戏记录，删除游戏记录，修改记录， 添加记录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 假设游戏记录地址是: /gamerecords/10002   (包含: 游戏房间号，玩家，游戏时间)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取一条游戏记录详细信息</span></span><br><span class="line"><span class="comment">// router.get(&#x27;/gamerecords/10002&#x27;, xxxx001)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除这条游戏记录信息</span></span><br><span class="line"><span class="comment">// router.delete(&#x27;/gamerecords/10002&#x27;, xxxx002)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改记录(想修改游戏的所有信息： 房间号，玩家, 游戏时间)</span></span><br><span class="line"><span class="comment">// router.put(&#x27;/gamerecords/10002&#x27;, xxxx003)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改记录(只想修改房间号)</span></span><br><span class="line"><span class="comment">// router.patch(&#x27;/gamerecords/10002&#x27;, xxxx04)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一条游戏记录</span></span><br><span class="line"><span class="comment">// router.post(&#x27;/gamerecords/10002&#x27;, xxxx05)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有游戏记录(也可能包含分页)</span></span><br><span class="line"><span class="comment">// router.get(&#x27;/gamerecords&#x27;, xxxx07)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于前端来说 restful api 有没有开发难度:</span></span><br><span class="line"><span class="comment">// $.ajax(&#123;</span></span><br><span class="line"><span class="comment">//   url: &#x27;&#x27;,</span></span><br><span class="line"><span class="comment">//   // type: &#x27;delete&#x27;,</span></span><br><span class="line"><span class="comment">//   type: &#x27;put&#x27;,</span></span><br><span class="line"><span class="comment">//   data: &#123;&#125;,</span></span><br><span class="line"><span class="comment">//   success: function () &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// users/10002</span></span><br><span class="line"><span class="comment">// 假如要做注册：</span></span><br><span class="line"><span class="comment">// 请求类型: post</span></span><br><span class="line"><span class="comment">// 请求地址: &#x27;/users&#x27;   (必需表示的是资源)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假如要做登陆:</span></span><br><span class="line"><span class="comment">// 请求类型: post</span></span><br><span class="line"><span class="comment">// 请求地址: /sessions    // 因为登陆其实是添加的 session</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假如退出登陆</span></span><br><span class="line"><span class="comment">// 请求类型: delete</span></span><br><span class="line"><span class="comment">// 请求地址: /sessions/id    // 退出登陆，服务器是要删除session</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 假如要判断用户有没有登陆</span></span><br><span class="line"><span class="comment">// 请求类型: get</span></span><br><span class="line"><span class="comment">// 请求地址: /sessions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x27;/deluser&#x27;</span></span><br><span class="line"><span class="comment">// &#x27;/getuser&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 总结: restful 风格 api</span></span><br><span class="line"><span class="comment">// 1. 我们使用一个能够表示资源的地址(资源是数据库里的一条数据,或者数组里的一个元素,或者文件夹中的一个文件)</span></span><br><span class="line"><span class="comment">// 2. 我们通过不同的请求类型(get, post, delete, put, patch), 对这个地址对应的资源</span></span><br><span class="line"><span class="comment">// 进行CRUD, 让后端代码根据不同的请求类型，对数据做不同的操作。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我遵循的风格: javascrtip standard style</span></span><br><span class="line"><span class="comment">// function xxx () &#123;</span></span><br><span class="line"><span class="comment">//   var aa = 11;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/WebSocket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/WebSocket/" class="post-title-link" itemprop="url">WebSocket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:19:59" itemprop="dateCreated datePublished" datetime="2020-12-07T21:19:59+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>WebSocket 是 HTML5 出的东西(协议)</p>
<p><strong>WebSocket 协议的目标是在一个独立的持久连接上提供全双工双向通信。客户端和服务器可以向对方主动发送和接受数据。在 JS 中创建 WebSocket 后，会有一个 HTTP 请求发向浏览器以发起请求。在取得服务器响应后，建立的连接会使用 HTTP 升级将 HTTP 协议转换为 WebSocket 协议。也就是说，使用标准的 HTTP 协议无法实现 WebSocket，只有支持那些协议的专门浏览器才能正常工作。</strong></p>
<p>由于 WebScoket 使用了自定义协议，所以 URL 与 HTTP 协议略有不同。未加密的连接为 ws:&#x2F;&#x2F;，而不是 http:&#x2F;&#x2F;。加密的连接为 wss:&#x2F;&#x2F;，而不是 https:&#x2F;&#x2F;。</p>
<p>WebSocket 是应用层协议，是 TCP&#x2F;IP 协议的子集，通过 HTTP&#x2F;1.1 协议的 101 状态码进行握手。<strong>也就是说，WebSocket 协议的建立需要先借助 HTTP 协议，在服务器返回 101 状态码之后，就可以进行 websocket 全双工双向通信了，就没有 HTTP 协议什么事情了</strong>。</p>
<p>WebSocket 是基于 TCP 的，TCP 的握手和 WebSocket 的握手是不同层次的。<br>TCP 的握手用来保证链接的建立，WebSocket 的握手是在 TCP 链接建立后告诉服务器这是个 WebSocket 链接，服务器你要按 WebSocket 的协议来处理这个 TCP 链接。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%B7%A5%E5%85%B7/%E5%90%84%E7%A7%8D%E6%BF%80%E6%B4%BB%E7%A0%81%E6%B3%A8%E5%86%8C%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B7%A5%E5%85%B7/%E5%90%84%E7%A7%8D%E6%BF%80%E6%B4%BB%E7%A0%81%E6%B3%A8%E5%86%8C%E7%A0%81/" class="post-title-link" itemprop="url">各种激活码注册码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:17:40" itemprop="dateCreated datePublished" datetime="2020-12-07T21:17:40+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="jetbrains-全家桶"><a href="#jetbrains-全家桶" class="headerlink" title="jetbrains 全家桶"></a>jetbrains 全家桶</h2><p><a target="_blank" rel="noopener" href="https://pan.lanzoui.com/b0f1c6hzc">https://pan.lanzoui.com/b0f1c6hzc</a></p>
<p><a target="_blank" rel="noopener" href="https://jetbra.in/s">https://jetbra.in/s</a></p>
<h2 id="ltsc-2019-自带的-kms-激活"><a href="#ltsc-2019-自带的-kms-激活" class="headerlink" title="ltsc 2019 自带的 kms 激活"></a>ltsc 2019 自带的 kms 激活</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slmgr /skms kms.digiboy.ir</span><br><span class="line">slmgr /ato</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%B7%A5%E5%85%B7/CapsLk%E6%98%A0%E5%B0%84Esc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B7%A5%E5%85%B7/CapsLk%E6%98%A0%E5%B0%84Esc/" class="post-title-link" itemprop="url">CapsLk映射Esc</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 21:16:21" itemprop="dateCreated datePublished" datetime="2020-12-07T21:16:21+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layout]</span><br><span class="line">&quot;Scancode Map&quot;=hex:00,00,00,00,00,00,00,00,02,00,00,00,01,00,3a,00,00,00,00,00</span><br></pre></td></tr></table></figure>

<p>将以上内容复制到 reg 后缀的文件中, 双击, 然后重启电脑即可</p>
<h2 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/usr/bin/setxkbmap -option &quot;caps:escape&quot;&#x27;</span> &gt;&gt; ~/.profile</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<p>修改 &#x2F;etc&#x2F;default&#x2F;keyboard</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XKBOPTIONS=&quot;caps:escape&quot;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/Vue2/webpack%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/Vue2/webpack%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">webpack项目打包优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 18:40:59" itemprop="dateCreated datePublished" datetime="2020-12-07T18:40:59+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue2/" itemprop="url" rel="index"><span itemprop="name">Vue2</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="externals-方案"><a href="#externals-方案" class="headerlink" title="externals 方案"></a>externals 方案</h2><p>将体积大而且不需要按需加载的包通过<code>CDN</code>的方式加载, 不参与打包, 例如: <code>vue</code>、<code>axios</code>、<code>vue-router</code> , 通过<code>CDN</code>加载的包不能使用<code>Vue.use()</code></p>
<h3 id="引入资源"><a href="#引入资源" class="headerlink" title="引入资源"></a>引入资源</h3><p>在 index.html 中通过 link 和 script 方法引入所需的 js 和 css</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1607337743495.png"></p>
<h3 id="配置-externals"><a href="#配置-externals" class="headerlink" title="配置 externals"></a>配置 externals</h3><p>在 <code>webpack.dev.conf.js</code> 和 <code>webpack.prod.conf.js</code> 的<code>module</code>下均添加<code>externals</code>, 这样<code>webpack</code>编译打包时不处理它, 却可以 import 引用到它。</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1607337762271.png"></p>
<p>vue-cli3.0 不需要以上此配置。</p>
<h2 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h2><p>每个包按需加载的方式都不同, 这里以 <code>element-ui</code> 为例, 在<code>main.js</code>主入口文件中给<code>element-ui</code>组件库做按需导入设置，去除没有使用的组件，进一步精简项目的总代码量。<br>参考: <a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/quickstart">https://element.eleme.cn/#/zh-CN/component/quickstart</a></p>
<h3 id="安装-babel-plugin-component"><a href="#安装-babel-plugin-component" class="headerlink" title="安装 babel-plugin-component"></a>安装 <code>babel-plugin-component</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-component -D</span><br></pre></td></tr></table></figure>

<h3 id="修改-babelrc"><a href="#修改-babelrc" class="headerlink" title="修改 .babelrc "></a>修改 <code>.babelrc </code></h3><p><img data-src="//img.to2b.cn/blog/ljk/1607337779527.png"></p>
<h3 id="按需引入"><a href="#按需引入" class="headerlink" title="按需引入"></a>按需引入</h3><p>完整组件列表和引入方式（完整组件列表以 <a target="_blank" rel="noopener" href="https://github.com/ElemeFE/element/blob/master/components.json">components.json</a> 为准）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">	<span class="title class_">Pagination</span>,</span><br><span class="line">	<span class="title class_">Dialog</span>,</span><br><span class="line">	<span class="title class_">Autocomplete</span>,</span><br><span class="line">	<span class="title class_">Dropdown</span>,</span><br><span class="line">	<span class="title class_">DropdownMenu</span>,</span><br><span class="line">	<span class="title class_">DropdownItem</span>,</span><br><span class="line">	<span class="title class_">Menu</span>,</span><br><span class="line">	<span class="title class_">Submenu</span>,</span><br><span class="line">	<span class="title class_">MenuItem</span>,</span><br><span class="line">	<span class="title class_">MenuItemGroup</span>,</span><br><span class="line">	<span class="title class_">Input</span>,</span><br><span class="line">	<span class="title class_">InputNumber</span>,</span><br><span class="line">	<span class="title class_">Radio</span>,</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	<span class="title class_">Loading</span>,</span><br><span class="line">	<span class="title class_">MessageBox</span>,</span><br><span class="line">	<span class="title class_">Message</span>,</span><br><span class="line">	<span class="title class_">Notification</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$ELEMENT</span> = &#123; <span class="attr">size</span>: <span class="string">&quot;small&quot;</span> &#125; <span class="comment">// element-ui的全局配置</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Pagination</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Dialog</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Autocomplete</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Dropdown</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">DropdownMenu</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">DropdownItem</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Menu</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Submenu</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">MenuItem</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">MenuItemGroup</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Input</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">InputNumber</span>)</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Radio</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Loading</span>.<span class="property">directive</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$loading</span> = <span class="title class_">Loading</span>.<span class="property">service</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$msgbox</span> = <span class="title class_">MessageBox</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$alert</span> = <span class="title class_">MessageBox</span>.<span class="property">alert</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$confirm</span> = <span class="title class_">MessageBox</span>.<span class="property">confirm</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$prompt</span> = <span class="title class_">MessageBox</span>.<span class="property">prompt</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$notify</span> = <span class="title class_">Notification</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$message</span> = <span class="title class_">Message</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/Vue2/vuex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/Vue2/vuex/" class="post-title-link" itemprop="url">vuex</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 18:39:38" itemprop="dateCreated datePublished" datetime="2020-12-07T18:39:38+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue2/" itemprop="url" rel="index"><span itemprop="name">Vue2</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>Vuex</code>是实现组件之间<strong>数据共享</strong>的一种机制</p>
<p>父子传值或者兄弟传值，不好管理，而且有些需求实现不了</p>
<p><code>vuex</code>提供了一种全新的数据共享管理机制, 该模式相比较简单的组件传值更加高端、大气、上档次</p>
<h2 id="初始化-vuex"><a href="#初始化-vuex" class="headerlink" title="初始化 vuex"></a>初始化 vuex</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vuex -S</span><br></pre></td></tr></table></figure>

<h2 id="导入并注册"><a href="#导入并注册" class="headerlink" title="导入并注册"></a>导入并注册</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Vuex</span>);</span><br></pre></td></tr></table></figure>

<h2 id="创建-store-公共状态对象"><a href="#创建-store-公共状态对象" class="headerlink" title="创建 store 公共状态对象"></a>创建 store 公共状态对象</h2><p>在 main.js 文件中添加:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// state 中存放的，就是全局共享的数据，可以把 state 认为 是组件中的 data</span></span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="将创建的-store-挂载到-vm-实例上"><a href="#将创建的-store-挂载到-vm-实例上" class="headerlink" title="将创建的 store 挂载到 vm 实例上"></a>将创建的 store 挂载到 vm 实例上</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">c</span>) =&gt;</span> <span class="title function_">c</span>(app),</span><br><span class="line">  router,</span><br><span class="line">  store, <span class="comment">// 将 创建的共享状态对象，挂载到 Vue 实例中，这样，所有的组件，就可以直接从 store 中获取 全局的数据了</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="访问信息"><a href="#访问信息" class="headerlink" title="访问信息"></a>访问信息</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">xxx</span>;</span><br></pre></td></tr></table></figure>

<h2 id="修改信息"><a href="#修改信息" class="headerlink" title="修改信息"></a>修改信息</h2><p>不要直接修改<code>this.$store.state.xxx</code>，容易造成数据混乱</p>
<h3 id="mutations-方式"><a href="#mutations-方式" class="headerlink" title="mutations 方式"></a>mutations 方式</h3><p>同步</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mutations</span>:&#123;</span><br><span class="line"> 	<span class="comment">// 参数state是固定的，代表vuex本身的state，用以获取共享数据</span></span><br><span class="line">	<span class="title function_">add</span>(<span class="params">state</span>)&#123;</span><br><span class="line">		state.<span class="property">count</span>++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">commit</span>(<span class="string">&#x27;add&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="actions-方式"><a href="#actions-方式" class="headerlink" title="actions 方式"></a>actions 方式</h3><p>异步</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h3><p>store 中存储的数据,不要放到 data 中, 而是要放到计算你属性中，因为：</p>
<ol>
<li>如果将字符串, 数字这些普通值赋值给 data 中的属性时,当我们使用双向数据绑定来修改 data 中的数据时, 原来 store 中的数据是不会被影响的</li>
<li>vue 官方推荐使用 mutation 的方式来统一修改 store 中的数据, mutation 是需要我们定义的</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/Vue2/vue-cli%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/Vue2/vue-cli%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">vue-cli构建项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-07 18:34:39" itemprop="dateCreated datePublished" datetime="2020-12-07T18:34:39+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/Vue2/" itemprop="url" rel="index"><span itemprop="name">Vue2</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="全局安装脚手架"><a href="#全局安装脚手架" class="headerlink" title="全局安装脚手架"></a>全局安装脚手架</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vue-cli</span><br></pre></td></tr></table></figure>

<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack my-project</span><br></pre></td></tr></table></figure>

<p><img data-src="//img.to2b.cn/blog/20190911102309.png"></p>
<p><code>Vue build</code> 选择 <code>Runtime-only</code> 选项<br><code>Use ESLint to lint your code?</code> 这个本应该应该 yes, 但是作为个人开发者, 选择 no 比较方便<br><code>Should we run npm install for you after the project has been created?</code> 选择 <code>No, I will handle that myself</code></p>
<h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd my-project	// 切换到项目根目录下</span><br><span class="line">npm install		// 安装依赖包</span><br></pre></td></tr></table></figure>

<h2 id="给webpack做简单的配置"><a href="#给webpack做简单的配置" class="headerlink" title="给webpack做简单的配置"></a>给<code>webpack</code>做简单的配置</h2><h3 id="默认-8080-端口-可以选择修改"><a href="#默认-8080-端口-可以选择修改" class="headerlink" title="默认 8080 端口, 可以选择修改"></a>默认 8080 端口, 可以选择修改</h3><p><img data-src="//img.to2b.cn/blog/1568166821268.png" alt="1568166821268"></p>
<h3 id="修改打包后的-js-和-css-为相对路径引入"><a href="#修改打包后的-js-和-css-为相对路径引入" class="headerlink" title="修改打包后的 js 和 css 为相对路径引入"></a>修改打包后的 js 和 css 为相对路径引入</h3><p>build 下的 webpack.prod.conf.js 中得 output 中添加 publicPath。</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1577149564119.png"></p>
<h3 id="设置网站-logo"><a href="#设置网站-logo" class="headerlink" title="设置网站 logo"></a>设置网站 logo</h3><p>webpack.dev.conf.js 中添加如下配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">    <span class="attr">inject</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">favicon</span>: <span class="string">&#x27;src/assets/img/ico.png&#x27;</span>,			<span class="comment">// logo图标</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>

<h2 id="新建-prettierrc-文件"><a href="#新建-prettierrc-文件" class="headerlink" title="新建.prettierrc 文件"></a>新建.prettierrc 文件</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;tabWidth&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;semi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;singleQuote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h2 id="打包项目"><a href="#打包项目" class="headerlink" title="打包项目"></a>打包项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h2 id="安装项目"><a href="#安装项目" class="headerlink" title="安装项目"></a>安装项目</h2><p>开发过程中, 用到的包需要安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -D	// 工程构建（开发时、“打包”时）依赖 ；例：xxx-cli , less-loader , babel-loader...</span><br><span class="line">npm i -S	// 项目（运行时、发布到生产环境时）依赖；例：vue, element-ui, react...</span><br></pre></td></tr></table></figure>

<h2 id="常用的需要手动安装的扩展包"><a href="#常用的需要手动安装的扩展包" class="headerlink" title="常用的需要手动安装的扩展包"></a>常用的需要手动安装的扩展包</h2><ul>
<li>less<br><code>npm i less-loader less -D</code></li>
<li>使<code>jsx</code>支持<code>v-model</code><ul>
<li><code>npm i babel-plugin-jsx-v-model -D</code></li>
<li>在<code>.babelrc</code>的<code>&quot;plugins&quot;</code>下添加<code>&quot;jsx-v-model&quot; </code></li>
</ul>
</li>
</ul>
<h2 id="非零开始"><a href="#非零开始" class="headerlink" title="非零开始"></a>非零开始</h2><p>以上 1-7 是从零开始构建项目, 如果是已有项目拷贝复制, 肯定不能把 <code>node_modules</code> 目录一同复制, 所以我们可以复制除了<code>node_modules</code>以外的所有文件, 然后再执行 <code>npm install</code> 即可</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/15/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/17/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
