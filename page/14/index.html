<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="LJKのBlog">
<meta property="og:url" content="http://blog.lujinkai.cn/page/14/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="像方便面一样的男子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/page/14/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/14/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LJKのBlog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/" class="post-title-link" itemprop="url">进程、系统性能和计划任务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:55:43" itemprop="dateCreated datePublished" datetime="2020-12-09T22:55:43+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BF%9B%E7%A8%8B%E5%92%8C%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">进程和计划任务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="进程和内存管理"><a href="#进程和内存管理" class="headerlink" title="进程和内存管理"></a>进程和内存管理</h2><h3 id="什么是进程？"><a href="#什么是进程？" class="headerlink" title="什么是进程？"></a>什么是进程？</h3><p>process：程序是静态文件，程序启动后会载入到内存中，运行中的程序就是进程，进程是一个指令合集，是资源分配的单位。</p>
<p>第一个进程是 init，centos7 以后为 systemd</p>
<p>进程都在<code>/proc/</code>目录下，例如有不明进程 724 占用 CPU 过高，可以<code>cat /dev/null &gt; /proc/724/exe</code>先清空进程，然后再排查问题，不直接 kill 是怕这个进程是木马程序，kill 掉还会重启。</p>
<p>进程都是由父进程创建，使用 fork()函数创建子进程。fork（）会产生一个和父进程完全相同的子进程，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。这种机制就叫<strong>写时复制</strong>。</p>
<p>写时复制在 php 中的应用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;this is string&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<p>此时,$a和$b 在内存中指向同一地址, 当修改$a或者$b 的时候, 才会复制一份, 然后对复制的这份进行修改。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">146</span> <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted_h</span> &#123;</span></span><br><span class="line"><span class="number">147</span>     <span class="type">uint32_t</span>         refcount;          <span class="comment">/* reference counter 32-bit</span></span><br><span class="line"><span class="comment">148     php7.1中常量字符串refcount=0，依靠u来标记常量，在7.3中已经改掉了*/</span></span><br><span class="line"><span class="number">149</span>     <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="number">150</span>         <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="number">151</span>             ZEND_ENDIAN_LOHI_3(</span><br><span class="line"><span class="number">152</span>                 zend_uchar    type,</span><br><span class="line"><span class="number">153</span>                 zend_uchar    flags,    <span class="comment">/* used for strings &amp; objects</span></span><br><span class="line"><span class="comment">154                 存储字符串的类型，例如：常量字符串2，变量字符串0 */</span></span><br><span class="line"><span class="number">155</span>                 <span class="type">uint16_t</span>      gc_info)  <span class="comment">/* keeps GC root number (or 0) and color */</span></span><br><span class="line"><span class="number">156</span>         &#125; v;</span><br><span class="line"><span class="number">157</span>         <span class="type">uint32_t</span> type_info;</span><br><span class="line"><span class="number">158</span>     &#125; u;</span><br><span class="line"><span class="number">159</span> &#125; zend_refcounted_h;</span><br><span class="line"><span class="number">160</span></span><br><span class="line"><span class="number">161</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted</span> &#123;</span></span><br><span class="line"><span class="number">162</span>     zend_refcounted_h gc;</span><br><span class="line"><span class="number">163</span> &#125;;</span><br><span class="line"><span class="number">165</span> <span class="comment">// 写时复制：对于整型或者其他简单类型的，因为zval 16个字节就可以表示了，所以是直接复制的</span></span><br><span class="line"><span class="number">166</span> <span class="comment">// 而对于zend_string, `$a = &#x27;string&#x27;; $b = $a;` $a和$b的zval指向的是同一个zend_string,用zend_string中的</span></span><br><span class="line"><span class="number">167</span> <span class="comment">// gc中的refcount进行标记，2，表示这个zeng_string被两个zval引用了，当我们修改$b的时候，就是修改$b指向的zval，</span></span><br><span class="line"><span class="number">168</span> <span class="comment">// $b指向zval的地址没变，但是zval的内容变了</span></span><br><span class="line"><span class="number">169</span> <span class="comment">// 同时原先的zend_string的gc也会修改，refcount减1</span></span><br><span class="line"><span class="number">170</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zend_string</span> &#123;</span></span><br><span class="line"><span class="number">171</span>     zend_refcounted_h gc;</span><br><span class="line"><span class="number">172</span>     zend_ulong        h;                <span class="comment">/* hash value 以空间换时间 */</span></span><br><span class="line"><span class="number">173</span>     <span class="type">size_t</span>            len;</span><br><span class="line"><span class="number">174</span>     <span class="type">char</span>              val[<span class="number">1</span>];   <span class="comment">// 柔性数组一定放在结构体的尾部</span></span><br><span class="line"><span class="number">175</span> &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="进程结构"><a href="#进程结构" class="headerlink" title="进程结构"></a>进程结构</h3><p>内核把进程存放在任务队列中，任务队列是双向循环链表结构。</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1598441043167.png"></p>
<p>链表中的每一项都是结构体 task_struck，这种结构体称为进程控制块 PCB，PCB 中包含了一个具体进程的所有信息：</p>
<ul>
<li>进程 id、用户 id 和组 id</li>
<li>程序计数器</li>
<li>进程的状态(有就绪、运行、阻塞)</li>
<li>进程切换时需要保存和恢复的 CPU 寄存器的值</li>
<li>描述虚拟地址空间的信息</li>
<li>描述控制终端的信息</li>
<li>当前工作目录</li>
<li>文件描述符表，包含很多指向 file 结构体的指针</li>
<li>进程可以使用的资源上限(ulimit –a 命令可以查看)</li>
<li>输入输出状态：配置进程使用 I&#x2F;O 设备</li>
</ul>
<h4 id="进程、线程、协程"><a href="#进程、线程、协程" class="headerlink" title="进程、线程、协程"></a>进程、线程、协程</h4><img data-src="//img.to2b.cn/blog/ljk/1598440203522.png" style="zoom:67%;" />

<p>查看进程中的线程：<code>cat /proc/PID/status | grep -i threads</code></p>
<ol>
<li>进程是资源分配的单位</li>
<li>线程是操作系统调度的单位</li>
<li>进程切换需要的资源很大, 效率很低；线程稍好；协程最好</li>
<li>多进程、线程根据 cpu 核数不一样可能是并行的，但是协程是在一个线程中，所以肯定是并发</li>
</ol>
<h3 id="进程相关概念"><a href="#进程相关概念" class="headerlink" title="进程相关概念"></a>进程相关概念</h3><p>进程运行在内存中，所以有必要了解一下内存。磁盘给文件分配空间的最小单位是块，一般是 4K，内存给进程分配空间的最小单位是<strong>页</strong>，又叫<strong>页框</strong>，大小也是 4K</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 kernels]<span class="comment"># getconf -a | grep -i size</span></span><br><span class="line">...</span><br><span class="line">PAGE_SIZE                           4096</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>getconf 命令可以查看系统参数。比如 系统位数、页面大小等。-a 获取所有系统参数信息。</p>
<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 kernels]<span class="comment"># getconf LONG_BIT</span></span><br><span class="line">64</span><br><span class="line">[root@centos7 kernels]<span class="comment"># getconf PAGE_SIZE</span></span><br><span class="line">4096</span><br></pre></td></tr></table></figure>

<h4 id="物理地址空间和虚拟地址空间"><a href="#物理地址空间和虚拟地址空间" class="headerlink" title="物理地址空间和虚拟地址空间"></a>物理地址空间和虚拟地址空间</h4><p>物理地址空间：你插了两根 8G 的内存条，就有 16G 的物理地址空间。</p>
<p>虚拟地址空间 和 交换空间 swap 没有关系，是进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据，以及 malloc、new 分配的堆空间和分配的栈空间等。假如进程申请 100m 的内存，但实际上只使用 了 10m，那么它会增长 100m，而不是实际的使用量。现代操作系统里面分配虚拟地址空间操作不同于分配物理内存。在 64 位操作系统上，可用的最大虚拟地址空间有 16EB，即大概 180 亿 GB。那么在一台只有 16G 的物理内存的机器上，也可以要求获得 4TB 的地址空间以备将来使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void *mem = mmap(0, 4ul * 1024ul * 1024ul * 1024ul * 1024ul, PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS | MAP_NORESERVE, -1, 0);</span><br></pre></td></tr></table></figure>

<p>当使用 mmap 并设置 MAP_NORESERVE 标志时，并不会要求实际的物理内存和 swap 空间存在。执行上述代码，可以在 top 中看到使用了 4096g 的 VIRT 虚拟内存，这当然不是真实的内存，它只是表示使用了 4096GB 的地址空间而已。</p>
<p>一般来说不用太在意 VIRT 太高，因为你有 16EB 的空间可以使用。</p>
<h5 id="MMU"><a href="#MMU" class="headerlink" title="MMU"></a>MMU</h5><p>Memory Management Unit 内存管理单元，是硬件，负责虚拟地址转换为物理地址。</p>
<p>程序在访问一个内存地址指向的内存时，CPU 不是直接把这个地址送到内存总线上，而是被送到 MMU，然后把这个内存地址映射到实际的物理内存地址上，最后通过总线再去访问内存，程序操作的地址就是虚拟内存地址。</p>
<h5 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h5><p>Translation Lookaside Buffer 翻译后备缓冲器，用于保存虚拟地址和物理地址映射关系的缓存</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1598447360644.png"></p>
<h4 id="用户和内核空间"><a href="#用户和内核空间" class="headerlink" title="用户和内核空间"></a>用户和内核空间</h4><h4 id="C-代码和内存布局之间的对应关系"><a href="#C-代码和内存布局之间的对应关系" class="headerlink" title="C 代码和内存布局之间的对应关系"></a>C 代码和内存布局之间的对应关系</h4><img data-src="//img.to2b.cn/blog/ljk/1598447438700.png" style="zoom: 67%;" />

<p>每个进程都包括 5 种不同的数据段：</p>
<ol>
<li>代码段：可执行程序在内存中的镜像，只读，不可写。</li>
<li>数据段：存放已初始化全局变量</li>
<li>BSS 段：Block Started by Symbol”的缩写,意为“以符号开始的块，BSS 段包含了程序中未初始化的全局变量，在内存中 bss 段全部置零。</li>
<li>堆：heap，存放数组和对象，堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用 malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用 free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）</li>
<li>栈：stack，栈是用户存放程序临时创建的局部变量，也就是说我们函数括弧“{}”中定义的变量（但不包括 static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的后进先出特点，所以栈特别方便用来保存&#x2F;恢复调用现场。可以把堆栈看成一个寄存、交换临时数据的内存区</li>
</ol>
<h5 id="堆和栈的区别"><a href="#堆和栈的区别" class="headerlink" title="堆和栈的区别"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/K346K346/article/details/80849966">堆和栈的区别</a></h5><ul>
<li>程序内存布局场景下，堆与栈表示两种内存管理方式；</li>
<li>数据结构场景下，堆与栈表示两种常见的数据结构；</li>
</ul>
<p><strong>程序内存分区中的堆和栈：</strong></p>
<ul>
<li>栈 由操作系统自动分配释放，用与存放函数的参数值，局部变量等，其操作方式类似与数据结构中的栈。栈区向地址减小的方向增长。程序员无法控制，若分配失败，则提示栈移出错误。</li>
<li>堆 由开发人员分配和释放，若开发人员不释放，程序结束时由 OS 回收，分配方式类似与链表。php 中 new 等可以申请内存，delete 等可以删除内存。</li>
</ul>
<p><strong>数据结构中的堆和栈</strong></p>
<ul>
<li>栈的基本操作包括初始化、判断栈是否为空、入栈、出栈及获取栈顶元素等。</li>
<li></li>
</ul>
<h4 id="进程使用内存问题"><a href="#进程使用内存问题" class="headerlink" title="进程使用内存问题"></a>进程使用内存问题</h4><h5 id="内存泄露：Memory-Leak"><a href="#内存泄露：Memory-Leak" class="headerlink" title="内存泄露：Memory Leak"></a>内存泄露：Memory Leak</h5><p>指程序中用 malloc 或 new 申请了一块内存，但是没有用 free 或 delete 将内存释放，导致这块内存一直处于占用状态</p>
<h5 id="内存溢出：Memory-Overflow"><a href="#内存溢出：Memory-Overflow" class="headerlink" title="内存溢出：Memory Overflow"></a>内存溢出：Memory Overflow</h5><p>指程序申请了 10M 的空间，但是在这个空间写入 10M 以上字节的数据，就是溢出</p>
<h5 id="内存不足：OOM"><a href="#内存不足：OOM" class="headerlink" title="内存不足：OOM"></a>内存不足：OOM</h5><p>OOM 即 Out Of Memory，“内存用完了”,在情况在 java 程序中比较常见。</p>
<p>在日志 messages 中看到类似下面的提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Jul 10 10:20:30 kernel: Out of memory: Kill process 9527 (java) score 88 or sacrifice child</span><br></pre></td></tr></table></figure>

<p>当 JVM 因为没有足够的内存来为对象分配空间并且垃圾回收器也已经没有空间可回收时，就会选一个进程杀掉。</p>
<p>导致原因：</p>
<ul>
<li>给应用分配的内存太小</li>
<li>内存泄露和内存溢出导致内存不够用</li>
</ul>
<p>相关内核参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/vm/overcommit_memory</span><br><span class="line"><span class="built_in">echo</span> 80 &gt; /proc/sys/vm/overcommit_ratio</span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /proc/sys/vm/panic_on_oom</span><br></pre></td></tr></table></figure>

<p>Linux 默认是允许 memory overcommit 的，只要你来申请内存我就给你，寄希望于进程实际上用不到那么多内存，但万一用到那么多了呢？Linux 设计了一个 OOM killer 机制挑选一个进程出来杀死，以腾出部分内存，如果还不够就继续。也可通过设置内核参数 vm.panic_on_oom 使得发生 OOM 时自动重启系统。这都是有风险的机制，重启有可能造成业务中断，杀死进程也有可能导致业务中断。所以 Linux<br>2.6 之后允许通过内核参数 vm.overcommit_memory 禁止 memory overcommit。</p>
<ul>
<li><p>overcommit_memory</p>
<ul>
<li>0：默认值，允许值，允许 overcommit，但是过于明目张胆的 overcommit 会被拒绝，内核利用某种算法猜测你的内存申请是否合理，它认为不合理就会拒绝 overcommit。</li>
<li>1：允许 overcommit，对内存申请来者不拒。</li>
<li>2：禁止 overcommit，申请的内存不允许超过可用内存的大小。</li>
</ul>
</li>
<li><p>overcommit_ratio</p>
<p>overcomit_memory&#x3D; 2 时，该参数有效，默认值 50，表示物理内存的 50%。</p>
</li>
<li><p>panic_on_oom</p>
<ul>
<li>0：默认值，出现 oom 时，触发 oom killer</li>
<li>1：程序在有 cpuset、memory policy、memcg 的约束情况下的 OOM，可以考虑不 panic，而是启动 OOM killer。其它情况触发 kernel panic，即系统直接重启</li>
<li>2：当出现 oom，直接触发 kernel panic，即系统直接重启</li>
</ul>
</li>
</ul>
<h3 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h3><p>进程的生命周期：</p>
<img data-src="//img.to2b.cn/blog/ljk/1598490636894.png" style="zoom: 67%;" />

<p>使用 prtstat 或 top 可以查看命令状态，或者直接查看文件&#x2F;proc&#x2F;PID&#x2F;status</p>
<p>top 命令的 S 字段表示进程的状态：S 表示休眠，R 表示正在运行，Z 表示僵死状态，N 表示该进程优先值是负数</p>
<h4 id="进程的基本状态："><a href="#进程的基本状态：" class="headerlink" title="进程的基本状态："></a>进程的基本状态：</h4><ul>
<li>创建：创建 PCB，如果无法无法创建（比如资源无法满足）</li>
<li>就绪：ready，进程已分配到所需资源，等待 CPU 的调度</li>
<li>执行：running，CPU 调度，进入到执行状态</li>
<li>阻塞：执行的进程由于某些事件而暂时无法运行，进入阻塞状态，等阻塞解决了，进入到就绪状态。CPU 是不会等你的。</li>
<li>终止：进程结束，正常结束或非正常结束。</li>
</ul>
<h4 id="进程更多状态"><a href="#进程更多状态" class="headerlink" title="进程更多状态"></a>进程更多状态</h4><ul>
<li>睡眠：可以当成阻塞处理，区别在于阻塞状态是被动进入，睡眠状态是主动进入，而且可以定时。准确的说，阻塞是一种状态，而睡眠和挂起是一种行为。<ul>
<li>可中断：interruptable</li>
<li>不可中断：uninterruptable</li>
</ul>
</li>
<li>停止：stopped，暂停于内存，但不会被调度，除非手动启动</li>
<li>挂起：暂停于外存，需要先激活才能使用</li>
<li>孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被 init 进程(进程号为 1)所收养，并由 init 进程对它们完成状态收集工作。</li>
<li>僵尸进程：zombie，如果一个进程已经终止，但是它的父进程尚未调用 wait() 或 waitpid() 对它进行清理，这时的进程状态称为僵死状态，处于僵死状态的进程称为僵尸进程(zombie process)。任何进程在刚终止时都是僵尸进程，正常情况下，僵尸进程都立刻被父进程清理了。<ul>
<li>杀死父进程可以关闭僵死态 的子进程</li>
</ul>
</li>
</ul>
<h3 id="LRU-算法"><a href="#LRU-算法" class="headerlink" title="LRU 算法"></a>LRU 算法</h3><h3 id="IPC-进程间通信"><a href="#IPC-进程间通信" class="headerlink" title="IPC 进程间通信"></a>IPC 进程间通信</h3><h4 id="同一主机"><a href="#同一主机" class="headerlink" title="同一主机"></a>同一主机</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pipe	管道，单向传输</span><br><span class="line">socket	套接字文件</span><br><span class="line">Memory-maped file	文件映射,将文件中的一段数据映射到物理内存，多个进程共享这片内存</span><br><span class="line">shm shared memory	共享内存</span><br><span class="line">signal	信号</span><br><span class="line">Lock	对资源上锁，如果资源已被某进程锁住，则其它进程想修改甚至读取这些资源，都将被阻塞，直到锁被打开</span><br><span class="line">semaphore	信号量，一种计数器</span><br></pre></td></tr></table></figure>

<h4 id="不同主机：socket-x3D-ip-port"><a href="#不同主机：socket-x3D-ip-port" class="headerlink" title="不同主机：socket&#x3D;ip:port"></a>不同主机：socket&#x3D;ip:port</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RPC	remote procedure call</span><br><span class="line">MQ	消息队列，生产者和消费者，如：kafka、RabbitMQ，ActiveMQ</span><br></pre></td></tr></table></figure>

<h3 id="进程优先级"><a href="#进程优先级" class="headerlink" title="进程优先级"></a>进程优先级</h3><img data-src="//img.to2b.cn/blog/ljk/1598495063607.png" style="zoom:80%;" />

<p>top 命令的 NI 字段表示 nice 优先级，-20 到 19，取值越大，优先级越低。就像人一样，越 nice 的人越被欺负，越 nice 的进程优先级越低。</p>
<h3 id="进程分类"><a href="#进程分类" class="headerlink" title="进程分类"></a>进程分类</h3><ul>
<li>守护进程：daemon，在系统引导过程中启动的进程，和终端无关。</li>
<li>前台进程：和终端相关，通过终端启动的进程。</li>
</ul>
<h3 id="IO-调度算法"><a href="#IO-调度算法" class="headerlink" title="IO 调度算法"></a>IO 调度算法</h3><ul>
<li>NOOP</li>
<li>Deadline scheduler</li>
<li>Anticipatory scheduler</li>
<li>CFQ</li>
</ul>
<p>查看 IO 调度算法：<code>cat /sys/block/sda/queue/scheduler</code></p>
<h2 id="任务计划"><a href="#任务计划" class="headerlink" title="任务计划"></a>任务计划</h2><h3 id="一次性任务"><a href="#一次性任务" class="headerlink" title="一次性任务"></a>一次性任务</h3><h3 id="周期性任务计划-cron"><a href="#周期性任务计划-cron" class="headerlink" title="周期性任务计划 cron"></a>周期性任务计划 cron</h3><h4 id="系统-cron-计划任务"><a href="#系统-cron-计划任务" class="headerlink" title="系统 cron 计划任务"></a>系统 cron 计划任务</h4><h4 id="anacron"><a href="#anacron" class="headerlink" title="anacron"></a>anacron</h4><h4 id="管理临时文件"><a href="#管理临时文件" class="headerlink" title="管理临时文件"></a>管理临时文件</h4><h4 id="用户计划任务"><a href="#用户计划任务" class="headerlink" title="用户计划任务"></a>用户计划任务</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/nmcli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/nmcli/" class="post-title-link" itemprop="url">nmcli</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:41:20" itemprop="dateCreated datePublished" datetime="2020-12-09T22:41:20+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>通常的 linux 发行版对于网络的配置方法一般会同时支持 network.service 和 NetworkManager.service（简称 NM）。默认情况下，这 2 个服务都有开启，而且功能上是平行的，可以通过任意一个来配置网络，正常的情况下通过 NM 来配置网络后它会自动把配置同步到 network.service 的配置中。</p>
<p>nmcli 是 NetworkManager 的命令行工具， 该命令可以完成网卡上所有的配置工作，绝大部分可以写入配置文件，永久生效 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmcli [OPTIONS] OBJECT &#123; COMMAND | <span class="built_in">help</span> &#125;</span><br></pre></td></tr></table></figure>

<p>OPTIONS：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-t                                <span class="comment"># terse output 简洁的输出</span></span><br><span class="line">-p                                <span class="comment"># pretty output 漂亮的输出</span></span><br><span class="line">-m tabular|multiline              <span class="comment"># output mode  输出模式</span></span><br><span class="line">-f &lt;field1,field2,...&gt;|all|common <span class="comment"># specify fields to output 指定要输出的字段</span></span><br><span class="line">-e <span class="built_in">yes</span>|no                         <span class="comment"># escape columns separators in values 在值中转义列分隔符</span></span><br><span class="line">-n                                <span class="comment"># 不要检查nmcli和NetworkManager版本</span></span><br><span class="line">-a                                <span class="comment"># 要求缺少参数</span></span><br><span class="line">-w &lt;seconds&gt;                      <span class="comment"># 设置超时等待整理操作</span></span><br></pre></td></tr></table></figure>

<p>OBJECT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g[eneral]      <span class="comment"># 显示NM状态和权限；获取和更改系统主机名、NetworkManager logging level and domains</span></span><br><span class="line">n[etworking]   <span class="comment"># 查询NM网络状态，启用和禁用网络</span></span><br><span class="line">r[adio]        <span class="comment"># 无线网相关</span></span><br><span class="line">c[onnection]   <span class="comment"># NM的连接</span></span><br><span class="line">d[evice]       <span class="comment"># 显示和管理网络接口</span></span><br><span class="line">a[gent]        <span class="comment"># Run nmcli as a NetworkManager secret agent, or polkit agent.</span></span><br><span class="line">m[onitor]      <span class="comment"># 观察NM活动，监视连接状态、设备或连接配置文件的更改</span></span><br></pre></td></tr></table></figure>

<p><strong>最常用的是 device 和 connection</strong>，主要是 connection</p>
<h3 id="device"><a href="#device" class="headerlink" title="device"></a>device</h3><p><strong>设备</strong>，可理解为实际存在的网卡（包括物理网卡和虚拟网卡）。可以简写为 nmcli d</p>
<p>在 NM 里，有 2 个层级：<strong>连接（connection）和设备（device），通常 NM 的管理是以连接为单位的，就像你的手机可以记住多个 wifi 连接，但一个时刻只能连接一个 wifi。一个网卡可以关联多个连接，但是一个网卡只能有一个连接处于活跃状态，通过 <code>nmcli connetion up</code>切换连接。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡状态</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli device</span></span><br><span class="line">DEVICE  TYPE      STATE      CONNECTION</span><br><span class="line">ens33   ethernet  connected  ens33</span><br><span class="line">ens37   ethernet  connected  ens37</span><br><span class="line">lo      loopback  unmanaged  --</span><br></pre></td></tr></table></figure>

<h3 id="connection"><a href="#connection" class="headerlink" title="connection"></a>connection</h3><p><strong>连接</strong>，可理解为配置文件，相当于 ifcfg-ethX。可以简写为<code>nmcli c</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改网卡名，注意修改的是NAME不是DEVICE</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection modify ens33 con-name &#x27;ens33 name&#x27;</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection</span></span><br><span class="line">NAME        UUID                                  TYPE      DEVICE</span><br><span class="line">ens33 name  c96bc909-188e-ec64-3a96-6a90982b08ad  ethernet  ens33</span><br><span class="line">ens37       4a5516a4-dfa4-24af-b1c4-e843e312e2fd  ethernet  ens37</span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection modify ens33\ name con-name ens33</span></span><br><span class="line"><span class="comment"># 修改网卡地址，只修改文件不生效，修改之前先使用 ipv4.method manual 将BOOTPROTO=dhcp改成BOOTPROTO=none</span></span><br><span class="line"><span class="comment"># 否则不能修改，只能添加或删除</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection modify ens33 ipv4.addresses 10.0.0.8/24</span></span><br><span class="line"><span class="comment"># 使修改网卡地址生效</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection reload</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection up ens33</span></span><br><span class="line"><span class="comment"># 给网卡添加地址</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection modify ens33 +ipv4.addresses 11.0.0.7/24</span></span><br><span class="line"><span class="comment"># 从网卡删除地址</span></span><br><span class="line">[root@centos7 network-scripts]<span class="comment">#nmcli connection modify ens33 -ipv4.addresses 11.0.0.7/24</span></span><br></pre></td></tr></table></figure>

<h2 id="ubuntu-使用-nmcli"><a href="#ubuntu-使用-nmcli" class="headerlink" title="ubuntu 使用 nmcli"></a>ubuntu 使用 nmcli</h2><p>ubuntu 默认情况下，无法使用 nmcli</p>
<ol>
<li><p>修改 <code>etc/netplan/*.yaml</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@u2:~<span class="comment"># vim /etc/netplan/00-installer-config.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: NetworkManager	<span class="comment"># 注意此行</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>/etc/NetworkManager/NetworkManager.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@u2:~<span class="comment"># vim /etc/NetworkManager/NetworkManager.conf</span></span><br><span class="line">[main]</span><br><span class="line">plugins=ifupdown,keyfile</span><br><span class="line"></span><br><span class="line">[ifupdown]</span><br><span class="line">managed=flase</span><br><span class="line"></span><br><span class="line">[device]</span><br><span class="line">wifi.scan-rand-mac-address=no</span><br></pre></td></tr></table></figure>
</li>
<li><p>应用配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@u2:~<span class="comment"># netplan apply</span></span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E5%99%A8/" class="post-title-link" itemprop="url">路由器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:40:27" itemprop="dateCreated datePublished" datetime="2020-12-09T22:40:27+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h1><p>交换机主要用于组建局域网，路由主要功能是将由交换机组好的局域网相互连接起来，或者接入 Internet</p>
<p>交换机能做的，路由器都能做</p>
<p>同一网段的 ip 可以直接通信，不同网段的 ip 需要通过路由器进行通信</p>
<p>路由器是属于网络互联设备，每一个端口连接的都是不同的网络 。在隔绝广播域方面，路由器做了以下工作：</p>
<p>对外端口：① 路由器接收到广播，直接拒绝；② 路由器接收到单播，先校验 MAC 地址，如果是接口的 MAC 地址，则解封去看三层的 ip 地址，查看目标地址(匹配路由表)，重新封装二层帧头，转发</p>
<p>对内端口：判断信息目的地，如果是</p>
<ul>
<li>工作在网络层</li>
<li>隔离广播域和冲突域</li>
<li>选择路由表中到达目标的最好路径</li>
<li>维护和检查路由信息</li>
<li>连接广域网</li>
</ul>
<p>有的交换机会集成路由器的功能，又叫三层交换机</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">磁盘存储和文件系统</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:36:00" itemprop="dateCreated datePublished" datetime="2020-12-09T22:36:00+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">磁盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="磁盘结构"><a href="#磁盘结构" class="headerlink" title="磁盘结构"></a>磁盘结构</h2><p><strong>一切皆文件</strong>：open()，read()，write()，close()</p>
<p>设备文件：关联至驱动程序，进而能够与对应的硬件设备进行通信</p>
<p><strong>设备号码</strong>：</p>
<ul>
<li>主设备号：major number, 标识设备类型</li>
<li>次设备号：minor number, 标识同一类型下的不同设备</li>
</ul>
<p><img data-src="//img.to2b.cn/blog/ljk/1597737342339.png"></p>
<p><strong>设备类型</strong>：</p>
<ul>
<li>块设备：block，存取设备单位“块”，磁盘等</li>
<li>字符设备：char，存取设备单位“字符”，键盘等</li>
</ul>
<p>机械硬盘的结构有两种，如下图所示：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597843069614.png" style="zoom:50%;" /> <img data-src="//img.to2b.cn/blog/ljk/1597843135650.png" style="zoom:50%;" /></p>
<p>硬盘寻址方式有两种：CHS 和 LBA</p>
<p>CHS：24 bit 位寻址，其中前 10 位表示柱面,中间 8 位表示磁头,后面 6 位表示扇区，最大寻址空间 8 GB</p>
<p>LBA：逻辑块寻址，LBA 是一个整数，表示从第几个扇区开始，到第几个扇区结束就完了，没有柱面磁头等概念，扇区这个概念也是逻辑上的，一个扇区通常是 512 个字节</p>
<h3 id="创建设备文件"><a href="#创建设备文件" class="headerlink" title="创建设备文件"></a>创建设备文件</h3><p>如果两个设备文件的类型、主次号码都相同，那这俩就是同一个设备</p>
<p>touch 创建普通文件，mknod 创建设备文件，删除用 rm，不能 cp 直接拷贝，如果要拷贝，使用<code>cp -a</code>保留属性即可拷贝</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#ll /dev/null /dev/zero</span></span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Aug 18 14:39 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 5 Aug 18 14:39 /dev/zero</span><br><span class="line">[root@centos7 ~]<span class="comment">#mknod ./testnull c 1 3</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#mknod ./testzero c 1 5</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#ll</span></span><br><span class="line">total 0</span><br><span class="line">crw-r--r--. 1 root root 1, 3 Aug 18 17:16 testnull</span><br><span class="line">crw-r--r--. 1 root root 1, 5 Aug 18 17:17 testzero</span><br></pre></td></tr></table></figure>

<h2 id="分区类型"><a href="#分区类型" class="headerlink" title="分区类型"></a>分区类型</h2><p>两种分区方式：mbr、gpt</p>
<h3 id="给虚拟机添加硬盘"><a href="#给虚拟机添加硬盘" class="headerlink" title="给虚拟机添加硬盘"></a>给虚拟机添加硬盘</h3><p>虚拟机-&gt;添加-&gt;硬盘-&gt;scsi-&gt;虚拟硬盘-&gt;单个文件-&gt;完成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> - - - &gt; /sys/class/scsi_host/host0/scan</span><br><span class="line"><span class="comment"># 如果lsblk还不显示，再试试host1和host2</span></span><br></pre></td></tr></table></figure>

<h3 id="MBR"><a href="#MBR" class="headerlink" title="MBR"></a>MBR</h3><p>mbr 最多四个主分区，可以 3 个主分区+1 扩展分区（N 个逻辑分区）</p>
<p>主分区和扩展分区对应 1~4，&#x2F;dev&#x2F;sda3，逻辑分区从 5 开始，&#x2F;dev&#x2F;sda5</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597750164277.png"></p>
<p>每个分区项占 16 个字节。</p>
<ul>
<li>第 1 个字节：活动分区启动计算机，非活动分区只是数据分区，所以四个分区只有一个 80，其他三个都是 00。</li>
<li>第 2、3、4 个字节：这三个字节说明分区在硬盘上的起始位置，CHS 寻址。</li>
<li>第 5 个字节：说明分区是否使用，0 表示未使用。</li>
<li>第 6、7、8 个字节：这三个字节说明分区在硬盘上的结束位置，CHS 寻址。我们现在已经不使用 CHS 寻址了，虽然仍然给它保留了位置。</li>
<li>第 9、10、11、12 个字节：这四个字节说明分区在硬盘上的起始位置，LBA 寻址。</li>
<li>第 12、13、14、15、16 个字节：最后这四个字节说明分区在硬盘上的结束位置，LBA 寻址。按照每个扇区 512 个字节计算，4 个字节 32 位最多表示 2^32*512&#x3D;2199023255552 字节&#x3D;2T，所以 mbr 下 LBA 的寻址范围最大就是 2T，所以 mbr 分区的硬盘容量最大 2T，注意是硬盘 2T，不是分区 2T。</li>
</ul>
<p>逻辑分区的分区信息储存在自己的分区内，所以逻辑分区可以有无数个。具体分区信息看图：</p>
<p><img data-src="https://s1.ax1x.com/2020/08/18/dKTrWj.png"></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597841934404.png"></p>
<p><code>hexdump -C /dev/sda -n 512</code> 查看硬盘的前 512 个字节，55 aa 这两个字节是结束标志位，高亮的 64 个字节是分区表，每 16 个字节是一个分区项</p>
<p>mbr 中的分区表 DPT：<br><img data-src="//img.to2b.cn/blog/ljk/1597751158479.png"></p>
<h3 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h3><p>gpt 支持 128 个分区，一般来说，windows 只能是 bios+mbr 或者 uefi+gpt 的组合，而 Linux 可以 bios+gpt 通过 grub 启动</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597846560522.png"></p>
<h2 id="磁盘常用命令"><a href="#磁盘常用命令" class="headerlink" title="磁盘常用命令"></a>磁盘常用命令</h2><h3 id="df"><a href="#df" class="headerlink" title="df"></a>df</h3><p>查看文件系统空间实际占用等信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<ul>
<li>-H 进制为 1000，而不是 1024</li>
<li>-T 显示文件系统类型</li>
<li>-h human-readable</li>
<li>-i 查看 inodes 的使用情况</li>
<li>-P 以 Posix 兼容的格式输出</li>
</ul>
<h3 id="du"><a href="#du" class="headerlink" title="du"></a>du</h3><p>查看某目录总体空间实际占用状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> [OPTION]... DIR</span><br></pre></td></tr></table></figure>

<ul>
<li>-h human-readable</li>
<li>-s summary 只显示目录占用的空间，不一一列出目录下所有的文件</li>
<li>–max-depth&#x3D;# 指定显示的目录层级，该选项和-s 冲突</li>
<li>-x 忽略不在同一个文件系统的目录</li>
</ul>
<p>问题：如果 df 和 du 统计的结果差距过大，是为什么？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果差距比较小，只有几十或者几十百m，是正常情况。如果差距过大，则是因为删除大文件导致。df直接统计分区，du对目录下的文件逐个统计，如果删除大文件，但是还有进程引用这个文件，此时df还会统计到它，而du是统计不到它的，这样就会造成df和du统计的结果差距过大</span><br><span class="line"></span><br><span class="line">解决方法：`lsof | grep delete` 找出占用已删除文件的进程，然后杀掉就行了</span><br></pre></td></tr></table></figure>

<h3 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h3><p>从目标文件 1 拷贝内容写入到目标文件 2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/PATH/FROM/SRC of=/PATH/TO/DEST bs=<span class="comment"># count=#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>if&#x3D;file1：in file &#x3D; file1 从 file1 读取内容</li>
<li>of&#x3D;file2：out file&#x3D;file2 将读取的内容写入到 file2</li>
<li>bs&#x3D;size：block size 指定块的大小，默认单位是字节</li>
<li>count&#x3D;# 读取#个块，如果要读取 1G 的内容，可以<code>bs=1024M count=1</code>，也可以<code>bs=1M count=1024</code>，或者<code>bs=64M count=16</code>。不指定 bs 和 count，可以理解为备份</li>
<li>skip&#x3D;# 读 file1 的时候，忽略前#个块，从#+1 个块开始读取</li>
<li>seek&#x3D;# 写 file2 的时候，忽略前#个块，从#+1 个块开始写入</li>
<li>conv&#x3D;conversion[,conversion…] 用指定的参数转换文件<ul>
<li>conversion 转换参数:</li>
<li>ascii 转换 EBCDIC 为 ASCII</li>
<li>ebcdic 转换 ASCII 为 EBCDIC</li>
<li>lcase 把大写字符转换为小写字符</li>
<li>ucase 把小写字符转换为大写字符</li>
<li>nocreat 不创建输出文件</li>
<li>noerror 出错时不停止</li>
<li>notrunc 不截短输出文件，file2 被写入内容的位置开始，默认先截断成 0 字节大小，这个参数可以保证不截断。例如 file2 内容是 123456789，从开头位置写入 ab，默认从开头往后，都截断成 0 字节，然后再写入 ab，添加 notrunc 参数，写完后是 ab3456789。</li>
<li>sync 把每个输入块填充到 ibs 个字节，不足部分用空(NUL)字符补齐</li>
<li>fdatasync 写完成前，物理写入输出文件</li>
</ul>
</li>
</ul>
<p>范例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份MBR</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/tmp/mbr.bak bs=512 count=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#破坏MBR中的bootloader</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sda bs=64 count=1 seek=446</span><br><span class="line"></span><br><span class="line"><span class="comment">#有一个大与2K的二进制文件fileA。现在想从第64个字节位置开始读取，需要读取的大小是128Byts。又有fileB, 想把上面读取到的128Bytes写到第32个字节开始的位置，替换128Bytes，实现如下</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=fileA of=fileB bs=1 count=128 skip=63 seek=31 conv=notrunc</span><br><span class="line"></span><br><span class="line"><span class="comment">#将本地的/dev/sdx整盘备份到/dev/sdy</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/dev/sdy</span><br><span class="line"></span><br><span class="line"><span class="comment">#将/dev/sdx全盘数据备份到指定路径的image文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/path/to/image</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份/dev/sdx全盘数据，并利用gzip压缩，保存到指定路径</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx | gzip &gt;/path/to/image.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#将备份文件恢复到指定盘</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/path/to/image of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment">#将压缩的备份文件恢复到指定盘</span></span><br><span class="line">gzip -dc /path/to/image.gz | <span class="built_in">dd</span> of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment">#将内存里的数据拷贝到root目录下的mem.bin文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mem of=/root/mem.bin bs=1024</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝光盘数据到root文件夹下，并保存为cdrom.iso文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/cdrom of=/root/cdrom.iso</span><br><span class="line"></span><br><span class="line"><span class="comment">#销毁磁盘数据</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=/dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过比较dd指令输出中命令的执行时间，即可确定系统最佳的block size大小</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=2048 count=500000</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=4096 count=250000</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试硬盘写速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试硬盘读速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/root/1Gb.file bs=64k | <span class="built_in">dd</span> of=/dev/null</span><br></pre></td></tr></table></figure>

<p>练习：</p>
<ol>
<li>创建一个 2G 的文件系统，块大小为 2048byte，预留 1%可用空间,文件系统 ext4，卷标为 TEST，要求<br>此分区开机后自动挂载至&#x2F;test 目录，且默认有 acl 挂载选项</li>
<li>写一个脚本，完成如下功能：<br>(1) 列出当前系统识别到的所有磁盘设备<br>(2) 如磁盘数量为 1，则显示其空间使用信息<br>否则，则显示最后一个磁盘上的空间使用信息</li>
<li>将 CentOS6 的 CentOS-6.10-x86_64-bin-DVD1.iso 和 CentOS-6.10-x86_64-bin-DVD2.iso 两个文件，<br>合并成一个 CentOS-6.10-x86_64-Everything.iso 文件，并将其配置为 yum 源</li>
</ol>
<h2 id="管理分区"><a href="#管理分区" class="headerlink" title="管理分区"></a>管理分区</h2><h3 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h3><p>列出块设备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk [options] [&lt;device&gt; ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>-f：列出文件系统相关信息</li>
</ul>
<h3 id="blkid"><a href="#blkid" class="headerlink" title="blkid"></a>blkid</h3><p>查看块设备（包括交换分区）所使用的文件系统类型、LABEL、UUID 等信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blkid [OPTION]... [DEVICE]</span><br></pre></td></tr></table></figure>

<p>-U UUID 根据指定的 UUID 来查找对应的设备<br>-L LABEL 根据指定的 LABEL 来查找对应的设备</p>
<h3 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a>fdisk</h3><p>管理 mbr 分区。交互式，根据提示操作即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m：查看帮助</span><br><span class="line">p：查看分区</span><br><span class="line">n：增加分区</span><br><span class="line">d：删除分区</span><br><span class="line">w：保存并退出</span><br><span class="line">q：不保存并退出</span><br></pre></td></tr></table></figure>

<p>对硬盘进行分区操作，如果硬盘上已有其他已经挂载的分区，w 保存操作后，centos7 及以前的系统识别不到分区更改，需要手动通知内核重新读取硬盘分区表</p>
<p>硬盘增加分区，前提是硬盘要有未分配的空间</p>
<h3 id="重新加载分区表"><a href="#重新加载分区表" class="headerlink" title="重新加载分区表"></a>重新加载分区表</h3><p>centos7 和 centos5：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partprobe</span><br></pre></td></tr></table></figure>

<p>centos6：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加分区</span></span><br><span class="line">partx -a /dev/DEVICE</span><br><span class="line"><span class="comment"># 删除分区</span></span><br><span class="line">partx -d --nr M-N /dev/DEVICE</span><br></pre></td></tr></table></figure>

<h3 id="gdisk"><a href="#gdisk" class="headerlink" title="gdisk"></a>gdisk</h3><p>管理 gpt 分区，操作和 fdisk 雷同</p>
<h3 id="parted"><a href="#parted" class="headerlink" title="parted"></a>parted</h3><p>高级分区操作，可以使交互式或非交互式，parted 的操作都是实时生效的，所以一般不用</p>
<h2 id="管理文件系统"><a href="#管理文件系统" class="headerlink" title="管理文件系统"></a>管理文件系统</h2><h3 id="文件系统组成"><a href="#文件系统组成" class="headerlink" title="文件系统组成"></a>文件系统组成</h3><p>以 ls 命令为例，它的作用是列出文件，它并不会与 ext4、xfs 等文件系统直接交互，而是和 vfs 进行交互，由 vfs 处理各种文件系统的兼容性</p>
<ul>
<li>内核中的模块：ext4, xfs, vfat</li>
<li>Linux 的虚拟文件系统：VFS</li>
<li>用户空间的管理工具：mkfs.ext4、mkfs.xfs、mkfs.vfat</li>
</ul>
<p><img data-src="//img.to2b.cn/blog/ljk/1613137329211.png"></p>
<p>新硬盘，先 fdisk 分区，然后 mkfs 创建文件系统，最后 mount 挂载</p>
<p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取，安全控制，日志，压缩，加密等</p>
<p>当前系统支持的文件系统：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># rpm -qf /lib/modules/3.10.0-1127.el7.x86_64/kernel-3.10.0-1127.el7.x86_64</span></span><br></pre></td></tr></table></figure>

<p>上面显示的不全，我不知道为什么，通过查看内核包可以看到所有支持的文件系统，每个 xz 压缩包都是对应文件系统的驱动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos7</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># rpm -qf /lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/</span></span><br><span class="line">kernel-3.10.0-1127.el7.x86_64</span><br><span class="line">[root@centos7 ~]<span class="comment"># rpm -ql `!!` | grep &#x27;/fs/&#x27;</span></span><br><span class="line">rpm -ql `rpm -qf /lib/modules/3.10.0-1127.el7.x86_64/` | grep <span class="string">&#x27;/fs/&#x27;</span></span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/binfmt_misc.ko.xz</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/btrfs</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/btrfs/btrfs.ko.xz</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/cachefiles</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/cachefiles/cachefiles.ko.xz</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/ceph</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/ceph/ceph.ko.xz</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/cifs</span><br><span class="line">/lib/modules/3.10.0-1127.el7.x86_64/kernel/fs/cifs/cifs.ko.xz</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu18.04</span></span><br><span class="line">lujinkai@Z510:~$ dpkg -S /lib/modules/5.4.0-42-generic/kernel/fs/</span><br><span class="line">linux-modules-extra-5.4.0-42-generic, linux-modules-5.4.0-42-generic: /lib/modules/5.4.0-42-generic/kernel/fs</span><br><span class="line">lujinkai@Z510:~$ dpkg -L linux-modules-extra-5.4.0-42-generic | grep <span class="string">&#x27;/fs/&#x27;</span></span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/9p</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/adfs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/adfs/adfs.ko</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/affs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/affs/affs.ko</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/afs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/afs/kafs.ko</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/aufs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/autofs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/befs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/befs/befs.ko</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/bfs</span><br><span class="line">/lib/modules/5.4.0-42-generic/kernel/fs/bfs/bfs.ko</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>或者查看 &#x2F;proc&#x2F;filesystems，nodev 标注的文件系统不需要块文件，也就是说不需要硬盘，文件就可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat /proc/filesystems</span></span><br><span class="line">nodev	sysfs</span><br><span class="line">nodev	rootfs</span><br><span class="line">nodev	ramfs</span><br><span class="line">nodev	bdev</span><br><span class="line">nodev	proc</span><br><span class="line">nodev	cgroup</span><br><span class="line">nodev	cpuset</span><br><span class="line">nodev	tmpfs</span><br><span class="line">nodev	devtmpfs</span><br><span class="line">nodev	debugfs</span><br><span class="line">nodev	securityfs</span><br><span class="line">nodev	sockfs</span><br><span class="line">nodev	dax</span><br><span class="line">nodev	bpf</span><br><span class="line">nodev	pipefs</span><br><span class="line">nodev	configfs</span><br><span class="line">nodev	devpts</span><br><span class="line">nodev	hugetlbfs</span><br><span class="line">nodev	autofs</span><br><span class="line">nodev	pstore</span><br><span class="line">nodev	mqueue</span><br><span class="line">nodev	selinuxfs</span><br><span class="line">	xfs</span><br><span class="line">	iso9660</span><br><span class="line">	ext3</span><br><span class="line">	ext2</span><br><span class="line">	ext4</span><br><span class="line">	vfat</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="超级块和-inode-table"><a href="#超级块和-inode-table" class="headerlink" title="超级块和 inode table"></a>超级块和 inode table</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># mkfs.ext4 /dev/sdb5</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Fragment size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">128016 inodes, 512000 blocks</span><br><span class="line">25600 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=1</span><br><span class="line">Maximum filesystem blocks=34078720</span><br><span class="line">63 block <span class="built_in">groups</span></span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">2032 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (8192 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>文件系统把每个分区分成多个块组（block group），每个块组中有很多块，每个块的大小通常为 4K，具体块组的组成看下图。超级块（super block）中存储了所有块组的元数据，超级块存储在块组 0 中，并在其他部分块组有备份；块组描述符表（GDT）是块组描述符的集合，和超级组一样，也是储存块组 0 中，在其他部分块组中备份；块位图（block bitmap）描述了块的使用情况；节点位图（inode bitmap）描述了节点的使用情况。节点表（inode table）存储节点；数据块（data blocks）存储数据</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597908144289.png"></p>
<p><strong>块组描述符</strong><br>Ext3 文件系统的每个块组描述符占用 32 字节，用以描述块组中的位图起始地址、i-节点表起始地址、空闲块数、空闲 i-节点数等信息，每个块组都有这样的一个块组描述符，所有的块组描述符集中存放，组成块组描述符表。</p>
<h3 id="mkfs"><a href="#mkfs" class="headerlink" title="mkfs"></a>mkfs</h3><p>创建文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.FS_TYPE /dev/DEVICE</span><br></pre></td></tr></table></figure>

<p>FS_TYPE：ext4、xfs 等，具体 tab 可以提示</p>
<h3 id="tune2fs-、dumpefs、xfs-info"><a href="#tune2fs-、dumpefs、xfs-info" class="headerlink" title="tune2fs 、dumpefs、xfs_info"></a>tune2fs 、dumpefs、xfs_info</h3><p>tune2fs 查看超级块信息，dumpe2fs 查看超级块和各个块组的信息，tune2fs 和 dump2fs 只适用于 ext 文件系统，xfs 文件系统使用 xfs_info 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># tune2fs -l /dev/sdb5</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># dumpe2fs /dev/sdb5</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># xfs_info /dev/sda1</span></span><br></pre></td></tr></table></figure>

<h3 id="fsck、e2fsck、xfs-repair"><a href="#fsck、e2fsck、xfs-repair" class="headerlink" title="fsck、e2fsck、xfs_repair"></a>fsck、e2fsck、xfs_repair</h3><p>tune2fs、dumpe2fs 查看分区的 ext 文件系统信息，Filesystem state 标记为 no clean，说明文件系统发生故障。使用 e2fsck 可以修复。如果是 xfs 文件系统发生故障，使用 xfs_repair 修改。fsck 通用，不管什么文件系统都可以修复</p>
<p>注意：1. 修复之前一定要 umount 先取消挂载</p>
<ol start="2">
<li>数据不一定能恢复</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fsck.FS_TYPE  /dev/DEVICE</span><br><span class="line">e2fsck  /dev/DEVICE</span><br><span class="line">xfs_repair /dev/DEVICE</span><br></pre></td></tr></table></figure>

<h2 id="挂载设备"><a href="#挂载设备" class="headerlink" title="挂载设备"></a>挂载设备</h2><h3 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mount  device MOUNT_POINT</span><br><span class="line"></span><br><span class="line">mount [-lhV]</span><br><span class="line">mount -a [-fFnrsvw] [-t vfstype] [-O optlist]</span><br><span class="line">mount [-fnrsvw] [-o option[,option]...]  device|<span class="built_in">dir</span></span><br><span class="line">mount [-fnrsvw] [-t vfstype] [-o options] device <span class="built_in">dir</span></span><br></pre></td></tr></table></figure>

<p>device：设备文件:例如:&#x2F;dev&#x2F;sda5、伪文件系统名称:proc, sysfs, devtmpfs, configfs</p>
<p>MOUNT_POINT：挂载点目录必须事先存在,建议使用空目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前已挂载的所有设备</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># mount</span></span><br><span class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)</span><br><span class="line">proc on /proc <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,nosuid,seclabel,size=487128k,nr_inodes=121782,mode=755)</span><br><span class="line">securityfs on /sys/kernel/security <span class="built_in">type</span> securityfs (rw,nosuid,nodev,noexec,relatime)</span><br><span class="line">tmpfs on /dev/shm <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,seclabel)</span><br><span class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 通过查看/etc/mtab文件显示当前已挂载的所有设备</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># ll /etc/mtab</span></span><br><span class="line">lrwxrwxrwx. 1 root root 17 Aug 14 19:22 /etc/mtab -&gt; /proc/self/mounts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看内核追踪到的已挂载的所有设备</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># ll /proc/mounts</span></span><br><span class="line">lrwxrwxrwx. 1 root root 11 Aug 20 18:06 /proc/mounts -&gt; self/mounts</span><br></pre></td></tr></table></figure>

<h4 id="mount-o-options"><a href="#mount-o-options" class="headerlink" title="mount -o options"></a><code>mount -o options</code></h4><p>挂载不同的文件系统，-o 的 options 是不同的，具体有哪些 option，参考对应的文件系统的挂载选项，例如：要挂载 nfs，<code>man mount.nfs</code> 查看对应 option，要挂载 cifs，<code>man mount.cifs</code>查看对应的 option …</p>
<h3 id="umount"><a href="#umount" class="headerlink" title="umount"></a>umount</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount MOUNT_POINT|device</span><br></pre></td></tr></table></figure>

<h3 id="findmnt"><a href="#findmnt" class="headerlink" title="findmnt"></a>findmnt</h3><p>查看挂载点信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findmnt MOUNT_POINT|device</span><br></pre></td></tr></table></figure>

<h3 id="lsof、fuser"><a href="#lsof、fuser" class="headerlink" title="lsof、fuser"></a>lsof、fuser</h3><p>查看正在访问指定文件系统的进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof MOUNT_POINT</span><br></pre></td></tr></table></figure>

<p>终止所有正在访问指定挂载点的进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -km MOUNT_POINT</span><br></pre></td></tr></table></figure>

<h3 id="持久挂载"><a href="#持久挂载" class="headerlink" title="持久挂载"></a>持久挂载</h3><p>mount 命令是临时挂载，将挂载信息写入到&#x2F;etc&#x2F;fstab 中可以下次开机时自动启用挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Wed Jul 29 17:08:37 2020</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=28eb957c-1e98-4175-9a00-3efdef247355 /                       xfs     defaults        0 0</span><br><span class="line">UUID=25ea1f67-ee88-44b1-935e-8af77eadf856 /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=91664c04-1540-4e35-8711-c3f183a556ca /data                   xfs     defaults        0 0</span><br><span class="line">UUID=a1966abb-acf9-4f53-8a86-733a93c2d576 swap                    swap    defaults        0 0</span><br><span class="line"></span><br><span class="line">/dev/sr0 /data/repo/centos/7/x86_64 iso9660 defaults 0 0</span><br></pre></td></tr></table></figure>

<p>注意&#x2F;etc&#x2F;fstab 中 device 一般用 UUID 指代，而不是路径，因为 UUID 稳定，一般不会更改，&#x2F;dev&#x2F;sr0 这种不是特别合适。</p>
<p><code>man 5 fstab</code>可以查看&#x2F;etc&#x2F;fstab 文件的格式，最后两个选项：</p>
<ul>
<li>转储频率：0:不做备份 1:每天转储 2:每隔一天转储</li>
<li>fsck 检查的文件系统的顺序：允许的数字是 0 1 2<ul>
<li>0：不自检</li>
<li>1：首先自检;一般只有 rootfs 才用</li>
<li>2：非 rootfs 使用</li>
</ul>
</li>
</ul>
<p>添加新的挂载项，执行<code>mount -a</code>使挂载生效</p>
<h2 id="管理-swap-空间"><a href="#管理-swap-空间" class="headerlink" title="管理 swap 空间"></a>管理 swap 空间</h2><h3 id="交换分区实现过程"><a href="#交换分区实现过程" class="headerlink" title="交换分区实现过程"></a>交换分区实现过程</h3><ol>
<li>创建交换分区或者文件</li>
<li>使用 mkswap 写入特殊签名</li>
<li>在&#x2F;etc&#x2F;fstab 文件中添加适当的条目</li>
<li>使用<code>swapon -a</code> 激活交换空间</li>
</ol>
<p>范例：以文件实现 swap 功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># dd if=/dev/zero of=/swapfile bs=1M count=1024</span></span><br><span class="line">1024+0 records <span class="keyword">in</span></span><br><span class="line">1024+0 records out</span><br><span class="line">1073741824 bytes (1.1 GB) copied, 2.04882 s, 524 MB/s</span><br><span class="line"></span><br><span class="line">[root@centos7 /]<span class="comment"># mkswap /swapfile</span></span><br><span class="line">Setting up swapspace version 1, size = 1048572 KiB</span><br><span class="line">no label, UUID=8ae1b7bc-7038-4f6a-9940-b75ec91beb21</span><br><span class="line"></span><br><span class="line">[root@centos7 /]<span class="comment"># chmod 600 /swapfile</span></span><br><span class="line">[root@centos7 /]<span class="comment"># swapon /swapfile</span></span><br><span class="line"></span><br><span class="line">[root@centos7 /]<span class="comment"># swapon -s</span></span><br><span class="line">Filename				Type		    Size	           Used	Priority</span><br><span class="line">/dev/sda5               partition	2097148	      0	         -2</span><br><span class="line">/swapfile                file	            1048572	       0	     -3</span><br></pre></td></tr></table></figure>

<h3 id="swap-的使用策略"><a href="#swap-的使用策略" class="headerlink" title="swap 的使用策略"></a>swap 的使用策略</h3><p>&#x2F;proc&#x2F;sys&#x2F;vm&#x2F;swappiness 的值决定了当内存占用达到一定的百分比时,会启用 swap 分区的空间，例如 swappiness 的值为 30，说明当物理内存使用到 70%，就开始使用 swap，应该将这个值设置为 0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时修改</span></span><br><span class="line">[root@centos7 /]<span class="comment"># echo 0 &gt; /proc/sys/vm/swappiness</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line"><span class="comment"># centos7</span></span><br><span class="line">[root@centos7 /]<span class="comment"># echo &#x27;vm.swappiness=0&#x27; &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># sysctl -p</span></span><br><span class="line">vm.swappiness = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu18.04</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="string">&#x27;vm.swappiness=0&#x27;</span> | sudo <span class="built_in">dd</span> of=/etc/sysctl.conf oflag=append conv=notrunc</span><br><span class="line">[sudo] password <span class="keyword">for</span> lujinkai:</span><br><span class="line">0+1 records <span class="keyword">in</span></span><br><span class="line">0+1 records out</span><br><span class="line">16 bytes copied, 0.000102837 s, 156 kB/s</span><br><span class="line">lujinkai@Z510:~$ sudo sysctl -p</span><br><span class="line">vm.swappiness = 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="RAID-管理"><a href="#RAID-管理" class="headerlink" title="RAID 管理"></a>RAID 管理</h2><p>RAID：独立硬盘冗余阵列，简称磁盘阵列，利用虚拟化存储技术把多个硬盘组合起来,成为一个或多个硬盘阵列组,目的为提升性能或数据冗余,或是两者同时提升。</p>
<p>简单来说,RAID 把多个硬盘组合成为一个逻辑硬盘,因此,操作系统只会把它当作一个实体硬盘。</p>
<p>RAID 层级不同,数据会以多种模式分散于各个硬盘，常用的 RAID 层级：RAID 0、RAID 1、RAID 5、RAID 6、RAID 10、RAID 50、RAID 60</p>
<h3 id="raid0"><a href="#raid0" class="headerlink" title="raid0"></a>raid0</h3><p>数据分散在多个硬盘，读写速度都有提升，但是一个硬盘坏了，所有数据都被破坏<br><img data-src="//img.to2b.cn/blog/ljk/1597925562640.png"></p>
<h3 id="raid-1"><a href="#raid-1" class="headerlink" title="raid 1"></a>raid 1</h3><p>数据备份到多个硬盘，有几个硬盘，就有几个备份，理论上，两个硬盘组 raid1，空间利用率有 50%，三个硬盘组 raid 1，空间利用率只有 33%<br><img data-src="//img.to2b.cn/blog/ljk/1597925584778.png"></p>
<h3 id="raid-4"><a href="#raid-4" class="headerlink" title="raid 4"></a>raid 4</h3><p>设置单独校验盘，数据分散在其他的硬盘，其他硬盘通过<strong>亦或运算</strong>得出的值，最多允许一块硬盘损坏，当存储数据的盘有坏的，其他盘可以计算出丢失的那部分数据。缺点是校验盘最容易坏。<br><img data-src="//img.to2b.cn/blog/ljk/1597925609938.png"></p>
<h3 id="raid-5"><a href="#raid-5" class="headerlink" title="raid 5"></a>raid 5</h3><p>是 raid 4 的升级版，校验不是单独一块盘，而是将校验分散在所有硬盘，最多允许一块硬盘损坏<br><img data-src="//img.to2b.cn/blog/ljk/1597925619610.png"></p>
<h3 id="raid-6"><a href="#raid-6" class="headerlink" title="raid 6"></a>raid 6</h3><p>是 raid 5 的升级版，校验由一份升级为两份，增加容错性，允许两块硬盘损坏。</p>
<p><font color=red>生产中，通常会准备热备盘，例如 raid5 就需要额外 1 块盘做热备</font></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597925634961.png"></p>
<h3 id="raid-10"><a href="#raid-10" class="headerlink" title="raid 10"></a>raid 10</h3><p>是 raid1 和 raid0 的组合，解决 raid 0 没有容错能力的缺点。<br><img data-src="//img.to2b.cn/blog/ljk/1597925647457.png"></p>
<h3 id="raid-50"><a href="#raid-50" class="headerlink" title="raid 50"></a>raid 50</h3><p>是 raid 5 和 raid 0 的组合，对比 raid 10，读写的速度更快<br><img data-src="//img.to2b.cn/blog/ljk/1597925705105.png"></p>
<h3 id="raid-60"><a href="#raid-60" class="headerlink" title="raid 60"></a>raid 60</h3><p>是 raid 6 和 raid 0 的组合，增加 raid 50 的容错能力<br><img data-src="//img.to2b.cn/blog/ljk/1597925717387.png"></p>
<h3 id="JBOD"><a href="#JBOD" class="headerlink" title="JBOD"></a>JBOD</h3><p>将多块磁盘的空间合并一个大的连续空间使用<br><img data-src="//img.to2b.cn/blog/ljk/1597925729291.png"></p>
<h3 id="raid7"><a href="#raid7" class="headerlink" title="raid7"></a>raid7</h3><p>RAID 7 并非公开的 RAID 标准，而是 Storage Computer Corporation 的专利硬件产品名称，RAID 7 是以 RAID 3 及 RAID 4 为基础所发展，但是经过强化以解决原来的一些限制。另外，在实现中使用大量的缓冲存储器以及用以实现异步数组管理的专用即时处理器，使得 RAID 7 可以同时处理大量的 IO 要求，所以性能甚至超越了许多其他 RAID 标准的实际产品。但也因为如此，在价格方面非常的高昂.RAID7 可以理解为一个独立存储计算机，自身带有操作系统和管理工具，可以独立运行，理论上性能最高的 RAID 模式。</p>
<h3 id="软件实现-raid"><a href="#软件实现-raid" class="headerlink" title="软件实现 raid"></a>软件实现 raid</h3><p>可以通过软件实现 raid，但是企业中不用，所以略过。。。</p>
<h2 id="LVM-管理和-LVM-快照"><a href="#LVM-管理和-LVM-快照" class="headerlink" title="LVM 管理和 LVM 快照"></a>LVM 管理和 LVM 快照</h2><p>LVM 逻辑卷管理器，本质上是一个虚拟设备驱动，在磁盘分区和文件系统之间添加一个逻辑层。底层的物理磁盘不再由内核直接控制，而是由 LVM 层来控制。LVM 维持着逻辑盘区和物理盘区之间的映射。LVM 逻辑设备向上层应用提供了和物理磁盘相同的功能，如文件系统的创建和数据的访问等</p>
<h3 id="基本术语准备"><a href="#基本术语准备" class="headerlink" title="基本术语准备"></a>基本术语准备</h3><ul>
<li><p>物理存储介质（PhysicalStorageMedia）<br>指系统的物理存储设备：磁盘，是存储系统<strong>最底层</strong>的存储单元</p>
</li>
<li><p>物理卷（Physical Volume，PV）<br>物理卷是由磁盘分区转化而来</p>
</li>
<li><p>卷组（Volume Group，VG）<br>类似于非 LVM 系统中的物理磁盘，其由一个或多个物理卷 PV 组成。可以在卷组上创建一个或多个 LV（逻辑卷）</p>
</li>
<li><p>逻辑卷（Logical Volume，LV）<br>类似于非 LVM 系统中的磁盘分区，逻辑卷建立在卷组 VG 之上。在逻辑卷 LV 之上可以建立文件系统</p>
</li>
<li><p>物理块（Physical Extent，PE）<br>PE 是物理卷 PV 的基本划分单元，具有唯一编号的 PE 是可以被 LVM 寻址的最小单元。PE 的大小是可配置的，默认为 4MB。所以物理卷（PV）由大小等同的基本单元 PE 组成</p>
</li>
<li><p>逻辑块（Logical Extent，LE）<br>逻辑卷 LV 也被划分为可被寻址的基本单位，称为 LE。在同一个卷组中，LE 的大小和 PE 是相同的，并且一一对应</p>
</li>
</ul>
<p><img data-src="//img.to2b.cn/blog/ljk/1597932121999.png"></p>
<p>物理卷：还是&#x2F;dev&#x2F;sda、&#x2F;dev&#x2F;sdb 等，名称系统分配</p>
<p>逻辑卷：&#x2F;dev&#x2F;vg0&#x2F;lv1 等，名称自定义</p>
<h3 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h3><h4 id="1-安装-lvm2-包"><a href="#1-安装-lvm2-包" class="headerlink" title="1. 安装 lvm2 包"></a>1. 安装 lvm2 包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># yum -y install lvm2</span></span><br></pre></td></tr></table></figure>

<h4 id="2-将设备指定为物理卷"><a href="#2-将设备指定为物理卷" class="headerlink" title="2. 将设备指定为物理卷"></a>2. 将设备指定为物理卷</h4><ul>
<li><code>pvs</code> 简要显示 pv 信息</li>
<li><code>pvdisplay</code> 详细显示 pv 信息</li>
<li><code>pvcreate /dev/DEVICE</code> 创建 pv</li>
<li><code>pvremove /dev/DEVICE</code> 删除 pv</li>
<li><code>pvmove</code> 搬移 PV 中的资料(只限于同一 VG 中)<ul>
<li><code>pvmove /dev/hda5 /dev/hda6</code> 将 VG 中 pv hda5 的内容搬移到 hda6 中</li>
<li><code>pvmove /dev/hda5</code> 也可以这样，lvm 决定 hda5 的内容被复制到哪里</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># pvcreate /dev/sdb</span></span><br><span class="line">WARNING: dos signature detected on /dev/sdb at offset 510. Wipe it? [y/n]: y</span><br><span class="line">  Wiping dos signature on /dev/sdb.</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb&quot;</span> successfully created.</span><br><span class="line">[root@centos7 ~]<span class="comment"># pvcreate /dev/sdc</span></span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdc&quot;</span> successfully created.</span><br><span class="line">[root@centos7 ~]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME   FSTYPE   LABEL           UUID                                   MOUNTPOINT</span><br><span class="line">sda</span><br><span class="line">|-sda1 xfs                      25ea1f67-ee88-44b1-935e-8af77eadf856   /boot</span><br><span class="line">|-sda2 xfs                      28eb957c-1e98-4175-9a00-3efdef247355   /</span><br><span class="line">|-sda3 xfs                      91664c04-1540-4e35-8711-c3f183a556ca   /data</span><br><span class="line">|-sda4</span><br><span class="line">|-sda5 swap                     a1966abb-acf9-4f53-8a86-733a93c2d576   [SWAP]</span><br><span class="line">|-sda6</span><br><span class="line">`-sda7</span><br><span class="line">sdb    LVM2_mem                 F4zIYp-IM1g-gJS6-ktqS-OZOD-u46a-z6YrQd</span><br><span class="line">sdc    LVM2_mem                 rAL8Wi-ln8P-LmUK-FaQn-40Mk-iGw4-ocXIUe</span><br><span class="line">sr0    iso9660  CentOS 7 x86_64 2020-04-22-00-51-40-00                 /data/repo/</span><br><span class="line">[root@centos7 ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG Fmt  Attr PSize  PFree</span><br><span class="line">  /dev/sdb      lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdc      lvm2 ---   5.00g  5.00g</span><br><span class="line">[root@centos7 ~]<span class="comment"># pvdisplay</span></span><br><span class="line">  <span class="string">&quot;/dev/sdb&quot;</span> is a new physical volume of <span class="string">&quot;10.00 GiB&quot;</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               10.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               F4zIYp-IM1g-gJS6-ktqS-OZOD-u46a-z6YrQd</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;/dev/sdc&quot;</span> is a new physical volume of <span class="string">&quot;5.00 GiB&quot;</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdc</span><br><span class="line">  VG Name</span><br><span class="line">  PV Size               5.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0</span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               rAL8Wi-ln8P-LmUK-FaQn-40Mk-iGw4-ocXIUe</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-用一个或多个物理卷来创建一个卷组"><a href="#3-用一个或多个物理卷来创建一个卷组" class="headerlink" title="3. 用一个或多个物理卷来创建一个卷组"></a>3. 用一个或多个物理卷来创建一个卷组</h4><ul>
<li><code>vgs</code> 显示卷组</li>
<li><code>vgdisplay</code> 显示卷组</li>
<li><code>vgcreate 卷组名 物理卷列表</code> 创建卷组</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定PE大小为16M，默认4M</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># vgcreate -s 16M vg0 /dev/sdb /dev/sdc</span></span><br><span class="line">  Volume group <span class="string">&quot;vg0&quot;</span> successfully created</span><br><span class="line">[root@centos7 ~]<span class="comment"># vgs</span></span><br><span class="line">  VG  <span class="comment">#PV #LV #SN Attr   VSize   VFree</span></span><br><span class="line">  vg0   2   0   0 wz--n- &lt;14.97g &lt;14.97g</span><br><span class="line">[root@centos7 ~]<span class="comment"># vgdisplay</span></span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               vg0</span><br><span class="line">  System ID</span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        2</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             <span class="built_in">read</span>/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                2</span><br><span class="line">  Act PV                2</span><br><span class="line">  VG Size               &lt;14.97 GiB</span><br><span class="line">  PE Size               16.00 MiB</span><br><span class="line">  Total PE              958</span><br><span class="line">  Alloc PE / Size       0 / 0</span><br><span class="line">  Free  PE / Size       958 / &lt;14.97 GiB</span><br><span class="line">  VG UUID               zszcPb-urGs-jKX8-ZOCu-Xlb8-JPrD-b5bVt8</span><br></pre></td></tr></table></figure>

<ul>
<li><code>vgextend 卷组名 物理卷列表</code> 向卷组中添加物理卷</li>
<li><code>vgreduce 卷组名 物理卷列表</code> 从卷组中删除物理卷</li>
<li><code>vgremove 卷组名</code> 删除卷组<ul>
<li>删除卷组之前应该先使用 pvmove 将数据迁移</li>
</ul>
</li>
</ul>
<h4 id="4-在卷组上创建逻辑卷"><a href="#4-在卷组上创建逻辑卷" class="headerlink" title="4. 在卷组上创建逻辑卷"></a>4. 在卷组上创建逻辑卷</h4><ul>
<li><p><code>lvs</code></p>
</li>
<li><p><code>lvdisplay</code></p>
</li>
<li><p><code>lvcreate</code> 创建逻辑卷</p>
<ul>
<li>n 后面跟逻辑卷名</li>
<li>s 创建快照</li>
<li>l 指定逻辑卷的大小（LE 数）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卷组vg0分配100个PE给新建逻辑卷lv0，这样lv0的大小就是100个LE</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># lvcreate -l 100 -n lv0 vg0</span></span><br><span class="line"><span class="comment"># 其他范例</span></span><br><span class="line">lvcreate -l 60%VG -n mylv testvg</span><br><span class="line">lvcreate -l 100%FREE -n yourlv testvg</span><br></pre></td></tr></table></figure></li>
<li>L 指定逻辑卷的大小，单位为“kKmMgGtT”<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卷组vg0分配1G给新建逻辑卷lv1</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># lvcreate -L 1G -n lv1 vg0</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>lvremove 逻辑卷</code> 删除逻辑卷</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># lvs</span></span><br><span class="line">  LV   VG  Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv0  vg0 -wi-a-----   1.56g</span><br><span class="line">  lv1  vg0 -wi-a-----   1.00g</span><br><span class="line">  lv2  vg0 -wi-a----- &lt;12.41g</span><br><span class="line">[root@centos7 ~]<span class="comment"># lvremove lv2</span></span><br><span class="line">  Volume group <span class="string">&quot;lv2&quot;</span> not found</span><br><span class="line">  Cannot process volume group lv2</span><br><span class="line">[root@centos7 ~]<span class="comment"># lvremove /dev/vg0/lv2</span></span><br><span class="line">Do you really want to remove active logical volume vg0/lv2? [y/n]: y</span><br><span class="line">  Logical volume <span class="string">&quot;lv2&quot;</span> successfully removed</span><br><span class="line">[root@centos7 ~]<span class="comment"># lvs</span></span><br><span class="line">  LV   VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  lv0  vg0 -wi-a----- 1.56g</span><br><span class="line">  lv1  vg0 -wi-a----- 1.00g</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>lvextend</code> 扩展逻辑卷</p>
<ul>
<li>-L [+]kKmMgGtT 没有+表示扩展至指定大小，有+表示增加指定大小</li>
<li>-l [+]Number[PERCENT]</li>
<li>-r 如果逻辑卷上已经有文件系统，同步扩展文件系统</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两步实现：</span></span><br><span class="line"><span class="comment"># 1. 实现逻辑卷的空间扩展</span></span><br><span class="line">lvextend -L [+]<span class="comment">#[mMgGtT] /dev/VG_NAME/LV_NAME</span></span><br><span class="line"><span class="comment"># 2. 实现文件系统的扩展</span></span><br><span class="line">resize2fs /dev/VG_NAME/LV_NAME	<span class="comment"># 针对ext</span></span><br><span class="line"><span class="comment"># 或：</span></span><br><span class="line">xfs_growfs MOUNTPOINT			<span class="comment"># 针对xfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一步实现</span></span><br><span class="line">lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># lvextend -r -L +1G /dev/vg0/lv1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>lvreduce</code> 缩减逻辑卷，只针对 ext 文件系统，xfs 不支持缩减，缩减有风险，最好先备份数据</p>
<ul>
<li>-l 同 lvextend</li>
<li>-L 同 lvextend</li>
</ul>
</li>
</ul>
<h4 id="5-在逻辑卷上创建文件系统并挂载"><a href="#5-在逻辑卷上创建文件系统并挂载" class="headerlink" title="5. 在逻辑卷上创建文件系统并挂载"></a>5. 在逻辑卷上创建文件系统并挂载</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/vg0/lv1</span><br><span class="line">mount /dev/vg0/lv1 /mnt/lv1/</span><br></pre></td></tr></table></figure>

<h4 id="6-跨主机迁移卷组"><a href="#6-跨主机迁移卷组" class="headerlink" title="6. 跨主机迁移卷组"></a>6. 跨主机迁移卷组</h4><ol>
<li><p>在旧系统中,umount 所有卷组上的逻辑卷</p>
</li>
<li><p>禁用卷组</p>
<p>vgchange 用于修改卷组的属性，经常被用来设置卷组是处于活动状态或者非活动状态。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vgchange –a n vg0</span><br><span class="line">lvdisplay</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>导出卷组</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vgexport vg0</span><br><span class="line">pvscan</span><br><span class="line">vgdisplay</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>拆下旧硬盘在目标计算机上,并导入卷组</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgimport vg0</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>启用</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgchange –ay vg0</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>mount 所有卷组上的逻辑卷</li>
</ol>
<h4 id="7-拆除指定的-pv-存储设备"><a href="#7-拆除指定的-pv-存储设备" class="headerlink" title="7. 拆除指定的 pv 存储设备"></a>7. 拆除指定的 pv 存储设备</h4><ol>
<li>pvmove 迁移物理卷数据，注意只能迁移到同一卷组下的其他物理卷</li>
<li>vgreduce 从卷组中移除物理卷</li>
<li>pvremove 从机器上移除物理卷</li>
</ol>
<h3 id="逻辑卷快照"><a href="#逻辑卷快照" class="headerlink" title="逻辑卷快照"></a>逻辑卷快照</h3><p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mkfs.xfs	/dev/vg0/data</span><br><span class="line">mount	/dev/vg0/data/	/mnt/data</span><br><span class="line"></span><br><span class="line"><span class="comment">#为现有逻辑卷创建快照，快照大小一般指定为十分之一</span></span><br><span class="line"><span class="comment">#  -p|--permission rw|r</span></span><br><span class="line">lvcreate	-l	64	-s	-n	data-snapshot	-p	r	/dev/vg0/data</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载快照</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt/snap</span><br><span class="line">mount -o ro,nouuid /dev/vg0/data-snapshot /mnt/snap		<span class="comment">#  -o ro,nouuid 只读，不校验重复uuid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#恢复快照</span></span><br><span class="line">umount /dev/vg0/data-snapshot</span><br><span class="line">umount /dev/vg0/data</span><br><span class="line">lvconvert --merge /dev/vg0/data-snapshot</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除快照</span></span><br><span class="line">umount	/mnt/snap</span><br><span class="line">lvremove	/dev/vg0/data-snapshot</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BD%AF%E4%BB%B6/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BD%AF%E4%BB%B6/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">软件管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:30:02" itemprop="dateCreated datePublished" datetime="2020-12-09T22:30:02+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="软件运行环境"><a href="#软件运行环境" class="headerlink" title="软件运行环境"></a>软件运行环境</h2><h3 id="POSIX"><a href="#POSIX" class="headerlink" title="POSIX"></a>POSIX</h3><p>POSIX:Portable Operating System Interface 可移植操作系统接口,定义了操作系统应该为应用程序<br>提供的接口标准,是 IEEE 为要在各种 UNIX 操作系统上运行的软件而定义的一系列 API 标准的总称。<br>Linux 和 windows 都要实现基本的 posix 标准,程序就在源代码级别可移植了</p>
<h3 id="C-语言程序的实现过程"><a href="#C-语言程序的实现过程" class="headerlink" title="C 语言程序的实现过程"></a>C 语言程序的实现过程</h3><p>源代码-&gt;预处理-&gt;编译-&gt;汇编-&gt;链接</p>
<p>预处理：略<br>编译：将 C 转译成汇编<br>汇编：将汇编转译成机器指令<br>链接：调用链接器 ld 来链接程序运行需要的一大堆目标文件,以及所依赖的其它库文件,最后生成可执行文件</p>
<h3 id="静态链接和动态链接"><a href="#静态链接和动态链接" class="headerlink" title="静态链接和动态链接"></a>静态链接和动态链接</h3><img data-src="//img.to2b.cn/blog/ljk/1597365779221.png" style="zoom: 67%;" />

<h4 id="ldd"><a href="#ldd" class="headerlink" title="ldd"></a>ldd</h4><p>查看二进制程序所依赖的库文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ ldd /bin/ls</span><br><span class="line">	linux-vdso.so.1 (0x00007fff7ccf9000)</span><br><span class="line">	libselinux.so.1 =&gt; /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007ffadd6d3000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffadd2e2000)</span><br><span class="line">	libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007ffadd070000)</span><br><span class="line">	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007ffadce6c000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007ffaddb1d000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007ffadcc4d000)</span><br></pre></td></tr></table></figure>

<p>动态库路径的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/ld.so.conf</span><br><span class="line">/etc/ld.so.conf.d/*.conf</span><br></pre></td></tr></table></figure>

<p>将配置文件规定的路径下的库文件加载到缓存文件（字典）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldconfig</span><br></pre></td></tr></table></figure>

<p>缓存文件（字典）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ ll /etc/ld.so.cache</span><br><span class="line">-rw-r--r-- 1 root root 81473 Aug 14 08:47 /etc/ld.so.cache</span><br><span class="line">lujinkai@Z510:~$ file !$</span><br><span class="line">file /etc/ld.so.cache</span><br><span class="line">/etc/ld.so.cache: data</span><br></pre></td></tr></table></figure>

<p>查看缓存文件（字典）<br>显示所有可用库文件名及文件路径映射关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldconfig -p</span><br></pre></td></tr></table></figure>

<p>程序执行时会去 ld.so.cache 文件查找动态库的信息，所以如果有新的库文件，需要先执行 ldconfig 将新的库文件加载到 ld.so.cache</p>
<h2 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># yum install -y autofs</span></span><br><span class="line">[root@centos7 /]<span class="comment"># systemctl start autofs</span></span><br><span class="line">[root@centos7 /]<span class="comment"># cd /misc/cd</span></span><br><span class="line">[root@centos7 <span class="built_in">cd</span>]<span class="comment"># ls</span></span><br><span class="line">CentOS_BuildTag  GPL       LiveOS    RPM-GPG-KEY-CentOS-7</span><br><span class="line">EFI              images    Packages  RPM-GPG-KEY-CentOS-Testing-7</span><br><span class="line">EULA             isolinux  repodata  TRANS.TBL</span><br><span class="line">[root@centos7 <span class="built_in">cd</span>]<span class="comment"># cd Packages/</span></span><br><span class="line">[root@centos7 Packages]<span class="comment"># ls</span></span><br><span class="line">acl-2.2.51-15.el7.x86_64.rpm</span><br><span class="line">aic94xx-firmware-30-6.el7.noarch.rpm</span><br><span class="line">aide-0.15.1-13.el7.x86_64.rpm</span><br><span class="line">alsa-firmware-1.0.28-2.el7.noarch.rpm</span><br><span class="line">alsa-lib-1.1.8-1.el7.x86_64.rpm</span><br><span class="line">alsa-tools-firmware-1.1.0-1.el7.x86_64.rpm</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预览包内文件</span></span><br><span class="line">[root@centos7 Packages]<span class="comment"># rpm2cpio zip-3.0-11.el7.x86_64.rpm | cpio -itv</span></span><br><span class="line">-rwxr-xr-x   1 root     root       215840 Nov  6  2016 ./usr/bin/zip</span><br><span class="line">-rwxr-xr-x   1 root     root       100456 Nov  6  2016 ./usr/bin/zipcloak</span><br><span class="line">-rwxr-xr-x   1 root     root        95984 Nov  6  2016 ./usr/bin/zipnote</span><br><span class="line">-rwxr-xr-x   1 root     root       100096 Nov  6  2016 ./usr/bin/zipsplit</span><br><span class="line">drwxr-xr-x   2 root     root            0 Nov  6  2016 ./usr/share/doc/zip-3.0</span><br><span class="line">-rw-r--r--   1 root     root       210354 Jul  6  2008 ./usr/share/doc/zip-3.0/CHANGES</span><br><span class="line">-rw-r--r--   1 root     root         3412 Mar  4  2007 ./usr/share/doc/zip-3.0/LICENSE</span><br><span class="line">-rw-r--r--   1 root     root        12748 Jun 26  2008 ./usr/share/doc/zip-3.0/README</span><br><span class="line">-rw-r--r--   1 root     root         6430 Mar 26  2008 ./usr/share/doc/zip-3.0/README.CR</span><br><span class="line">-rw-r--r--   1 root     root         6675 Jun 13  2008 ./usr/share/doc/zip-3.0/TODO</span><br><span class="line">-rw-r--r--   1 root     root        15731 Jul  2  2008 ./usr/share/doc/zip-3.0/WHATSNEW</span><br><span class="line">-rw-r--r--   1 root     root        13167 Jun 13  2008 ./usr/share/doc/zip-3.0/WHERE</span><br><span class="line">-rw-r--r--   1 root     root         3395 Dec 14  1996 ./usr/share/doc/zip-3.0/algorith.txt</span><br><span class="line">-rw-r--r--   1 root     root        28496 Jun 17  2008 ./usr/share/man/man1/zip.1.gz</span><br><span class="line">-rw-r--r--   1 root     root          951 May  8  2008 ./usr/share/man/man1/zipcloak.1.gz</span><br><span class="line">-rw-r--r--   1 root     root          819 Nov  6  2016 ./usr/share/man/man1/zipnote.1.gz</span><br><span class="line">-rw-r--r--   1 root     root          619 Nov  6  2016 ./usr/share/man/man1/zipsplit.1.gz</span><br><span class="line">1598 blocks</span><br></pre></td></tr></table></figure>

<p>范例：统计 rpm 的架构类型及相应的包管理器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 Packages]<span class="comment"># ls *.rpm | sed -En &quot;s/.*\.(.*)\.rpm/\1/p&quot; | sort | uniq -c | sort -nr</span></span><br><span class="line">    381 x86_64</span><br><span class="line">     65 noarch</span><br><span class="line">[root@centos7 Packages]<span class="comment"># ls *.rpm | rev | cut -d. -f2 | rev | sort | uniq -c | sort -nr</span></span><br><span class="line">    381 x86_64</span><br><span class="line">     65 noarch</span><br><span class="line">[root@centos7 Packages]<span class="comment"># ls *.rpm | grep -Eo &quot;[^.]+\.rpm$&quot; | grep -Eo &quot;^[^.]+&quot; | sort | uniq -c | sort -nr</span></span><br><span class="line">    381 x86_64</span><br><span class="line">     65 noarch</span><br></pre></td></tr></table></figure>

<h3 id="包管理器"><a href="#包管理器" class="headerlink" title="包管理器"></a>包管理器</h3><ul>
<li>redhat：rpm 文件，rpm 包管理器</li>
<li>debian：deb 文件，dpkg 包管理器</li>
</ul>
<h3 id="x2F-var-x2F-lib-x2F-rpm"><a href="#x2F-var-x2F-lib-x2F-rpm" class="headerlink" title="&#x2F;var&#x2F;lib&#x2F;rpm"></a>&#x2F;var&#x2F;lib&#x2F;rpm</h3><p>当安装完一个包后，包的信息会存储到一个数据库中，这数据库中信息是所有包共享的，所以叫共享数据库：&#x2F;var&#x2F;lib&#x2F;rpm，这里面记录了当前主机上安装好的各种 rpm 包，包括它们的名称、版本、依赖关系、功能说明、包安装后生成的各文件路径及校验码信息。</p>
<p>这个数据库很重要，一旦破坏，就无法安装卸载软件，当使用 rpm 安装软件的时候，会查询这个数据库，如果已经安装，就提示已安装。</p>
<h3 id="获取包的途径"><a href="#获取包的途径" class="headerlink" title="获取包的途径"></a>获取包的途径</h3><p>光盘：<br><a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/">http://mirrors.163.com/centos/</a><br><a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/centos/">https://mirrors.aliyun.com/centos/</a><br><a target="_blank" rel="noopener" href="http://mirrors.163.com/ubuntu-releases/">http://mirrors.163.com/ubuntu-releases/</a><br><a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/ubuntu-releases/">https://mirrors.aliyun.com/ubuntu-releases/</a></p>
<h2 id="包管理器-rpm"><a href="#包管理器-rpm" class="headerlink" title="包管理器 rpm"></a>包管理器 rpm</h2><p>安装、卸载、升级、查询、校验、数据库维护</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh PACKAGE_FILE...</span><br><span class="line"></span><br><span class="line">-i    <span class="comment"># install</span></span><br><span class="line">-v    <span class="comment"># 显示详细的信息</span></span><br><span class="line">-h    <span class="comment"># 显示进度</span></span><br></pre></td></tr></table></figure>

<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -e PACKAGE_FILE... [--nodeps]</span><br><span class="line"></span><br><span class="line">-e        <span class="comment"># 卸载</span></span><br><span class="line">--nodeps  <span class="comment"># 忽略依赖关系</span></span><br></pre></td></tr></table></figure>

<h3 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh PACKAGE_FILE...</span><br><span class="line">rpm -Fvh PACKAGE_FILE...</span><br><span class="line"></span><br><span class="line">-U      <span class="comment"># upgrade 例如要升级php，如果本机已安装php，则升级，如果本机没有php，则安装</span></span><br><span class="line">-F      <span class="comment"># freshen 例如要升级php，如果本机已安装php，则升级，如果本机没有php，则不执行任何操作</span></span><br><span class="line">--force <span class="comment"># 强制安装</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>不要对内核做升级操作；Linux 支持多内核并存，因此直接安装新版本内核</li>
<li>如果原程序的配置文件被修改，升级时，新版本提供的同以配置文件不会直接覆盖，而是把新版本的配置文件重命名（filename.rpmnew）后保留</li>
</ol>
<h3 id="降级"><a href="#降级" class="headerlink" title="降级"></a>降级</h3><p>在升级的命令上添加 –oldpackage 即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh --oldpackage PACKAGE_FILE...</span><br><span class="line">rpm -Fvh --oldpackage PACKAGE_FILE...</span><br></pre></td></tr></table></figure>

<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm &#123;-q|--query&#125; [select-options] [query-options]</span><br></pre></td></tr></table></figure>

<p>常用查询语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-q PACKAGE</span><br><span class="line">-qa | grep <span class="string">&#x27;pattern&#x27;</span></span><br><span class="line">-qi PACKAGE</span><br><span class="line">-qc PACKAGE</span><br><span class="line">-ql PACKAGE</span><br><span class="line">-qd PACKAGE</span><br><span class="line">-q --scripts PACKAGE</span><br><span class="line">-qf file</span><br><span class="line">-qpi PACKAGE_FILE</span><br><span class="line">-qpl PACKAGE_FILE, ...</span><br><span class="line"></span><br><span class="line">-a         <span class="comment"># 所有已安装的包</span></span><br><span class="line">-f         <span class="comment"># 文件是由哪个包安装生成的</span></span><br><span class="line">-p rpmfile <span class="comment"># 尚未安装的包文件，以下-c、-d、-i、-l、--script默认只查询已安装的包，如果要查询未安装的包的相关信息，需要配合-p选项</span></span><br><span class="line">-c         <span class="comment"># 程序的配置文件</span></span><br><span class="line">-d         <span class="comment"># 程序的文档</span></span><br><span class="line">-i         <span class="comment"># information</span></span><br><span class="line">-l         <span class="comment"># 安装后生成的所有文件</span></span><br><span class="line">--scripts  <span class="comment"># 包自带的脚本文件</span></span><br></pre></td></tr></table></figure>

<h3 id="校验"><a href="#校验" class="headerlink" title="校验"></a>校验</h3><p>占位。。。</p>
<h3 id="数据库维护"><a href="#数据库维护" class="headerlink" title="数据库维护"></a>数据库维护</h3><p>&#x2F;var&#x2F;lib&#x2F;rpm</p>
<h2 id="yum-和-dnf"><a href="#yum-和-dnf" class="headerlink" title="yum 和 dnf"></a>yum 和 dnf</h2><p>rpm 不能解决包的依赖关系，yum 和 dnf 可以，yum 适用 centos7，dnf 适用 centos8，以下只介绍 yum，dnf 也都一样</p>
<p>yum：服务器存放 rpm 包和包相关的元数据库</p>
<p>yum 实现过程：</p>
<p>先在 yum 服务器上创建 yum repository(仓库),在仓库中事先存储了众多 rpm 包,以及包的相关的元数据文件(放置于特定目录 repodata 下),当 yum 客户端利用 yum&#x2F;dnf 工具进行安装时包时,会自动下载 repodata 中的元数据,查询远数据是否存在相关的包及依赖关系,自动从仓库中找到相关包下载并安装</p>
<h3 id="yum-客户端配置"><a href="#yum-客户端配置" class="headerlink" title="yum 客户端配置"></a>yum 客户端配置</h3><p>配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/yum.conf</span><br><span class="line">/etc/yum.repos.d/*.repo</span><br></pre></td></tr></table></figure>

<p>&#x2F;etc&#x2F;yum.conf 这个文件不用动，如果要改，就改 &#x2F;etc&#x2F;yum.repos.d&#x2F;</p>
<p>&#x2F;etc&#x2F;yum.repos.d&#x2F;*.repo，每个 repo 文件都记录了不同的仓库</p>
<p>CentOS-Base.repo</p>
<p>访问 mirrorlist，返回的是多个 baseurl，所以可以不设置 mirrorlist，只设置 baseurl，可以设置多个 baseurl<br><img data-src="//img.to2b.cn/blog/ljk/1597460963538.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">failovermethod    <span class="comment"># 随机访问baseurl还是顺序访问</span></span><br><span class="line">	roundrobin    <span class="comment"># 意为随机挑选，默认值</span></span><br><span class="line">	priority      <span class="comment"># 按顺序访问</span></span><br><span class="line"><span class="built_in">enable</span>            <span class="comment"># 开启或禁用，不写默认就是开启</span></span><br><span class="line">gpgcheck          <span class="comment"># 是否需要校验，校验的key就是gpgkey</span></span><br><span class="line">gpgkey            <span class="comment"># 校验的key</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$releasever</span>    <span class="comment"># 当前OS的发行版的主版本号,如:8,7,6</span></span><br><span class="line"><span class="variable">$arch</span>          <span class="comment"># CPU架构,如:aarch64, i586, i686,x86_64等</span></span><br><span class="line"><span class="variable">$basearch</span>      <span class="comment"># 系统基础平台;i386, x86_64</span></span><br><span class="line"><span class="variable">$contentdir</span>    <span class="comment"># 表示目录,比如:centos-8,centos-7</span></span><br><span class="line"><span class="variable">$YUM0</span>-<span class="variable">$YUM9</span>    <span class="comment"># 自定义变量</span></span><br></pre></td></tr></table></figure>

<p>什么是 epel？<br>extra packages for enterprise linux，是基于 Fedora 的一个项目，为“红帽系”的操作系统提供额外的软件包，适用于 RHEL、CentOS 和 Scientific Linux，可以理解为是一个第三方源</p>
<h4 id="常见-baseurl"><a href="#常见-baseurl" class="headerlink" title="常见 baseurl"></a>常见 baseurl</h4><p>centos</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">http://mirrors.163.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">http://mirrors.huaweicloud.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">http://mirrors.tuna.tsinghua.edu.cn/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br></pre></td></tr></table></figure>

<p>epel centos7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://mirrors.aliyun.com/epel/7/<span class="variable">$basearch</span></span><br><span class="line">http://mirrors.huaweicloud.com/epel/7/<span class="variable">$basearch</span></span><br><span class="line">http://mirrors.tuna.tsinghua.edu.cn/epel/7/<span class="variable">$basearch</span></span><br></pre></td></tr></table></figure>

<p>epel centos8</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://mirrors.aliyun.com/epel/8/Everything/<span class="variable">$basearch</span></span><br><span class="line">http://mirrors.huaweicloud.com/epel/8/Everything/<span class="variable">$basearch</span></span><br><span class="line">http://mirrors.tuna.tsinghua.edu.cn/epel/8/Everything/<span class="variable">$basearch</span></span><br></pre></td></tr></table></figure>

<p>注意：yum 仓库指向的路径一定必须是 repodata 目录所在目录</p>
<h2 id="yum-命令"><a href="#yum-命令" class="headerlink" title="yum 命令"></a>yum 命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum [options] [<span class="built_in">command</span>] [package ...]</span><br></pre></td></tr></table></figure>

<h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-y                     <span class="comment">#自动回答为“yes”</span></span><br><span class="line">-q                     <span class="comment">#静默模式</span></span><br><span class="line">--nogpgcheck           <span class="comment">#跳过gpg check</span></span><br><span class="line">--enablerepo=&lt;repoid&gt;  <span class="comment">#临时启用指定repo,支持通配符,如:&quot;*&quot;</span></span><br><span class="line">--disablerepo=&lt;repoid&gt; <span class="comment">#临时禁用指定repo,支持通配符,如:&quot;*&quot;,和--repo互斥</span></span><br><span class="line">--noplugins            <span class="comment">#禁用所有插件</span></span><br><span class="line">--showduplicates       <span class="comment">#显示仓库中所有的包，主要与list和search等子命令搭配使用</span></span><br></pre></td></tr></table></figure>

<h3 id="command"><a href="#command" class="headerlink" title="command"></a>command</h3><p>在 centos8 中(centos7&#x2F;6 不行)，yum 然后 tab 可以列出 yum 部分常用的子命令，注意不是全部</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597543416977.png"></p>
<p>详细的命令解析参考<code>man dnf</code>或<code>man yum</code>，但是 man 手册的内容太多了，我们只记 yum 的常用用法就可以了，毕竟 yum 只是用来解决编译安装的依赖问题。</p>
<p>以下是常用的子命令：</p>
<h4 id="repolist"><a href="#repolist" class="headerlink" title="repolist"></a>repolist</h4><p>显示仓库列表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist [all|enabled|disabled]</span><br></pre></td></tr></table></figure>

<h4 id="list"><a href="#list" class="headerlink" title="list"></a>list</h4><p>显示程序包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum list</span><br><span class="line">yum list [all | glob_exp1] [glob_exp2] [...]</span><br><span class="line">yum list &#123;available|installed|updates&#125; [glob_exp1] [...]</span><br></pre></td></tr></table></figure>

<h4 id="install-and-reinstall"><a href="#install-and-reinstall" class="headerlink" title="install and reinstall"></a>install and reinstall</h4><p>安装和重新安装程序包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install package1 [package2] [...]	<span class="comment"># 安装</span></span><br><span class="line">yum reinstall package1 [package2] [...]	<span class="comment"># 重新安装</span></span><br></pre></td></tr></table></figure>

<p>–downloadonly：只下载相关的 rpm 包，默认下载到 var&#x2F;cache&#x2F;yum&#x2F;x86_64&#x2F;7 目录下，不执行安装动作<br>–downloaddir&#x3D;<path>，–destdir&#x3D;<path>：配合–downloadonly，指定下载的路径，如果不存在则自动创建</p>
<h4 id="remove-or-erase"><a href="#remove-or-erase" class="headerlink" title="remove or erase"></a>remove or erase</h4><p>卸载程序包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove | erase package1 [package2] [...]</span><br></pre></td></tr></table></figure>

<h4 id="update-and-downgrade"><a href="#update-and-downgrade" class="headerlink" title="update and downgrade"></a>update and downgrade</h4><p>检查可用升级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum check-update</span><br></pre></td></tr></table></figure>

<p>升级和降级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum upgrade|update [package1] [package2] [...]</span><br><span class="line">yum upgrade-minimal	<span class="comment"># 最小化升级</span></span><br><span class="line">yum downgrade package1 [package2] [...] <span class="comment"># 降级</span></span><br></pre></td></tr></table></figure>

<h4 id="查看包的详细信息"><a href="#查看包的详细信息" class="headerlink" title="查看包的详细信息"></a>查看包的详细信息</h4><p>info、provides|whatprovides、search、deplist、repoquery</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum info [...]</span><br></pre></td></tr></table></figure>

<p>查看指定的特性（可以是某文件）是由哪个程序包提供的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides | whatprovides feature1 [feature2] [...]</span><br></pre></td></tr></table></figure>

<p>主义文件要写全路径，而不是只是文件名，可以使用通配符，例如：<code>yum provides */vsftpd.conf</code></p>
<p>以指定的关键字搜索程序包及 summary 信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum search string1 [string2] [...]</span><br></pre></td></tr></table></figure>

<p>查看指定包所依赖的 capabilities：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum deplist package1 [package2] [...]</span><br></pre></td></tr></table></figure>

<p>扩展： centos8 查看未安装包的文件列表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf repoquery package</span><br><span class="line">dnf repoquery -l package</span><br></pre></td></tr></table></figure>

<p>扩展： centos7 查看未安装包的文件列表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install yum-utils</span><br><span class="line">repoquery -q package</span><br><span class="line">repoquery -ql package</span><br></pre></td></tr></table></figure>

<h4 id="clean-and-makecache"><a href="#clean-and-makecache" class="headerlink" title="clean and makecache"></a>clean and makecache</h4><p>清除&#x2F;var&#x2F;cache&#x2F;yum 缓存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean [ packages | metadata | expire-cache | rpmdb | plugins | all ]</span><br></pre></td></tr></table></figure>

<p>构建缓存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># yum clean all; yum makecache</span></span><br></pre></td></tr></table></figure>

<h4 id="history"><a href="#history" class="headerlink" title="history"></a>history</h4><p>事务历史</p>
<p>centos7 及以前的版本日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/log/yum.log</span><br></pre></td></tr></table></figure>

<p>centos8 版本日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/log/dnf.rpm.log</span><br><span class="line">/var/log/dnf.log</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="built_in">history</span> [info|list|packages-list|packages-info|summary|addon-info|redo|undo|rollback|new|<span class="built_in">sync</span>|stats]</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># dnf history</span></span><br><span class="line">ID     | Command line             | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">     4 | install lrzsz            | 2020-08-15 09:58 | Install        |    1</span><br><span class="line">     3 | install -y autofs        | 2020-08-15 09:05 | Install        |    1</span><br><span class="line">     2 | install vim wget -y      | 2020-08-15 08:03 | Install        |    5</span><br><span class="line">     1 |                          | 2020-07-29 05:12 | Install        |  455 EE</span><br><span class="line">[root@centos8 ~]<span class="comment"># dnf history info 4</span></span><br><span class="line">Transaction ID : 4</span><br><span class="line">Begin time     : Sat 15 Aug 2020 09:58:11 AM EDT</span><br><span class="line">Begin rpmdb    : 455:2fec96053059825d1e35cd07ef7f27130b90a171</span><br><span class="line">End time       : Sat 15 Aug 2020 09:58:11 AM EDT (0 seconds)</span><br><span class="line">End rpmdb      : 456:d9d289d9345ad932d7563415cf622772184a6e92</span><br><span class="line">User           : root &lt;root&gt;</span><br><span class="line">Return-Code    : Success</span><br><span class="line">Releasever     : 8</span><br><span class="line">Command Line   : install lrzsz</span><br><span class="line">Packages Altered:</span><br><span class="line">    Install lrzsz-0.12.20-43.el8.x86_64 @BaseOS</span><br></pre></td></tr></table></figure>

<h4 id="localinstall-or-install"><a href="#localinstall-or-install" class="headerlink" title="localinstall or install"></a>localinstall or install</h4><p>安装及升级本地程序包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall|install rpmfile1 [rpmfile2] [...]</span><br><span class="line">yum localupdate|update rpmfile1 [rpmfile2] [...]</span><br></pre></td></tr></table></figure>

<h4 id="查看包的安全警告"><a href="#查看包的安全警告" class="headerlink" title="查看包的安全警告"></a>查看包的安全警告</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum updateinfo --summary|--list|--info</span><br></pre></td></tr></table></figure>

<h4 id="包组管理相关"><a href="#包组管理相关" class="headerlink" title="包组管理相关"></a>包组管理相关</h4><p>groupinstall、groupupdate、grouplist、groupremove、groupinfo</p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/826.html">什么是软件包组？</a><br>简单说就是功能相对集中的软件包集合，例如，在初始安装 Linux 时没有安装图形界面，但后来发现需要图形界面的支持，这时可以手工安装图形界面软件组（Server with GUI、GNOME），这样就可以支持图形界面了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum grouplist [hidden] [groupwildcard] [...]</span><br><span class="line">yum groupinstall group1 [group2] [...]</span><br><span class="line">yum groupupdate group1 [group2] [...]</span><br><span class="line">yum groupremove group1 [group2] [...]</span><br><span class="line">yum groupinfo group1 [...]</span><br></pre></td></tr></table></figure>

<h3 id="实现私有-yum-仓库"><a href="#实现私有-yum-仓库" class="headerlink" title="实现私有 yum 仓库"></a>实现私有 yum 仓库</h3><p>服务端：</p>
<ol>
<li>将远程仓库的 rpm 包和 meta 同步到本地</li>
<li>安装 http 或 https 或 ftp 或 file 服务，使客户端可以访问</li>
</ol>
<p>客户端：</p>
<ol>
<li>修改配置文件，将远程仓库地址修改为私有的仓库地址</li>
</ol>
<p>具体实现：</p>
<h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><p>服务端环境为 CentOS7，配置 yum 和 apt 私有仓库</p>
<ol>
<li>创建目录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 mirrors]<span class="comment"># pwd</span></span><br><span class="line">/data/mirrors</span><br><span class="line">[root@centos7 mirrors]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── centos</span><br><span class="line">│   ├── 6</span><br><span class="line">│   │   └── x86_64</span><br><span class="line">│   ├── 7</span><br><span class="line">│   │   └── x86_64</span><br><span class="line">│   └── 8</span><br><span class="line">│       └── x86_64</span><br><span class="line">├── epel</span><br><span class="line">│   ├── 6</span><br><span class="line">│   │   └── x86_64</span><br><span class="line">│   ├── 7</span><br><span class="line">│   │   └── x86_64</span><br><span class="line">│   └── 8</span><br><span class="line">│       └── x86_64</span><br><span class="line">└── ubuntu</span><br><span class="line">    ├── 18.04</span><br><span class="line">    │   └── x86_64</span><br><span class="line">    └── 20.04</span><br><span class="line">        └── x86_64</span><br><span class="line"></span><br><span class="line">19 directories, 0 files</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装 ngnix，配置路径</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /mirrors &#123;</span><br><span class="line">    root /data;</span><br><span class="line">    autoindex on;</span><br><span class="line">    autoindex_exact_size on;</span><br><span class="line">    autoindex_localtime on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="//img.to2b.cn/blog/ljk/1597673044262.png"></p>
<ol start="3">
<li>配置服务端的 yum 远程仓库国内的镜像源<br>centos7</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/yum.repos.d/tmp.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=base repo</span><br><span class="line">baseurl=http://mirrors.aliyun.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.163.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.huaweicloud.com/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">        http://mirrors.tuna.tsinghua.edu.cn/centos/<span class="variable">$releasever</span>/os/<span class="variable">$basearch</span>/</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0	<span class="comment"># 方便下载，先禁止校验</span></span><br><span class="line"><span class="comment"># gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span><br></pre></td></tr></table></figure>

<p>ubuntu18.04</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>将远程仓库的 rpm 包和 meta 同步到本地<br>centos 使用 reposync，centos8 的 dnf 集成，centos7 来自 yum-utils；ubuntu 使用 apt-mirror，yum 无法安装这个命令，所以可以在 ubuntu 的机器上同步完后，拷贝到 centos 的机器上。如果服务端的环境是 ubuntu，apt 则可以直接安装 apt-mirror 和 reposync 命令。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf reposync --repoid=epel --download-metadata -p /data/mirrors/epel/7/x86_64</span><br></pre></td></tr></table></figure>

<p>以上命令是把整个 epel 仓库同步过来，大约有一万多个包。<br>如果想自定义仓库，控制仓库中有哪些包，以及每个包的版本，可以使用<code>yum install --downloadonly</code>下载<br>指定的 rpm 包，或者去官网等渠道下载想要的版本的包，将这些包放到指定目录下：<code>/data/mirror/centos&#123;6,7,8&#125;/x86_64</code>，<br>然后执行<code>createrepo /data/mirror/centos&#123;6,7,8&#125;/x86_64</code>即可生产元数据 repodata，当仓库的包有变动，重新执行<code>createrepo</code>命令即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 x86_64]<span class="comment">#yum install --downloadonly --downloaddir=./ php mysql nginx httpd</span></span><br><span class="line">[root@centos7 x86_64]<span class="comment">#ll</span></span><br><span class="line">total 17724</span><br><span class="line">-rw-r--r--. 1 root root  105968 Aug 23  2019 apr-1.4.8-5.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   94132 Jul  4  2014 apr-util-1.5.2-6.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 2843664 Apr  4 04:53 httpd-2.4.6-93.el7.centos.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   94308 Apr  4 04:53 httpd-tools-2.4.6-93.el7.centos.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   49644 Jul  4  2014 libzip-0.10.1-8.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   31264 Jul  4  2014 mailcap-2.1.41-2.el7.noarch.rpm</span><br><span class="line">-rw-r--r--. 1 root root 9169616 Apr  4 05:01 mariadb-5.5.65-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  575413 Oct  4  2019 nginx-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   19857 Oct  4  2019 nginx-all-modules-1.16.1-1.el7.noarch.rpm</span><br><span class="line">-rw-r--r--. 1 root root   30445 Oct  4  2019 nginx-mod-http-image-filter-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   39849 Oct  4  2019 nginx-mod-http-perl-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   29613 Oct  4  2019 nginx-mod-http-xslt-filter-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   58301 Oct  4  2019 nginx-mod-mail-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   86465 Oct  4  2019 nginx-mod-stream-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 1421660 Apr  4 05:04 php-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 2880032 Apr  4 05:04 php-cli-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  578968 Apr  4 05:04 php-common-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">[root@centos7 x86_64]<span class="comment">#createrepo ./</span></span><br><span class="line">Spawning worker 0 with 17 pkgs</span><br><span class="line">Workers Finished</span><br><span class="line">Saving Primary metadata</span><br><span class="line">Saving file lists metadata</span><br><span class="line">Saving other metadata</span><br><span class="line">Generating sqlite DBs</span><br><span class="line">Sqlite DBs complete</span><br><span class="line">[root@centos7 x86_64]<span class="comment">#ll</span></span><br><span class="line">total 17728</span><br><span class="line">-rw-r--r--. 1 root root  105968 Aug 23  2019 apr-1.4.8-5.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   94132 Jul  4  2014 apr-util-1.5.2-6.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 2843664 Apr  4 04:53 httpd-2.4.6-93.el7.centos.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   94308 Apr  4 04:53 httpd-tools-2.4.6-93.el7.centos.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   49644 Jul  4  2014 libzip-0.10.1-8.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   31264 Jul  4  2014 mailcap-2.1.41-2.el7.noarch.rpm</span><br><span class="line">-rw-r--r--. 1 root root 9169616 Apr  4 05:01 mariadb-5.5.65-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  575413 Oct  4  2019 nginx-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   19857 Oct  4  2019 nginx-all-modules-1.16.1-1.el7.noarch.rpm</span><br><span class="line">-rw-r--r--. 1 root root   30445 Oct  4  2019 nginx-mod-http-image-filter-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   39849 Oct  4  2019 nginx-mod-http-perl-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   29613 Oct  4  2019 nginx-mod-http-xslt-filter-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   58301 Oct  4  2019 nginx-mod-mail-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root   86465 Oct  4  2019 nginx-mod-stream-1.16.1-1.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 1421660 Apr  4 05:04 php-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root 2880032 Apr  4 05:04 php-cli-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">-rw-r--r--. 1 root root  578968 Apr  4 05:04 php-common-5.4.16-48.el7.x86_64.rpm</span><br><span class="line">drwxr-xr-x. 2 root root    4096 Aug 18 15:33 repodata</span><br></pre></td></tr></table></figure>

<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><ol>
<li>修改配置文件 <code>/etc/yum.repos.d/base.repo</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name=base repo</span><br><span class="line">baseurl=http://10.0.0.100/mirrors/centos/7/x86_64</span><br><span class="line">failovermethod=priority</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>重新生产缓存</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all; yum makecache</span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-软件管理"><a href="#Ubuntu-软件管理" class="headerlink" title="Ubuntu 软件管理"></a>Ubuntu 软件管理</h2><p>Ubuntu 下，dpkg 类似 rpm，apt 类似 yum</p>
<h3 id="dpkg-常见用法"><a href="#dpkg-常见用法" class="headerlink" title="dpkg 常见用法"></a>dpkg 常见用法</h3><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i package.deb</span><br></pre></td></tr></table></figure>

<p>卸载，不建议，不自动卸载依赖于它的包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpkg -r package</span><br><span class="line">dpkg -P package 	<span class="comment"># 同时删除配置文件</span></span><br></pre></td></tr></table></figure>

<p>列出当前已安装的包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l</span><br></pre></td></tr></table></figure>

<p>显示该包的简要说明</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l package</span><br></pre></td></tr></table></figure>

<p>列出该包的状态，包括详细信息，类似 rpm -qi</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -s package</span><br></pre></td></tr></table></figure>

<p>列出该包中所包含的文件，类似 rpm -ql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L package</span><br></pre></td></tr></table></figure>

<p>搜索包含 pattern 的包，类似 rpm –qf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -S &lt;pattern&gt;</span><br></pre></td></tr></table></figure>

<p>列出 deb 包的内容，类似 rpm –qpl</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -c package.deb</span><br></pre></td></tr></table></figure>

<p>解开 deb 包的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg --unpack package.deb</span><br></pre></td></tr></table></figure>

<h3 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h3><p>apt 与 apt-get 有一些类似的命令选项，但它并不能完全向下兼容 apt-get 命令,也即可用 apt 替换部分 apt-get 系列命令，但不是全部</p>
<table>
<thead>
<tr>
<th>apt 命令</th>
<th>被取代的命令</th>
<th>命令的功能</th>
</tr>
</thead>
<tbody><tr>
<td>apt install</td>
<td>apt-get install</td>
<td>安装软件包</td>
</tr>
<tr>
<td>apt remove</td>
<td>apt-get remove</td>
<td>移除软件包</td>
</tr>
<tr>
<td>apt purge</td>
<td>apt-get purge</td>
<td>移除软件包及配置文件</td>
</tr>
<tr>
<td>apt update</td>
<td>apt-get update</td>
<td>刷新存储库索引</td>
</tr>
<tr>
<td>apt upgrade</td>
<td>apt-get upgrade</td>
<td>升级所有可升级的软件包</td>
</tr>
<tr>
<td>apt autoremove</td>
<td>apt-get autoremove</td>
<td>自动删除不需要的包</td>
</tr>
<tr>
<td>apt full-upgrade</td>
<td>apt-get dist-upgrade</td>
<td>在升级软件包时自动处理依赖关系</td>
</tr>
<tr>
<td>apt search</td>
<td>apt-cache search</td>
<td>搜索应用程序</td>
</tr>
<tr>
<td>apt show</td>
<td>apt-cache show</td>
<td>显示安装细节</td>
</tr>
</tbody></table>
<h4 id="卸载软件包："><a href="#卸载软件包：" class="headerlink" title="卸载软件包："></a>卸载软件包：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt purge package</span><br><span class="line">sudo apt autoremove</span><br><span class="line">sudo apt autoclean</span><br><span class="line"><span class="comment"># dpkg -l |grep ^rc|awk &#x27;&#123;print $2&#125;&#x27; |sudo xargs dpkg -P</span></span><br></pre></td></tr></table></figure>

<h4 id="删除缓存"><a href="#删除缓存" class="headerlink" title="删除缓存"></a>删除缓存</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get autoclean</span><br><span class="line">sudo apt-get autoremove</span><br><span class="line">sudo apt-get clean</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BElocate%E5%92%8Cfind/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BElocate%E5%92%8Cfind/" class="post-title-link" itemprop="url">文件查找locate和find</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:28:37" itemprop="dateCreated datePublished" datetime="2020-12-09T22:28:37+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/" itemprop="url" rel="index"><span itemprop="name">tar和find</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h2><p>find 去硬盘搜索，locate 是去数据库搜索，系统预建的文件索引数据库：&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db<br>执行<code>updatedb</code>更新数据库，这个命令构建索引的过程需要遍历整个根文件系统，很消耗 io 资源，所以在服务器比较繁忙的时候不要执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">locate [OPTION]... [PATTERN]...</span><br><span class="line"></span><br><span class="line">-i      <span class="comment"># 不区分大小写的搜索</span></span><br><span class="line">-n N    <span class="comment"># 只列举前N个匹配项目</span></span><br><span class="line">-r      <span class="comment"># 使用基本正则表达式</span></span><br></pre></td></tr></table></figure>

<p>支持模糊搜索：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ locate `<span class="built_in">pwd</span>`/*sh</span><br><span class="line">/home/lujinkai/data/test/a.sh</span><br><span class="line">/home/lujinkai/data/test/b.sh</span><br><span class="line">/home/lujinkai/data/test/c_r.sh</span><br><span class="line">/home/lujinkai/data/test/test.sh</span><br><span class="line">/home/lujinkai/data/test/test2.sh</span><br></pre></td></tr></table></figure>

<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>locate 查询的不是实时数据，find 查询的是实时的，因为 find 是去遍历指定路径完成文件查找</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [OPTION]... [path...] [expression]</span><br></pre></td></tr></table></figure>

<h3 id="OPTION"><a href="#OPTION" class="headerlink" title="OPTION"></a>OPTION</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-P   <span class="comment"># 找到符号链接的时候，所有的属性都来自符号链接，从来不follow symbolic links。这是默认选项</span></span><br><span class="line">-L   <span class="comment"># 找到符号链接的时候，所有的属性来自文件本身，总是follow symbolic links。而不是符号链接</span></span><br><span class="line">-H   <span class="comment"># 仅仅当作为命令行参数时，也就是这里的[path...]，才会follow symbolic links</span></span><br></pre></td></tr></table></figure>

<h3 id="expression"><a href="#expression" class="headerlink" title="expression"></a>expression</h3><p>描述了如何匹配文件以及如何处理匹配的文件。一个 expression 是由以下多个选项组成：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- Tests</span><br><span class="line">- Actions</span><br><span class="line">- Global options</span><br><span class="line">- Positional options</span><br><span class="line">- Operators</span><br></pre></td></tr></table></figure>

<p>如果整个 expression 没有包含任何选项，默认 <code>-print</code></p>
<p><code>-delete</code> 也类似一个选项，因为它隐含 <code>-depth</code> 选项</p>
<h4 id="Positional-options-位置选项"><a href="#Positional-options-位置选项" class="headerlink" title="Positional options 位置选项"></a>Positional options 位置选项</h4><p>位置选项总是返回 true。位置选项会影响所有指定的 Tests，哪怕 Tests 写在前面（除了-daystart，-daystart 只影响写在其后面的 Tests），为了易读性，最好把位置选项放在 expression 的开头部分</p>
<ul>
<li><p>-daystart<br>指定每天的开始是 0 点而不是 24 小时之前，例如：当前时间是 8 月 13 日 8 点，要求搜索 2 天内修改过的文件，默认搜索文件的起点是 8 月 11 日 8 点，如果使用-daystart 选项，则搜索文件的起点是 8 月 11 日 0 点</p>
<p>影响的 Tests：-amin,-atime,-cmin,-ctime,-mmin、-mtime</p>
</li>
<li><p>-follow<br>这个选项已经被弃用，使用-L 代替</p>
</li>
<li><p>-regextype type<br>不常用，先略过。。。</p>
<p>影响的 Tests：-regex、-iregex</p>
</li>
<li><p>-warn，-nowarn<br>打开或关闭警告信息，具体看 man 帮助</p>
</li>
</ul>
<h4 id="Global-options-全局选项"><a href="#Global-options-全局选项" class="headerlink" title="Global options 全局选项"></a>Global options 全局选项</h4><p>Global options 也总是返回 true，对所有的</p>
<ul>
<li><p>-d<br>已弃用，等同于-depth 的，与 FreeBSD、NetBSD、MacOSX 和 OpenBSD 兼容.</p>
</li>
<li><p>-depth<br>搜索到目录时，先处理目录中的文件，再处理目录本身。对于-delete 这个 action，它隐含-depth 选项</p>
</li>
<li><p>-ignore_readdir_race<br>在 find 统计文件的时候，如果有其他操作把这文件删了，会报错，加上这个选项就不报错了</p>
</li>
<li><p>-noignore_readdir_race<br>关闭-ignore_readdir_race.</p>
</li>
<li><p>-maxdepth levels<br>最大搜索目录深度,指定目录下的文件为第 1 级</p>
</li>
<li><p>-mindepth levels<br>最小搜索目录深度</p>
</li>
<li><p>-mount<br>不搜索其他文件系统，-xdev 的替代名称，用于与 find 的其他版本兼容</p>
</li>
<li><p>-xdev<br>不搜索其他文件系统</p>
</li>
<li><p>-noleaf<br>禁止在非 UNUX 文件系统，MS-DOS 系统，CD-ROM 文件系统中进行最优化查找，具体什么意思没太看懂</p>
</li>
<li><p>-help，–help<br>打印帮助信息，并且退出</p>
</li>
<li><p>-version<br>打印 find 版本号然后退出</p>
</li>
</ul>
<h4 id="Tests-测试"><a href="#Tests-测试" class="headerlink" title="Tests 测试"></a>Tests 测试</h4><p>关于选项的参数是数字的，n 表示等于 n，+n 表示大于 n，-n 表示小于 n，例如：<code>-uid 0</code>表示要求 uid 等于 0，<code>-uid +0</code>要求 uid 大于 0</p>
<h5 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h5><p>n：n 个时间单位之内<br>+n：n 个时间单位之前<br>atime：access time，访问时间，文件中的数据库最后被访问的时间<br>mtime：modify time，修改时间，文件内容被修改的最后时间<br>ctime：change time，变化时间，文件的原数据，发生改变的时间</p>
<ul>
<li><p>-amin n<br>a：atime、min：minutes<br>n：搜索 atime 在 n 分钟内有改变的文件<br>+n：搜索 atime 在 n 分钟之前有改变的文件</p>
</li>
<li><p>-mmin n<br>m：mtime</p>
</li>
<li><p>-cmin n<br>c：ctime</p>
</li>
<li><p>-atime n、-ctime n、-mtime n<br>和 amin、mmin、cmin 的区别在于时间单位为天，也就是 24 小时，从现在往前数 24×n 小时</p>
</li>
<li><p>-used n<br>查找 atime 在 ctime 后 n 天的文件</p>
</li>
<li><p>-anewer file<br>搜索 atime 比给定 file 的 mtime 还要晚的文件。换言之，在 file 的内容被修改后，又访问了哪些文件？</p>
</li>
<li><p>-cnewer file<br>搜索 ctime 比给定 file 的 mtime 还要晚的文件。</p>
</li>
<li><p>-new file<br>搜索 mtime 比给定文件的 mtime 还要晚的文件。</p>
</li>
</ul>
<p>-newerXY reference<br>X 和 Y 是占位符，主要是查找 X 时间戳比 reference 的 Y 时间戳更新的文件。<br>reference 可以是时间字符串（参考 date -d 格式，推荐使用 yyyy-MM-dd hh:mm:ss），也可以是<br>X 可以是 a、B、c、m，Y 可以是 a、B、c、m、t。<br>a：atime；<br>B：birth time 文件的出生日期，不是所有系统都支持这个参数；<br>c：ctime；<br>t：代表 reference 本身，此时 reference 必须是时间，不能是文件，显然只有 Y 可以设为 t，X 设为 t 是没有意义的</p>
<p>范例：获取 mtime 为昨天的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ find . -newermt $(<span class="built_in">date</span> -d <span class="string">&#x27;-1 day&#x27;</span> +%F) ! -newermt $(<span class="built_in">date</span> +%F)</span><br><span class="line">./issue</span><br><span class="line">./re.txt</span><br><span class="line">lujinkai@Z510:~/data/test$ find . -newermt <span class="string">&#x27;2020-08-12 00:00:00&#x27;</span> ! -newermt <span class="string">&#x27;2020-08-13 00:00:00&#x27;</span></span><br><span class="line">./issue</span><br><span class="line">./re.txt</span><br></pre></td></tr></table></figure>

<h5 id="文件名和-inode"><a href="#文件名和-inode" class="headerlink" title="文件名和 inode"></a>文件名和 inode</h5><ul>
<li><p>-name pattern<br>文件的 basename 与 pattern 匹配，支持使用通配符，注意，这里的 pattern 的 *、?、[] 是可以匹配.开头的文件，也就是隐藏文件（在 bash 中，是无法匹配的）</p>
</li>
<li><p>-iname pattern<br>不区分大小写的 name</p>
</li>
<li><p>-lname pattern<br>找找符合指定匹配模式的符号链接文件，该选项与-L 冲突</p>
</li>
<li><p>-ilname pattern<br>不区分大小写的 lname</p>
</li>
<li><p>-inum n<br>按照 inode 号查找</p>
</li>
<li><p>-samefile name<br>找出指定文件同 inode 号的文件，即其硬链接</p>
</li>
<li><p>-links n<br>File has n hard links.</p>
</li>
<li><p>-regex pattern<br>-name 只能匹配 basename，-regex 可以匹配整个文件路径，匹配规则是正则表达式</p>
</li>
<li><p>-iregex pattern<br>相比 regex，iregex 对匹配的内容不区分大小写</p>
</li>
<li><p>-path pattern<br>和-regex pattern 相比，-path pattern 的匹配规则是通配符</p>
</li>
<li><p>-ipath pattern<br>不区分大小写的 path</p>
</li>
<li><p>-wholename pattern<br>不推荐使用，可以使用 -path 代替</p>
</li>
<li><p>-iwholename pattern<br>不区分大小写的 wholename</p>
</li>
</ul>
<h5 id="属主、属组"><a href="#属主、属组" class="headerlink" title="属主、属组"></a>属主、属组</h5><ul>
<li>-user uname<br>uname 可以是用户名，也可以是 uid</li>
<li>-group gname<br>gname 可以是组名，也可以是 gid</li>
<li>-uid n<br>文件的属主 id 是 n</li>
<li>-gid n<br>文件的属组 id 是 n</li>
<li>-nouser<br>查找没有属主的文件</li>
<li>-nogroup<br>查找没有属组的文件</li>
</ul>
<h5 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h5><ul>
<li>-type c<br>c 可以是以下类型：<br>b（block）、c（character）、d（directory）、p（FIFO）、f（regular file）、l（symbolic link）、s（socket）、D（门 (Solaris 特有)）<br>当搜索多个文件类型时，可以用逗号分割</li>
</ul>
<h5 id="空文件或目录"><a href="#空文件或目录" class="headerlink" title="空文件或目录"></a>空文件或目录</h5><ul>
<li>-empty<br>查找空文件和空目录</li>
</ul>
<h5 id="文件大小"><a href="#文件大小" class="headerlink" title="文件大小"></a>文件大小</h5><ul>
<li>-size n[cwbkMG]<br>c：1 字节、w：2 字节、b：512 字节（默认）、k：1k、M：1M、G:1G<br>n 的前缀+和-表示大于和小于，对比目标文件时，对文件的 size 进行四舍五入，精度就是指定的 cwbkMG，例如：<code>-size -1M</code>并不等同于<code>-size -1048576c</code>。前者只匹配空文件，后者匹配 0 到 1048575 字节的文件。</li>
</ul>
<h5 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h5><ul>
<li><p>-perm mode<br>精确匹配文件权限，必须提供全部的权限，不提供的默认此权限为 0，mode 推荐使用八进制模式，如果使用符号模式，可能会比较复杂，例如：<code>-perm g=w</code>只能匹配到模式为 0020 的文件</p>
</li>
<li><p>-perm &#x2F;mode<br>可以提供 1 个或多个权限，只要满足其中一个权限，就能匹配，例如：<code>-perm /u=rwx</code>,u 满足 rwx 中一项即可；<code>-perm /222</code>,ugo 中只要有一个具有写权限即可</p>
</li>
<li><p>-perm -mode<br>可以提供 1 个或多个权限，无论提供多少权限，必须全部满足，才能匹配，例如：<code>-perm /u=rwx</code>,u 必须全部满足 rwx；<code>-perm /222</code>,ugo 都要具有写权限</p>
</li>
<li><p>-perm +mode<br>已淘汰，使用 -perm &#x2F;mode 代替</p>
</li>
<li><p>-writable<br>匹配当前用户可写的文件</p>
</li>
<li><p>-readable<br>匹配当前用户可读的文件。-perm 测试文件的 ugo 的权限，而-writable 和-readable 测试当前用户对文件的权限</p>
</li>
</ul>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul>
<li><p>-executable<br>查找可以被执行的文件（sh、bin 文件），和可以被搜索的目录</p>
</li>
<li><p>-true<br>总是返回 true</p>
</li>
<li><p>-false<br>总是返回 false</p>
</li>
<li><p>-fstype type<br>指定文件系统的类型，本机的文件系统类型在&#x2F;etc&#x2F;fstab 中可以查看</p>
</li>
<li><p>-xtype c<br>和“-type”相同，除非文件是符号链接。对于符号链接，-xtype 检查-type 不检查的文件的类型。<br>具体什么意思，还不太清楚</p>
</li>
<li><p>-context pattern<br>只限 SELinux，因为 SELinux 我们都会关掉，所以这个选项没什么用</p>
</li>
</ul>
<h4 id="ACTIONS-动作"><a href="#ACTIONS-动作" class="headerlink" title="ACTIONS 动作"></a>ACTIONS 动作</h4><ul>
<li><p>-print<br>默认的处理动作，输出内容到终端</p>
</li>
<li><p>-delete<br>删除文件，删除成功返回 true，删除失败报错</p>
</li>
<li><p>-ls<br>对处理后的内容执行类似<code>ls -l</code>的操作</p>
</li>
<li><p>-ok command {} ;<br>对查找到的每个文件执行 command,对于每个文件执行命令之前,都会交互式要求用户确认，{}用于引用查找到的文件名称自身</p>
</li>
<li><p>-exec command {} ;<br>对查找到的每个文件执行由 COMMAND 指定的命令，{}用于引用查找到的文件名称自身</p>
</li>
<li><p>-fls file<br>查找到的所有文件的长格式信息保存至指定文件中</p>
</li>
<li><p>-prune<br>如果该文件是一个目录，则不要下降到它，该选项和-depth 冲突，如果设置了-depth 选项，该选项失效</p>
</li>
<li><p>-quit</p>
</li>
</ul>
<h4 id="OPERATORS-操作"><a href="#OPERATORS-操作" class="headerlink" title="OPERATORS 操作"></a>OPERATORS 操作</h4><ul>
<li><p>( expr )<br>强制优先</p>
</li>
<li><p>!expr<br>取反</p>
</li>
<li><p>expr1 expr2<br>隐含的“与“操作</p>
</li>
<li><p>expr1 -a expr2<br>和“expr1 expr2“一样</p>
</li>
<li><p>expr1 -o expr2<br>“或“操作</p>
</li>
<li><p>expr1 , expr2</p>
</li>
</ul>
<h2 id="替换参数-xargs"><a href="#替换参数-xargs" class="headerlink" title="替换参数 xargs"></a>替换参数 xargs</h2><p>xargs 读取标准输入的内容，使用空格或回车（-n）将数据分割，可以直接输出，也可以作为参数传递给后面的命令</p>
<p>find 常常搭配 xargs 一起使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find | xargs <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示10个数字</span></span><br><span class="line"><span class="built_in">seq</span> 10 | xargs</span><br><span class="line"><span class="comment">#删除当前目录下的大量文件</span></span><br><span class="line"><span class="built_in">ls</span> | xargs <span class="built_in">rm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">find -name <span class="string">&quot;*.sh&quot;</span> | xargs <span class="built_in">ls</span> -Sl</span><br><span class="line">[root@centos8 data]<span class="comment">#echo &#123;1..10&#125; |xargs</span></span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line">[root@centos8 data]<span class="comment">#echo &#123;1..10&#125; |xargs -n1</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">[root@centos8 data]<span class="comment">#echo &#123;1..10&#125; |xargs -n2</span></span><br><span class="line">1 2</span><br><span class="line">3 4</span><br><span class="line">5 6</span><br><span class="line">7 8</span><br><span class="line">9 10</span><br><span class="line"><span class="comment">#批量创建和删除用户</span></span><br><span class="line"><span class="built_in">echo</span> user&#123;1..10&#125; |xargs -n1 useradd</span><br><span class="line"><span class="built_in">echo</span> user&#123;1..100&#125; | xargs -n1 userdel -r</span><br><span class="line"><span class="comment">#这个命令是错误的</span></span><br><span class="line">find /sbin/ -perm /700 | <span class="built_in">ls</span> -l</span><br><span class="line"><span class="comment">#查找有特殊权限的文件,并排序</span></span><br><span class="line">find /bin/ -perm /7000 | xargs <span class="built_in">ls</span> -Sl</span><br><span class="line"><span class="comment">#此命令和上面有何区别?</span></span><br><span class="line">find /bin/ -perm -7000 | xargs <span class="built_in">ls</span> -Sl</span><br><span class="line"><span class="comment">#以字符nul分隔*</span></span><br><span class="line">find -<span class="built_in">type</span> f -name “*.txt” -print0 | xargs -0 <span class="built_in">rm</span></span><br><span class="line"><span class="comment">#并发执行多个进程</span></span><br><span class="line"><span class="built_in">seq</span> 100 |xargs -i -P10 wget -P /data</span><br><span class="line">http://10.0.0.8/&#123;&#125;.html</span><br><span class="line"><span class="comment">#并行下载视频</span></span><br><span class="line"><span class="built_in">seq</span> 389 | xargs -i -P3 you-get https://www.bilibili.com/video/av36489007?p=&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>练习</p>
<ol>
<li>查找&#x2F;var 目录下属主为 root,且属组为 mail 的所有文件</li>
<li>查找&#x2F;var 目录下不属于 root、lp、gdm 的所有文件</li>
<li>查找&#x2F;var 目录下最近一周内其内容修改过,同时属主不为 root,也不是 postfix 的文件</li>
<li>查找当前系统上没有属主或属组,且最近一个周内曾被访问过的文件</li>
<li>查找&#x2F;etc 目录下大于 1M 且类型为普通文件的所有文件</li>
<li>查找&#x2F;etc 目录下所有用户都没有写权限的文件</li>
<li>查找&#x2F;etc 目录下至少有一类用户没有执行权限的文件</li>
<li>查找&#x2F;etc&#x2F;init.d 目录下,所有用户都有执行权限,且其它用户有写权限的文件</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9/" class="post-title-link" itemprop="url">打包压缩</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:28:05" itemprop="dateCreated datePublished" datetime="2020-12-09T22:28:05+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/tar%E5%92%8Cfind/" itemprop="url" rel="index"><span itemprop="name">tar和find</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="压缩和解压缩"><a href="#压缩和解压缩" class="headerlink" title="压缩和解压缩"></a>压缩和解压缩</h2><p>除了 zip，所有的压缩都是压缩文件，不能打包目录。</p>
<h3 id="Z"><a href="#Z" class="headerlink" title=".Z"></a>.Z</h3><p>压缩 compress</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compress file</span><br></pre></td></tr></table></figure>

<p>解压缩 uncompress</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncompress file.Z</span><br></pre></td></tr></table></figure>

<h3 id="gz"><a href="#gz" class="headerlink" title=".gz"></a>.gz</h3><p>压缩 gzip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip file</span><br></pre></td></tr></table></figure>

<p>解压缩 gunzip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip file.gz</span><br></pre></td></tr></table></figure>

<h3 id="bz2"><a href="#bz2" class="headerlink" title=".bz2"></a>.bz2</h3><p>压缩 bzip2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bzip2 file</span><br></pre></td></tr></table></figure>

<p>解压 bunzip2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bunzip2 file.bz2</span><br></pre></td></tr></table></figure>

<h3 id="xz"><a href="#xz" class="headerlink" title=".xz"></a>.xz</h3><p>压缩 xz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xz file</span><br></pre></td></tr></table></figure>

<p>解压 unxz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unxz file.xz</span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title=".zip"></a>.zip</h3><p>压缩 zip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要指定压缩后的名称file.zip</span></span><br><span class="line">zip file.zip file</span><br></pre></td></tr></table></figure>

<p>解压 unzip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果解压的是文件，不是目录，需要指定解压后的名称file</span></span><br><span class="line">unzip file.zip file</span><br></pre></td></tr></table></figure>

<p>打包目录并压缩 zip -r</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r dir.zip <span class="built_in">dir</span></span><br></pre></td></tr></table></figure>

<p>解压目录 unzip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压目录可以指定解压后的名称，也可以不指定</span></span><br><span class="line">unzip dir.zip</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">unzip dir.zip <span class="built_in">dir</span></span><br></pre></td></tr></table></figure>

<h2 id="打包和解包"><a href="#打包和解包" class="headerlink" title="打包和解包"></a>打包和解包</h2><h3 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h3><p>tar 即 Tape ARchive 磁带归档，可以对目录和多个文件打包一个文件，并且可以压缩，保留文件属性不丢失，常用于备份功能，推荐使用</p>
<p>对应格式是.tar</p>
<p>结合压缩工具，实现打包并压缩</p>
<ul>
<li>-z gzip .tar.gz</li>
<li>-j bzip2 .tar.bz2</li>
<li>-J xz .tar.xz</li>
</ul>
<p>打包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar cvf dir.tar <span class="built_in">dir</span></span><br><span class="line">tar zcvf dir.tar.gz <span class="built_in">dir</span></span><br><span class="line">tar jcvf dir.tar.bz2 <span class="built_in">dir</span></span><br><span class="line">tar Jcvf dir.tar.xz <span class="built_in">dir</span></span><br></pre></td></tr></table></figure>

<p>解包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf dir.tar</span><br><span class="line">tar -zxvf dir.tar.gz</span><br><span class="line">tar -jxvf dir.tar.bz2</span><br><span class="line">tar -Jxvf dir.tar.xz</span><br></pre></td></tr></table></figure>

<h3 id="split"><a href="#split" class="headerlink" title="split"></a>split</h3><p>split 命令可以分割一个文件为多个文件</p>
<p>切割</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分割大的 tar 文件为多份小文件</span></span><br><span class="line"><span class="built_in">split</span> -b Size –d tar-file-name prefix-name</span><br><span class="line"></span><br><span class="line"><span class="built_in">split</span> -b 1M mybackup.tgz mybackup-parts</span><br><span class="line"><span class="comment">#切换成的多个小分文件使用数字后缀</span></span><br><span class="line"><span class="built_in">split</span> -b 1M –d mybackup.tgz mybackup-parts</span><br></pre></td></tr></table></figure>

<p>合并</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> mybackup-parts* &gt; mybackup.tar.gz</span><br></pre></td></tr></table></figure>

<h3 id="cpio"><a href="#cpio" class="headerlink" title="cpio"></a>cpio</h3><p>cpio 是历史悠久的打包和解包工具，不过目前很少使用了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/test/" class="post-title-link" itemprop="url">test</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:24:39" itemprop="dateCreated datePublished" datetime="2020-12-09T22:24:39+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>判断某需求是否满足，一般做条件判断，搭配 if 和三元表达式使用。<br>若真，则状态码$?返回0<br>若假，则状态码$?返回 1</p>
<p>test 命令也可以简写为[]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> expression</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">[ expression ]</span><br></pre></td></tr></table></figure>

<h2 id="在-test-中使用变量建议使用双引号包裹"><a href="#在-test-中使用变量建议使用双引号包裹" class="headerlink" title="在 test 中使用变量建议使用双引号包裹"></a>在 test 中使用变量建议使用双引号包裹</h2><p>test 和[]都是命令，一个命令本质上对应一个程序或者一个函数。即使是一个程序，它也有入口函数，所以也可以将一个程序等效为一个函数，这样我们就不用在区分函数和程序了，直接讲一个命令和一个函数对应起来。</p>
<p>所以，使用一个命令实际上就是调用一个函数，命令后面附带的选项和参数最终都会作为实参传递给函数。参数”“和不传参是不一样的，所以，变量应该用双引号包裹起来，这样能避免变量为空时导致的很多奇葩问题。</p>
<h2 id="与数值比较相关的-test-选项"><a href="#与数值比较相关的-test-选项" class="headerlink" title="与数值比较相关的 test 选项"></a>与数值比较相关的 test 选项</h2><ul>
<li>-eq 等于</li>
<li>&#x3D;和&#x3D;&#x3D; 两者是一样的</li>
<li>-ne 不等于</li>
<li>!&#x3D; 等同与-ne</li>
<li>-gt 大于</li>
<li>-\&gt; 判断 ascii</li>
<li>-lt 小于</li>
<li>-\&lt; 判断 ascii</li>
<li>-ge 大于等于</li>
<li>-le 小于等于</li>
</ul>
<h2 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h2><ul>
<li>-v FILE 小写 v，判断变量是否定义</li>
<li>-R FILE 判断变量是否定义并且是名称引用，bash4.4 新特性，这个说实话看不懂</li>
</ul>
<h2 id="文件测试"><a href="#文件测试" class="headerlink" title="文件测试"></a>文件测试</h2><h3 id="存在性测试"><a href="#存在性测试" class="headerlink" title="存在性测试"></a>存在性测试</h3><ul>
<li>-a FILE 同-e</li>
<li>-e FILE 文件是否存在，存在返回 0</li>
<li>-b FILE 文件是否存在且为块设备文件</li>
<li>-c FILE 文件是否存在且为字符设备文件</li>
<li>-d FILE 文件是否存在且为目录文件</li>
<li>-f FILE 文件是否存在且为普通文件</li>
<li>-h FILE 同-L</li>
<li>-L FILE 文件是否存在且为符号链接文件</li>
<li>-p FILE 文件是否存在且为命名管道文件</li>
<li>-S FILE 文件是否存在且为套接字文件</li>
</ul>
<h3 id="文件权限测试"><a href="#文件权限测试" class="headerlink" title="文件权限测试"></a>文件权限测试</h3><ul>
<li>-r FILE 文件是否存在且可读</li>
<li>-w FILE 文件是否存在且可写</li>
<li>-x FILE 文件是否存在且可执行</li>
<li>-u FILE 文件是否存在且拥有 suid 权限<br>如果 bin 文件设置了 SUID，那么当前用户执行这个 bin 文件的时候，会自动继承这个 bin 文件的属主的身份。</li>
<li>-g FILE 文件是否存在且拥有 guid 权限</li>
<li>-k FILE 是否存在且拥有 sticky 权限<br>当目录设置了 Sticky 权限，只有文件的所有者和 root 可以删除该文件。</li>
</ul>
<h3 id="文件属性测试"><a href="#文件属性测试" class="headerlink" title="文件属性测试"></a>文件属性测试</h3><ul>
<li>-s FILE 文件是否存在且非空</li>
<li>-t fd 文件描述符是否在某终端已经打开<br>fd 是文件描述符，或者说句柄，open 打开一个文件，就返回一个文件描述符 fd，fd 就指向这个打开的文件，使用 close(fd)关闭。linux 默认最多打开 1024 个文件，显然不够用，可以通过设置 ulimit 来调整。</li>
<li>-N FILE 文件自从上一次被读取后是否被修改</li>
<li>-O FILE 当前有效用户是否为文件属主</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:/home/ljk$ ll ./ljk.log</span><br><span class="line">-rw-rw-r-- 1 ljk ljk 8 Aug  9 17:57 ./ljk.log</span><br><span class="line">lujinkai@Z510:/home/ljk$ [ -O ljk.log ]</span><br><span class="line">lujinkai@Z510:/home/ljk$ <span class="built_in">echo</span> $?</span><br><span class="line">1</span><br><span class="line">lujinkai@Z510:/home/ljk$ <span class="built_in">cd</span> ~/data/test/</span><br><span class="line">lujinkai@Z510:~/data/test$ ll test.sh</span><br><span class="line">-rw-r--r-- 1 lujinkai lujinkai 36 Aug  8 22:38 test.sh</span><br><span class="line">lujinkai@Z510:~/data/test$ [ -O test.sh ]</span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<ul>
<li>-G FILE 当前有效用户是否为文件数组</li>
<li>FILE1 -ef FILE2 FILE1 是否是 FILE2 的硬链接</li>
<li>FILE1 -nt FILE2 FILE1 是否新于 FILE2(mtime)</li>
<li>FILE1 -ot FILE2 FILE1 是否旧于 FILE2</li>
</ul>
<h2 id="字符串测试"><a href="#字符串测试" class="headerlink" title="字符串测试"></a>字符串测试</h2><ul>
<li><p>-z 判断字符串是否为空，为空返回 0</p>
</li>
<li><p>-n 判断字符串是否为非空，非空返回 0，-n 可以省略，<code>test string</code>等同于<code>test -n string</code></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1596973702065.png"></p>
</li>
</ul>
<h2 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h2><ul>
<li>-a 逻辑与</li>
<li>-o 逻辑或</li>
</ul>
<hr>
<p>for i in 遍历后 $i 还存在，需要手动删除 unset i</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/pushd%E5%92%8Cpopd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/pushd%E5%92%8Cpopd/" class="post-title-link" itemprop="url">pushd和popd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:42" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:42+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 shell 脚本中，相比 <code>cd</code> 和 <code>cd -</code>，使用 <code>pushd</code> 和 <code>popd</code> 更高端大气上档次</p>
<ul>
<li>pushd : push (in) directory，将目录压栈,最后一个压入的目录位于栈顶</li>
<li>popd : pop (out) directory，将目录栈逐个弹出</li>
</ul>
<p>目录栈的栈顶永远存放的是当前目录。如果当前目录发生变化，那么目录栈的栈顶元素肯定也变了；反过来，如果栈顶元素发生变化，那么当前目录肯定也变了</p>
<p>pushd 不带参数，就会在栈顶的两个目录之间切换．如果需要调整到其他目录，可以使用+n 参数．具体每个栈内目录编号，通过 dirs -v 查看</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">shell脚本编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:41" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:41+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="脚本调试"><a href="#脚本调试" class="headerlink" title="脚本调试"></a>脚本调试</h3><p>脚本错误分为三种：</p>
<ul>
<li>语法错误，导致后续命令不继续执行，使用 <code>bash -n</code> 检查错误</li>
<li>命令错误，默认后续命令继续执行，使用 <code>bash -x</code> 检查错误</li>
<li>逻辑错误，只能使用 <code>bash -x</code> 检查</li>
</ul>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>shell 脚本中的所有变量值都是字符串，其中的数字也是字符串</p>
<h4 id="shell-中变量命名规则"><a href="#shell-中变量命名规则" class="headerlink" title="shell 中变量命名规则"></a>shell 中变量命名规则</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- 只能使用数字、字母及下划线，且不能以数字开头</span><br><span class="line">- 区分大小写</span><br><span class="line">- 变量、等号、值中间不能出现任何空格</span><br></pre></td></tr></table></figure>

<p>注意： 不支持短横线 “-”，这点和主机名相反</p>
<h4 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&#x27;value&#x27;</span></span><br><span class="line"></span><br><span class="line">name=<span class="string">&#x27;root&#x27;</span>		<span class="comment"># 直接字符串赋值</span></span><br><span class="line">name=<span class="string">&quot;<span class="variable">$user</span>&quot;</span>    <span class="comment"># 变量引用，注意一定要用双引号</span></span><br><span class="line">name=`COMMAND`  或者 name=$(COMMAND)		<span class="comment"># 命令引用</span></span><br></pre></td></tr></table></figure>

<h4 id="引用变量"><a href="#引用变量" class="headerlink" title="引用变量"></a>引用变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br><span class="line"><span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure>

<p>关于$：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- js中变量名前不加$，只有在上引号包裹的字符串中才使用$&#123;&#125;引用变量</span><br><span class="line">- php变量名前加$，无论什么情况，$和变量名不可分离</span><br><span class="line">- shell变量名前不加$，只有在引用的时候加$，在容易起因歧义的时候，使用$&#123;&#125;引用变量</span><br></pre></td></tr></table></figure>

<p>拼接字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- php使用点 .</span><br><span class="line">- js使用加号 +</span><br><span class="line">- shell中什么也不需要，直接写在一起就可以了，也可以用+=拼接自身</span><br></pre></td></tr></table></figure>

<h4 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> name</span><br></pre></td></tr></table></figure>

<h4 id="declare-★★★"><a href="#declare-★★★" class="headerlink" title="declare ★★★"></a>declare ★★★</h4><p>declare 是 bash 内置命令，用来声明变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> [-aAfFgilnrtux] [-p] [name[=value] ...]</span><br><span class="line"></span><br><span class="line">f    <span class="comment"># 显示已定义的函数</span></span><br><span class="line">F    <span class="comment"># 显示已定义的函数名</span></span><br><span class="line">g    <span class="comment"># 声明一个全局变量，name=&quot;value&quot; 这种方式就是省略参数g，完整的写法是declare -g name=&quot;value&quot;，所以在函数中请使用 declare name=&quot;value&quot;，不要使用 name=&quot;value&quot;，除非你想声明一个全局变量</span></span><br><span class="line">-p   <span class="comment"># 显示所有变量及其属性和值，不包括函数</span></span><br><span class="line"></span><br><span class="line">为变量设置属性，如果没有声明变量，则显示设置此属性的变量：</span><br><span class="line">a    <span class="comment"># 声明索引数组</span></span><br><span class="line">A    <span class="comment"># 声明关联数组</span></span><br><span class="line">i    <span class="comment"># 声明整数，可以进行算数运算</span></span><br><span class="line">l    <span class="comment"># 声明变量为小写字母</span></span><br><span class="line">n    <span class="comment"># 为value设置引用属性</span></span><br><span class="line">r    <span class="comment"># 声明只读变量，相当于 readonly，当前进程内，只能定义，不能修改，不能删除</span></span><br><span class="line">t    <span class="comment"># 为变量设置trace属性，跟踪函数从调用shell继承DEBUG和RETURN类型的。trace属性对变量没有特殊意义</span></span><br><span class="line">u    <span class="comment"># 声明变量为大写字母</span></span><br><span class="line">x    <span class="comment"># 声明环境变量，相当于 export</span></span><br></pre></td></tr></table></figure>

<p>Shell 内建命令之 trap：<a target="_blank" rel="noopener" href="https://blog.csdn.net/asty9000/article/details/88393166">https://blog.csdn.net/asty9000/article/details/88393166</a></p>
<ul>
<li><p>i 示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> var=算术表达式</span><br><span class="line">((var=算术表达式))</span><br><span class="line">var=$[算术表达式]</span><br><span class="line">var=$((算术表达式))</span><br><span class="line"><span class="built_in">declare</span> -i var=算术表达式</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;算术表达式&#x27;</span> | bc</span><br></pre></td></tr></table></figure>
</li>
<li><p>n 示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> a=123</span><br><span class="line"><span class="built_in">declare</span> -n b=a		<span class="comment"># b=123		等同于 declare b=$a</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="eval-★★★"><a href="#eval-★★★" class="headerlink" title="eval ★★★"></a>eval ★★★</h4><p>先扫描一遍，进行置换，再执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 范例一</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> &#123;a..z&#125;</span><br><span class="line">a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> &#123;a..z&#125; | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br><span class="line">lujinkai@Z510:~$ words=<span class="string">&quot;echo &#123;a..z&#125; | tr -d &#x27; &#x27;&quot;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$words</span></span><br><span class="line"><span class="built_in">echo</span> &#123;a..z&#125; | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> `<span class="built_in">echo</span> <span class="variable">$words</span>`</span><br><span class="line"><span class="built_in">echo</span> &#123;a..z&#125; | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">eval</span> <span class="variable">$words</span></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范例二</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># CMD=whoami</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo</span></span><br><span class="line"><span class="variable">$CMD</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># eval $CMD</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范例三</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># n=10</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo &#123;0..$n&#125;</span></span><br><span class="line">&#123;0..10&#125;</span><br><span class="line">[root@centos8 ~]<span class="comment"># eval echo &#123;0..$n&#125;</span></span><br><span class="line">0 1 2 3 4 5 6 7 8 9 10</span><br></pre></td></tr></table></figure>

<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p>1、编写脚本 systeminfo.sh,显示当前主机系统信息,包括:主机名,IPv4 地址,操作系统版本,内核版本,CPU 型号,内存大小,硬盘大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">主机名：hostname</span><br><span class="line">ipv4地址：hostname -I</span><br><span class="line">操作系统版本：os-release NAME VERSION</span><br><span class="line">内核版本：echo `uname -s;uname -r`</span><br><span class="line">内存大小：`free -m | awk &#x27;/Mem:/&#123;print $2&#125;&#x27;`</span><br><span class="line">硬盘大小：lsblk -m | awk &#x27;/sda/&#123;print $2&#125;&#x27;| head -n1</span><br></pre></td></tr></table></figure>

<p>2、编写脚本 backup.sh,可实现每日将 &#x2F;etc&#x2F; 目录备份到 &#x2F;backup&#x2F;etcYYYY-mm-dd 中</p>
<p>3、编写脚本 disk.sh,显示当前硬盘分区中空间利用率最大的值</p>
<p>4、编写脚本 links.sh,显示正连接本主机的每个远程主机的 IPv4 地址和连接数,并按连接数从大到小排序</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>对所有用户生效的环境变量：<code>/etc/profile</code><br>对特定用户生效的环境变量：<code>~/.bashrc</code> 或者 <code>~/.bash_profile</code><br>临时有效的环境变量：脚本或命令行使用 export 定义</p>
<p>常用环境变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH、HOME、LOGNAME、PWD、HISTFILE、HISTSIZE、HOSTNAME、SHELL、PS1、TMOUT、IFS、OFS</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明环境变量，除了使用 declare -x 还可以使用export</span></span><br><span class="line"><span class="built_in">export</span> name=VALUE</span><br></pre></td></tr></table></figure>

<p>显示所有环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span></span><br><span class="line"><span class="built_in">printenv</span></span><br><span class="line"><span class="built_in">export</span></span><br><span class="line"><span class="built_in">declare</span> -x</span><br></pre></td></tr></table></figure>

<h4 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h4><p>位置变量，在 bash shell 中内置的变量，在脚本代码中调用通过命令行传递给脚本的参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1,2...   对应第一个，第二个等参数，当参数小于10个的时候，<span class="variable">$n</span>可以表示，当参数大于10个的时候，使用<span class="variable">$&#123;n&#125;</span>表示</span><br><span class="line">0        命令本身，包括路径在内</span><br><span class="line">*        传递给脚本所有的参数，全部参数合为一个字符串，每个参数区别对待</span><br><span class="line">@        传递给脚本的所有参数，每个参数为独立字符串，所有参数视为一个整体</span><br><span class="line"><span class="comment">#        传递给脚本的参数个数</span></span><br></pre></td></tr></table></figure>

<p>注意：<code>$@</code> 和 <code>$*</code> 只有在被双引号包起来的时候才会有差异，在 <code>for in</code> 循环中，不加引号的时候，<code>$*</code> 和 <code>$@</code> 都可以正常遍历，加双引号的时候，<code>$*</code> 只有一个字符串变量</p>
<p>清空所有位置变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> --</span><br></pre></td></tr></table></figure>

<p>范例：利用软链接实现同一个脚本不同功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="退出状态码"><a href="#退出状态码" class="headerlink" title="退出状态码"></a>退出状态码</h4><p>用于无条件终止当前脚本的执行 <code>exit n</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n == 0         <span class="comment">#脚本执行成功</span></span><br><span class="line">n == 1-125     <span class="comment">#出错，这些对应的错误值由用户在脚本中定义</span></span><br><span class="line">  n == 1        <span class="comment">#一般未知错误</span></span><br><span class="line">  n == 2        <span class="comment">#不合适的shell命令</span></span><br><span class="line">n == 126       <span class="comment">#文件不可执行</span></span><br><span class="line">n == 127       <span class="comment">#不存在该命令</span></span><br><span class="line">n == 128       <span class="comment">#无效的退出参数</span></span><br><span class="line">n == 128+x     <span class="comment">#与linux信号x相关的严重错误</span></span><br><span class="line">n == 130       <span class="comment">#通过ctrl+c终止的命令</span></span><br><span class="line">n &gt;  255       <span class="comment">#正常范围之外的退出状态码</span></span><br></pre></td></tr></table></figure>

<p>1-125 这些错误值可以由用户自定义<br>如果不给定 n 的值，而直接使用 exit，那么返回 exit 之前最后一条语句的状态，等于 <code>exit $?</code></p>
<h4 id="‘’-“”"><a href="#‘’-“”" class="headerlink" title="‘’ “” `` $()"></a>‘’ “” `` $()</h4><p>单引号不解析变量，双引号解析变量，反引号中必须是有输出的命令，$() 和 ``是等价的, 但是 $() 可以嵌套</p>
<h4 id="脚本安全和-set"><a href="#脚本安全和-set" class="headerlink" title="脚本安全和 set"></a>脚本安全和 set</h4><p>set 命令：可以用来定制 shell 环境，set + 关闭设置，set - 打开设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> $-</span><br><span class="line">himBHs</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h <span class="comment">#hashall，外部命令使用过一次后就会被hash下来，后面再使用这个命令就优先从hash中获取，通过`set +h`将h选项关闭</span></span><br><span class="line">i <span class="comment">#interactive-comments，说明当前shell是交互式shell，在脚本中，i选项是被关闭的</span></span><br><span class="line">m <span class="comment">#monitor，打开监控</span></span><br><span class="line">B <span class="comment">#braceexpand，大括号扩展</span></span><br><span class="line">H <span class="comment">#history，H选项打开，可以展开历史列表中的命令，可以通过!来完成，例如!!返回上一个历史命令，!n返回第n个历史命令</span></span><br></pre></td></tr></table></figure>

<p><strong>set 命令实现脚本安全：</strong></p>
<p>参考：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2017/11/bash-set.html?utm_source=tool.lu">http://www.ruanyifeng.com/blog/2017/11/bash-set.html?utm_source=tool.lu</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-u 变量未定义就报错， 等同 `<span class="built_in">set</span> -o nounset`</span><br><span class="line">-e 遇到错误（<span class="built_in">exit</span>不等于0）就退出，等同 `<span class="built_in">set</span> -o errexit`</span><br><span class="line">-o option 显示，打开或关闭选项</span><br><span class="line">  显示选项 `<span class="built_in">set</span> -o`</span><br><span class="line">  打开选项 `<span class="built_in">set</span> -o 选项`</span><br><span class="line">  关闭选项 `<span class="built_in">set</span> -o 选项`</span><br><span class="line">-x 当执行命令的时候，打印命令及其参数，类似 `bash -x`</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">set</span> -o</span><br><span class="line">allexport      	off</span><br><span class="line">braceexpand    	on</span><br><span class="line">emacs          	on</span><br><span class="line">errexit        	off</span><br><span class="line">errtrace       	off</span><br><span class="line">functrace      	off</span><br><span class="line">hashall        	on</span><br><span class="line">histexpand     	on</span><br><span class="line"><span class="built_in">history</span>        	on</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="格式化输出-printf"><a href="#格式化输出-printf" class="headerlink" title="格式化输出 printf"></a>格式化输出 printf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">&quot;指定的格式&quot;</span> <span class="string">&quot;文本1&quot;</span> <span class="string">&quot;文本2&quot;</span>...</span><br></pre></td></tr></table></figure>

<p><img data-src="//img.to2b.cn/blog/ljk/1596809556035.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%s       <span class="comment">#字符串</span></span><br><span class="line">%f       <span class="comment">#浮点数</span></span><br><span class="line">%b       <span class="comment">#解析转义符</span></span><br><span class="line">%c       <span class="comment">#ASCI字符串，即显示对应参数的第一个字符</span></span><br><span class="line">%d,%i    <span class="comment">#十进制整数</span></span><br><span class="line">%o       <span class="comment">#八进制值</span></span><br><span class="line">%u       <span class="comment">#不带正负号的十进制值</span></span><br><span class="line">%x       <span class="comment">#十六进制值（a-f）</span></span><br><span class="line">%X       <span class="comment">#十六进制值（A-Z)</span></span><br><span class="line">%%       <span class="comment">#表示%本身</span></span><br><span class="line">%n       <span class="comment">#指定输出宽度为n，不足补空格，默认右对齐，例如：%-10s 表示10个字符宽，- 表示左对齐</span></span><br></pre></td></tr></table></figure>

<p>常用转义字符：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\a    <span class="comment">#警告字符</span></span><br><span class="line">\b    <span class="comment">#后退</span></span><br><span class="line">\f    <span class="comment">#换页</span></span><br><span class="line">\n    <span class="comment">#换行</span></span><br><span class="line">\r    <span class="comment">#回车</span></span><br><span class="line">\t    <span class="comment">#水平制表符，就是tab键</span></span><br><span class="line">\v    <span class="comment">#水平制表符</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">printf</span> <span class="string">&quot;%.2f\n&quot;</span> 1 2 3</span><br><span class="line">1.00</span><br><span class="line">2.00</span><br><span class="line">3.00</span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">printf</span> <span class="string">&quot;hello: %s\n&quot;</span> daming xiaohong tom</span><br><span class="line">hello: daming</span><br><span class="line">hello: xiaohong</span><br><span class="line">hello: tom</span><br></pre></td></tr></table></figure>

<h3 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h3><p>bash 只支持整数运算，不支持小数运算。复杂的运算请使用 bc</p>
<p>加减乘除、自加自减，取余，异或取反，三元运算等都和 php 一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> var=算术表达式</span><br><span class="line">((var=算术表达式))</span><br><span class="line">var=$[算术表达式]</span><br><span class="line">var=$((算术表达式))</span><br><span class="line"><span class="built_in">declare</span> -i var=算术表达式</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;算术表达式&#x27;</span> | bc</span><br></pre></td></tr></table></figure>

<p>$RANDOM：内建的随机数生成器变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$RANDOM</span> 取值范围: 0-32767 (2^15=32768)</span><br></pre></td></tr></table></figure>

<p>示例：生成 0-49 随机数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $[<span class="variable">$RANDOM</span>%50] <span class="comment"># 除以50取余</span></span><br></pre></td></tr></table></figure>

<p>示例：鸡兔同笼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">head</span>=<span class="variable">$1</span></span><br><span class="line">foot=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> tu=(<span class="variable">$foot</span>-2*<span class="variable">$head</span>)/2</span><br><span class="line"><span class="built_in">let</span> ji=<span class="variable">$head</span>-<span class="variable">$tu</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 兔子：<span class="variable">$tu</span></span><br><span class="line"><span class="built_in">echo</span> 鸡：<span class="variable">$ji</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算-amp-amp-、-、！"><a href="#逻辑运算-amp-amp-、-、！" class="headerlink" title="逻辑运算 &amp;&amp;、||、！"></a>逻辑运算 &amp;&amp;、||、！</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">与  &amp;&amp;</span><br><span class="line">或  ||</span><br><span class="line">非  !</span><br></pre></td></tr></table></figure>

<p>短路运算</p>
<h3 id="使用-read-命令来接受输入"><a href="#使用-read-命令来接受输入" class="headerlink" title="使用 read 命令来接受输入"></a>使用 read 命令来接受输入</h3><p>read 是 shell 内置命令，从标准输入中读取数据并赋值给变量。如果没有重定向，默认是从键盘读取用户输入的数据，如果进行了重定向，那么可以从文件中都去数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read [options] [name ...]</span></span><br><span class="line"><span class="built_in">read</span>: <span class="built_in">read</span> [-ers] [-a array] [-d delim] [-i text] [-n nchars] [-N nchars] [-p prompt] [-t <span class="built_in">timeout</span>] [-u fd] [name ...]</span><br></pre></td></tr></table></figure>

<p>如果没有提供变量名，那么读取的数据默认存放到环境变量 REPLY 中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-a array     <span class="comment">#读取的数据赋值给数组</span></span><br><span class="line">-d delimiter <span class="comment">#用字符串delimiter指定读取结束的位置，而不是一个换行符（读取到的数据不包括delimiter）</span></span><br><span class="line">-n num       <span class="comment">#指定输入字符串的长度，到达指定长度自动退出</span></span><br><span class="line">-t seconds   <span class="comment">#设置超时时间，用户超过时间没有输入，自动退出，exit非零</span></span><br><span class="line">-s           <span class="comment">#静默输入，一般用于密码</span></span><br><span class="line">-p prompt    <span class="comment">#显示提示内容，提示内容不能换行</span></span><br><span class="line">-e           <span class="comment">#在用户输入的时候，对功能键进行编码转换，更人性化</span></span><br><span class="line">-r           <span class="comment">#不允许反斜杠转义，选项一般都要加上，pycharm中如果不加会警告提示</span></span><br><span class="line">-u           <span class="comment">#从文件描述符fd中读取内容</span></span><br></pre></td></tr></table></figure>

<p>read 就像表单提交，所有用户提交的信息都是不可信的，一定要做好校验</p>
<h3 id="条件测试命令"><a href="#条件测试命令" class="headerlink" title="条件测试命令"></a><a href="./test/">条件测试命令</a></h3><h2 id="bash-shell-的配置文件"><a href="#bash-shell-的配置文件" class="headerlink" title="bash shell 的配置文件"></a>bash shell 的配置文件</h2><p>bash shell 配置文件有： <code>/etc/profile</code>、<code>~/.bash_profile</code>、<code>~/.bash_login</code>、<code>~/.profile</code>、<code>~/.bashrc</code>、<code>/etc/bashrc</code>、<code>/etc/profile.d/\*.sh</code>，不同的启动方式会加载不同的配置文件</p>
<h3 id="生效范围"><a href="#生效范围" class="headerlink" title="生效范围"></a>生效范围</h3><p>&#x2F;etc 目录下的配置文件是全局生效，家目录下的配置文件是对当前用户生效</p>
<p>配置文件太多，为了避免混乱，默认：对所有用户添加配置，添加到 &#x2F;etc&#x2F;profile.d&#x2F; 目录下，当前用户添加配置，添加到 ~&#x2F;.bashrc 中</p>
<h3 id="登录方式"><a href="#登录方式" class="headerlink" title="登录方式"></a>登录方式</h3><p>shell 登录有两种方式：交互式登录和非交互式登录</p>
<h4 id="交互式"><a href="#交互式" class="headerlink" title="交互式"></a>交互式</h4><ol>
<li>帐号密码登录；</li>
<li><ol start="2">
<li><code>su - userName</code></li>
</ol>
</li>
</ol>
<p>配置文件生效和执行顺序：</p>
<p>Ubuntu18.4</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. /etc/profile</span><br><span class="line">2. /etc/profile/*.sh</span><br><span class="line">3. /etc/bash.bashrc</span><br><span class="line">4. ~/.profile</span><br><span class="line">5. ~/.etc/bashrc</span><br></pre></td></tr></table></figure>

<p>CentOS7</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. /etc/profile</span><br><span class="line">2. /etc/profile.d/\*.sh</span><br><span class="line">3. ~/.bash_profile</span><br><span class="line">4. ~/.bashrc</span><br><span class="line">5. /etc/bashrc</span><br></pre></td></tr></table></figure>

<h4 id="非交互式"><a href="#非交互式" class="headerlink" title="非交互式"></a>非交互式</h4><ol>
<li><code>su userName</code>；</li>
<li>图形化界面下打开的终端；</li>
<li>执行脚本；</li>
<li>任何其他的 bash 实例</li>
</ol>
<p>非交互式登录，只加载 <code>~/.bashrc</code>（centos 的~&#x2F;.bashrc 中会加载&#x2F;etc&#x2F;bashrc 文件）</p>
<p>所以按照功能划分：profile 类只在交互式登录中加载，而 bashrc 类在交互式和非交互式登录中都有加载</p>
<h3 id="bash-退出任务"><a href="#bash-退出任务" class="headerlink" title="bash 退出任务"></a>bash 退出任务</h3><p>退出 shell 时自动运行 <code>~/.bash_logout</code> 文件，可以用来创建自动备份文件、清除临时文件</p>
<h2 id="流程控制-条件选择"><a href="#流程控制-条件选择" class="headerlink" title="流程控制 - 条件选择"></a>流程控制 - 条件选择</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>if&#x2F;then&#x2F;elif&#x2F;else&#x2F;fi</p>
<p>单分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f ~/.bashrc ]; <span class="keyword">then</span></span><br><span class="line">    . ~/.bashrc</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>双分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> []; <span class="keyword">then</span></span><br><span class="line">	code...</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	code...</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>多分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> []; <span class="keyword">then</span></span><br><span class="line">	code...</span><br><span class="line"><span class="keyword">elif</span> []; <span class="keyword">then</span></span><br><span class="line">	code...</span><br><span class="line"><span class="keyword">elif</span> []; <span class="keyword">then</span></span><br><span class="line">	code...</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	code...</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><p>类似 php 中的 switch</p>
<p>case&#x2F;esac</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Is it morning? Please answer yes or no.&quot;</span></span><br><span class="line"><span class="built_in">read</span> YES_OR_NO</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$YES_OR_NO</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line"><span class="built_in">yes</span>|y|Yes|YES)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Good Morning!&quot;</span>;;</span><br><span class="line">[nN]*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Good Afternoon!&quot;</span>;;</span><br><span class="line">*)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Sorry, <span class="variable">$YES_OR_NO</span> not recognized. Enter yes or no.&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<p>case 支持 glob 风格的通配符：*、?、[]、|</p>
<h2 id="流程控制-循环"><a href="#流程控制-循环" class="headerlink" title="流程控制 - 循环"></a>流程控制 - 循环</h2><h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h3><p>for in&#x2F;do&#x2F;done</p>
<p>递归遍历当前目录下的所有文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">dir</span>=$(<span class="built_in">dirname</span> <span class="string">&quot;`readlink -f <span class="variable">$0</span>`&quot;</span>)</span><br><span class="line"><span class="function"><span class="title">fn</span></span>() &#123;</span><br><span class="line">	<span class="keyword">for</span> filename <span class="keyword">in</span> `<span class="built_in">ls</span> <span class="variable">$1</span>`; <span class="keyword">do</span></span><br><span class="line">		file=<span class="variable">$&#123;1&#125;</span>/<span class="variable">$&#123;filename&#125;</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$file</span>\n&quot;</span></span><br><span class="line">		<span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$file</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">			fn <span class="variable">$file</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line">fn <span class="variable">$dir</span></span><br></pre></td></tr></table></figure>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p>while&#x2F;do&#x2F;done</p>
<p>无限循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>验证密码，限制尝试输入不超过 5 次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;enter password:&#x27;</span></span><br><span class="line"><span class="built_in">read</span> -s try</span><br><span class="line">num=1</span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$try</span> != <span class="string">&#x27;123456&#x27;</span> ]]; <span class="keyword">do</span></span><br><span class="line">	num=$((<span class="variable">$num</span>+<span class="number">1</span>))</span><br><span class="line">	<span class="keyword">if</span> [[ <span class="variable">$num</span> &gt; 5 ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&#x27;no change&#x27;</span></span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;try again&#x27;</span></span><br><span class="line">	<span class="built_in">read</span> -s try</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$try</span> == <span class="string">&#x27;123456&#x27;</span> ]]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;yes&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="while-read"><a href="#while-read" class="headerlink" title="while read"></a>while read</h4><p>while 循环的特殊用法,遍历文件或文本的每一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 依次读取file文件中的每一行,且将行赋值给变量X</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> X; <span class="keyword">do</span></span><br><span class="line">循环体</span><br><span class="line"><span class="keyword">done</span> &lt; file</span><br></pre></td></tr></table></figure>

<p>练习，使用 while 实现：</p>
<ol>
<li>编写脚本，求 100 以内所有正奇数之和</li>
<li>编写脚本，提示请输入网络地址，如 192.168.0.0，判断输入的网段中主机在线状态，并统计在线和离线主机各多少</li>
<li>编写脚本，打印九九乘法表</li>
<li>编写脚本，利用变量 RANDOM 生成 10 个随机数字，输出这个 10 数字，并显示其中的最大值和最小值</li>
<li>编写脚本，实现打印国际象棋棋盘</li>
<li>后续六个字符串: efbaf275cd、4be9c40b8b、44b2395c46、f8c8873ce0、b902c16c8b、ad865d2f63 是通过对随机数变量 RANDOM 随机执行命令: <code>echo $RANDOM | md5sum | cut -c1-10</code> 后的结果，请破解这些字符串对应的 RANDOM 值</li>
</ol>
<h3 id="until"><a href="#until" class="headerlink" title="until"></a>until</h3><p>while 判断条件为真则循环，until 判断条件为假则循环</p>
<p>无限循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> <span class="literal">false</span>; <span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<h3 id="循环控制-continue-和-break"><a href="#循环控制-continue-和-break" class="headerlink" title="循环控制 continue 和 break"></a>循环控制 continue 和 break</h3><p>continue 跳过本次循环，break 跳出所有循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -u</span><br><span class="line"></span><br><span class="line">i=10</span><br><span class="line"><span class="keyword">while</span> ((i--)); <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$i</span> == 5 ]; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&#x27;i is 5&#x27;</span></span><br><span class="line">	  <span class="comment"># continue</span></span><br><span class="line">      <span class="built_in">break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">unset</span> i</span><br></pre></td></tr></table></figure>

<h3 id="循环控制-shift"><a href="#循环控制-shift" class="headerlink" title="循环控制 shift"></a>循环控制 shift</h3><p>将参数列表最左边的参数删除，while 循环遍历位置参量列表时,常用到 shift</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$#</span> &gt; <span class="number">0</span>)); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">    <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>select 用于生成菜单，并显示 PS3 提示符，然后等待用户输入，无论输入什么都执行一遍循环，常搭配 case 来处理用户输入，select 通过 break 退出循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> variable <span class="keyword">in</span> list ;<span class="keyword">do</span></span><br><span class="line">	循环体命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line">PS3=<span class="string">&quot;请点菜(1-6): &quot;</span></span><br><span class="line"><span class="keyword">select</span> MENU <span class="keyword">in</span> 北京烤鸭 佛跳墙 小龙虾 羊蝎子 火锅 点菜结束; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">    1)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$MENU</span> 价格是 100</span><br><span class="line">        ((sum += <span class="number">100</span>))</span><br><span class="line">        ;;</span><br><span class="line">    2)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$MENU</span> 价格是 88</span><br><span class="line">        ((sum += <span class="number">88</span>))</span><br><span class="line">        ;;</span><br><span class="line">    3)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$MENU</span>价格是 66</span><br><span class="line">        ((sum += <span class="number">66</span>))</span><br><span class="line">        ;;</span><br><span class="line">    4)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$MENU</span> 价格是 166</span><br><span class="line">        ((sum += <span class="number">166</span>))</span><br><span class="line">        ;;</span><br><span class="line">    5)</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$MENU</span> 价格是 200</span><br><span class="line">        ((sum += <span class="number">200</span>))</span><br><span class="line">        ;;</span><br><span class="line">    6)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;点菜结束,退出&quot;</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;点菜错误,重新选择&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;总价格是: <span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数运行在当前 shell 进程</p>
<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法一:</span></span><br><span class="line"><span class="function"><span class="title">func_name</span></span> ()&#123;</span><br><span class="line">...函数体...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#语法二:</span></span><br><span class="line"><span class="keyword">function</span> func_name &#123;</span><br><span class="line">...函数体...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#语法三:</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func_name</span></span> () &#123;</span><br><span class="line">...函数体...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明环境函数</span></span><br><span class="line"><span class="built_in">declare</span> -xf function_name</span><br><span class="line"><span class="built_in">export</span> -f function_name</span><br></pre></td></tr></table></figure>

<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func_name		<span class="comment"># 注意不要加（）</span></span><br><span class="line"><span class="comment"># 参数用空格分割，在函数内部使用位置变量接收传入的参数</span></span><br><span class="line">func_name arg1 arg2 arg3 ...</span><br></pre></td></tr></table></figure>

<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> func_name</span><br></pre></td></tr></table></figure>

<h3 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h3><p>函数返回值：</p>
<ul>
<li>使用 echo 等命令进行输出</li>
<li>函数体中调用命令的输出结果</li>
</ul>
<p>函数的退出状态码：</p>
<ul>
<li>默认取决于函数中执行的最后一条命令的退出状态码</li>
<li>自定义退出状态码,其格式为:<br>return 从函数中返回,用最后状态命令决定返回值<br>return 0 无错误返回<br>return 1-255 有错误返回</li>
</ul>
<h3 id="函数变量"><a href="#函数变量" class="headerlink" title="函数变量"></a>函数变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> NAME=VALUE</span><br><span class="line"><span class="comment"># 等于</span></span><br><span class="line"><span class="built_in">declare</span> NAME=VALUE</span><br></pre></td></tr></table></figure>

<h2 id="脚本相关工具"><a href="#脚本相关工具" class="headerlink" title="脚本相关工具"></a>脚本相关工具</h2><h3 id="trap"><a href="#trap" class="headerlink" title="trap"></a>trap</h3><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/3482.html">信号</a>捕捉，捕捉一个或多个信号，替换为自定义操作</p>
<p>trap 捕捉的信号包括系统信号和 shell 信号，系统信号通过<code>trap -l</code>或<code>kill -l</code>查看，shell 信号有四个：EXIT(或信号代码 0)、ERR、DEBUG 和 RETURN。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">trap</span> <span class="built_in">command</span> signal_list <span class="comment"># 捕捉信号列表，替换为自定义command</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;&#x27;</span> signal_list      <span class="comment"># 捕捉信号列表，不做任何操作</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;-&#x27;</span> signal_list     <span class="comment"># 捕捉信号列表，恢复这些信号</span></span><br><span class="line"><span class="built_in">trap</span> -p                  <span class="comment"># 列出自定义捕捉信号操作</span></span><br><span class="line"><span class="built_in">trap</span> -l                  <span class="comment"># 列出所有系统信</span></span><br></pre></td></tr></table></figure>

<p>信号名是 SIG 后面的部分，捕捉的时候可以写信号的编号，也可以写信号名称，不区分大小写</p>
<p>由于不少信号在不同架构的计算机上数值不同，所以在不确定编号是否唯一的时候，最好写信号名称</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Press ctrl+c or ctrl+\ &#x27;&quot;</span> int quit</span><br></pre></td></tr></table></figure>

<p>DEBUG 和 RETURN 这两种信号陷阱无需关注，EXIT 是退出状态码为 0 时发出的信号，退出状态码非 0 时则发出 ERR 信号</p>
<p>系统信号的编号从 1 到 64，EXIT 的编号是 0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">finish</span></span>()&#123;</span><br><span class="line">	<span class="built_in">echo</span> finish| <span class="built_in">tee</span> -a /root/finish.log</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> finish <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="mktemp"><a href="#mktemp" class="headerlink" title="mktemp"></a>mktemp</h3><p>创建临时文件，可以避免文件名冲突</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># X至少3个，大写X</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">mktemp</span> fileXXXXX</span><br><span class="line">fileS9vLK</span><br><span class="line"><span class="comment"># -d 创建临时目录</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">mktemp</span> -d dirXXX</span><br><span class="line">diresA</span><br></pre></td></tr></table></figure>

<h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><p>expect 基于 Tcl( Tool Command Language )语言开发，主要应用于自动化交互式操作的场景,借助 expect 处理交互的命令,可以将交互过程如:ssh 登录,ftp 登录等写在一个脚本上,使之自动化完成。尤其适用于需要对多台服务器执行相同操作的环境中,可以大大提高系统管理人员的工作效率</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expect [ -dDinN ] [ -c cmds ] [ [ -[f|b] ] cmdfile ] [ args ]</span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>shell 和 php 一样，支持索引数组和关联数组。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 索引数组</span></span><br><span class="line">arr=(val1 val2 val3 val4 ...)</span><br><span class="line"><span class="comment"># 关联数组</span></span><br><span class="line"><span class="built_in">declare</span> -A brr=([name]=<span class="string">&#x27;lujinkai&#x27;</span> [age]=<span class="string">&#x27;18&#x27;</span> [gender]=<span class="string">&#x27;男&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>注意：声明索引数组可以省略 declare，声明关联数组不能省略 declare，如果省略不报错，但是数据会乱。</p>
<h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ array=(<span class="string">&quot;Allen&quot;</span> <span class="string">&quot;Mike&quot;</span> <span class="string">&quot;Messi&quot;</span> <span class="string">&quot;Jerry&quot;</span> <span class="string">&quot;Hanmeimei&quot;</span> <span class="string">&quot;Wang&quot;</span>)</span><br><span class="line"><span class="comment"># 打印数组长度</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="variable">$&#123;#array[@]&#125;</span></span><br><span class="line">6</span><br><span class="line"><span class="comment"># 打印元素长度</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="variable">$&#123;#array[1]&#125;</span>	<span class="comment"># 打印第1个元素 Mike的长度</span></span><br><span class="line">4</span><br><span class="line"><span class="comment"># 分片访问</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="variable">$&#123;array[@]:1:2&#125;</span></span><br><span class="line">Mike Messi</span><br><span class="line"><span class="comment"># 元素内容替换</span></span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="variable">$&#123;array[@]/e/E&#125;</span></span><br><span class="line">AllEn MikE MEssi JErry HanmEimei Wang</span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="variable">$&#123;array[@]//e/E&#125;</span></span><br><span class="line">AllEn MikE MEssi JErry HanmEimEi Wang</span><br><span class="line"><span class="comment"># 数组的遍历</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$val</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ str=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p>假设有一个指针 pointer，始终指向字符串的“间隙”，从前往后，“间隙”号依次为 0、1、2、3…，而且显然“间隙”数量比字符数量多 1 个，如果字符串有 2 个字符，那就有 3 个“间隙”。指针默认指向 0，指针的位置就是切片位置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字符串长度</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;#str&#125;</span></span><br><span class="line">26</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从切片位置往后截取length个字符：$&#123;str:offset:length&#125;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:0:6&#125;</span></span><br><span class="line">abcdef</span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:4:2&#125;</span></span><br><span class="line">ef</span><br><span class="line"></span><br><span class="line"><span class="comment"># 截取后length个字符：$&#123;str:0-length&#125; 0可以用空格代替</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str: -3&#125;</span></span><br><span class="line">xyz</span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:0-3&#125;</span></span><br><span class="line">xyz</span><br><span class="line"></span><br><span class="line"><span class="comment">#  截取后length个字符，然后再处理：$&#123;str:0-length:offset&#125;、$&#123;str:0-length:-offset&#125;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:0-3:1&#125;</span></span><br><span class="line">x</span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:0-3:-1&#125;</span></span><br><span class="line">xy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 掐头去尾：$&#123;str:offset:-length&#125;</span></span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str:1:-1&#125;</span></span><br><span class="line">bcdefghijklmnopqrstuvwxy</span><br></pre></td></tr></table></figure>

<h3 id="查找替换"><a href="#查找替换" class="headerlink" title="查找替换"></a>查找替换</h3><p><img data-src="//img.to2b.cn/blog/ljk/1599050885616.png"></p>
<p><code>$&#123;str#*word&#125;</code> 查找 word 第一次出现的位置，删除其以及之前的部分</p>
<p><code>$&#123;str##*word&#125;</code> 贪婪模式，查找 word 最后一次出现的位置，删除其及其之前的部分</p>
<p><code>$&#123;str%word*&#125;</code> 查找 word 最后出现的位置，删除其及其之后的部分</p>
<p><code>$&#123;str%%word*&#125;</code> 查找 word 第一次出现的位置，删除其及其之后的部分</p>
<p><code>$&#123;str/pattern&#125;</code> 删除第一个匹配</p>
<p><code>$&#123;str//pattern&#125;</code> 删除所有匹配</p>
<h3 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h3><p><code>$&#123;str^^&#125;</code> 转大写</p>
<p><code>$&#123;str,,&#125;</code> 转小写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str^^&#125;</span></span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line">lujinkai@Z510:~$ <span class="built_in">echo</span> <span class="variable">$&#123;str,,&#125;</span></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br></pre></td></tr></table></figure>

<h3 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h3><p><img data-src="//img.to2b.cn/blog/ljk/1599052693808.png"></p>
<p>变量测试点比较多，而且不怎么用，主要用 if 来判断测试，所以不用深究</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/expect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/expect/" class="post-title-link" itemprop="url">expect</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:22" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:22+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>expect 基于 Tcl( Tool Command Language )语言开发，主要应用于自动化交互式操作的场景,借助 expect 处理交互的命令,可以将交互过程如:ssh 登录,ftp 登录等写在一个脚本上,使之自动化完成。尤其适用于需要对多台服务器执行相同操作的环境中,可以大大提高系统管理人员的工作效率。</p>
<p>expect 可以认为是一种脚本语言，下面介绍的是 expect 环境下的变量和命令：</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h3><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> name value</span><br></pre></td></tr></table></figure>

<p>调用变量</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br></pre></td></tr></table></figure>

<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="close-slave-onexec-0-1-i-spawn-id"><a href="#close-slave-onexec-0-1-i-spawn-id" class="headerlink" title="close [-slave] [-onexec 0|1] [-i spawn_id]"></a>close [-slave] [-onexec 0|1] [-i spawn_id]</h3><h3 id="debug-now-0-1"><a href="#debug-now-0-1" class="headerlink" title="debug [[-now] 0|1]"></a>debug [[-now] 0|1]</h3><h3 id="disconnect"><a href="#disconnect" class="headerlink" title="disconnect"></a>disconnect</h3><h3 id="exit-opts-status"><a href="#exit-opts-status" class="headerlink" title="exit [-opts] [status]"></a>exit [-opts] [status]</h3><h3 id="exp-continue-continue-timer-★"><a href="#exp-continue-continue-timer-★" class="headerlink" title="exp_continue [-continue_timer] ★"></a>exp_continue [-continue_timer] ★</h3><p>不返回结果，继续执行。</p>
<h3 id="exp-internal-f-file-value"><a href="#exp-internal-f-file-value" class="headerlink" title="exp_internal [-f file] value"></a>exp_internal [-f file] value</h3><h3 id="exp-open-args-i-spawn-id"><a href="#exp-open-args-i-spawn-id" class="headerlink" title="exp_open [args] [-i spawn_id]"></a>exp_open [args] [-i spawn_id]</h3><h3 id="exp-pid-i-spawn-id"><a href="#exp-pid-i-spawn-id" class="headerlink" title="exp_pid [-i spawn_id]"></a>exp_pid [-i spawn_id]</h3><h3 id="exp-send"><a href="#exp-send" class="headerlink" title="exp_send"></a>exp_send</h3><h3 id="exp-send-error"><a href="#exp-send-error" class="headerlink" title="exp_send_error"></a>exp_send_error</h3><h3 id="exp-send-log"><a href="#exp-send-log" class="headerlink" title="exp_send_log"></a>exp_send_log</h3><h3 id="exp-send-tty"><a href="#exp-send-tty" class="headerlink" title="exp_send_tty"></a>exp_send_tty</h3><h3 id="exp-send-user"><a href="#exp-send-user" class="headerlink" title="exp_send_user"></a>exp_send_user</h3><h3 id="exp-version-exit-version"><a href="#exp-version-exit-version" class="headerlink" title="exp_version [[-exit] version]"></a>exp_version [[-exit] version]</h3><h3 id="expect-opts-pat1-body1-…-opts-patn-bodyn-★"><a href="#expect-opts-pat1-body1-…-opts-patn-bodyn-★" class="headerlink" title="expect [[-opts] pat1 body1] … [-opts] patn [bodyn] ★"></a>expect [[-opts] pat1 body1] … [-opts] patn [bodyn] ★</h3><p>模式匹配，匹配成功后执行指定操作，如果没有指定操作，则忽略。<br>eof 和 timeout 是关键字<br>如果匹配的是关键字”eof”，则在文件结束时候执行指定操作，如果匹配的是关键字”timeout”,则在超时时执行指定的操作，默认的超时时间是 10 秒，可以设置为 30 秒<code>set timeout 30</code>，或者设置不超时<code>set timeout -</code></p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> timeout <span class="number">30</span></span><br><span class="line"><span class="comment"># 匹配一次</span></span><br><span class="line">expect &#x27;hi&#x27; &#123;send <span class="string">&quot;You said hi\n&quot;</span>&#125;</span><br><span class="line"><span class="comment"># 匹配多次：每次匹配成功后执行指定操作，返回的结果用来进行下一次模式匹配。</span></span><br><span class="line">expect &#123;</span><br><span class="line">    busy               &#123;<span class="keyword">puts</span> busy\n ; exp_continue&#125;</span><br><span class="line">    failed             abort</span><br><span class="line">    <span class="string">&quot;invalid password&quot;</span> abort</span><br><span class="line">    timeout            abort</span><br><span class="line">    connected</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="expect-after-expect-args"><a href="#expect-after-expect-args" class="headerlink" title="expect_after [expect_args]"></a>expect_after [expect_args]</h3><h3 id="expect-background-expect-args"><a href="#expect-background-expect-args" class="headerlink" title="expect_background [expect_args]"></a>expect_background [expect_args]</h3><h3 id="expect-before-expect-args"><a href="#expect-before-expect-args" class="headerlink" title="expect_before [expect_args]"></a>expect_before [expect_args]</h3><h3 id="expect-tty-expect-args"><a href="#expect-tty-expect-args" class="headerlink" title="expect_tty [expect_args]"></a>expect_tty [expect_args]</h3><h3 id="expect-user-expect-args"><a href="#expect-user-expect-args" class="headerlink" title="expect_user [expect_args]"></a>expect_user [expect_args]</h3><h3 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h3><h3 id="interact-string1-body1-…-stringn-bodyn-★"><a href="#interact-string1-body1-…-stringn-bodyn-★" class="headerlink" title="interact [string1 body1] … [stringn [bodyn]] ★"></a>interact [string1 body1] … [stringn [bodyn]] ★</h3><p>interact 是交互的意思。将当前进程的控制权交给用户，就是让用户手动处理的意思。</p>
<h3 id="interpreter-args"><a href="#interpreter-args" class="headerlink" title="interpreter [args]"></a>interpreter [args]</h3><h3 id="log-file-args-a-file"><a href="#log-file-args-a-file" class="headerlink" title="log_file [args] [[-a] file]"></a>log_file [args] [[-a] file]</h3><h3 id="log-user-info-0-1"><a href="#log-user-info-0-1" class="headerlink" title="log_user -info|0|1"></a>log_user -info|0|1</h3><h3 id="match-max-d-i-spawn-id-size"><a href="#match-max-d-i-spawn-id-size" class="headerlink" title="match_max [-d] [-i spawn_id] [size]"></a>match_max [-d] [-i spawn_id] [size]</h3><h3 id="overlay-spawn-id-spawn-id-…-program-args"><a href="#overlay-spawn-id-spawn-id-…-program-args" class="headerlink" title="overlay [-# spawn_id] [-# spawn_id] […] program [args]"></a>overlay [-# spawn_id] [-# spawn_id] […] program [args]</h3><h3 id="parity-d-i-spawn-id-value"><a href="#parity-d-i-spawn-id-value" class="headerlink" title="parity [-d] [-i spawn_id] [value]"></a>parity [-d] [-i spawn_id] [value]</h3><h3 id="remove-nulls-d-i-spawn-id-value"><a href="#remove-nulls-d-i-spawn-id-value" class="headerlink" title="remove_nulls [-d] [-i spawn_id] [value]"></a>remove_nulls [-d] [-i spawn_id] [value]</h3><h3 id="send-flags-string-★"><a href="#send-flags-string-★" class="headerlink" title="send [-flags] string ★"></a>send [-flags] string ★</h3><p>将字符串发送给当前进程。</p>
<ul>
<li>-i</li>
<li>-null</li>
<li>-break</li>
<li>-s</li>
<li>-h</li>
</ul>
<h3 id="send-error-flags-string"><a href="#send-error-flags-string" class="headerlink" title="send_error [-flags] string"></a>send_error [-flags] string</h3><h3 id="send-log-–-string"><a href="#send-log-–-string" class="headerlink" title="send_log [–] string"></a>send_log [–] string</h3><h3 id="send-tty-flags-string"><a href="#send-tty-flags-string" class="headerlink" title="send_tty [-flags] string"></a>send_tty [-flags] string</h3><h3 id="send-user-flags-string"><a href="#send-user-flags-string" class="headerlink" title="send_user [-flags] string"></a>send_user [-flags] string</h3><h3 id="sleep-seconds"><a href="#sleep-seconds" class="headerlink" title="sleep seconds"></a>sleep seconds</h3><h3 id="spawn-args-program-args-★"><a href="#spawn-args-program-args-★" class="headerlink" title="spawn [args] program [args] ★"></a>spawn [args] program [args] ★</h3><p>spawn 是繁衍的意思。新建一个进程，运行指定命令，标准输入，标准输出、标准错误都在 expect 环境内，方便其他 expect 命令进行后续处理。<br>spawn 启动进程时，会产生一个变量 spawn_id, 存储了进程的描述符。用 close 关闭当前进程及其相关文件。</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line">spawn ssh <span class="number">10.0</span><span class="number">.0</span><span class="number">.7</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>;exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;123456&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<h3 id="strace-level"><a href="#strace-level" class="headerlink" title="strace level"></a>strace level</h3><h3 id="stty-args"><a href="#stty-args" class="headerlink" title="stty args"></a>stty args</h3><h3 id="system-args"><a href="#system-args" class="headerlink" title="system args"></a>system args</h3><h3 id="timestamp-args"><a href="#timestamp-args" class="headerlink" title="timestamp [args]"></a>timestamp [args]</h3><h3 id="trap-command-signals"><a href="#trap-command-signals" class="headerlink" title="trap [[command] signals]"></a>trap [[command] signals]</h3><h3 id="wait-args"><a href="#wait-args" class="headerlink" title="wait [args]"></a>wait [args]</h3><h2 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h2><p>写成 expect 脚本，可以接收参数，[lindex $argv 0]表示调用第一个参数。</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="keyword">set</span> ip [<span class="keyword">lindex</span> <span class="variable">$argv</span> <span class="number">0</span>]</span><br><span class="line"><span class="keyword">set</span> user [<span class="keyword">lindex</span> <span class="variable">$argv</span> <span class="number">1</span>]</span><br><span class="line"><span class="keyword">set</span> password [<span class="keyword">lindex</span> <span class="variable">$argv</span> <span class="number">2</span>]</span><br><span class="line"><span class="keyword">set</span> timeout <span class="number">10</span></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>;exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;$password\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect <span class="string">&quot;]#&quot;</span> &#123; send <span class="string">&quot;useradd haha\n&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;]#&quot;</span> &#123; send <span class="string">&quot;echo 123456 |passwd --stdin haha\n&quot;</span> &#125;</span><br><span class="line">send <span class="string">&quot;exit\n&quot;</span></span><br><span class="line">expect <span class="keyword">eof</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#./ssh4.exp 10.0.0.7 root 123456</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip=<span class="variable">$1</span></span><br><span class="line">user=<span class="variable">$2</span></span><br><span class="line">password=<span class="variable">$3</span></span><br><span class="line">expect &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">set timeout 20</span></span><br><span class="line"><span class="string">spawn ssh $user@$ip</span></span><br><span class="line"><span class="string">expect &#123;</span></span><br><span class="line"><span class="string">	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;;exp_continue &#125;</span></span><br><span class="line"><span class="string">	&quot;password&quot; &#123; send &quot;$password\n&quot; &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;useradd hehe\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;echo 123456 |passwd --stdin hehe\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;exit\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect eof</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#./ssh5.sh 192.168.8.10 root 123456</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/mail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/mail/" class="post-title-link" itemprop="url">mail</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:22" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:22+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装邮件服务</span></span><br><span class="line">yum -y install mailx</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置/etc/mail.rc</span></span><br><span class="line"><span class="built_in">set</span> from=ljkk3014@foxmail.com</span><br><span class="line"><span class="built_in">set</span> smtp=smtp.qq.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-user=ljkk3014@foxmail.com</span><br><span class="line"><span class="built_in">set</span> smtp-auth-password=jwopcmnpmawddbbg		<span class="comment"># 随便写的</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送邮件</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># echo -e &quot;Hello, I am `whoami`,The system version is here,please help me to check it ,thanks! \n`cat /etc/os-release`&quot; | mail -s hello 441757636@qq.com</span></span><br></pre></td></tr></table></figure>

<p>效果:</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1596250258504.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/%E4%BF%A1%E5%8F%B7%20signal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/%E4%BF%A1%E5%8F%B7%20signal/" class="post-title-link" itemprop="url">信号 signal</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:02" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:02+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/maxgongzuo/p/6372898.html">https://www.cnblogs.com/maxgongzuo/p/6372898.html</a></p>
<h2 id="信号配置-Signal-dispositions"><a href="#信号配置-Signal-dispositions" class="headerlink" title="信号配置 Signal dispositions"></a>信号配置 Signal dispositions</h2><p>每个信号都有一个配置，决定信号传递到进程时的行为。每个信号都有一个默认的配置，指定信号的默认操作，至于最终具体的操作，肯定是基于它的默认操作的。</p>
<h3 id="Term"><a href="#Term" class="headerlink" title="Term"></a>Term</h3><p>默认操作是终止进程</p>
<h3 id="Ign"><a href="#Ign" class="headerlink" title="Ign"></a>Ign</h3><p>默认操作是忽略进程</p>
<h3 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h3><p>默认操作是终止进程，并 core dump</p>
<h4 id="core-dump"><a href="#core-dump" class="headerlink" title="core dump"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/s-lisheng/p/11278193.html">core dump</a></h4><p>当程序运行的过程中异常终止或崩溃，操作系统会将程序当时的内存状态记录下来，保存在一个文件中，这种行为就叫做 Core Dump（中文有的翻译成“核心转储”)。除了内存信息之外，还有些关键的程序运行状态也会同时 dump 下来，例如寄存器信息（包括程序指针、栈指针等）、内存管理信息、其他处理器和操作系统状态和信息。core dump 对于编程人员诊断和调试程序是非常有帮助的，因为对于有些程序错误是很难重现的，例如指针异常，而 core dump 文件可以再现程序出错时的情景。</p>
<p>如果没有进行 core dump 的相关设置，默认是不开启的。可以通过<code>ulimit -c</code>查看是否开启。如果输出为<code>0</code>，则没有开启，需要执行<code>ulimit -c unlimited</code>开启 core dump 功能。</p>
<h3 id="Stop"><a href="#Stop" class="headerlink" title="Stop"></a>Stop</h3><p>默认操作是停止进程，后台休眠</p>
<p>Term 和 Stop 的区别：Term 终止进程，进程不存在；Stop 停止进程，进程还存在，可以通过 Cont 唤醒</p>
<h3 id="Cont"><a href="#Cont" class="headerlink" title="Cont"></a>Cont</h3><p>默认操作是继续被停止的进程</p>
<h2 id="标准信号-Standard-signals"><a href="#标准信号-Standard-signals" class="headerlink" title="标准信号 Standard signals"></a>标准信号 Standard signals</h2><p><code>kill -l</code> 或 <code>trap -l</code>可以查看所有的系统信号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ <span class="built_in">kill</span> -l</span><br><span class="line"> 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP</span><br><span class="line"> 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1</span><br><span class="line">11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM</span><br><span class="line">16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP</span><br><span class="line">21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR</span><br><span class="line">31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1	64) SIGRTMAX</span><br></pre></td></tr></table></figure>

<p>编号 1-31 是标准信号，我们只研究这些，后面的不研究，常用信号说明：</p>
<p>信号名是 SIG 后面的部分，大部分信号都能被捕获，SIGKILL 和 SIGSTOP 不能被捕获。</p>
<h3 id="1-HUP"><a href="#1-HUP" class="headerlink" title="1) HUP"></a>1) HUP</h3><p>默认操作 Term，可捕获</p>
<p>本信号在用户终端连接(正常或非正常)结束时发出, 通常是在终端的控制进程结束时, 通知同一 session 内的各个作业, 这时它们与控制终端不再关联。</p>
<p>登录 Linux 时，系统会分配给登录用户一个终端(Session)。在这个终端运行的所有程序，包括前台进程组和后台进程组，一般都属于这个 Session。当用户退出 Linux 登录时，前台进程组和后台有对终端输出的进程将会收到 SIGHUP 信号。这个信号的默认操作为终止进程，因此前台进 程组和后台有终端输出的进程就会中止。不过可以捕获这个信号，比如 wget 能捕获 SIGHUP 信号，并忽略它，这样就算退出了 Linux 登录，wget 也 能继续下载。</p>
<p>此外，对于与终端脱离关系的守护进程，这个信号用于通知它重新读取配置文件。</p>
<h3 id="2-INT"><a href="#2-INT" class="headerlink" title="2) INT"></a>2) INT</h3><p>默认操作 Term，可捕获</p>
<p>程序终止(interrupt)信号, 在用户键入 INTR 字符(通常是 Ctrl-C)时发出，用于通知前台<strong>进程组终止进程</strong>。</p>
<h3 id="3-QUIT"><a href="#3-QUIT" class="headerlink" title="3) QUIT"></a>3) QUIT</h3><p>默认操作 Core，可捕获</p>
<p>和 SIGINT 类似, 但由 QUIT 字符(通常是 Ctrl-)来控制. 进程在因收到 SIGQUIT 退出时会 core dump, 在这个意义上类似于一个程序错误信号。</p>
<h3 id="9-KILL"><a href="#9-KILL" class="headerlink" title="9) KILL"></a>9) KILL</h3><p>默认操作 Term，不可捕获</p>
<p>杀掉进程，KILL 和 TERM 的区别在于此信号不能被捕获、阻塞或忽略，所以一旦接收到此信号的进程只能终止，而 TERM 可以被捕获，进程在捕获到 TERM 信号后，可以执行自定义操作，例如通知子进程关闭，清理资源等操作。</p>
<h3 id="15-TERM"><a href="#15-TERM" class="headerlink" title="15) TERM"></a>15) TERM</h3><p>默认操作 Term，可捕获</p>
<p>终止进程，是 kill 默认传递的信号。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/()%7B%7D(())[][[]]/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/()%7B%7D(())%5B%5D%5B%5B%5D%5D/" class="post-title-link" itemprop="url">(){}(())[][[]]</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:22:09" itemprop="dateCreated datePublished" datetime="2020-12-09T22:22:09+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="单小括号"><a href="#单小括号" class="headerlink" title="单小括号 ()"></a>单小括号 ()</h2><p>()：等同`` ，命令组。括号中的命令将会新开一个子 shell 顺序执行，所以括号中的变量不能够被脚本余下的部分使用。括号中多个命令之间用分号隔开，最后一个命令可以没有分号，各命令和括号之间不必有空格。</p>
<p>可以使用$获取()中的标准输出，$()</p>
<p>array&#x3D;(a b c d) 用于初始化数组</p>
<h2 id=""><a href="#" class="headerlink" title="{}"></a>{}</h2><p>{}和()一样可以将多个命令组合在一起，使用分号隔开，批量执行，区别在于：<br>1.()是新开进程，{}在当前进程<br>2.()和命令之间不需要空格，{}左边和命令之间必须要有空格<br>3.()中最后一个命令可以不加分号，{}中所有命令都要加分号 4.$搭配()可以获取()的返回值；$搭配{}是用来解析变量，这点和 php 一样</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>bash 支持{a,b,c}这样的扩展，比如 a{d,c,b}e 会被扩展成 ade ace abe</p>
<p>类似还有：<code>cp filename&#123;,bak&#125;</code></p>
<p>等同于 ：<code>cp filename filename.bak</code></p>
<h3 id="简化重复字符串"><a href="#简化重复字符串" class="headerlink" title="简化重复字符串"></a>简化重复字符串</h3><p>{} 可以实现打印重复字符串的简化形式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># touch &#123;0..9&#125;.log</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">0.<span class="built_in">log</span>  1.<span class="built_in">log</span>  2.<span class="built_in">log</span>  3.<span class="built_in">log</span>  4.<span class="built_in">log</span>  5.<span class="built_in">log</span>  6.<span class="built_in">log</span>  7.<span class="built_in">log</span>  8.<span class="built_in">log</span>  9.<span class="built_in">log</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls &#123;4..7&#125;.log</span></span><br><span class="line">4.<span class="built_in">log</span>  5.<span class="built_in">log</span>  6.<span class="built_in">log</span>  7.<span class="built_in">log</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls &#123;0..9..2&#125;*</span></span><br><span class="line">0.<span class="built_in">log</span>  2.<span class="built_in">log</span>  4.<span class="built_in">log</span>  6.<span class="built_in">log</span>  8.<span class="built_in">log</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls &#123;1,4,6&#125;.log</span></span><br><span class="line">1.<span class="built_in">log</span>  4.<span class="built_in">log</span>  6.<span class="built_in">log</span></span><br><span class="line"><span class="comment"># 关闭和开启&#123;&#125;的扩展功能</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># echo $-</span></span><br><span class="line">himBH</span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># set +B</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># echo $-</span></span><br><span class="line">himH</span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls &#123;1,4,6&#125;.log</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access &#123;1,4,6&#125;.<span class="built_in">log</span>: No such file or directory</span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># set -B</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># ls &#123;1,4,6&#125;.log</span></span><br><span class="line">1.<span class="built_in">log</span>  4.<span class="built_in">log</span>  6.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>补充：批量创建文件是用{}，批量显示文件使用[]</p>
<h3 id="变量替换"><a href="#变量替换" class="headerlink" title="变量替换"></a>变量替换</h3><h3 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h3><h2 id="双小括号"><a href="#双小括号" class="headerlink" title="双小括号 (())"></a>双小括号 (())</h2><p>将数学运算表达式放在(())中，表达式可以有一个，也可以由多个，多个表达式用逗号分割，(())的执行结果取决于最后一个表达式的值</p>
<p>可以使用$获取(())命令的执行结果</p>
<h2 id="单中括号"><a href="#单中括号" class="headerlink" title="单中括号 []"></a>单中括号 []</h2><p>[]有两种用法：一是等同 test； 二是算数运算$[],等同于$(())<br>关于 test 和[]，推荐使用[]； 关于$[]和$(())，推荐使用$(())</p>
<h3 id="1-等同-test"><a href="#1-等同-test" class="headerlink" title="1. 等同 test"></a>1. 等同 test</h3><p>等同于 test 命令，通常和 if 语句一起使用，在”[]”的内部和数据之间必须使用空格；否则判断式会报错。</p>
<p>test 和[]中可用的比较运算符只有&#x3D;&#x3D;和!&#x3D;，两者都是用来比较字符串的，不可用于整数比较，整数比较只能使用-eq、-gt 这种形式。</p>
<p>具体参数参考<a href="./test.md">test.md</a></p>
<h2 id="双中括号"><a href="#双中括号" class="headerlink" title="双中括号 [[]]"></a>双中括号 [[]]</h2><p>[[]]是shell内置关键字，它和test类似，也用来检测某个条件是否成立。<br>test能做到的，[[]]也能做到，而且做的更好，test 做不到的，[[]]还能做到。可以认为[[]]是 test 的升级版，对细节进行了优化，并扩展了一些功能。</p>
<p>[[]]的用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ expression ]]</span><br></pre></td></tr></table></figure>

<p>当[[]]判断expression成立时，退出状态0，否则为非0值，注意[[]]和 expression 之间的空格，这两个空格是必须的，否则会导致语法错误。</p>
<h3 id="不需要注意某些细枝末节"><a href="#不需要注意某些细枝末节" class="headerlink" title="[[]]不需要注意某些细枝末节"></a>[[]]不需要注意某些细枝末节</h3><p>[[]]是shell内置关键字，不是命令，在使用时没有给函数传递参数的过程，所以test命令的某些注意事项在[[]]中不存在了，具体包括：</p>
<ul>
<li>不需要把变量名用””包裹起来，即使变量是空值，也不会出错</li>
<li>不需要、也不能对&gt;、&lt;进行转义，转义后会出错</li>
</ul>
<h3 id="支持逻辑运算符"><a href="#支持逻辑运算符" class="headerlink" title="[[]]支持逻辑运算符"></a>[[]]支持逻辑运算符</h3><p>[[]]剔除了 test 命令的-o 和-a 选项，只能使用||和&amp;&amp;</p>
<h3 id="支持正则表达式"><a href="#支持正则表达式" class="headerlink" title="[[]]支持正则表达式"></a>[[]]支持正则表达式</h3><p>在[[]]中，可以使用&#x3D;~来检测字符串是否符合某个正则表达式，他的用法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ str =~ regex ]]</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>[[]]完全可以替换[]，但是[[]]对数字的比较仍然不友好，所有，当 if 判断条件时，用(())来处理整型数字，当使用正则表达式或通配符使用[[]]，其它情况一般使用 [ ]</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97/" class="post-title-link" itemprop="url">ANSI转义序列</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:17:59" itemprop="dateCreated datePublished" datetime="2020-12-09T22:17:59+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">文本处理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考：<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/zh-hans/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97">https://zh.m.wikipedia.org/zh-hans/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97</a></p>
<p><strong>ANSI 转义序列（ANSI escape sequences）</strong>是一种<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/w/index.php?title=%E5%B8%A6%E5%86%85%E4%BF%A1%E5%8F%B7&action=edit&redlink=1">带内信号</a>（英语：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/In-band_signaling">In-band signaling</a>）的<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97">转义序列</a>标准，用于控制视频文本<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E7%B5%82%E7%AB%AF">终端</a>上的光标位置、颜色和其他选项。在文本中嵌入确定的字节序列，大部分以<code>ESC</code><a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6">转义字符</a>和”[“字符开始，终端会把这些字节序列解释为相应的指令，而不是普通的<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81">字符编码</a>。</p>
<p>ANSI 序列是在二十世纪七十年代引入的标准，用以取代特定于终端供应商的序列，并在二十世纪八十年代早期开始在计算机设备市场上广泛使用。与早期缺少光标移动功能的系统相比，新生的<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E5%85%AC%E5%91%8A%E6%9D%BF%E7%B3%BB%E7%BB%9F">电子公告板系统</a>使用 ANSI 序列改进其显示。正是因为这个原因，ANSI 序列变成了所有制造商共同采用的标准。</p>
<p>在 21 世纪，尽管硬件文本终端已经越来越少了，但 ANSI 标准依然存在，因为大多数终端模拟器会对部分 ANSI 转义序列进行解释。一个值得注意的例外是，在微软<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/Windows_10">Windows 10</a>更新 TH2 之前，<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/Windows%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">Windows 操作系统</a>的<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/Win32%E6%8E%A7%E5%88%B6%E5%8F%B0">Win32 控制台</a>是不支持 ANSI 转义序列的。</p>
<h2 id="转义序列"><a href="#转义序列" class="headerlink" title="转义序列"></a>转义序列</h2><p>序列具有不同的长度。所有序列都以 ASCII 字符<code>**[ESC](https://zh.m.wikipedia.org/wiki/退出键)**</code>（27 &#x2F; <a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/wiki/%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">十六进制</a> 0x1B）开头，第二个字节则是 0x40–0x5F（ASCII <code>@A–Z[\]^_</code>）范围内的字符。[<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/zh-hans/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97#cite_note-ecma48-13">12]</a>:5.3.a</p>
<p><strong>一些 ANSI 转义序列（不完整列表）</strong></p>
<table>
<thead>
<tr>
<th align="left">序列</th>
<th>**C1</th>
<th><strong>名称</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">ESC [</td>
<td>0x9b</td>
<td>CSI - 控制序列导入器（Control Sequence Introducer）</td>
<td>大部分有用的序列，请参阅下一节。结束于 ASCII 64 到 126 (<code>@</code>到<code>~</code>&#x2F;十六进制 0x40 到 0x7E).[<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/zh-hans/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97#cite_note-ecma48-13">12]</a></td>
</tr>
<tr>
<td align="left">…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td align="left"></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="CSI"><a href="#CSI" class="headerlink" title="CSI"></a>CSI</h2><p>CSI 序列由<code>ESC [</code>、若干个（包括 0 个）“参数字节”、若干个“中间字节”，以及一个“最终字节”组成。</p>
<p>所有常见的序列都只是把参数用作一系列分号分隔的数字，如<code>1;2;3</code>。缺少的数字视为 0（如<code>1;;3</code>相当于中间的数字是 0，<code>ESC[m</code>这样没有参数的情况相当于参数为 0）。某些序列（如 CUU）把 0 视为 1，以使缺少参数的情况下有意义。</p>
<p><strong>一些 ANSI 控制序列（不完整列表）</strong></p>
<table>
<thead>
<tr>
<th><strong>代码</strong></th>
<th><strong>名称</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>CSI <code>n</code> m</td>
<td>SGR – 选择图形再现（Select Graphic Rendition）</td>
<td>设置<a target="_blank" rel="noopener" href="https://zh.m.wikipedia.org/zh-hans/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97#%E9%80%89%E6%8B%A9%E5%9B%BE%E5%BD%A2%E5%86%8D%E7%8E%B0%EF%BC%88SGR%EF%BC%89%E5%8F%82%E6%95%B0">SGR 参数</a>，包括文字颜色。CSI 后可以是 0 或者更多参数，用分号分隔。如果没有参数，则视为<code>CSI 0 m</code>（重置&#x2F;常规）。</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="选择图形再现（SGR）参数"><a href="#选择图形再现（SGR）参数" class="headerlink" title="选择图形再现（SGR）参数"></a>选择图形再现（SGR）参数</h2><table>
<thead>
<tr>
<th>代码</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>重置&#x2F;正常</td>
<td>关闭所有属性。</td>
</tr>
<tr>
<td>1</td>
<td>粗体或增加强度</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>下划线</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>缓慢闪烁</td>
<td>低于每分钟 150 次。</td>
</tr>
<tr>
<td>22</td>
<td>正常颜色或强度</td>
<td>不强不弱。</td>
</tr>
<tr>
<td>30–37</td>
<td>设置前景色</td>
<td>参见下面的颜色表。</td>
</tr>
<tr>
<td>38</td>
<td>设置前景色</td>
<td>下一个参数是<code>5;n</code>或<code>2;r;g;b</code>，见下。</td>
</tr>
<tr>
<td>39</td>
<td>默认前景色</td>
<td>由具体实现定义（按照标准）。</td>
</tr>
<tr>
<td>40–47</td>
<td>设置背景色</td>
<td>参见下面的颜色表。</td>
</tr>
<tr>
<td>48</td>
<td>设置背景色</td>
<td>下一个参数是<code>5;n</code>或<code>2;r;g;b</code>，见下。</td>
</tr>
<tr>
<td>49</td>
<td>默认背景色</td>
<td>由具体实现定义（按照标准）。</td>
</tr>
</tbody></table>
<h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><p>初始的规格只有 8 种颜色，只给了它们的名字。SGR 参数 30-37 选择前景色，40-47 选择背景色。相当多的终端将“粗体”（SGR 代码 1）实现为更明亮的颜色而不是不同的字体，从而提供了 8 种额外的前景色，但通常情况下并不能用于背景色，虽然有时候反显（SGR 代码 7）可以允许这样。例如：在白色背景上显示黑色文字使用<code>ESC[30;47m</code>，显示红色文字用<code>ESC[31m</code>，显示明亮的红色文字用<code>ESC[1;31m</code>。重置为默认颜色用<code>ESC[39;49m</code>（某些终端不支持），重置所有属性用<code>ESC[0m</code>。后来的终端新增了功能，可以直接用 90-97 和 100-107 指定“明亮”的颜色。</p>
<p>字颜色:30———–37</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">30    黑</span><br><span class="line">31    红</span><br><span class="line">32    绿</span><br><span class="line">33    黄</span><br><span class="line">34    蓝色</span><br><span class="line">35    紫色</span><br><span class="line">36    深绿</span><br><span class="line">37    白色</span><br></pre></td></tr></table></figure>

<p>字背景颜色范围:40—-47</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">40    黑</span><br><span class="line">41    深红</span><br><span class="line">42    绿</span><br><span class="line">43    黄色</span><br><span class="line">44    蓝色</span><br><span class="line">45    紫色</span><br><span class="line">46    深绿</span><br><span class="line">47    白色</span><br></pre></td></tr></table></figure>

<p>字体加亮颜色:90————97</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">90    黑</span><br><span class="line">91    红</span><br><span class="line">92    绿</span><br><span class="line">93    黄</span><br><span class="line">94    蓝色</span><br><span class="line">95    紫色</span><br><span class="line">96    深绿</span><br><span class="line">97    白色</span><br></pre></td></tr></table></figure>

<p>背景加亮颜色范围:100——————–107</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">100   黑</span><br><span class="line">101   深红</span><br><span class="line">102   绿</span><br><span class="line">103   黄色</span><br><span class="line">104   蓝色</span><br><span class="line">105   紫色</span><br><span class="line">106   深绿</span><br><span class="line">107   白色</span><br></pre></td></tr></table></figure>

<h3 id="ANSI-控制码的说明"><a href="#ANSI-控制码的说明" class="headerlink" title="ANSI 控制码的说明"></a>ANSI 控制码的说明</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">\033[0m                 <span class="comment"># 关闭所有属性</span></span><br><span class="line">\033[1m                 <span class="comment"># 设置高亮度</span></span><br><span class="line">\033[4m                 <span class="comment"># 下划线</span></span><br><span class="line">\033[5m                 <span class="comment"># 闪烁</span></span><br><span class="line">\033[7m                 <span class="comment"># 反显</span></span><br><span class="line">\033[8m                 <span class="comment"># 消隐</span></span><br><span class="line">\033[30m -- \033[37m    <span class="comment"># 设置前景色</span></span><br><span class="line">\033[40m -- \033[47m    <span class="comment"># 设置背景色</span></span><br><span class="line">\033[nA                 <span class="comment"># 光标上移n行</span></span><br><span class="line">\033[nB                 <span class="comment"># 光标下移n行</span></span><br><span class="line">\033[nC                 <span class="comment"># 光标右移n行</span></span><br><span class="line">\033[nD                 <span class="comment"># 光标左移n行</span></span><br><span class="line">\033[y;xH               <span class="comment"># 设置光标位置</span></span><br><span class="line">\033[2J                 <span class="comment"># 清屏</span></span><br><span class="line">\033[K                  <span class="comment"># 清除从光标到行尾的内容</span></span><br><span class="line">\033[s                  <span class="comment"># 保存光标位置</span></span><br><span class="line">\033[u                  <span class="comment"># 恢复光标位置</span></span><br><span class="line">\033[?25l               <span class="comment"># 隐藏光标</span></span><br><span class="line">\033[?25h               <span class="comment"># 显示光标</span></span><br></pre></td></tr></table></figure>

<h2 id="在-vim-中应用"><a href="#在-vim-中应用" class="headerlink" title="在 vim 中应用"></a>在 vim 中应用</h2><p>输入逃逸符^[ : ctrl + v + [</p>
<p>vim 中输入 ^[[1;31m123^[[0m</p>
<p>使用 cat 打印就是红色的 123</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:17:58" itemprop="dateCreated datePublished" datetime="2020-12-09T22:17:58+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">文本处理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><h2 id="字符匹配"><a href="#字符匹配" class="headerlink" title="字符匹配"></a>字符匹配</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. 		匹配任意单个字符</span><br><span class="line">[] 		匹配指定范围内的任意单个字符</span><br><span class="line">[^] 	匹配指定范围外的任意单个字符</span><br></pre></td></tr></table></figure>

<h2 id="匹配次数"><a href="#匹配次数" class="headerlink" title="匹配次数"></a>匹配次数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 匹配前面的字符0次到无数次</span><br><span class="line">? 匹配前面的字符0次或1次</span><br><span class="line">+ 匹配前面的字符至少一次</span><br><span class="line">&#123;n&#125; 匹配前面的字符n次</span><br><span class="line">&#123;m,n&#125; 匹配前面的字符m次到n次</span><br><span class="line">&#123;,n&#125; 匹配前面的字符最多n次</span><br><span class="line">&#123;n,&#125; 匹配前面的字符至少n次</span><br></pre></td></tr></table></figure>

<h2 id="位置锚定"><a href="#位置锚定" class="headerlink" title="位置锚定"></a>位置锚定</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">^ 行首</span><br><span class="line">$ 行尾</span><br><span class="line">\&gt; 或 \b 词首</span><br><span class="line">\&lt; 或 \b 词尾</span><br><span class="line"></span><br><span class="line">^$ 空行</span><br><span class="line">^[[:space:]]*$ 空白行</span><br><span class="line">\&lt;PATTERN\&gt; 匹配整个单词</span><br><span class="line"></span><br><span class="line">ps：单词是由字母、数字、下划线组成</span><br></pre></td></tr></table></figure>

<h2 id="分组及其他"><a href="#分组及其他" class="headerlink" title="分组及其他"></a>分组及其他</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">() 分组</span><br><span class="line">向后引用：\1,\2...</span><br><span class="line">| 或</span><br></pre></td></tr></table></figure>

<h2 id="正则表达式练习-1"><a href="#正则表达式练习-1" class="headerlink" title="正则表达式练习 1"></a>正则表达式练习 1</h2><p>1、显示&#x2F;proc&#x2F;meminfo 文件中以大小 s 开头的行(要求:使用两种方法)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -i <span class="string">&#x27;^s&#x27;</span> /proc/meminfo</span><br><span class="line">grep -E <span class="string">&#x27;^(s|S)&#x27;</span> /proc/meminfo</span><br></pre></td></tr></table></figure>

<p>2、显示&#x2F;etc&#x2F;passwd 文件中不以&#x2F;bin&#x2F;bash 结尾的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;^/bin/bash$&#x27;</span> passwd</span><br></pre></td></tr></table></figure>

<p>3、显示用户 rpc 默认的 shell 程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getent passwd ljk | <span class="built_in">cut</span> -d: -f8</span><br></pre></td></tr></table></figure>

<p>4、找出&#x2F;etc&#x2F;passwd 中的两位或三位数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -Eo <span class="string">&#x27;\&lt;[0-9]&#123;2,3&#125;\&gt;&#x27;</span> passwd</span><br></pre></td></tr></table></figure>

<p>5、显示 CentOS7 的&#x2F;etc&#x2F;grub2.cfg 文件中,至少以一个空白字符开头的且后面有非空白字符的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;^[[:space:]]+[^[:space:]]+&#x27;</span> /etc/grub2.cfg</span><br></pre></td></tr></table></figure>

<p>6、找出“netstat -tan”命令结果中以 LISTEN 后跟任意多个空白字符结尾的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tan | grep -E <span class="string">&#x27;LISTEN[[:space:]]+$&#x27;</span></span><br></pre></td></tr></table></figure>

<p>7、显示 CentOS7 上所有 UID 小于 1000 以内的用户名和 UID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -d: -f1,3 | grep -E <span class="string">&#x27;\&lt;[0-9]&#123;1,3&#125;\&gt;&#x27;</span></span><br><span class="line"><span class="built_in">cat</span> /etc/passwd | <span class="built_in">cut</span> -d: -f1,3 | grep -Ev <span class="string">&#x27;\&lt;[0-9]&#123;4,&#125;\&gt;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>8、添加用户 bash、testbash、basher、sh、nologin(其 shell 为&#x2F;sbin&#x2F;nologin),找出&#x2F;etc&#x2F;passwd 用户名和 shell 同名的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;^(\&lt;[0-9a-zA-Z_]+\&gt;).*\1$&#x27;</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<p>9、利用 df 和 grep,取出磁盘各分区利用率,并从大到小排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | grep -Eo <span class="string">&#x27;[0-9]&#123;,3&#125;%&#x27;</span> | <span class="built_in">tr</span> -d % | <span class="built_in">sort</span> -nr</span><br><span class="line"><span class="built_in">df</span> | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | <span class="built_in">tr</span> -s <span class="string">&quot; &quot;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure>

<h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习 2"></a>练习 2</h2><p>1、显示三个用户 root、mage、wang 的 UID 和默认 shell<br>2、找出&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;functions 文件中行首为某单词(包括下划线)后面跟一个小括号的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;^[a-zA-Z0-9_]+\(\)&#x27;</span> ./functions</span><br></pre></td></tr></table></figure>

<p>3、使用 egrep 取出&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;functions 中其基名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;^\&lt;[0-9a-zA-Z_]+\&gt;\(\)&#x27;</span> ./functions | grep -Eo <span class="string">&#x27;^\&lt;[0-9a-zA-Z_]+\&gt;&#x27;</span></span><br><span class="line">grep -E <span class="string">&#x27;^\&lt;[0-9a-zA-Z_]+\&gt;\(\)&#x27;</span> ./functions | <span class="built_in">cut</span> -d <span class="string">&#x27; &#x27;</span> -f 1 | <span class="built_in">tr</span> -d <span class="string">&#x27;()&#x27;</span></span><br></pre></td></tr></table></figure>

<p>4、使用 egrep 取出上面路径的目录名<br>5、统计 last 命令中以 root 登录的每个主机 IP 地址登录次数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> : | <span class="built_in">cut</span> -d: -f3 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure>

<p>6、利用扩展正则表达式分别表示 0-9、10-99、100-199、200-249、250-255</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">&#x27;\&lt;[0-9]&#123;1&#125;\&gt;&#x27;</span> a.log</span><br><span class="line">grep -E <span class="string">&#x27;\&lt;[0-9]&#123;2&#125;\&gt;&#x27;</span> a.log</span><br><span class="line">grep -E <span class="string">&#x27;\&lt;1[0-9]&#123;2&#125;\&gt;&#x27;</span> a.log</span><br><span class="line">grep -E <span class="string">&#x27;\&lt;2[0-4][0-9]\&gt;&#x27;</span> a.log</span><br><span class="line">grep -E <span class="string">&#x27;\&lt;25[0-5]\&gt;&#x27;</span> a.log</span><br></pre></td></tr></table></figure>

<p>7、显示 ifconfig 命令结果中所有 IPv4 地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep -Eo <span class="string">&#x27;[0-9]&#123;,3&#125;\.[0-9]&#123;,3&#125;\.[0-9]&#123;,3&#125;\.[0-9]&#123;,3&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>8、将此字符串:welcome to magedu linux 中的每个字符去重并排序,重复次数多的排到前面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;welcome to magedu linux&#x27;</span> | grep -o <span class="string">&#x27;.&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -nr</span><br></pre></td></tr></table></figure>

<p>9、精确匹配 ip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bsed/" class="post-title-link" itemprop="url">文本处理三剑客之sed</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:15:47" itemprop="dateCreated datePublished" datetime="2020-12-09T22:15:47+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">文本处理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>sed：stream editor 流编辑器，对标准输出或文件逐行进行处理</p>
<p>sed 是从文件或管道中读取一行，处理一行，输出一行;再读取一行，再处理一行，再输出一行，直到最后一行。每当处理一行时，把当前处理的行存储在临时缓冲区中，称为**模式空间(PatternSpace)**，接着用 sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。接着处理下一行，这样不断重复，直到文件末尾。一次处理一行的设计模式使得 sed 性能很高，sed 在读取大文件时不会出现卡顿的现象。如果使用 vi 命令打开几十 M 上百 M 的文件，明显会出现有卡顿的现象，这是因为 vi 命令打开文件是一次性将文件加载到内存，然后再打开。Sed 就避免了这种情况，一行一行的处理，打开速度非常快，执行速度也很快</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed [OPTION]... <span class="string">&#x27;script;script;...&#x27;</span> [input-file]...</span><br></pre></td></tr></table></figure>

<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="OPTION"><a href="#OPTION" class="headerlink" title="OPTION"></a>OPTION</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-n         <span class="comment"># 不输出模式空间内容到屏幕，即不自动打印，如果不加-n，会自动打印每一行</span></span><br><span class="line">-e         <span class="comment"># 当script有多个时，使用-e，多个script之间是或关系，$(-e &#x27;script1&#x27; -e &#x27;script2&#x27;) 等同于 $(&#x27;script1;script2&#x27;)</span></span><br><span class="line">-f file    <span class="comment"># 从指定文件中读取script</span></span><br><span class="line">-r,-E      <span class="comment"># 支持扩展正则表达式</span></span><br><span class="line">-i         <span class="comment"># 对文件直接进行修改，而不是输出到终端</span></span><br><span class="line">-i.bak     <span class="comment"># 先备份原文件再修改文件</span></span><br></pre></td></tr></table></figure>

<h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><p>script 是 <strong>地址</strong> 和 <strong>命令</strong> 的组合，地址用来定位，命令用来对定位的内容进行操作</p>
<h4 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">不给地址：对全文进行处理</span><br><span class="line"></span><br><span class="line">单地址：</span><br><span class="line">  n：n是阿拉伯数数字,指定行</span><br><span class="line">  $：最后一行</span><br><span class="line">  /pattern/：匹配到的每一行</span><br><span class="line"></span><br><span class="line">地址范围：</span><br><span class="line">  n，n：第n行到第n行 3,6 从第3行到第6行</span><br><span class="line">  n，+n：第n行开始，往后再匹配n行 3,+4 从第3行到第7行</span><br><span class="line">  /pattern1/，/pattern2/：从pattern1匹配到行，到pattern2匹配到的行，再往下继续，从pattern1匹配到行，到pattern2匹配到的行...</span><br><span class="line"></span><br><span class="line">步进：~</span><br><span class="line"></span><br><span class="line">  first\~step：匹配first行，然后步进为step向后继续匹配，例如 1\~2 就是匹配奇数行、2\~2就是匹配偶数行</span><br></pre></td></tr></table></figure>

<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">p         <span class="comment"># print 打印查询的行</span></span><br><span class="line">Ip        <span class="comment"># 忽略大小写输出</span></span><br><span class="line">d         <span class="comment"># 删除匹配到的行</span></span><br><span class="line">a         <span class="comment"># append，追加内容到下一行，支持使用\n实现多行追加； 如果要解析空格，需要用反斜杠\</span></span><br><span class="line">i text    <span class="comment"># insert，在行前面插入内容</span></span><br><span class="line">c text    <span class="comment"># change，替换行</span></span><br><span class="line">w file    <span class="comment"># 保存模式匹配的行到指定文件</span></span><br><span class="line">r file    <span class="comment"># 从file中读取内容，插入到匹配到的行的下一行</span></span><br><span class="line">=         <span class="comment"># 打印匹配到行的行号</span></span><br><span class="line">! 命令     <span class="comment"># 对没有匹配到的行进行处理，例如 !p 是打印未匹配到的行、！atext 是在未匹配到的行的下一行添加text</span></span><br><span class="line"></span><br><span class="line">s/pattern/string/修饰符    <span class="comment"># 查找替换</span></span><br><span class="line">  修饰符:</span><br><span class="line">  g        <span class="comment"># 一行里如果由多个匹配到的内容，全部替换。默认只替换第一个。</span></span><br><span class="line">  p        <span class="comment"># 打印替换成功的行</span></span><br><span class="line">  w file   <span class="comment"># 将成功替换的行保存至文件中</span></span><br><span class="line">  I，i     <span class="comment"># 忽略大小写</span></span><br></pre></td></tr></table></figure>

<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>1.将 php.ini-production 中的无关信息去掉</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -E <span class="string">&#x27;/^; /d;/^;+;$/d&#x27;</span> /usr/local/src/php-7.4.8/php.ini-production | <span class="built_in">uniq</span> &gt; php.ini</span><br></pre></td></tr></table></figure>

<p>2.获取分区利用率</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~$ <span class="built_in">df</span> | sed -En <span class="string">&#x27;/^\/dev\/sd/s/.* ([0-9]+)%.*/\1/p&#x27;</span></span><br></pre></td></tr></table></figure>

<p>3.取基名和目录名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用/作为分隔符，如果搜索条件中出现/需要转义，所以为了易读性，不建议使用搜索条件中出现的字符作为分割符</span></span><br><span class="line"><span class="built_in">pwd</span> |sed -r <span class="string">&#x27;s/(^\/.*\/)([^\/]+\/?)/\2/&#x27;</span>	<span class="comment"># 取基名</span></span><br><span class="line"><span class="built_in">pwd</span> |sed -r <span class="string">&#x27;s@(^/.*/)([^/]+/?)@\2@&#x27;</span>	<span class="comment"># 取目录</span></span><br></pre></td></tr></table></figure>

<p>4.将非#开头的行加#</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ sed -Ei <span class="string">&#x27;s/^[^#].*/# &amp;/&#x27;</span> a.log</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">lujinkai@Z510:~/data/test$ sed -Ei <span class="string">&#x27;s/(^[^#].*)/# \1/&#x27;</span> a.log</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">lujinkai@Z510:~/data/test$ sed -ri <span class="string">&#x27;/^#/!s/^/# /&#x27;</span> a.log</span><br></pre></td></tr></table></figure>

<p>5.将#开头的行删除#</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ sed -ri <span class="string">&#x27;s/^#(.*)/\1/&#x27;</span> a.log</span><br></pre></td></tr></table></figure>

<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><p>略。。。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bgrep/" class="post-title-link" itemprop="url">文本处理三剑客之grep</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:15:32" itemprop="dateCreated datePublished" datetime="2020-12-09T22:15:32+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">文本处理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>文本搜索工具，对目标文本逐行进行匹配检查，打印匹配的行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">grep [OPTION]... PATTERN [FILE]...</span><br><span class="line"></span><br><span class="line">-m n       <span class="comment"># 匹配n次后停止</span></span><br><span class="line">-v         <span class="comment"># 对匹配的内容取反</span></span><br><span class="line">-i         <span class="comment"># 忽略大小写</span></span><br><span class="line">-n         <span class="comment"># 显示匹配内容的行号</span></span><br><span class="line">-c         <span class="comment"># 统计匹配的行号</span></span><br><span class="line">-o         <span class="comment"># 仅显示匹配的内容，而不是整行</span></span><br><span class="line">-q         <span class="comment"># 静默模式，不输出任何信息</span></span><br><span class="line">-A n       <span class="comment"># after，匹配到的每行，再向下多匹配n行</span></span><br><span class="line">-B n       <span class="comment"># before，匹配到的每行，再向上多匹配n行</span></span><br><span class="line">-C n       <span class="comment"># context，匹配到的行，再向上和向下各多匹配n行</span></span><br><span class="line">-e         <span class="comment"># 当搜索条件有多个时，使用-e，多个搜索条件之间是或关系</span></span><br><span class="line">-w         <span class="comment"># 匹配整个单词，例如我想匹配root，不加-w会匹配到rooter，加-w就不会出现这种情况</span></span><br><span class="line">- -E       <span class="comment"># 相当于egrep</span></span><br><span class="line">- -F       <span class="comment"># 支持正则表达式，相当于fgrep</span></span><br><span class="line">-f file    <span class="comment"># 搜索条件可以写在文件中，每行是一个搜索条件，多个搜索条件之间是或的关系</span></span><br><span class="line">- -r       <span class="comment"># 递归目录，但不处理软链接</span></span><br><span class="line">- -R       <span class="comment"># 递归目录，处理软件链接</span></span><br></pre></td></tr></table></figure>

<p>-e 示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ grep -e <span class="string">&#x27;root&#x27;</span> -e <span class="string">&#x27;ljk&#x27;</span> passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">ljk:x:1001:1001::/home/ljk:/bin/bash</span><br></pre></td></tr></table></figure>

<p>-w 示例：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1597149025243.png"></p>
<p>-f file 示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">echo</span> <span class="string">&#x27;^root&#x27;</span> &gt; re.txt</span><br><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">cat</span> re.txt</span><br><span class="line">^root</span><br><span class="line">lujinkai@Z510:~/data/test$ grep -f re.txt passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1.取两个文件的相同行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 思路：使用-f参数，将第一个文件作为搜索条件</span></span><br><span class="line">grep -f f1.txt f2.txt</span><br></pre></td></tr></table></figure>

<p>2.分区利用率最大的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h | grep <span class="string">&#x27;^/dev/sd&#x27;</span> | grep -Eo <span class="string">&#x27;[0-9]&#123;,3&#125;%&#x27;</span> | <span class="built_in">tr</span> -d % | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1</span><br></pre></td></tr></table></figure>

<p>2.哪个 IP 和当前主机连接数最多的前三位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.连接状态的统计</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>4.算出所有人的年龄总和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lujinkai@Z510:~/data/test$ <span class="built_in">cat</span> age.txt</span><br><span class="line">xiaoming=20</span><br><span class="line">xiaohong=18</span><br><span class="line">xiaoqiang=22</span><br><span class="line"></span><br><span class="line">lujinkai@Z510:~/data/test$ grep -Eo <span class="string">&#x27;[0-9]&#123;,2&#125;&#x27;</span> age.txt | <span class="built_in">paste</span> -s -d+ | bc</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E4%B8%89%E5%89%91%E5%AE%A2%E4%B9%8Bawk/" class="post-title-link" itemprop="url">文本处理三剑客之awk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:14:55" itemprop="dateCreated datePublished" datetime="2020-12-09T22:14:55+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">文本处理</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>awk 是一个文本处理工具，通常用于处理数据并生成结果报告。</p>
<p>awk 的工作模式和 sed 类似，也是逐行读取，逐行处理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk [-W option] [-F value] [-v var=value] [--] <span class="string">&#x27;program text&#x27;</span> [file ...]</span><br><span class="line">awk [-W option] [-F value] [-v var=value] [-f program-file] [--] [file ...]</span><br><span class="line"></span><br><span class="line">-F	<span class="comment"># 指定分隔符</span></span><br><span class="line">-v	<span class="comment"># 变量赋值</span></span><br></pre></td></tr></table></figure>

<h2 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;commands&#125;pattern&#123;commands&#125;END&#123;commands&#125;&#x27;</span> file</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">standard output | awk <span class="string">&#x27;BEGIN&#123;commands&#125;pattern&#123;commands&#125;END&#123;commands&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>BEGIN{commands}：正式处理文本之前执行，可以省略</li>
<li>END 后{commands}：处理完所有文本后执行，可以省略</li>
<li>pattern{commands}：逐行执行，pattern 判断此行是否符合匹配模式，符合则执行{commands}<ul>
<li>pattern：匹配模式，可以省略</li>
<li>{commands}：对每行执行的命令，这里面可以写判断、循环等语句，功能强大，所以 awk 又被称为 awk 编程。不可省略</li>
</ul>
</li>
</ul>
<h2 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$0</span>          <span class="comment"># 整行内容</span></span><br><span class="line"><span class="variable">$1</span> - <span class="variable">$n</span>     <span class="comment"># 当前行的第1-n个字段</span></span><br><span class="line">NF          <span class="comment"># 当前行的字段个数，也就是有多少列</span></span><br><span class="line">NR          <span class="comment"># 当前行的行号，从1开始计数</span></span><br><span class="line">FNR         <span class="comment"># 多文件处理时，每个文件行号单独计数，从0开始</span></span><br><span class="line">FS          <span class="comment"># 输入字段分割符。不指定默认就是空格或tab</span></span><br><span class="line">RS          <span class="comment"># 输入行分割符号。默认回车换行</span></span><br><span class="line">OFS         <span class="comment"># 输出字段分隔符。默认空格</span></span><br><span class="line">ORS         <span class="comment"># 输出行分割符。默认回车换行</span></span><br><span class="line">FILENAME    <span class="comment"># 处理文件的文件名</span></span><br><span class="line">ARGC        <span class="comment"># 命令行参数个数</span></span><br><span class="line">ARGV        <span class="comment"># 命令行参数数组</span></span><br></pre></td></tr></table></figure>

<h2 id="格式化输出-printf"><a href="#格式化输出-printf" class="headerlink" title="格式化输出 printf"></a>格式化输出 printf</h2><h3 id="格式符"><a href="#格式符" class="headerlink" title="格式符"></a>格式符</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%s    <span class="comment"># 打印字符串</span></span><br><span class="line">%d    <span class="comment"># 打印十进制数</span></span><br><span class="line">%f    <span class="comment"># 打印一个浮点数</span></span><br><span class="line">%x    <span class="comment"># 打印十六进制数</span></span><br><span class="line">%o    <span class="comment"># 打印八进制数</span></span><br><span class="line">%e    <span class="comment"># 打印数字的科学计数法形式</span></span><br><span class="line">%c    <span class="comment"># 打印单个字符的ASCII码</span></span><br></pre></td></tr></table></figure>

<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-    <span class="comment"># 左对齐</span></span><br><span class="line">+    <span class="comment"># 右对齐</span></span><br><span class="line"><span class="comment">#    # 显示八进制在前面加0，显示十六进制在前面加0x</span></span><br></pre></td></tr></table></figure>

<h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><p>第一种模式匹配：正则表达式 RegExp</p>
<p>第二种模式匹配：关系运算符号匹配</p>
<p>&lt;、&gt;、&lt;、&gt;&#x3D;、!&#x3D;<br><del>：匹配正则表达式<br>!</del>：不匹配正则表达式<br>||：或<br>&amp;&amp;：与<br>!：非</p>
<h2 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h2><p>+、-、<em>、&#x2F;、%、^或</em>*、++x、x++、–x、x–</p>
<p>-x：转换为负数<br>+x：将字符串转换为数值</p>
<h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>注：awk 中语句块没有作用域，都是全局变量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)</span><br><span class="line">	动作1</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(条件表达式)</span><br><span class="line">	动作2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	动作3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">switch (expression) &#123;</span><br><span class="line">    <span class="keyword">case</span> value|regex : statement</span><br><span class="line">    ...</span><br><span class="line">    [ default: statement ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(条件表达式)</span><br><span class="line">	动作</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">	动作</span><br><span class="line"><span class="keyword">while</span>（条件表达式）</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(i=0; i&lt;100, i++)</span><br><span class="line">	动作</span><br></pre></td></tr></table></figure>

<h3 id="continue-和-break"><a href="#continue-和-break" class="headerlink" title="continue 和 break"></a>continue 和 break</h3><p>continue 跳过本次循环，break 跳出整个循环</p>
<h2 id="next"><a href="#next" class="headerlink" title="next"></a>next</h2><p>next 可以提前结束对本行处理而直接进入下一行处理(awk 自身循环)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk -F: &#x27;&#123;if($3%2!=0) next; print $1,$3&#125;&#x27; /etc/passwd</span></span><br></pre></td></tr></table></figure>

<h2 id="awk-内置函数"><a href="#awk-内置函数" class="headerlink" title="awk 内置函数"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/awk-built-in-functions.html#b3">awk 内置函数</a></h2><h3 id="算数函数"><a href="#算数函数" class="headerlink" title="算数函数"></a>算数函数</h3><ul>
<li><p>rand：返回 0-1 之间一个随机数，需要配合 srand()配合生成随机数种子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#awk &#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>int：返回整数</p>
</li>
</ul>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p><img data-src="//img.to2b.cn/blog/ljk/1598605859434.png"></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1598605923551.png"></p>
<ul>
<li><p>length</p>
</li>
<li><p>index</p>
</li>
<li><p>tolower</p>
</li>
<li><p>toupper</p>
</li>
<li><p>substr</p>
</li>
<li><p>split</p>
</li>
<li><p>match</p>
</li>
<li><p>sub</p>
</li>
<li><p>gsub</p>
</li>
</ul>
<h3 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h3><ul>
<li><p>mktime：生成时间戳</p>
</li>
<li><p>strftime：将时间戳转化格式化时间输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strftime(<span class="string">&quot;%Y-%m-%dT%H:%M&quot;</span>,systime()) ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>systime：获取当前时间戳</p>
</li>
</ul>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><ul>
<li><p>next：提前结束本行处理，进入下一行处理</p>
</li>
<li><p>system：system(commands)，在 awk 中调用 shell 命令</p>
</li>
<li><p>exit</p>
</li>
</ul>
<p>终止脚本执行</p>
<h2 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-v    <span class="comment"># 参数传递</span></span><br><span class="line">-f    <span class="comment"># 指定脚本文件</span></span><br><span class="line">-F    <span class="comment"># 指定分割符</span></span><br><span class="line">-V    <span class="comment"># 查看awk的版本号</span></span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>shell 中数组的下标从 0 开始，awk 中数组下标从 1 开始，而且也有关联数组。但每次只能定义元素。如果想一次性定义多个元素，可以通过 split 间接实现。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">str=<span class="string">&quot;a b c d e&quot;</span></span><br><span class="line"><span class="built_in">split</span>(str,array,<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> array)</span><br><span class="line">    <span class="built_in">print</span> array[i]</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title="++"></a>++</h3><p>awk 中，数组[键]++ 表示给数组的元素赋值，赋值+1。灵活运用，可以实现去重、统计的功能</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr[a]=<span class="number">1</span></span><br><span class="line">arr[b]=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">print arr[a]++		<span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

<p>范例：显示主机的连接状态出现的次数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;NR!=1&#123;print $1&#125;&#x27;</span> ss.log |<span class="built_in">sort</span> |<span class="built_in">uniq</span> -c</span><br><span class="line">ss -ant | awk <span class="string">&#x27;NR&gt;1 &#123;++s[$1]&#125; END &#123;for(k in s) print k,s[k]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><p>脚本</p>
<p>将 awk 写成脚本，调用或直接执行</p>
<p>范例：调用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat passwd.awk</span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">[root@centos8 ~]</span><br><span class="line">[root@centos8 ~]<span class="comment">#awk -F: -f passwd.awk /etc/passwd</span></span><br><span class="line">nobody 65534</span><br><span class="line">wang 1000</span><br><span class="line">mage 1001</span><br></pre></td></tr></table></figure>

<p>范例：直接执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#cat test.awk</span></span><br><span class="line"><span class="comment">#!/bin/awk -f</span></span><br><span class="line"><span class="comment">#this is a awk script</span></span><br><span class="line">&#123;<span class="keyword">if</span>(<span class="variable">$3</span>&gt;=1000)<span class="built_in">print</span> <span class="variable">$1</span>,<span class="variable">$3</span>&#125;</span><br><span class="line">[root@centos8 ~]</span><br><span class="line">[root@centos8 ~]<span class="comment">#chmod +x test.awk</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#./test.awk -F: /etc/passwd</span></span><br><span class="line">nobody 65534</span><br><span class="line">wang 1000</span><br><span class="line">mage 1001</span><br></pre></td></tr></table></figure>

<h3 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h3><p>检查出最近一小时内访问 nginx 服务次数超过 3 次的客户端 IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>1、文件 host_list.log 如下格式,请提取”.magedu.com”前面的主机名部分并写入到回到该文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1 www.magedu.com</span><br><span class="line">2 blog.magedu.com</span><br><span class="line">3 study.magedu.com</span><br><span class="line">4 linux.magedu.com</span><br><span class="line">5 python.magedu.com</span><br><span class="line">......</span><br><span class="line">999 study.magedu.com</span><br></pre></td></tr></table></figure>

<p>2、统计&#x2F;etc&#x2F;fstab 文件中每个文件系统类型出现的次数</p>
<p>3、统计&#x2F;etc&#x2F;fstab 文件中每个单词出现的次数</p>
<p>4、提取出字符串 Yd$C@M05MB%9&amp;Bdh7dq+YVixp3vpw 中的所有数字</p>
<p>5、有一文件记录了 1-100000 之间随机的整数共 5000 个,存储的格式 100,50,35,89…请取出其中最大和最小的整数</p>
<p>6、解决 Dos 攻击生产案例:根据 web 日志或者或者网络连接数,监控当某个 IP 并发连接数或者短时内 PV 达到 100,即调用防火墙命令封掉对应的 IP,监控频率每隔 5 分钟。防火墙命令为:iptables -AINPUT -s IP -j REJECT</p>
<p>7、将以下文件内容中 FQDN 取出并根据其进行计数从高到低排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://mail.magedu.com/index.html</span><br><span class="line">http://www.magedu.com/test.html</span><br><span class="line">http://study.magedu.com/index.html</span><br><span class="line">http://blog.magedu.com/index.html</span><br><span class="line">http://www.magedu.com/images/logo.jpg</span><br><span class="line">http://blog.magedu.com/20080102.html</span><br><span class="line">http://www.magedu.com/images/magedu.jpg</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%92%8C%E5%B8%AE%E5%8A%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/Linux%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8%E5%92%8C%E5%B8%AE%E5%8A%A9/" class="post-title-link" itemprop="url">Linux基础入门和帮助</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:04:47" itemprop="dateCreated datePublished" datetime="2020-12-09T22:04:47+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="终端"><a href="#终端" class="headerlink" title="终端"></a>终端</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 控制台 /dev/console</span><br><span class="line">- 串行终端 /dev/ttyS#</span><br><span class="line">- 虚拟终端: tty: /dev/tty#</span><br><span class="line">- 伪终端: pty: /dev/pts/#</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/21711307">终端、Shell、tty 和控制台（console）有什么区别？ - 知乎</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/11460821.html">Linux 终端(tty)</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/11605804.html">Linux 伪终端(pty)</a></p>
<h3 id="控制台-x2F-dev-x2F-console"><a href="#控制台-x2F-dev-x2F-console" class="headerlink" title="控制台 &#x2F;dev&#x2F;console"></a>控制台 &#x2F;dev&#x2F;console</h3><p>计算机启动的时候，所有的信息都会显示到控制台上，而不会显示到终端上</p>
<h3 id="串行终端-x2F-dev-x2F-ttyS"><a href="#串行终端-x2F-dev-x2F-ttyS" class="headerlink" title="串行终端 &#x2F;dev&#x2F;ttyS#"></a>串行终端 &#x2F;dev&#x2F;ttyS#</h3><p>计算机串行端口连接的终端设备, 这些串行端口所对应的设备名称是&#x2F;dev&#x2F;tty0、&#x2F;dev&#x2F;tty1 等，分别对应于系统下的 COM1、COM2 等</p>
<h3 id="虚拟终端-tty-x2F-dev-x2F-tty"><a href="#虚拟终端-tty-x2F-dev-x2F-tty" class="headerlink" title="虚拟终端: tty: &#x2F;dev&#x2F;tty#"></a>虚拟终端: tty: &#x2F;dev&#x2F;tty#</h3><p>每打开一个 terminal，系统会启动一个 shell 与这个 terminal 关联起来, shell&#x3D;命令行解释器, tty 和 terminal 是同义词</p>
<p>tty 是虚拟终端, 与之对应的是 console 是物理终端</p>
<img data-src="//img.to2b.cn/blog/ljk/1595852561609.png" style="zoom:;" />

<h3 id="伪终端-pty-x2F-dev-x2F-pts-x2F"><a href="#伪终端-pty-x2F-dev-x2F-pts-x2F" class="headerlink" title="伪终端: pty: &#x2F;dev&#x2F;pts&#x2F;#"></a>伪终端: pty: &#x2F;dev&#x2F;pts&#x2F;#</h3><p>使用 tty1-6 的情况一般为 Linux 系统直接连了键盘和显示器，或者是使用了 vSphere console 等虚拟化方案，其它情况下使用的都是伪终端, <strong>通过 SSH 等方式建立的连接中使用的都是伪终端</strong></p>
<h2 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lscpu</span><br><span class="line">free</span><br><span class="line">lsblk 和 <span class="built_in">df</span></span><br><span class="line"><span class="built_in">uname</span></span><br><span class="line"><span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line"><span class="built_in">cat</span> /etc/os-release</span><br><span class="line"><span class="built_in">cat</span> /etc/centos-release</span><br><span class="line">lsb_release</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看cpu</span></span><br><span class="line">[lujinkai@centos8 ~]$ lscpu</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">cat</span> /proc/cpuinfo</span><br><span class="line"><span class="comment"># 查看内存</span></span><br><span class="line">[lujinkai@centos8 ~]$ free -h</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">cat</span> /proc/meminfo</span><br><span class="line"><span class="comment"># 查看硬盘和分区情况</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0  200G  0 disk</span><br><span class="line">├─sda1   8:1    0    1G  0 part /boot</span><br><span class="line">├─sda2   8:2    0  100G  0 part /</span><br><span class="line">├─sda3   8:3    0   50G  0 part /data</span><br><span class="line">├─sda4   8:4    0    1K  0 part</span><br><span class="line">└─sda5   8:5    0    2G  0 part [SWAP]</span><br><span class="line">sr0     11:0    1  1.6G  0 rom</span><br><span class="line"><span class="comment"># -f 显示文件系统的信息</span></span><br><span class="line">[root@centos8 /]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME   FSTYPE  LABEL                      UUID                                 MOUNTPOINT</span><br><span class="line">sda</span><br><span class="line">├─sda1 ext4                               a489cd2b-daf2-4d94-90ab-696a21284f6a /boot</span><br><span class="line">├─sda2 xfs                                30e97194-a6ff-42cb-b6e0-3374d3e614e7 /</span><br><span class="line">├─sda3 xfs                                721abfdb-0d93-4559-9ac1-a487ecabf339 /data</span><br><span class="line">├─sda4</span><br><span class="line">└─sda5 swap                               1b064969-1539-4d0a-ab1f-6f304f99ac9e [SWAP]</span><br><span class="line">sr0    iso9660 CentOS-8-2-2004-x86_64-dvd 2020-06-08-22-08-12-00</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">cat</span> /proc/partitions</span><br><span class="line">major minor  <span class="comment">#blocks  name</span></span><br><span class="line"></span><br><span class="line">   8        0  209715200 sda</span><br><span class="line">   8        1    1048576 sda1</span><br><span class="line">   8        2  104857600 sda2</span><br><span class="line">   8        3   52428800 sda3</span><br><span class="line">   8        4          1 sda4</span><br><span class="line">   8        5    2097152 sda5</span><br><span class="line">  11        0    1678336 sr0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统版本信息</span></span><br><span class="line"><span class="comment"># 查看内核版本</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">uname</span></span><br><span class="line">Linux</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">uname</span> -r</span><br><span class="line">4.18.0-80.el8.x86_64</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux centos8.mageedu.org 4.18.0-80.el8.x86_64 <span class="comment">#1 SMP Tue Jun 4 09:19:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"><span class="comment"># 查看操作系统发行版本</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">cat</span> /etc/redhat-release</span><br><span class="line">CentOS Linux release 8.0.1905 (Core)</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">cat</span> /etc/os-release</span><br><span class="line">NAME=<span class="string">&quot;CentOS Linux&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;8 (Core)&quot;</span></span><br><span class="line">ID=<span class="string">&quot;centos&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;rhel fedora&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;8&quot;</span></span><br><span class="line">PLATFORM_ID=<span class="string">&quot;platform:el8&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;CentOS Linux 8 (Core)&quot;</span></span><br><span class="line">ANSI_COLOR=<span class="string">&quot;0;31&quot;</span></span><br><span class="line">CPE_NAME=<span class="string">&quot;cpe:/o:centos:centos:8&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.centos.org/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.centos.org/&quot;</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">&quot;CentOS-8&quot;</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">&quot;8&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">&quot;centos&quot;</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">&quot;8&quot;</span></span><br><span class="line">[lujinkai@centos8 ~]$ lsb_release -a</span><br><span class="line">LSB Version:    :core-4.1-amd64:core-4.1-noarch</span><br><span class="line">Distributor ID: CentOS</span><br><span class="line">Description:    CentOS Linux release 8.0.1905 (Core)</span><br><span class="line">Release:        8.0.1905</span><br><span class="line">Codename:       Core</span><br></pre></td></tr></table></figure>

<h2 id="用户登录信息"><a href="#用户登录信息" class="headerlink" title="用户登录信息"></a>用户登录信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我是谁</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">whoami</span></span><br><span class="line">lujinkai</span><br><span class="line"><span class="comment"># 我是谁 详细</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">who</span> am i</span><br><span class="line">lujinkai pts/1        2020-07-27 22:12 (10.0.0.1)</span><br><span class="line"><span class="comment"># 当前所有已登录用户信息</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">who</span></span><br><span class="line">root     tty1         2020-07-27 22:21</span><br><span class="line">root     pts/0        2020-07-27 22:11 (10.0.0.1)</span><br><span class="line">lujinkai pts/1        2020-07-27 22:12 (10.0.0.1)</span><br><span class="line"><span class="comment"># 当前所有已登录用户信息 显示正在执行的操作</span></span><br><span class="line">[lujinkai@centos8 ~]$ w</span><br><span class="line"> 22:21:22 up 10 min,  3 <span class="built_in">users</span>,  load average: 0.05, 0.08, 0.09</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     tty1     -                22:21   18.00s  0.01s  0.01s -bash</span><br><span class="line">root     pts/0    10.0.0.1         22:11   10:12   0.02s  0.02s -bash</span><br><span class="line">lujinkai pts/1    10.0.0.1         22:12    2.00s  0.08s  0.02s w</span><br></pre></td></tr></table></figure>

<h2 id="主机名"><a href="#主机名" class="headerlink" title="主机名"></a>主机名</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hostname NAME                 <span class="comment"># 临时生效</span></span><br><span class="line">hostnamectl set-hostname NAME <span class="comment"># 永久生效</span></span><br><span class="line"><span class="comment"># 永久生效还可以修改文件 /etc/hostname</span></span><br></pre></td></tr></table></figure>

<ol>
<li>主机名不支持使用下划线<code>_</code> , 可以使用字母、横线或数字组合</li>
<li>主机名不要使用数字结尾，因为有些软件对主机名有要求</li>
</ol>
<h2 id="命令提示符"><a href="#命令提示符" class="headerlink" title="命令提示符"></a>命令提示符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="variable">$echo</span> <span class="variable">$PS1</span></span><br><span class="line">\[\e[37;40m\][\[\e[32;40m\]\u\[\e[37;40m\]@\h \[\e[35;40m\]\W\[\e[0m\]]$</span><br><span class="line"></span><br><span class="line">\e   <span class="comment"># 控制符\033</span></span><br><span class="line">\u   <span class="comment"># 当前用户</span></span><br><span class="line">\h   <span class="comment"># 主机名简称</span></span><br><span class="line">\H   <span class="comment"># 主机名</span></span><br><span class="line">\w   <span class="comment"># 当前工作目录</span></span><br><span class="line">\W   <span class="comment"># 当前工作目录基名</span></span><br><span class="line">\t   <span class="comment"># 24小时时间格式</span></span><br><span class="line">\T   <span class="comment"># 12小时时间格式</span></span><br></pre></td></tr></table></figure>

<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><p>三种风格：短选项（UNIX）、长选项（GNU）、BSD 风格选项</p>
<p>ctrl + c : 终止命令执行；ctrl + d : 退出终端</p>
<h3 id="内部命令和外部命令"><a href="#内部命令和外部命令" class="headerlink" title="内部命令和外部命令"></a>内部命令和外部命令</h3><p>内部命令是 shell 内置的，外部命令是自己安装的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> -a COMMAND		<span class="comment"># 判断一个命令是内部命令还是外部命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 内部命令：</span></span><br><span class="line"><span class="built_in">enable</span> COMMAND		<span class="comment"># 启用内部命令</span></span><br><span class="line"><span class="built_in">enable</span> -n COMMAND	<span class="comment"># 禁用内部命令</span></span><br><span class="line"><span class="built_in">enable</span> -n			<span class="comment"># 查看所有禁用的内部命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外部命令：</span></span><br><span class="line"><span class="built_in">which</span> COMMAND		<span class="comment"># 查看外部命令的执行文件路径</span></span><br><span class="line">whereis COMMAND		<span class="comment"># 除了查看外部命令执行文件路径,还能查看man文件的路径等信息</span></span><br></pre></td></tr></table></figure>

<h3 id="命令执行顺序"><a href="#命令执行顺序" class="headerlink" title="命令执行顺序"></a>命令执行顺序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">别名 &gt; 内部命令 &gt; hash &gt; $PATH &gt; command not found</span><br></pre></td></tr></table></figure>

<h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><p>打印变量的时候，变量加引号的规则和 php 一样，单引号当成字符串输出，双引号则解析变量</p>
<p>-e：启用 \ 字符的解释功能 (escapes 转义符)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\a             <span class="comment"># 发出警告声</span></span><br><span class="line">\b             <span class="comment"># 退格键</span></span><br><span class="line">\c             <span class="comment"># 最后不加上换行符号</span></span><br><span class="line">\e             <span class="comment"># escape，相当于\033</span></span><br><span class="line">\n             <span class="comment"># 换行且光标移至行首</span></span><br><span class="line">\r             <span class="comment"># 回车，即光标移至行首，但不换行</span></span><br><span class="line">\t             <span class="comment"># 插入tab</span></span><br><span class="line">\              <span class="comment"># 插入\字符</span></span><br><span class="line">\0nnn          <span class="comment"># 插入nnn（八进制）所代表的ASCII字符</span></span><br><span class="line">\xHH插入HH（十六进制） <span class="comment"># 所代表的ASCII数字（man 7 ascii）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例：</span></span><br><span class="line"><span class="variable">$echo</span> -e <span class="string">&quot;\a&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="字符集和编码"><a href="#字符集和编码" class="headerlink" title="字符集和编码"></a>字符集和编码</h2><p>Unicode 是字符集, Unicode 的编码方案有 UTF-8、UTF-16、UTF-32</p>
<h2 id="bash-shell"><a href="#bash-shell" class="headerlink" title="bash shell"></a>bash shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前使用的shell</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="comment"># 显示当前系统使用的所有shell</span></span><br><span class="line"><span class="built_in">cat</span> /etc/shells</span><br></pre></td></tr></table></figure>

<h3 id="bash-快捷键"><a href="#bash-快捷键" class="headerlink" title="bash 快捷键"></a>bash 快捷键</h3><p>Ctrl + a 光标移到命令行首，相当于 Home<br>Ctrl + e 光标移到命令行尾，相当于 End</p>
<h2 id="hash-缓存表"><a href="#hash-缓存表" class="headerlink" title="hash 缓存表"></a>hash 缓存表</h2><p>shell 内部命令本来就在内存中, hash 缓存的是外部命令的路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示hash缓存</span></span><br><span class="line"><span class="built_in">hash</span></span><br><span class="line"><span class="comment"># 清除某条命令缓存</span></span><br><span class="line"><span class="built_in">hash</span> -d COMMAND</span><br><span class="line"><span class="comment"># 清除所有命令的内存</span></span><br><span class="line"><span class="built_in">hash</span> -r</span><br></pre></td></tr></table></figure>

<h2 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span></span><br><span class="line">  -d	<span class="comment"># display time described by STRING, not &#x27;now&#x27;</span></span><br><span class="line">  -s	<span class="comment"># set time described by STRING</span></span><br><span class="line">clock</span><br><span class="line">timedatectl</span><br><span class="line">cal</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示时间戳</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> +%s</span><br><span class="line">1595857012</span><br><span class="line"><span class="comment"># 将时间戳格式化</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> -d @`<span class="built_in">date</span> +%s`</span><br><span class="line">Mon Jul 27 21:40:31 CST 2020</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> -d @`<span class="built_in">date</span> +%s` +%F</span><br><span class="line">2020-07-27</span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> -d @1595857012 +%F_%T</span><br><span class="line">2020-07-27_21:40:34</span><br><span class="line">[lujinkai@centos8 ~]<span class="variable">$date</span> <span class="string">&quot;+%F %T&quot;</span></span><br><span class="line">2021-03-16 01:12:53</span><br><span class="line"><span class="comment"># 昨天</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> -d <span class="string">&#x27;-1 day&#x27;</span> +%F</span><br><span class="line">2020-07-27</span><br><span class="line"><span class="comment"># 明天</span></span><br><span class="line">[lujinkai@centos8 ~]$ <span class="built_in">date</span> -d <span class="string">&#x27;1 day&#x27;</span> +%F</span><br><span class="line">2020-07-29</span><br><span class="line"></span><br><span class="line"><span class="comment"># %F  完整日期格式，等价于 %Y-%m-%d</span></span><br><span class="line"><span class="comment"># %T  时间，等于%H:%M:%S</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以硬件时间为准, 校正系统时间</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># clock -s</span></span><br><span class="line"><span class="comment"># 以系统时间为准, 校正硬件时间</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># clock -w</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示系统全部的时区</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># timedatectl list-timezones</span></span><br><span class="line"><span class="comment"># 查找上海</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># timedatectl list-timezones | grep &#x27;Shanghai&#x27;</span></span><br><span class="line">Asia/Shanghai</span><br><span class="line"><span class="comment"># 设置时区为上海</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># timedatectl set-timezone Asia/Shanghai</span></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># timedatectl status</span></span><br><span class="line">               Local time: Mon 2020-07-27 21:56:19 CST</span><br><span class="line">           Universal time: Mon 2020-07-27 13:56:19 UTC</span><br><span class="line">                 RTC time: Mon 2020-07-27 13:56:19</span><br><span class="line">                Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">System clock synchronized: no</span><br><span class="line">              NTP service: inactive</span><br><span class="line">          RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br><span class="line"><span class="comment"># 查看当前所在的时区</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># ll /etc/localtime</span></span><br><span class="line">lrwxrwxrwx. 1 root root 35 Jul 23 16:33 /etc/localtime -&gt; ../usr/share/zoneinfo/Asia/Shanghai</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日历</span></span><br><span class="line"><span class="comment"># 显示全年日历</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># cal -y</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># cal 2020</span></span><br><span class="line"><span class="comment"># 显示一个月的日历</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># cal 7 2020</span></span><br></pre></td></tr></table></figure>

<h2 id="关机和重启"><a href="#关机和重启" class="headerlink" title="关机和重启"></a>关机和重启</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">halt     <span class="comment"># 关机 相当于 shutdown -h</span></span><br><span class="line">poweroff <span class="comment"># 关机 相当于shutdown -p</span></span><br><span class="line">reboot   <span class="comment"># 重启 相当于shutdown -r</span></span><br><span class="line"></span><br><span class="line">shutdown -h +3                    <span class="comment"># 定时关机 3分钟后自动关机</span></span><br><span class="line">shutdown -h 00:00 <span class="string">&quot;class is over&quot;</span> <span class="comment"># 定时关机 00:00关机 并提示&#x27;class is over&#x27;</span></span><br><span class="line">shutdown -c                       <span class="comment"># 取消关机</span></span><br></pre></td></tr></table></figure>

<p>但是在 VMware 中, CentOS7、8 和 Ubuntu18.04 关机的时候, 使用<code>halt</code>会报错, 使用<code>shutdown -h now</code>就能顺利关机, 不知道为什么?</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1596017476185.png"></p>
<h2 id="计算器-bc"><a href="#计算器-bc" class="headerlink" title="计算器 bc"></a>计算器 bc</h2><p>-q 表示不显示欢迎信息<br><img data-src="//img.to2b.cn/blog/ljk/1595895348099.png"></p>
<p>bc 有四个内置变量，我们在计算时会经常用到，如下表所示：</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>作 用</th>
</tr>
</thead>
<tbody><tr>
<td>scale</td>
<td>指定精度，也即小数点后的位数；默认为 0，也即不使用小数部分。</td>
</tr>
<tr>
<td>ibase</td>
<td>指定输入的数字的进制，默认为十进制。</td>
</tr>
<tr>
<td>obase</td>
<td>指定输出的数字的进制，默认为十进制。</td>
</tr>
<tr>
<td>last 或者 .</td>
<td>表示最近打印的数字</td>
</tr>
</tbody></table>
<p><font color=red>注意：obase 要尽量放在 ibase 前面，因为 ibase 设置后，后面的数字都是以 ibase 的进制来换算的</font></p>
<h2 id="命令历史-history"><a href="#命令历史-history" class="headerlink" title="命令历史 history"></a>命令历史 history</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示最近5条历史命令</span></span><br><span class="line">[root@4710419222 <span class="built_in">test</span>]<span class="comment"># history 5</span></span><br><span class="line"> 7618  2020-07-28 19:19:03 root <span class="built_in">set</span> -B</span><br><span class="line"> 7619  2020-07-28 19:19:05 root <span class="built_in">ls</span> &#123;1,4,6&#125;.<span class="built_in">log</span></span><br><span class="line"> 7620  2020-07-28 19:21:46 root <span class="built_in">history</span></span><br><span class="line"> 7621  2020-07-28 19:22:06 root <span class="built_in">history</span> 10</span><br><span class="line"> 7622  2020-07-28 19:22:16 root <span class="built_in">history</span> 5</span><br><span class="line"> <span class="comment"># 清除此次登录记录的命令</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># history -c</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># history</span></span><br><span class="line">    1  2020-07-28 19:23:15 root <span class="built_in">history</span></span><br><span class="line"> <span class="comment"># !n 执行第n条历史命令</span></span><br><span class="line"> <span class="comment"># !$ 调用前一条命令的最后一个参数</span></span><br><span class="line"> <span class="comment"># !* 调用前一条命令的所有参数</span></span><br><span class="line"> <span class="comment"># ctrl + r 搜索历史命令快捷键</span></span><br><span class="line"> <span class="comment"># !string 执行上一条以string开头的命令</span></span><br></pre></td></tr></table></figure>

<p>相关环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HISTSIZE		<span class="comment"># 命令历史记录的条数</span></span><br><span class="line">HISTFILE		<span class="comment"># 指定历史文件，默认为~/.bash_history</span></span><br><span class="line">HISTFILESIZE	<span class="comment"># 命令历史文件记录历史的条数</span></span><br><span class="line">HISTTIMEFORMAT=<span class="string">&quot;%F %T \`whoami\` &quot;</span>	<span class="comment"># 显示时间和用户</span></span><br><span class="line">HISTIGNORE=<span class="string">&quot;str1:str2*:…&quot;</span>		<span class="comment"># 忽略str1命令，str2开头的历史</span></span><br><span class="line">HISTCONTROL	<span class="comment"># 控制命令历史的记录方式</span></span><br><span class="line">  ignoredups	<span class="comment"># 是默认值，可忽略重复的命令，连续且相同为“重复”</span></span><br><span class="line">  ignorespace	<span class="comment"># 忽略所有以空白开头的命令</span></span><br><span class="line">  ignoreboth	<span class="comment"># 相当于ignoredups, ignorespace的组合</span></span><br><span class="line">  erasedups	<span class="comment"># 删除重复命令</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 profile.d]<span class="comment"># echo &#x27;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&#x27; &gt;&gt; ~/.bash_profile</span></span><br><span class="line">[root@centos8 profile.d]<span class="comment"># echo &#x27;export HISTCONTROL=ignoreboth&#x27; &gt;&gt; ~/.bash_profile</span></span><br></pre></td></tr></table></figure>

<h2 id="获得帮助-重点"><a href="#获得帮助-重点" class="headerlink" title="获得帮助 (重点)"></a>获得帮助 (重点)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一步: 判断命令为内部命令还是外部命令, 如果二者都是, 则查询内部命令</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># type -a echo</span></span><br><span class="line"><span class="built_in">echo</span> is a shell <span class="built_in">builtin</span></span><br><span class="line"><span class="built_in">echo</span> is /usr/bin/ech</span><br><span class="line"><span class="comment"># 第二步: 使用whatis查询man的分组</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># whatis echo</span></span><br><span class="line"><span class="built_in">echo</span> (1)             - display a line of text</span><br><span class="line"><span class="built_in">echo</span> (3x)            - curses input options</span><br><span class="line"><span class="comment"># 第三步</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># man 1 echo</span></span><br><span class="line"><span class="comment"># 如果是外部命令, 简单的查询可以省略第二步, 直接 --help</span></span><br><span class="line">[root@4710419222 ~]<span class="comment"># type hostname</span></span><br><span class="line">hostname is /usr/bin/hostname</span><br><span class="line">[root@4710419222 ~]<span class="comment"># hostname --help</span></span><br></pre></td></tr></table></figure>

<p>范例二:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment"># type -a history</span></span><br><span class="line"><span class="built_in">history</span> is a shell <span class="built_in">builtin</span></span><br><span class="line">[root@centos8 ~]<span class="comment"># whatis history</span></span><br><span class="line"><span class="built_in">history</span> (1)          - bash built-in commands, see bash(1)</span><br><span class="line">[root@centos8 ~]<span class="comment"># man 1 history</span></span><br><span class="line"><span class="comment"># 此时发现找不到history</span></span><br><span class="line"><span class="comment"># 可以使用 /keyword 进行搜索, 使用 n 和 N 进行上下查找</span></span><br><span class="line"><span class="comment"># 然后很容易就找到了history的man手册</span></span><br></pre></td></tr></table></figure>

<h3 id="man-页面分组"><a href="#man-页面分组" class="headerlink" title="man 页面分组"></a>man 页面分组</h3><p>不同类型的帮助称为不同的“章节”，统称为 Linux 手册</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">       1   Executable programs or shell commands</span><br><span class="line">       2   System calls (<span class="built_in">functions</span> provided by the kernel)</span><br><span class="line">       3   Library calls (<span class="built_in">functions</span> within program libraries)</span><br><span class="line">       4   Special files (usually found <span class="keyword">in</span> /dev)</span><br><span class="line">       5   File formats and conventions eg /etc/passwd</span><br><span class="line">       6   Games</span><br><span class="line">       7   Miscellaneous (including macro packages and conventions), e.g. man(7), groff(7)</span><br><span class="line">       8   System administration commands (usually only <span class="keyword">for</span> root)</span><br><span class="line">       9   Kernel routines [Non standard]</span><br><span class="line">1：用户命令</span><br><span class="line">2：系统调用</span><br><span class="line">3：C库调用</span><br><span class="line">4：设备文件及特殊文件</span><br><span class="line">5：配置文件格式</span><br><span class="line">6：游戏</span><br><span class="line">7：杂项</span><br><span class="line">8：管理类的命令</span><br><span class="line">9：Linux 内核API</span><br></pre></td></tr></table></figure>

<h3 id="man-帮助段落说明"><a href="#man-帮助段落说明" class="headerlink" title="man 帮助段落说明"></a>man 帮助段落说明</h3><ul>
<li>NAME 名称及简要说明</li>
<li>SYNOPSIS 用法格式说明</li>
<li>[] 可选内容</li>
<li><strong>&lt;&gt; 必选内容</strong></li>
<li>a|b 二选一</li>
<li>{ } 分组</li>
<li>… 同一内容可出现多次</li>
<li>DESCRIPTION 详细说明</li>
<li>OPTIONS 选项说明</li>
<li>EXAMPLES 示例</li>
<li>FILES 相关文件</li>
<li>AUTHOR 作者</li>
<li>COPYRIGHT 版本信息</li>
<li>REPORTING BUGS bug 信息</li>
<li>从 SEE ALSO 其它帮助参考</li>
</ul>
<h3 id="man-命令的操作方法"><a href="#man-命令的操作方法" class="headerlink" title="man 命令的操作方法"></a>man 命令的操作方法</h3><ul>
<li>space 下一页</li>
<li>b 上一页</li>
<li>1G 回到首部</li>
<li>G 翻至文件尾部</li>
<li>&#x2F;keyword 搜索关键字, 使用 n 和 N 上下查找</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/13/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/15/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
