<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="LJKのBlog">
<meta property="og:url" content="http://blog.lujinkai.cn/page/5/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="像方便面一样的男子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LJKのBlog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/redux/1.%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/redux/1.%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">Redux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 22:48:37" itemprop="dateCreated datePublished" datetime="2022-01-25T22:48:37+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:22" itemprop="dateModified" datetime="2023-05-29T16:58:22+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/redux/" itemprop="url" rel="index"><span itemprop="name">redux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Redux-是什么？"><a href="#Redux-是什么？" class="headerlink" title="Redux 是什么？"></a>Redux 是什么？</h2><p><strong>Redux 是一个使用叫做“action”的事件来管理和更新应用状态的模式和工具库</strong> 它以集中式 Store（centralized store）的方式对整个应用中使用的状态进行集中管理，其规则确保状态只能以可预测的方式更新。</p>
<h2 id="Redux-库和工具"><a href="#Redux-库和工具" class="headerlink" title="Redux 库和工具"></a>Redux 库和工具</h2><p>Redux 是一个小型的独立 JS 库。 但是，它通常与其他几个包一起使用：</p>
<h3 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux</h3><p>Redux 可以集成到任何的 UI 框架中，其中最常见的是 React 。<a target="_blank" rel="noopener" href="https://react-redux.js.org/"><strong>React-Redux</strong></a> 是 Redux 官方维护的。</p>
<h3 id="Redux-Toolkit"><a href="#Redux-Toolkit" class="headerlink" title="Redux Toolkit"></a>Redux Toolkit</h3><p><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/"><strong>Redux Toolkit</strong></a> 是官方推荐的编写 Redux 逻辑的方法。</p>
<h3 id="Redux-DevTools-扩展"><a href="#Redux-DevTools-扩展" class="headerlink" title="Redux DevTools 扩展"></a>Redux DevTools 扩展</h3><p><a target="_blank" rel="noopener" href="https://github.com/zalmoxisus/redux-devtools-extension"><strong>Redux DevTools 扩展</strong></a> 可以显示 Redux 存储中状态随时间变化的历史记录。这允许你有效地调试应用程序，包括使用强大的技术，如“时间旅行调试”。</p>
<h2 id="单向数据流-one-way-data-flow"><a href="#单向数据流-one-way-data-flow" class="headerlink" title="单向数据流( one-way data flow )"></a>单向数据流( <strong>one-way data flow</strong> )</h2><img data-src="//img.to2b.cn/blog/ljk/1634971418586.png" style="zoom:50%;" />

<p>基于 state 渲染 view，当发生某些 action（例如用户单击按钮）时，生成新的 state，基于新的 state 再重新渲染 view，这就是单向数据流。</p>
<p>然而，当我们有<strong>多个组件需要共享和使用相同 state</strong>时，可能会变得很复杂，尤其是当这些组件位于应用程序的不同部分时。</p>
<p>解决这个问题的一种方法是从组件中提取共享 state，并将其放入组件树之外的一个集中位置。这样，我们的组件树就变成了一个大“view”，任何组件都可以访问 state 或触发 action，无论它们在树中的哪个位置！</p>
<h2 id="不可变性"><a href="#不可变性" class="headerlink" title="不可变性"></a>不可变性</h2><p>“Mutable” 意为 “可改变的”，而 “immutable” 意为永不可改变。</p>
<p>JavaScript 的对象（object）和数组（array）默认都是 mutable 的。</p>
<p><strong>如果想要不可变的方式来更新，代码必需先 <em>复制</em> 原来的 object&#x2F;array，然后更新它的复制体</strong>。</p>
<p>展开运算符（spread operator）可以实现这个目的。</p>
<p><strong>Redux 期望所有状态更新都是使用不可变的方式</strong>。</p>
<h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><p><strong>action</strong> 是一个具有 <code>type</code> 字段的普通 JavaScript 对象。<strong>你可以将 action 视为描述应用程序中发生了什么的事件</strong>.</p>
<h3 id="action-creator"><a href="#action-creator" class="headerlink" title="action creator"></a>action creator</h3><p><strong>action creator</strong> 是一个创建并返回一个 action 对象的函数。它的作用是让你不必每次都手动编写 action 对象：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
		<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"todos/todoAdded"</span><span class="token punctuation">,</span>
		<span class="token literal-property property">payload</span><span class="token operator">:</span> text<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><p><strong>reducer</strong> 是一个函数，接收当前的 <code>state</code> 和一个 <code>action</code> 对象，必要时决定如何更新状态，并返回新状态。函数签名是：<code>(state, action) =&gt; newState</code>。 <strong>你可以将 reducer 视为一个事件监听器，它根据接收到的 action（事件）类型处理事件。</strong></p>
<p>reducer 必须符合一下规则：</p>
<ul>
<li>仅使用 <code>state</code> 和 <code>action</code> 参数计算新的状态值</li>
<li>禁止直接修改 <code>state</code>。必须通过复制现有的 <code>state</code> 并对复制的值进行更改的方式来做 _不可变更新（immutable updates）_。</li>
<li>禁止任何异步逻辑、依赖随机值或导致其他“副作用”的代码</li>
</ul>
<p>reducer 函数内部的逻辑通常遵循以下步骤：</p>
<ul>
<li>检查 reducer 是否关心这个 action<ul>
<li>如果是，则复制 state，使用新值更新 state 副本，然后返回新 state</li>
</ul>
</li>
<li>否则，返回原来的 state 不变</li>
</ul>
<p><strong>Redux 中 <em>真正</em> 重要的是 reducer 函数，以及其中计算新状态的逻辑。</strong></p>
<h3 id="store"><a href="#store" class="headerlink" title="store"></a>store</h3><p>当前 Redux 应用的状态存在于一个名为 <strong>store</strong> 的对象中。</p>
<p><code>store</code> 是通过传入一个 <code>reducer</code> 来创建的，并且有一个名为 <code>getState</code> 的方法，它返回当前<code>state</code>。</p>
<h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p>Redux store 有一个方法叫 <code>dispatch</code>。<strong>更新 state 的唯一方法是调用 <code>store.dispatch()</code> 并传入一个 action 对象</strong>。 store 将执行所有 reducer 函数并计算出更新后的 state，调用 <code>getState()</code> 可以获取新 state。</p>
<p>**dispatch 一个 action 可以形象的理解为 “触发一个事件”**。发生了一些事情，我们希望 store 知道这件事。 Reducer 就像事件监听器一样，当它们收到关注的 action 后，它就会更新 state 作为响应。</p>
<h3 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h3><p>随着应用变得越来越大，会遇到应用程序的不同部分需要读取相同的数据，selector 函数可以从 store 状态树中提取指定的片段。</p>
<h2 id="redux-数据流"><a href="#redux-数据流" class="headerlink" title="redux 数据流"></a>redux 数据流</h2><p>早些时候，我们谈到了“单向数据流”，它描述了更新应用程序的以下步骤序列：</p>
<ul>
<li>State 描述了应用程序在特定时间点的状况</li>
<li>基于 state 来渲染 UI</li>
<li>当发生某些事情时（例如用户单击按钮），state 会根据发生的事情进行更新</li>
<li>基于新的 state 重新渲染 UI</li>
</ul>
<p>具体来说，对于 Redux，我们可以将这些步骤分解为更详细的内容：</p>
<ul>
<li>初始启动：<ul>
<li>使用最顶层的 root reducer 函数创建 Redux store</li>
<li>store 调用一次 root reducer，并将返回值保存为它的初始 <code>state</code></li>
<li>当 UI 首次渲染时，UI 组件访问 Redux store 的当前 state，并使用该数据来决定要呈现的内容。同时监听 store 的更新，以便他们可以知道 state 是否已更改。</li>
</ul>
</li>
<li>更新环节：<ul>
<li>应用程序中发生了某些事情，例如用户单击按钮</li>
<li>dispatch 一个 action 到 Redux store，例如 <code>dispatch(&#123;type: &#39;counter/increment&#39;&#125;)</code></li>
<li>store 用之前的 <code>state</code> 和当前的 <code>action</code> 再次运行 reducer 函数，并将返回值保存为新的 <code>state</code></li>
<li>store 通知所有订阅过的 UI，通知它们 store 发生更新</li>
<li>每个订阅过 store 数据的 UI 组件都会检查它们需要的 state 部分是否被更新。</li>
<li>发现数据被更新的每个组件都强制使用新数据重新渲染，紧接着更新网页</li>
</ul>
</li>
</ul>
<p>动画的方式来表达数据流更新：</p>
<img data-src="//img.to2b.cn/blog/ljk/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif" style="zoom:50%;" />

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><strong>Redux 是一个管理全局应用状态的库</strong><ul>
<li>Redux 通常与 React-Redux 库一起使用，把 Redux 和 React 集成在一起</li>
<li>Redux Toolkit 是编写 Redux 逻辑的推荐方式</li>
</ul>
</li>
<li><strong>Redux 使用 “单向数据流”</strong><ul>
<li>State 描述了应用程序在某个时间点的状态，UI 基于该状态渲染</li>
<li>当应用程序中发生某些事情时：<ul>
<li>UI dispatch 一个 action</li>
<li>store 调用 reducer，随后根据发生的事情来更新 state</li>
<li>store 通知 UI state 发生了变化</li>
</ul>
</li>
<li>UI 基于新 state 重新渲染</li>
</ul>
</li>
<li><strong>Redux 有这几种类型的代码</strong><ul>
<li><em>Action</em> 是有 <code>type</code> 字段的<strong>纯对象</strong>，描述发生了什么</li>
<li><em>Reducer</em> 是纯函数，基于先前的 state 和 action 来计算新的 state</li>
<li>每当 dispatch 一个 action 后，<em>store</em> 就会调用 root reducer</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/react-router/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/react-router/" class="post-title-link" itemprop="url">react-router</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 22:48:27" itemprop="dateCreated datePublished" datetime="2022-01-25T22:48:27+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>大型应用中，适合将路由分布在多个<Routes>元素中，这样可以更轻松的进行代码分拆。但是在较小的应用程序中，或者具有密切相关的嵌套组件，则适合将所有路由集中放在一个<Routes>中，这样可以在一个地方查看所有路由，代码可读性更强。</p>
<h2 id="集中路由"><a href="#集中路由" class="headerlink" title="集中路由"></a>集中路由</h2><h2 id="分散路由"><a href="#分散路由" class="headerlink" title="分散路由"></a>分散路由</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/react-query/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/react-query/" class="post-title-link" itemprop="url">react-query</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 22:48:12" itemprop="dateCreated datePublished" datetime="2022-01-25T22:48:12+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>官网：<a target="_blank" rel="noopener" href="https://tanstack.com/query/latest/docs/react/overview">https://tanstack.com/query/latest/docs/react/overview</a></p>
<p>刷新缓存：使用refetch或者使缓存失效，如果是全部查询则使用前者，如果是分页查询则使用后者。</p>
<p><code>staleTime</code> 和 <code>cacheTime</code>：</p>
<ul>
<li><p><code>staleTime</code>：可以理解为数据保质期，在保质期内遇到同 key 的请求，不会去再次获取数据，而是从缓存中获取。</p>
<p><code>staleTime</code> 默认 0</p>
</li>
<li><p><code>cacheTime</code> ：数据在内存中的缓存时间，当数据在缓存期时，会按照 key 进行存储，下次遇到同 key 获取数据，会直接从缓存中取，瞬间展示，但是否后台请求新数据，要看 staleTime 的配置，当不配置 staleTime 时，遇到同 key 获取数据，虽然瞬间切换至缓存数据展示，但此时后台获取新数据，待获取完毕后瞬间切换为新数据。</p>
<p><code>cacheTime</code> 默认5分钟</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21567385/article/details/114171438">https://blog.csdn.net/qq_21567385/article/details/114171438</a></p>
<p><code>isLoading</code>和<code>isFetching</code>：</p>
<ul>
<li><code>isLoading</code>：</li>
<li><code>isFetching</code>：</li>
</ul>
<p><code>isLoading</code> 是在 “硬” 加载时才会为 <code>true</code>，<code>isFetching</code> 是在每次请求时为 <code>true</code>，那么 <code>isFetching</code> 我们能通俗易懂的理解，就是每次请求时当做 loading 嘛。</p>
<p>那什么是 <code>isLoading</code> 的 “硬” 加载？其实 “硬” 加载就是没有缓存时的加载，那么缓存是什么？ </p>
<h2 id="Query-Invalidation（查询失效）"><a href="#Query-Invalidation（查询失效）" class="headerlink" title="Query Invalidation（查询失效）"></a>Query Invalidation（查询失效）</h2><p><code>QueryClient</code> 的 <code>invalidateQueries</code> 方法主动让查询（query）失效。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 让缓存中的所有查询失效</span>
queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 使用'todos'开头的键的查询都失效</span>
queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p>当使用<code>invalidateQueries</code>让一个查询失效时，会发生两件事：</p>
<ul>
<li>查询被标记为过期（stale），过期状态会覆盖<code>staleTime</code>配置。</li>
<li>发起重新请求（refetch），如果当前页面正渲染查询的数据，也会重新请求。</li>
</ul>
<h3 id="查询匹配"><a href="#查询匹配" class="headerlink" title="查询匹配"></a>查询匹配</h3><p>使用<code>invalidateQueries</code>和<code>removeQueries</code>这些API（支持查询配置的都可以），支持精确匹配，也可以通过前缀匹配多个查询。</p>
<p>关于过滤器的类型，参考<a target="_blank" rel="noopener" href="https://tanstack.com/query/latest/docs/react/guides/filters#query-filters">Query Filters</a>.</p>
<p>下面示例中，使用<code>todos</code>前缀使查询键中以<code>todos</code>开头的所有查询失效：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useQuery<span class="token punctuation">,</span> useQueryClient <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query'</span>

<span class="token comment">// Get QueryClient from the context</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token function">useQueryClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// Both queries below will be invalidated</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> page<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p>传递具体的query key：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript">queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 不会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p><code>invalidateQueries</code> API是非常灵活的，如果只想让<code>todos</code>查询失效，而不影响更多的子键，可以通过设置<code>exact: true</code>实现：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript">queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  exact<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>				<span class="token comment">// 精确匹配，不会扩大范围</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 不会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'done'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p>如果要更精细的颗粒度，可以传入函数：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript">queryClient<span class="token punctuation">.</span><span class="token function">invalidateQueries</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  <span class="token function-variable function">predicate</span><span class="token operator">:</span> <span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=></span>
    query<span class="token punctuation">.</span>queryKey<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'todos'</span> <span class="token operator">&amp;&amp;</span> query<span class="token punctuation">.</span>queryKey<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">?.</span>version <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">,</span>		<span class="token comment">// version >= 10 返回true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> version<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> version<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token comment">// 不会失效</span>
<span class="token keyword">const</span> todoListQuery <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  queryKey<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> version<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  queryFn<span class="token operator">:</span> fetchTodoList<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/%E8%B7%A8%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/%E8%B7%A8%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">跨组件状态管理总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 22:47:34" itemprop="dateCreated datePublished" datetime="2022-01-25T22:47:34+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="小场面"><a href="#小场面" class="headerlink" title="小场面"></a>小场面</h2><h3 id="状态提升"><a href="#状态提升" class="headerlink" title="状态提升"></a><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/lifting-state-up.html">状态提升</a></h3><p>兄弟组件之间传值（共享状态），需要状态提升，示例：</p>
<p>Ceshi3 和 Ceshi4 之间需要共享 value 值，所以将 value 值提升到他俩的公共父组件 Ceshi2 中：</p>
<p>Ceshi2：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> Ceshi3 <span class="token keyword">from</span> <span class="token string">"./ceshi3"</span>
<span class="token keyword">import</span> Ceshi4 <span class="token keyword">from</span> <span class="token string">"./ceshi4"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span>

<span class="token keyword">const</span> <span class="token function-variable function">Ceshi2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token comment">// 状态提升</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>div<span class="token operator">></span>
			<span class="token operator">&lt;</span>Ceshi3 value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> setValue<span class="token operator">=</span><span class="token punctuation">&#123;</span>setValue<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
			<span class="token operator">&lt;</span>Ceshi4 value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> setValue<span class="token operator">=</span><span class="token punctuation">&#123;</span>setValue<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi2</code></pre>

<p>Ceshi3：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"antd"</span>

<span class="token keyword">type</span> <span class="token class-name">InputType</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	value<span class="token operator">:</span> <span class="token builtin">string</span>
	<span class="token function-variable function">setValue</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Ceshi3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> value<span class="token punctuation">,</span> setValue <span class="token punctuation">&#125;</span><span class="token operator">:</span> InputType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>e <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi3</code></pre>

<p>Ceshi4：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"antd"</span>

<span class="token keyword">type</span> <span class="token class-name">InputType</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	value<span class="token operator">:</span> <span class="token builtin">string</span>
	<span class="token function-variable function">setValue</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">Ceshi4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> value<span class="token punctuation">,</span> setValue <span class="token punctuation">&#125;</span><span class="token operator">:</span> InputType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>e <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi4</code></pre>

<h3 id="组合组件"><a href="#组合组件" class="headerlink" title="组合组件"></a>组合组件</h3><p>对于上面<strong>状态提升</strong>的示例，只是将需要共享的数据进行提升，可以将组件进行提升，也就是组合组件：</p>
<p>Ceshi2：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> Ceshi3 <span class="token keyword">from</span> <span class="token string">"./ceshi3"</span>
<span class="token keyword">import</span> Ceshi4 <span class="token keyword">from</span> <span class="token string">"./ceshi4"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Input <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"antd"</span>

<span class="token keyword">const</span> <span class="token function-variable function">Ceshi2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token comment">// 状态提升</span>
	<span class="token keyword">const</span> InputCeshi <span class="token operator">=</span> <span class="token operator">&lt;</span>Input value<span class="token operator">=</span><span class="token punctuation">&#123;</span>value<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>e <span class="token operator">=></span> <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span>div<span class="token operator">></span>
			<span class="token operator">&lt;</span>Ceshi3 input<span class="token operator">=</span><span class="token punctuation">&#123;</span>InputCeshi<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
			<span class="token operator">&lt;</span>Ceshi4 input<span class="token operator">=</span><span class="token punctuation">&#123;</span>InputCeshi<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
	<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi2</code></pre>

<p>Ceshi3：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">Ceshi3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">&#123;</span> input<span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> props<span class="token punctuation">.</span>input
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi3</code></pre>

<p>Ceshi4：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">Ceshi4</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> input <span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> input<span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> input
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Ceshi4</code></pre>

<h2 id="缓存状态"><a href="#缓存状态" class="headerlink" title="缓存状态"></a>缓存状态</h2><h3 id="react-query"><a href="#react-query" class="headerlink" title="react-query"></a><a target="_blank" rel="noopener" href="https://react-query.tanstack.com/overview">react-query</a></h3><h3 id="swr"><a href="#swr" class="headerlink" title="swr"></a>swr</h3><h2 id="客户端状态"><a href="#客户端状态" class="headerlink" title="客户端状态"></a>客户端状态</h2><h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/context.html">Context</a></h3><p>react 框架原生提供</p>
<p>示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"></code></pre>

<h3 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a><a target="_blank" rel="noopener" href="http://cn.redux.js.org/">Redux</a></h3><p>第三方，最经典的，如果是大型应用，需要比较复杂的状态管理，推荐使用。</p>
<p>需要维护 一个全局状态树。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/C/%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C/%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-24 14:44:59" itemprop="dateCreated datePublished" datetime="2021-09-24T14:44:59+08:00">2021-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="变量与常量"><a href="#变量与常量" class="headerlink" title="变量与常量"></a>变量与常量</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>		<span class="token comment">// 变量，可以再赋值</span></code></pre>

<p>C 语言的常量可以分为<strong>直接常量</strong>和<strong>符号常量</strong>，符号常量一般习惯使用大写字母：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">const</span> <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span>		<span class="token comment">// 直接常量</span></code></pre>

<h3 id="宏定义-define"><a href="#宏定义-define" class="headerlink" title="宏定义 define"></a>宏定义 define</h3><p>示例：</p>
<pre class="language-C" data-language="C"><code class="language-C">#define	PI 3.14</code></pre>

<h4 id="define-和-const-的区别"><a href="#define-和-const-的区别" class="headerlink" title="define 和 const 的区别"></a>define 和 const 的区别</h4><ul>
<li><p>define 是宏定义，程序在预处理阶段将用 define 定义的内容进行了 <strong>替换</strong> 。因此在程序运行时，常量表中并没有用 define 定义的常量，系统不为它分配内存。</p>
<p>而 const 定义的常量，在程序运行时，存在常量表中，且系统为它分配内存。</p>
</li>
<li><p>define 定义的常量，预处理时只是直接进行了替换，因此在编译时不能进行数据类型检验。</p>
<p>而 const 定义的常量，在编译时进行严格的类型检验，可以避免出错。</p>
</li>
<li><p>define 定义表达式时要注意<strong>“边缘效应”</strong>，例如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span></span></span>
<span class="token keyword">float</span> a <span class="token operator">=</span> N<span class="token operator">/</span><span class="token number">2.0</span><span class="token punctuation">;</span>
<span class="token comment">/*
按照常规做法，可能会认为结果是3/2 = 1.5
但是实际上，结果应该为1+2/2.0 = 2.0

若想要实现3/2，则#define N (1+2)
即为避免边缘效应，一定要加！括！号！
*/</span></code></pre></li>
</ul>
<h4 id="用-define-定义函数"><a href="#用-define-定义函数" class="headerlink" title="用 define 定义函数"></a>用 define 定义函数</h4><p>示例：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LEN</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token function">LEN</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1652494372866.png"></p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652494451002.png"></p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652494510384.png"></p>
<p><font color=red>注：int、short int、long int 是根据编译环境的不同，所取范围不同。而其中 short int 和 long int 至少是表中所写范围，但是 int 在表中是以 16 位编译环境写的取值范围。另外 c 语言 int 的取值范围在于他占用的字节数 ，不同的编译器，规定是不一样。ANSI 标准定义 int 是占 2 个字节，TC 是按 ANSI 标准的，它的 int 是占 2 个字节的。但是在 VC 里，一个 int 是占 4 个字节的。</font></p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652494597559.png"></p>
<ul>
<li>整型<ul>
<li>short：两个字节，16 位，2^16</li>
<li>unsigned short：第一位是符号位，-2^15 - 2^15</li>
<li>int：4 个字节，32 位，2^32</li>
<li>long：8 个字节，64 位</li>
</ul>
</li>
<li>浮点<ul>
<li>float</li>
<li>double：这个一般不用</li>
</ul>
</li>
<li>字符<ul>
<li>char：c++有 string 类型，c 没有 string 类型，c 中表示字符串可以使用字符数组或者字符字符指针。</li>
</ul>
</li>
<li>void：对类型不关心，不敏感</li>
</ul>
<h3 id="格式化输出-printf"><a href="#格式化输出-printf" class="headerlink" title="格式化输出 printf"></a>格式化输出 printf</h3><img data-src="//img.to2b.cn/blog/lujinkai/1652351459757.png" style="zoom:150%;" />

<ul>
<li>%d：带符号十进制整数</li>
<li>%c：单个字符</li>
<li>%s：字符串</li>
<li>%f：6 位小数</li>
</ul>
<h3 id="自动类型转换"><a href="#自动类型转换" class="headerlink" title="自动类型转换"></a>自动类型转换</h3><p>自动转换发生在不同数据类型运算时，<strong>在编译的时候自动完成</strong>。自动转换遵循的规则就好比小盒子可以放进大盒子里面一样，下图表示了类型自动转换的规则。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652767179744.png"></p>
<p>char 类型数据转换为 int 类型数据遵循 ASCII 码中的对应值，ASCII 参考：<a target="_blank" rel="noopener" href="http://c.biancheng.net/c/ascii/">http://c.biancheng.net/c/ascii/</a></p>
<p><font color=red>注：字节小的可以向字节大的自动转换，但字节大的不能向字节小的自动转换</font></p>
<h3 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h3><p>强制类型转换是通过定义类型转换运算来实现的。其一般形式为：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token punctuation">(</span>数据类型<span class="token punctuation">)</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span></code></pre>

<p>其作用是把表达式的运算结果强制转换成类型说明符所表示的类型，例如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">float</span> a <span class="token operator">=</span> <span class="token number">6.77</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 6</span></code></pre>

<p>转换为 go：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> a <span class="token builtin">float32</span> <span class="token operator">=</span> <span class="token number">6.77</span>
	<span class="token keyword">var</span> b <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 6</span></code></pre>

<ol>
<li>转换后不会改变原数据的类型及变量值，只在本次运算中<strong>临时性转换</strong>。</li>
<li>强制转换后的运算结果<strong>不遵循四舍五入原则</strong>。</li>
</ol>
<h3 id="C-语言关键字"><a href="#C-语言关键字" class="headerlink" title="C 语言关键字"></a>C 语言关键字</h3><p>32 个：</p>
<ul>
<li>auto：声明自动变量</li>
<li>short：声明短整型变量或函数</li>
<li>int：声明整型变量或函数</li>
<li>long ：声明长整型变量或函数</li>
<li>float：声明浮点型变量或函数</li>
<li>double：声明双精度变量或函数</li>
<li>char：声明字符型变量或函数</li>
<li>struct：声明结构体变量或函数</li>
<li>union：声明共用数据类型</li>
<li>enum：声明枚举类型</li>
<li>typedef：用以给数据类型取别名</li>
<li>const：声明只读变量</li>
<li>unsigned：声明无符号类型变量或函数</li>
<li>signed：声明有符号类型变量或函数</li>
<li>extern：声明变量是在其他文件正声明</li>
<li>register：声明寄存器变量</li>
<li>static：声明静态变量</li>
<li>volatile：说明变量在程序执行中可被隐含地改变</li>
<li>void：声明函数无返回值或无参数，声明无类型指针</li>
<li>if：条件语句</li>
<li>else：条件语句否定分支（与 if 连用）</li>
<li>switch：用于开关语句 　　 case：开关语句分支</li>
<li>for：一种循环语句</li>
<li>do：循环语句的循环体</li>
<li>while：循环语句的循环条件</li>
<li>goto：无条件跳转语句</li>
<li>continue：结束当前循环，开始下一轮循环</li>
<li>break：跳出当前循环</li>
<li>default：开关语句中的“其他”分支</li>
<li>sizeof：计算数据类型长度</li>
<li>return：子程序返回语句（可以带参数，也可不带参数）循环条件</li>
</ul>
<p>1999 年 12 月 16 日，ISO 推出了 C99 标准，该标准新增了 5 个 C 语言关键字：</p>
<ul>
<li>inline</li>
<li>restrict</li>
<li>_Bool</li>
<li>_Complex</li>
<li>_Imaginary</li>
</ul>
<p>2011 年 12 月 8 日，ISO 发布 C 语言的新标准 C11，该标准新增了 7 个 C 语言关键字：</p>
<ul>
<li>_Alignas</li>
<li>_Alignof</li>
<li>_Atomic</li>
<li>_Static_assert</li>
<li>_Noreturn</li>
<li>_Thread_local</li>
<li>_Generic</li>
</ul>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><ul>
<li>算术运算符</li>
<li>赋值运算符</li>
<li>关系运算符</li>
<li>逻辑运算符</li>
<li>三目运算符</li>
</ul>
<h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1652768181204.png"></p>
<p>除法运算中注意：</p>
<p>如果相除的<strong>两个数都是整数</strong>的话，则<strong>结果也为整数</strong>，小数部分省略，如 8&#x2F;3 &#x3D; 2；而两数中<strong>有一个为小数</strong>，<strong>结果则为小数</strong>，如：9.0&#x2F;2 &#x3D; 4.500000。</p>
<p>取余运算中注意：</p>
<p>该运算<strong>只适合用两个整数</strong>进行取余运算，如：10%3 &#x3D; 1；而 10.0%3 则是错误的；运算后的符号取决于被模数的符号，如(-10)%3 &#x3D; -1;而 10%(-3) &#x3D; 1。</p>
<p><font color=red>注：C 语言中没有乘方这个运算符，也不能用 ×，÷ 等算术符号。</font></p>
<h4 id="自增与自减运算符"><a href="#自增与自减运算符" class="headerlink" title="自增与自减运算符"></a>自增与自减运算符</h4><p>自增运算符为“++”，其功能是使变量的值自增 1；自减运算符为“–”，其功能是使变量值自减 1。它们经常使用在循环中。自增自减运算符有以下几种形式：</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652768486640.png"></p>
<p>注意：无论是 a++还是++a 都等同于 a&#x3D;a+1,在表达式执行完毕后 a 的值都自增了 1,无论是 a–还是–a 都等同于 a&#x3D;a-1,在表达式执行完毕后 a 的值都自减少 1。</p>
<h3 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h3><p>C 语言中赋值运算符分为<strong>简单赋值运算符</strong>和<strong>复合赋值运算符</strong>，之前我们已经接触过简单赋值运算符“&#x3D;”号了，下面讲一下复合赋值运算符：</p>
<p>复合赋值运算符就是在简单赋值符“&#x3D;”之前加上其它运算符构成，例如+&#x3D;、-&#x3D;、*&#x3D;、&#x2F;&#x3D;、%&#x3D;。</p>
<h3 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1652768998141.png"></p>
<p>关系表达式的值是“真”和“假”，在 C 程序用整数 1 和 0 表示。</p>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>在数学中我们见过 7&lt;x&lt;100 这样的公式，意思是 x 大于 7 并且 x 小于 100。</p>
<p>在程序中这样写一个变量的范围值是不行的，计算机是看不懂这样的算式的，那么怎样让计算机看懂呢？这里就要用到逻辑运算符了。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652769080731.png"></p>
<p>逻辑运算的值也是有两种分别为“真”和“假”，C 语言中用整型的 1 和 0 来表示。其求值规则如下：</p>
<ol>
<li><p>与运算(&amp;&amp;)</p>
<p>参与运算的<strong>两个变量都为真</strong>时，<strong>结果才为真</strong>，否则为假。例如：5&gt;&#x3D;5 &amp;&amp; 7&gt;5 ，运算结果为真；</p>
</li>
<li><p>或运算(||)</p>
<p>参与运算的两个变量<strong>只要有一个为真</strong>，<strong>结果就为真</strong>。 两个量都为假时，结果为假。例如：5&gt;&#x3D;5||5&gt;8，运算结果为真；</p>
</li>
<li><p>非运算(!)</p>
<p>参与运算的变量<strong>为真时</strong>，结果<strong>为假</strong>；参与运算量<strong>为假时</strong>，结果<strong>为真</strong>。例如：!(5&gt;8)，运算结果为真。</p>
</li>
</ol>
<h3 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h3><pre class="language-c" data-language="c"><code class="language-c">表达式<span class="token number">1</span> <span class="token operator">?</span> 表达式<span class="token number">2</span> <span class="token operator">:</span> 表达式<span class="token number">3</span>；</code></pre>

<h3 id="运算符-优先级"><a href="#运算符-优先级" class="headerlink" title="运算符 优先级"></a>运算符 优先级</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1652770332275.png"></p>
<p>没必要去死记运算符的优先级顺序，记住最高优先级是()就可以了。</p>
<h2 id="结构语句"><a href="#结构语句" class="headerlink" title="结构语句"></a>结构语句</h2><h3 id="分支结构-if-x2F-if-else"><a href="#分支结构-if-x2F-if-else" class="headerlink" title="分支结构 if &#x2F; if-else"></a>分支结构 if &#x2F; if-else</h3><h4 id="简单-if"><a href="#简单-if" class="headerlink" title="简单 if"></a>简单 if</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="简单-if-else-语句"><a href="#简单-if-else-语句" class="headerlink" title="简单 if-else 语句"></a>简单 if-else 语句</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="多重-if-else-语句"><a href="#多重-if-else-语句" class="headerlink" title="多重 if-else 语句"></a>多重 if-else 语句</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>表达式<span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>表达式<span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="循环结构-while-x2F-do-while"><a href="#循环结构-while-x2F-do-while" class="headerlink" title="循环结构 while &#x2F; do-while"></a>循环结构 while &#x2F; do-while</h3><h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>使用 while 语句应注意以下几点：</p>
<ol>
<li>while 语句中的<strong>表达式一般是关系表达或逻辑表达式</strong>，当表达式的值为假时不执行循环体，反之则循环体一直执行。</li>
<li>一定要记着<strong>在循环体中改变循环变量的值</strong>，否则会出现死循环（无休止的执行）。</li>
<li>循环体如果包括有一个以上的语句，则<strong>必须用{}括起来</strong>，组成复合语句。</li>
</ol>
<h4 id="do-while"><a href="#do-while" class="headerlink" title="do-while"></a>do-while</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">do</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span></code></pre>

<p>do-while 循环语句的语义是：它先执行循环中的执行代码块，然后再判断 while 中表达式是否为真，如果为真则继续循环；如果为假，则终止循环。因此，<strong>do-while 循环至少要执行一次循环语句</strong>。</p>
<h3 id="循环结构-for"><a href="#循环结构-for" class="headerlink" title="循环结构 for"></a>循环结构 for</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span>表达式<span class="token number">1</span><span class="token punctuation">;</span> 表达式<span class="token number">2</span><span class="token punctuation">;</span> 表达式<span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    执行代码块<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>在 for 循环中，<strong>表达式 1</strong>是一个或多个<strong>赋值语句</strong>，它用来<strong>控制变量的初始值</strong>；<strong>表达式 2</strong>是一个<strong>关系表达式</strong>，它决定什么时候退出循环；<strong>表达式 3</strong>是循环变量的<strong>步进值</strong>，定义控制循环变量每循环一次后按什么方式变化。这<strong>三部分之间用分号(;)分开</strong>。</p>
<p>使用 for 语句应该<strong>注意</strong>：</p>
<ol>
<li><p>for 循环中的“表达式 1、2、3”均可可以缺省，但<strong>分号(;)不能缺省</strong>。</p>
</li>
<li><p>省略“表达式 1（循环变量赋初值）”，<strong>表示不对循环变量赋初始值</strong>。如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第%d遍书写: computer\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>省略“表达式 2(循环条件)”，不做其它处理，<strong>循环一直执行（死循环）</strong>。如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第%d遍书写: computer\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>省略“表达式 3(循环变量增量)”，不做其他处理，<strong>循环一直执行（死循环）</strong>。如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token punctuation">)</span>	<span class="token comment">// 省略循环变量的步进值</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第%d遍书写: computer\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><strong>注：死循环可以使用后面即将讲到的 break 解决</strong></p>
</li>
<li><p>表达式 1 可以是设置循环变量的初值的赋值表达式，<strong>也可以是其他表达式</strong>。如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> sum<span class="token punctuation">,</span> num<span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// 循环变量初始值可以换成其他表达式</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> num<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> num<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    sum <span class="token operator">+=</span> num<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>表达式 1 和表达式 3 可以是一个简单表达式<strong>也可以是多个表达式以逗号分割</strong>。如：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> num <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> num<span class="token operator">++</span><span class="token punctuation">,</span> sum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    sum <span class="token operator">+=</span> num<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"num=%d,sum=%d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>表达式 2 一般是<strong>关系表达式或逻辑表达式</strong>，但<strong>也可是数值表达式或字符表达式</strong>，只要其<strong>值非零</strong>，就执行循环体。</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> sum<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> num<span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> sum<span class="token operator">&lt;=</span><span class="token number">5</span> <span class="token operator">&amp;&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span> num<span class="token operator">++</span><span class="token punctuation">,</span> sum<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    sum <span class="token operator">+=</span> num<span class="token punctuation">;</span>
  	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"num=%d,sum=%d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h3 id="循环中的-break-与-continue"><a href="#循环中的-break-与-continue" class="headerlink" title="循环中的 break 与 continue"></a>循环中的 break 与 continue</h3><p>break 用于结束循环，continue 用于跳过本次循环。</p>
<p>注：在多层循环中，一个<strong>break 语句只跳出当前循环</strong>。</p>
<h3 id="分支结构-switch"><a href="#分支结构-switch" class="headerlink" title="分支结构 switch"></a>分支结构 switch</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">switch</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> 常量表达式<span class="token number">1</span>：执行代码块<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">case</span> 常量表达式n：执行代码块n <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> 执行代码块n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>注意：</p>
<ul>
<li>在 case 子句后如果没有 break;会一直往后执行一直到遇到 break;才会跳出 switch 语句。</li>
<li>switch 后面的表达式语句只能是<strong>整型或者字符类型</strong>。</li>
<li>在 case 后，<strong>允许有多个语句</strong>，可以不用{}括起来。</li>
<li>各 case 和 default 子句的先后顺序可以变动，而不会影响程序执行结果。</li>
<li>default 子句可以省略不用。</li>
</ul>
<h3 id="goto-语句"><a href="#goto-语句" class="headerlink" title="goto 语句"></a>goto 语句</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">goto</span> 语句标号<span class="token punctuation">;</span></code></pre>

<p>语句标号是一个标识符，该标识符一般用英文大写并遵守标识符命名规则，这个标识符加上一个“:”一起出现在函数内某处，执行 goto 语句后，程序将跳转到该标号处并执行其后的语句。</p>
<p>示例：用 goto 语句和 if 语句构成循环求 10 以内的数之和。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1652774762658.png"></p>
<p>应用场景：深层循环嵌套，调到循环外面需要多个 break，但是仅仅使用一次 goto 语句就可以实现。</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token comment">// 伪代码</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#123;</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>disaster<span class="token punctuation">)</span>
              <span class="token punctuation">&#123;</span>
                   <span class="token keyword">goto</span> error<span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
error<span class="token operator">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>disaster<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>C 语言提供了大量的库函数，比如 stdio.h 提供输出函数，但是还是满足不了我们开发中的一些逻辑，所以这个时候需要自己定义函数，自定义函数的一般形式：</p>
<pre class="language-none"><code class="language-none">[数据类型] 函数名称([参数])
&#123;
	执行代码块;
	return (表达式);
&#125;</code></pre>

<p>注意：</p>
<ol>
<li><p>数据类型默认 int</p>
</li>
<li><p>自定义函数尽量放在 main 函数之前，如果要放在 main 函数之后的话，需要在 mian 函数之前声明自定义函数，声明格式为：</p>
<pre class="language-none"><code class="language-none">[数据类型] 函数名称([参数])</code></pre></li>
</ol>
<p>示例：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">sayLove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello word\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sayLove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">sayLove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i love u\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="内部函数与外部函数"><a href="#内部函数与外部函数" class="headerlink" title="内部函数与外部函数"></a>内部函数与外部函数</h3><p>在 C 语言中不能被其他源文件调用的函数称谓<strong>内部函数</strong> ，内部函数由 static 关键字来定义，因此又被称谓静态函数，形式为：</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token punctuation">[</span>returnType<span class="token punctuation">]</span> <span class="token function">funcName</span><span class="token punctuation">(</span><span class="token punctuation">[</span>params<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p>外部函数使用 <code>extern</code> 关键字修饰，可以省略。</p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>声明：</p>
<pre class="language-c" data-language="c"><code class="language-c">itemType arrayName<span class="token punctuation">[</span>length<span class="token punctuation">]</span></code></pre>

<p>初始化：</p>
<pre class="language-c" data-language="c"><code class="language-c">itemType arrayName<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>itemn<span class="token punctuation">&#125;</span>
itemType arrayName<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>itemn<span class="token punctuation">&#125;</span></code></pre>

<ul>
<li>数组的下标均以 0 开始；</li>
<li>数组在初始化的时候，数组内元素的个数不能大于声明的数组长度；</li>
<li>如果采用第一种初始化方式，元素个数小于数组的长度时，多余的数组元素初始化为 0；</li>
</ul>
<h3 id="数组的遍历"><a href="#数组的遍历" class="headerlink" title="数组的遍历"></a>数组的遍历</h3><p>只能使用 for 遍历，注意 c 语言没有提供计算数组长度的方法</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LEN</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token function">LEN</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="数组作为函数参数"><a href="#数组作为函数参数" class="headerlink" title="数组作为函数参数"></a>数组作为函数参数</h3><pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">LEN</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">tmp</span><span class="token punctuation">(</span><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> len<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token function">tmp</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token function">LEN</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>注意：</p>
<ul>
<li>形参可以指定长度，也可以不指定</li>
<li>数组作为参数传递，传递的是指针，所以：<ul>
<li>不能通过 sizeof 求长度</li>
<li>如果修改，是通过指针修改，会修改数组本身</li>
</ul>
</li>
</ul>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1656327800707.png"></p>
<h4 id="strlen"><a href="#strlen" class="headerlink" title="strlen"></a>strlen</h4><p>strlen()获取字符串的长度，在字符串长度中是不包括‘\0’而且汉字和字母的长度是不一样的。</p>
<h4 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp"></a>strcmp</h4><p>strcmp()在比较的时候会<strong>把字符串先转换成 ASCII 码</strong>再进行比较,返回的结果为<strong>0 表示 s1 和 s2 的 ASCII 码相等</strong>,返回结果为<strong>1 表示 s1 比 s2 的 ASCII 码大</strong>,返回结果为**-1 表示 s1 比 s2 的 ASCII 码小**。</p>
<h4 id="strcpy"><a href="#strcpy" class="headerlink" title="strcpy"></a>strcpy</h4><p>strcpy()拷贝之后会覆盖原来字符串且不能对字符串常量进行拷贝。</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// word</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="strcat"><a href="#strcat" class="headerlink" title="strcat"></a>strcat</h4><p>拼接字符串，strcat 在使用时 s1 与 s2 指的内存空间不能重叠，且 s1 要有足够的空间来容纳要复制的字符串。</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> s1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello "</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> s2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"word"</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> s<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">strcat</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// hello word</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/JavaScript/videojs/videojs%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/JavaScript/videojs/videojs%E6%96%87%E6%A1%A3/" class="post-title-link" itemprop="url">videojs文档</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-12 10:59:19" itemprop="dateCreated datePublished" datetime="2021-09-12T10:59:19+08:00">2021-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/JavaScript/videojs/" itemprop="url" rel="index"><span itemprop="name">videojs</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>官方文档：<a target="_blank" rel="noopener" href="https://docs.videojs.com/index.html">https://docs.videojs.com/index.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/%E5%9F%BA%E7%A1%80/PHP7%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/%E5%9F%BA%E7%A1%80/PHP7%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E4%B8%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">PHP7中的异常与错误处理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-08 22:52:17" itemprop="dateCreated datePublished" datetime="2021-09-08T22:52:17+08:00">2021-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="PHP-中的-Exception-Error-Throwable"><a href="#PHP-中的-Exception-Error-Throwable" class="headerlink" title="PHP 中的 Exception, Error, Throwable"></a>PHP 中的 Exception, Error, Throwable</h2><ul>
<li>PHP 中将代码自身异常(一般是环境或者语法非法所致)称作错误 <code>Error</code>，将运行中出现的逻辑错误称为异常 <code>Exception</code></li>
<li>错误是没法通过代码处理的，而异常则可以通过 <code>try/catch</code> 来处理</li>
<li>PHP7 中出现了 <code>Throwable</code> 接口，该接口由 <code>Error</code> 和 <code>Exception</code> 实现，用户不能直接实现 <code>Throwable</code> 接口，而只能通过继承 <code>Exception</code> 来实现接口</li>
</ul>
<h3 id="PHP7-异常处理机制"><a href="#PHP7-异常处理机制" class="headerlink" title="PHP7 异常处理机制"></a>PHP7 异常处理机制</h3><p>过去的 PHP，处理致命错误几乎是不可能的。致命错误不会调用由 <code>set_error_handler()</code> 设置的处理方式，而是简单的停止脚本的执行。</p>
<p>在 PHP7 中，当致命错误和可捕获的错误(<code>E_ERROR</code> 和 <code>E_RECOVERABLE_ERROR</code>)发生时会抛出异常，而不是直接停止脚本的运行。对于某些情况，比如内存溢出，致命错误则仍然像之前一样直接停止脚本执行。在 PHP7 中，一个未捕获的异常也会是一个致命错误。这意味着在 PHP5.x 中致命错误抛出的异常未捕获，在 PHP7 中也是致命错误。</p>
<blockquote>
<p>注意：其他级别的错误如 <code>warning</code> 和 <code>notice</code>，和之前一样不会抛出异常，只有 <code>fatal</code> 和 <code>recoverable</code> 级别的错误会抛出异常。</p>
</blockquote>
<p>从 <code>fatal</code> 和 <code>recoverable</code> 级别错误抛出的异常并非继承自 <code>Exception</code> 类。这种分离是为了防止现有 PHP5.x 的用于停止脚本运行的代码也捕获到错误抛出的异常。<code>fatal</code> 和 <code>recoverable</code> 级别的错误抛出的异常是一个全新分离出来的类 <code>Error</code> 类的实例。跟其他异常一样，<code>Error</code> 类异常也能被捕获和处理，同样允许在 <code>finally</code> 之类的块结构中运行。</p>
<h3 id="Throwable"><a href="#Throwable" class="headerlink" title="Throwable"></a>Throwable</h3><p>为了统一两个异常分支，<code>Exception</code> 和 <code>Error</code> 都实现了一个全新的接口：<code>Throwable</code></p>
<p>PHP7 中新的异常结构如下：</p>
<pre class="language-none"><code class="language-none">interface Throwable
    |- Exception implements Throwable
        |- ...
    |- Error implements Throwable
        |- TypeError extends Error
        |- ParseError extends Error
        |- ArithmeticError extends Error
            |- DivisionByZeroError extends ArithmeticError
        |- AssertionError extends Error</code></pre>

<p>如果在 PHP7 的代码中定义了 <code>Throwable</code> 类，它将会是如下这样：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">interface</span> <span class="token class-name-definition class-name">Throwable</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">array</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getTraceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getPrevious</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Throwable</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>这个接口看起来很熟悉。<code>Throwable</code> 规定的方法跟 <code>Exception</code> 几乎是一样的。唯一不同的是 <code>Throwable::getPrevious()</code> 返回的是 <code>Throwable</code> 的实例而不是 <code>Exception</code> 的。<code>Exception</code> 和 <code>Error</code> 的构造函数跟之前 <code>Exception</code> 一样，可以接受任何 <code>Throwable</code> 的实例。</p>
<p><code>Throwable</code> 可以用于 <code>try/catch</code>块中捕获 <code>Exception</code> 和 <code>Error</code> 对象(或是任何未来可能的异常类型)。记住捕获更多特定类型的异常并且对之做相应的处理是更好的实践。然而在某种情况下我们想捕获任何类型的异常(比如日志或框架中错误处理)。在 PHP7 中，要捕获所有的应该使用 <code>Throwable</code> 而不是 <code>Exception</code>。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token number">1</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token number">2</span> <span class="token comment">// Code that may throw an Exception or Error.</span>
<span class="token number">3</span> <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token number">4</span> <span class="token comment">// Handle exception</span>
<span class="token number">5</span> <span class="token punctuation">&#125;</span></code></pre>

<p>用户定义的类不能实现 <code>Throwable</code> 接口。做出这个决定一定程度上是为了预测性和一致性——只有 <code>Exception</code> 和 <code>Error</code> 的对象可以被抛出。此外，异常需要携带对象在追溯堆栈中创建位置的信息，而用户定义的对象不会自动的有参数来存储这些信息。</p>
<p><code>Throwable</code> 可以被继承从而创建特定的包接口或者添加额外的方法。一个继承自 <code>Throwable</code> 的接口只能被 <code>Exception</code> 或 <code>Error</code> 的子类来实现。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token number">1</span> <span class="token keyword">interface</span> <span class="token class-name-definition class-name">MyPackageThrowable</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token number">2</span>
<span class="token number">3</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">MyPackageException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token keyword">implements</span> <span class="token class-name">MyPackageThrowable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token number">4</span>
<span class="token number">5</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyPackageException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h3><p>事实上，PHP5.x 中所有的错误都是 <code>fatal</code> 或 <code>recoverable</code> 级别的错误，在 PHP7 中都能抛出一个 <code>Error</code>实例。跟其他任何异常一样，<code>Error</code> 对象可以使用 <code>try/catch</code> 块来捕获。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$var</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$var</span><span class="token operator">-></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Throws an Error object in PHP 7.</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Handle error</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>通常情况下，之前的致命错误都会抛出一个基本的 <code>Error</code> 类实例，但某些错误会抛出一个更具体的 <code>Error</code> 子类：<code>TypeError</code>、<code>ParseError</code> 以及 <code>AssertionError</code>。</p>
<h3 id="TypeError"><a href="#TypeError" class="headerlink" title="TypeError"></a>TypeError</h3><p>当函数参数或返回值不符合声明的类型时，<code>TypeError</code> 的实例会被抛出。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$left</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$right</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token keyword">return</span> <span class="token variable">$left</span> <span class="token operator">+</span> <span class="token variable">$right</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'left'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'right'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TypeError</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//Argument 1 passed to add() must be of the type integer, string given</span></code></pre>

<h3 id="ParseError"><a href="#ParseError" class="headerlink" title="ParseError"></a>ParseError</h3><p>当 <code>include/require</code> 文件或 <code>eval()</code> 代码存在语法错误时，<code>ParseError</code> 会被抛出。</p>
<pre class="language-none"><code class="language-none">1 try &#123;
2 require &#39;file-with-parse-error.php&#39;;
3 &#125; catch (ParseError $e) &#123;
4 echo $e-&gt;getMessage(), &quot;\n&quot;;
5 &#125;</code></pre>

<h3 id="ArithmeticError"><a href="#ArithmeticError" class="headerlink" title="ArithmeticError"></a>ArithmeticError</h3><p><code>ArithmeticError</code> 在两种情况下会被抛出。一是位移操作负数位。二是调用<code>intdiv()</code> 时分子是 <code>PHP_INT_MIN</code> 且分母是 -1 (这个使用除法运算符的表达式：<code>PHP_INT_MIN / -1</code>，结果是浮点型)。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token number">1</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token number">2</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">3</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArithmeticError</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token number">4</span> <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Bit shift by negative number</span>
<span class="token number">5</span> <span class="token punctuation">&#125;</span></code></pre>

<h3 id="DevisionByZeroError"><a href="#DevisionByZeroError" class="headerlink" title="DevisionByZeroError"></a>DevisionByZeroError</h3><p>当 <code>intdiv()</code> 的分母是 0 或者取模操作 (%) 中分母是 0 时，<code>DivisionByZeroError</code> 会被抛出。注意在除法运算符 (&#x2F;) 中使用 0 作除数（也即 xxx&#x2F;0 这样写）时只会触发一个 warning，这时候若分子非零结果是 INF，若分子是 0 结果是 NaN。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token number">1</span> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token number">2</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">%</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token number">3</span> <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DivisionByZeroError</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token number">4</span> <span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Modulo by zero</span>
<span class="token number">5</span> <span class="token punctuation">&#125;</span></code></pre>

<h3 id="AssertionError"><a href="#AssertionError" class="headerlink" title="AssertionError"></a>AssertionError</h3><p>当 <code>assert()</code> 的条件不满足时，<code>AssertionError</code> 会被抛出。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'zend.assertions'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-php" data-language="php"><code class="language-php"><span class="token number">1</span> <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'assert.exception'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2</span>
<span class="token number">3</span> <span class="token variable">$test</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">4</span>
<span class="token number">5</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$test</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">6</span>
<span class="token number">7</span> <span class="token comment">//Fatal error: Uncaught AssertionError: assert($test === 0)</span></code></pre>

<p>只有断言启用并且是设置 ini 配置的 <code>zend.assertions = 1</code> 和 <code>assert.exception = 1</code> 时，<code>assert()</code>才会执行并抛 <code>AssertionError</code>。</p>
<h3 id="在你的代码中使用-Error"><a href="#在你的代码中使用-Error" class="headerlink" title="在你的代码中使用 Error"></a>在你的代码中使用 Error</h3><p>用户可以通过继承 <code>Error</code> 来创建符合自己层级要求的 <code>Error</code> 类。这就形成了一个问题：什么情况下应该抛出 <code>Exception</code>，什么情况下应该抛出 <code>Error</code>。</p>
<p><code>Error</code> 应该用来表示需要程序员关注的代码问题。从 PHP 引擎抛出的 <code>Error</code> 对象属于这些分类，通常都是代码级别的错误，比如传递了错误类型的参数给一个函数或者解析一个文件发生错误。<code>Exception</code> 则应该用于在运行时能安全的处理，并且另一个动作能继续执行的情况。</p>
<p>由于 <code>Error</code> 对象不应该在运行时被处理，因此捕获 <code>Error</code> 对象也应该是不频繁的。一般来说，<code>Error</code> 对象仅被捕获用于日志记录、执行必要的清理以及展示错误信息给用户。</p>
<h3 id="编写代码支持-PHP5-x-和-PHP7-的异常"><a href="#编写代码支持-PHP5-x-和-PHP7-的异常" class="headerlink" title="编写代码支持 PHP5.x 和 PHP7 的异常"></a>编写代码支持 PHP5.x 和 PHP7 的异常</h3><p>为了在同样的代码中捕获任何 PHP5.x 和 PHP7 的异常，可以使用多个 <code>catch</code>，先捕获 <code>Throwable</code>，然后是 <code>Exception</code>。当 PHP5.x 不再需要支持时，捕获 <code>Exception</code> 的 <code>catch</code> 块可以移除。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Code that may throw an Exception or Error.</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> <span class="token variable">$t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Executed only in PHP 7, will not match in PHP 5.x</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// Executed only in PHP 5.x, will not be reached in PHP 7</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>不幸的是，处理异常的函数中的类型声明不容易确定。当 <code>Exception</code> 用于函数参数类型声明时，如果函数调用时候能用 <code>Error</code> 的实例，这个类型声明就要去掉。当 PHP5.x 不需要被支持时，类型声明则可以还原为 <code>Throwable</code>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/Hook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/Hook/" class="post-title-link" itemprop="url">Hook</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:14:27" itemprop="dateCreated datePublished" datetime="2021-08-29T14:14:27+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="如何理解React的副作用？"><a href="#如何理解React的副作用？" class="headerlink" title="如何理解React的副作用？"></a>如何理解React的副作用？</h2><p>说到React的副作用，我们先说下纯函数（Pure function）、纯组件（Pure Component）。</p>
<h3 id="纯函数-和-纯组件"><a href="#纯函数-和-纯组件" class="headerlink" title="纯函数 和 纯组件"></a>纯函数 和 纯组件</h3><p><strong>纯函数</strong> (Pure Function) 是 函数式编程 里面非常重要的概念 。</p>
<p>如果一个函数是 <strong>纯函数</strong> (Pure Function) ，它必须符合两个条件：</p>
<ol>
<li><strong>函数返回结果只依赖入参，入参固定，则返回值永远不变。</strong></li>
<li><strong>函数执行过程中不会产生对外可观察的变化。</strong></li>
</ol>
<p>示例：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> a
<span class="token punctuation">&#125;</span></code></pre>

<p>**纯组件 **就是纯函数：给一个component相同的props，永远会渲染出相同的视图，并且不会产生对外可观察的变化。</p>
<h3 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a>副作用</h3><p>纯函数不会产生对外可观察的变化，这个对外可观察的变化就是副作用。</p>
<p>副作用包括但不限于：</p>
<ul>
<li>修改外部变量；</li>
<li>调用另一个非纯函数（纯函数内调用纯函数，不会产生副作用，依然还是纯函数）；</li>
<li>发送HTTP请求；</li>
<li>调用DOM API 修改页面；</li>
<li>调用 <code>window.reload</code> 刷新页面，甚至<code>console.log()</code>往控制台打印数据；</li>
<li><code>Math.random()</code>；</li>
<li>获取当前时间；</li>
<li>…</li>
</ul>
<h3 id="钩子-Hook"><a href="#钩子-Hook" class="headerlink" title="钩子 Hook"></a>钩子 Hook</h3><p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html">https://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/09/react-hooks.html">https://www.ruanyifeng.com/blog/2019/09/react-hooks.html</a></p>
<p>函数组件的主体只应该用来返回组件的 HTML 代码，所有的其他操作（副作用）都必须通过钩子（hook）引入。</p>
<p>由于副作用非常多，所以hook有许多种。React 为许多常见的副作用提供了专用的hook：</p>
<ul>
<li>useState()：保存状态</li>
<li>useContext()：保存上下文</li>
<li>useRef()：保存引用</li>
<li>…</li>
</ul>
<p>上面这些hook，都是引入某种特定的副作用，而 <strong><code>useEffect()</code>是通用的副作用hook</strong> 。找不到对应的hook时，就可以用它。其实，从名字也可以看出来，它跟副作用（side effect）直接相关。</p>
<h2 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hooks-reference.html#useeffect">useEffect</a></h2><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">useEffect</span><span class="token punctuation">(</span>didUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>只要是副作用，都可以使用<code>useEffect()</code>引入。它的常见用途有下面几种：</p>
<ul>
<li>获取数据（data fetching） </li>
<li>事件监听或订阅（setting up a subscription）</li>
<li>改变 DOM（changing the DOM）</li>
<li>输出日志（logging）</li>
</ul>
<p>重点：</p>
<ol>
<li><p>赋值给 <code>useEffect</code> 的函数会在组件渲染到屏幕之后执行。</p>
</li>
<li><p>清除 effect：useEffect 函数可以返回一个清除函数，用以清除 effect 创建的诸如订阅或计时器 ID 等资源，示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> useDebounce <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">V</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">V</span><span class="token punctuation">,</span> delay<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>debouncedValue<span class="token punctuation">,</span> setDebouncedValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 每次在value变化以后，设置一个定时器</span>
    <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setDebouncedValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 每个定时器的名称都是timeout，所以只有最后一个定时器能存活下来</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个清除函数</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> debouncedValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p>如果该 useEffect 只调用一次，清除函数会在组件卸载前执行；如果组件多次渲染（通常如此），则 <strong>在执行下一个 effect 之前，上一个 effect 就已被清除</strong></p>
</li>
<li><p>effect 的执行时机：传给 <code>useEffect</code> 的函数会在浏览器完成布局与绘制<strong>之后</strong>，在一个延迟事件中被调用，虽然 <code>useEffect</code> 会在浏览器绘制后延迟执行，但会保证在任何新的渲染前执行。在开始新的更新前，React 总会先清除上一轮渲染的 effect。</p>
</li>
<li><p>effect 的条件执行：给 useEffect 传递第二个参数，它是 effect 所依赖的值数组。</p>
</li>
</ol>
<p><font color=red> react 中组件重新渲染是很频繁的，为了避免重复的网络请求，所以发送网络请求的操作一定要放在 useEffect 中  </font></p>
<h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h2><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>返回一个 state，以及更新 state 的函数。</p>
<p>在初始渲染期间，返回的状态 (<code>state</code>) 与传入的第一个参数 (<code>initialState</code>) 值相同。</p>
<p><code>setState</code> 函数用于更新 state。<font color=red>它接收一个新的 state 值并将组件的一次重新渲染加入队列。</font>就是说每次使用<code>setState</code>都会重新渲染组件。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>在后续的重新渲染中，<code>useState</code> 返回的第一个值将始终是更新后最新的 state</p>
<blockquote>
<p>注意：</p>
<p>React 会确保 <code>setState</code> 函数的标识是稳定的，并且不会在组件重新渲染时发生变化。这就是为什么可以安全地从 <code>useEffect</code> 或 <code>useCallback</code> 的依赖列表中省略 <code>setState</code>。</p>
</blockquote>
<h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h2><p>useReducer 是 useState 的替代方案。当 useState 不能很好的满足需要的时候，useReducer 可能会解决我们的问题。</p>
<pre class="language-react" data-language="react"><code class="language-react">import &#123; useReducer &#125; from &quot;react&quot;;
import &#123; Button, Space &#125; from &quot;antd&quot;;

type Action &#x3D; &#123;
  type: &quot;incr&quot; | &quot;decr&quot; | &quot;set&quot;;
  present?: number;
&#125;;
const Test &#x3D; () &#x3D;&gt; &#123;
  const reducer &#x3D; (state: number, action: Action) &#x3D;&gt; &#123;
    switch (action.type) &#123;
      case &quot;decr&quot;: &#123;
        return state - 1;
      &#125;
      case &quot;incr&quot;: &#123;
        return state + 1;
      &#125;
      case &quot;set&quot;: &#123;
        if (action.present) &#123;
          return action.present;
        &#125; else &#123;
          throw new Error(&quot;未设置有效值&quot;);
        &#125;
      &#125;
    &#125;
    &#x2F;&#x2F; return state
  &#125;;
  const initial &#x3D; 0;
  const [state, dispatch] &#x3D; useReducer(reducer, initial);
  return (
    &lt;Space&gt;
      &#123;state&#125;
      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123; type: &quot;incr&quot; &#125;)&#125;&gt;+&lt;&#x2F;Button&gt;
      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123; type: &quot;decr&quot; &#125;)&#125;&gt;-&lt;&#x2F;Button&gt;
      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; dispatch(&#123; type: &quot;set&quot; &#125;)&#125;&gt;reset&lt;&#x2F;Button&gt;
    &lt;&#x2F;Space&gt;
  );
&#125;;

export default Test;</code></pre>

<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a><a target="_blank" rel="noopener" href="https://react.docschina.org/docs/context.html">useContext</a></h2><h3 id="React-createContext"><a href="#React-createContext" class="headerlink" title="React.createContext"></a>React.createContext</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> MyContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>创建一个 Context 对象。</p>
<h3 id="Context-Provider"><a href="#Context-Provider" class="headerlink" title="Context.Provider"></a>Context.Provider</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token operator">&lt;</span>MyContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token comment">/* 某个值 */</span><span class="token punctuation">&#125;</span><span class="token operator">></span></code></pre>

<p>Provider 接收一个 <code>value</code> 属性，传递给 consumers 组件。一个 Provider 可以和多个 consumers 组件有对应关系。多个 Provider 也可以嵌套使用，里层的会覆盖外层的数据。</p>
<p>当 Provider 的 <code>value</code> 值发生变化时，它内部的所有 consumers 组件都会重新渲染。</p>
<p>通过新旧值检测来确定变化，使用了与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is#Description"><code>Object.is</code></a> 相同的算法（基本等同于“&#x3D;&#x3D;&#x3D;”）。</p>
<blockquote>
<p>注意</p>
<p>当传递对象给 <code>value</code> 时，检测变化的方式会导致一些问题：详见<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/context.html#caveats">注意事项</a>。</p>
</blockquote>
<h3 id="Class-contextType"><a href="#Class-contextType" class="headerlink" title="Class.contextType"></a>Class.contextType</h3><h3 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a>Context.Consumer</h3><h3 id="Context-displayName"><a href="#Context-displayName" class="headerlink" title="Context.displayName"></a>Context.displayName</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/React/create-react-app%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/React/create-react-app%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">create-react-app构建项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:14:09" itemprop="dateCreated datePublished" datetime="2021-08-29T14:14:09+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="全局安装-create-react-app"><a href="#全局安装-create-react-app" class="headerlink" title="全局安装 create-react-app"></a>全局安装 create-react-app</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 配置npm国内源</span>
<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org/

<span class="token comment"># 全局安装 create-react-app</span>
<span class="token function">yarn</span> global <span class="token function">add</span> create-react-app</code></pre>

<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># npx create-react-app my-app --template typescript</span>
<span class="token function">yarn</span> create react-app my-app <span class="token parameter variable">--template</span> typescript</code></pre>

<h3 id="删除-git"><a href="#删除-git" class="headerlink" title="删除.git"></a>删除.git</h3><p>因为是个人开发，不是团队开发，所以不需要 git</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">admin@admin MINGW64 /d/www
$ <span class="token builtin class-name">cd</span> my-app/

admin@admin MINGW64 /d/www/my-app <span class="token punctuation">(</span>master<span class="token punctuation">)</span>
$ <span class="token function">rm</span> <span class="token parameter variable">-rf</span> .git

admin@admin MINGW64 /d/www/my-app
$</code></pre>

<h3 id="配置-import-的-baseurl"><a href="#配置-import-的-baseurl" class="headerlink" title="配置 import 的 baseurl"></a>配置 import 的 baseurl</h3><p>在 tsconfig.json 中添加 baseUrl 配置项</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
		<span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es5"</span><span class="token punctuation">,</span>
		<span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dom"</span><span class="token punctuation">,</span> <span class="token string">"dom.iterable"</span><span class="token punctuation">,</span> <span class="token string">"esnext"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"allowSyntheticDefaultImports"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"noFallthroughCasesInSwitch"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>
		<span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
		<span class="token property">"resolveJsonModule"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"isolatedModules"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"noEmit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"react-jsx"</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="配置格式化规则"><a href="#配置格式化规则" class="headerlink" title="配置格式化规则"></a>配置格式化规则</h3><p>在项目根目录下新建文件 .prettierrc.js ，定义格式化规则：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">//单行长度</span>
	<span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//缩进长度</span>
	<span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//句末使用分号</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>在项目根目录下新建文件 .prettierignore ，语法同.gitignore，定义忽略格式化的文件：</p>
<pre class="language-none"><code class="language-none">build
coverage</code></pre>

<h3 id="主要文件介绍"><a href="#主要文件介绍" class="headerlink" title="主要文件介绍"></a>主要文件介绍</h3><pre class="language-bash" data-language="bash"><code class="language-bash">admin@admin MINGW64 /d/www/my-app
$ ll src/
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">564</span> Jul <span class="token number">27</span> 09:39 App.css
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">273</span> Jul <span class="token number">27</span> 09:39 App.test.tsx
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">556</span> Jul <span class="token number">27</span> 09:39 App.tsx		<span class="token comment"># 描述app本身</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">366</span> Jul <span class="token number">27</span> 09:39 index.css
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">500</span> Jul <span class="token number">27</span> 09:39 index.tsx	<span class="token comment"># 入口文件，准备工作</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span> <span class="token number">2632</span> Jul <span class="token number">27</span> 09:39 logo.svg
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>   <span class="token number">41</span> Jul <span class="token number">31</span> <span class="token number">18</span>:05 react-app-env.d.ts	<span class="token comment"># 引入预先定义好的typescript类型</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">425</span> Jul <span class="token number">27</span> 09:39 reportWebVitals.ts	<span class="token comment"># 埋点上报</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">241</span> Jul <span class="token number">27</span> 09:39 setupTests.ts		<span class="token comment"># 配置单元测试</span>
admin@admin MINGW64 /d/www/my-app
$ ll public/	<span class="token comment"># public目录不参与打包</span>
total <span class="token number">30</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span> <span class="token number">3870</span> Jul <span class="token number">27</span> 09:39 favicon.ico
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span> <span class="token number">1721</span> Jul <span class="token number">27</span> 09:39 index.html
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span> <span class="token number">5347</span> Jul <span class="token number">27</span> 09:39 logo192.png
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span> <span class="token number">9664</span> Jul <span class="token number">27</span> 09:39 logo512.png
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>  <span class="token number">492</span> Jul <span class="token number">27</span> 09:39 manifest.json	<span class="token comment"># pwa配置文件</span>
-rw-r--r-- <span class="token number">1</span> admin <span class="token number">197121</span>   <span class="token number">67</span> Jul <span class="token number">27</span> 09:39 robots.txt		<span class="token comment"># 配置爬虫权限</span></code></pre>

<h2 id="安装各种包"><a href="#安装各种包" class="headerlink" title="安装各种包"></a>安装各种包</h2><h3 id="json-server"><a href="#json-server" class="headerlink" title="json-server"></a>json-server</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> global <span class="token function">add</span> json-server		<span class="token comment"># 推荐全局安装</span></code></pre>

<p>在项目根目录下新建目录 __json_server__，在目录下新建 db.json 文件。</p>
<p>package.json 中新增快捷方式：</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test"</span><span class="token punctuation">,</span>
    <span class="token property">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span><span class="token punctuation">,</span>
    <span class="token property">"json-server"</span><span class="token operator">:</span> <span class="token string">"json-server --watch --host 0.0.0.0 --port 3001 ./__json_server__/db.json"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre>

<h3 id="prettier"><a href="#prettier" class="headerlink" title="prettier"></a>prettier</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> prettier <span class="token parameter variable">--dev</span> <span class="token parameter variable">--exact</span>
<span class="token function">yarn</span> <span class="token function">add</span> eslint-config-prettier <span class="token parameter variable">--dev</span>   <span class="token comment"># 解决prettier和eslint的冲突</span></code></pre>

<p>修改 package.json，新增”prettier”</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token property">"eslintConfig"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"react-app"</span><span class="token punctuation">,</span>
        <span class="token string">"react-app/jest"</span><span class="token punctuation">,</span>
        <span class="token string">"prettier"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre>

<h3 id="qs"><a href="#qs" class="headerlink" title="qs"></a>qs</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> qs
<span class="token function">yarn</span> <span class="token function">add</span> @types/qs <span class="token parameter variable">--dev</span>		<span class="token comment"># 给qs打补丁，加上类型，以适应ts的类型检查</span></code></pre>

<h3 id="emotion"><a href="#emotion" class="headerlink" title="emotion"></a>emotion</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @emotion/styled @emotion/react</code></pre>

<h3 id="dayjs"><a href="#dayjs" class="headerlink" title="dayjs"></a>dayjs</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> dayjs</code></pre>

<h2 id="env-和-env-development"><a href="#env-和-env-development" class="headerlink" title=".env 和 .env.development"></a>.env 和 .env.development</h2><p><code>npm start</code> 的时候，调用 <code>.env</code>，<code>npm run build</code> 的时候，调用<code>.env.development</code>，create-react-app 会自动切换。注意：配置项一定是<code>REACT_APP_</code>开头。</p>
<p><code>.env</code> 示例：</p>
<pre class="language-none"><code class="language-none">REACT_APP_API_URL&#x3D;http:&#x2F;&#x2F;online.com</code></pre>

<p><code>.env.development</code> 示例：</p>
<pre class="language-none"><code class="language-none">REACT_APP_API_URL&#x3D;http:&#x2F;&#x2F;172.16.2.1:3001</code></pre>

<h2 id="Ant-Design"><a href="#Ant-Design" class="headerlink" title="Ant Design"></a>Ant Design</h2><p>官网：<a target="_blank" rel="noopener" href="https://ant.design/index-cn">https://ant.design/index-cn</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> antd</code></pre>

<h3 id="craco"><a href="#craco" class="headerlink" title="craco"></a>craco</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> @craco/craco
<span class="token function">yarn</span> <span class="token function">add</span> craco-less <span class="token parameter variable">--dev</span></code></pre>

<p>项目根目录下新建文件 craco.config.js ：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> CracoLessPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"craco-less"</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">&#123;</span>
			<span class="token literal-property property">plugin</span><span class="token operator">:</span> CracoLessPlugin<span class="token punctuation">,</span>
			<span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
				<span class="token literal-property property">lessLoaderOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
					<span class="token literal-property property">lessOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
						<span class="token literal-property property">modifyVars</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
							<span class="token string-property property">"@primary-color"</span><span class="token operator">:</span> <span class="token string">"#1890ff"</span><span class="token punctuation">,</span>
							<span class="token string-property property">"@font-size-base"</span><span class="token operator">:</span> <span class="token string">"16px"</span><span class="token punctuation">,</span>
						<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
						<span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
					<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
			<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="配置-webstrom"><a href="#配置-webstrom" class="headerlink" title="配置 webstrom"></a>配置 webstrom</h2><h3 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h3><p>这里已经安装过了</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1628158459560.png"></p>
<h3 id="配置自动-import-的绝对路径"><a href="#配置自动-import-的绝对路径" class="headerlink" title="配置自动 import 的绝对路径"></a>配置自动 import 的绝对路径</h3><p>这里应勾选了</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1628158599503.png"></p>
<h3 id="配置-css-in-js-语法高亮"><a href="#配置-css-in-js-语法高亮" class="headerlink" title="配置 css-in-js 语法高亮"></a>配置 css-in-js 语法高亮</h3><p>这里已经安装过了</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1629437279959.png"></p>
<h3 id="配置自动格式化"><a href="#配置自动格式化" class="headerlink" title="配置自动格式化"></a>配置自动格式化</h3><p><img data-src="//img.to2b.cn/blog/ljk/1636470130045.png"></p>
<h2 id="yarn-v2"><a href="#yarn-v2" class="headerlink" title="yarn v2"></a>yarn v2</h2><p>以上是 yarn v1 搭配 create-react-app 构建 react，下面介绍使用 yarn v2：</p>
<ol>
<li><p>全局安装 yarn v2</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i yarn@berry <span class="token parameter variable">-g</span></code></pre>
</li>
<li><p>初始化项目：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">yarn</span> dlx create-react-app react-ts-antd-yarn2-dev <span class="token parameter variable">--template</span> typescript
<span class="token punctuation">..</span>.
➤ YN0000: └ Completed <span class="token keyword">in</span> 2s 148ms
➤ YN0000: Failed with errors <span class="token keyword">in</span> 5s 116ms
<span class="token variable"><span class="token variable">`</span>yarnpkg <span class="token function">add</span> @testing-library/jest-dom@^5.14.1 @testing-library/react@^12.0.0 @testing-library/user-event@^13.2.1 @types/jest@^27.0.1 @types/node@^16.7.13 @types/react@^17.0.20 @types/react-dom@^17.0.9 typescript@^4.4.2 web-vitals@^2.1.0<span class="token variable">`</span></span> failed</code></pre>
</li>
<li><p>初始化项目：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 进入项目目录</span>
<span class="token operator">></span> <span class="token builtin class-name">cd</span> react-ts-antd-yarn2-dev
<span class="token comment"># 2. 升级yarn到v3，这一步是必须的</span>
<span class="token operator">></span> <span class="token function">yarn</span> <span class="token builtin class-name">set</span> version stable		<span class="token comment"># 或者：yarn set version berry</span>
<span class="token comment"># 2. 配置npm国内源</span>
<span class="token operator">></span> <span class="token function">yarn</span> config <span class="token builtin class-name">set</span> npmRegistryServer https://registry.npmmirror.com
<span class="token comment"># 3. 初始化</span>
<span class="token operator">></span> <span class="token function">yarn</span></code></pre>
</li>
<li><p>安装必要包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> @testing-library/jest-dom @testing-library/react @testing-library/user-event @types/jest @types/node @types/react @types/react-dom@ typescript
<span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> web-vitals

<span class="token comment"># 精简（去掉测试包），并删除src下测试相关的文件</span>
<span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> typescript @types/react-dom @types/react @types/jest @types/node</code></pre>
</li>
<li><p>项目根目录下新建 tsconfig.json 文件</p>
<pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./src"</span><span class="token punctuation">,</span>
		<span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es2015"</span><span class="token punctuation">,</span>
		<span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dom"</span><span class="token punctuation">,</span> <span class="token string">"dom.iterable"</span><span class="token punctuation">,</span> <span class="token string">"esnext"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"allowSyntheticDefaultImports"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"noFallthroughCasesInSwitch"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>
		<span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
		<span class="token property">"resolveJsonModule"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"isolatedModules"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"noEmit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"react-jsx"</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>src 目录下新建 react-app-env.d.ts 文件，如果缺少这个文件，已组件形式引入图片会报错</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">/// &lt;reference types="react-scripts" /></span></code></pre>
</li>
<li><p>.gitignore 中新增以下内容：</p>
<pre class="language-none"><code class="language-none">.yarn&#x2F;*
!.yarn&#x2F;cache
!.yarn&#x2F;patches
!.yarn&#x2F;plugins
!.yarn&#x2F;releases
!.yarn&#x2F;sdks
!.yarn&#x2F;versions</code></pre>
</li>
<li><p>启动项目</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">yarn</span> start</code></pre>
</li>
<li><p>配置 prettier</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> eslint-config-prettier prettier</code></pre>

<p>项目根目录下新增 .prettierrc.js 文件</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//此处的规则供参考，其中多半其实都是默认值，可以根据个人习惯改写</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">//单行长度</span>
	<span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//缩进长度</span>
	<span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//句末使用分号</span>
	<span class="token literal-property property">jsxBracketSameLinte</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">"avoid"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>剩下的和 yarn 一致</p>
</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> @emotion/react @emotion/styled antd @ant-design/icons dayjs qs react-query react-router react-router-dom
<span class="token operator">></span> <span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> @craco/craco craco-less @types/qs</code></pre>

<ol start="11">
<li>…</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/TypeScript/%E6%B3%9B%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/TypeScript/%E6%B3%9B%E5%9E%8B/" class="post-title-link" itemprop="url">泛型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:01:31" itemprop="dateCreated datePublished" datetime="2021-08-29T14:01:31+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/TypeScript/" itemprop="url" rel="index"><span itemprop="name">TypeScript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904184894980104">https://juejin.cn/post/6844904184894980104</a></p>
<h2 id="泛型是什么"><a href="#泛型是什么" class="headerlink" title="泛型是什么"></a>泛型是什么</h2><p>设计泛型的关键目的是在成员之间提供有意义的约束，这些成员可以是：类的实例成员、类的方法、函数参数和函数返回值。</p>
<p>为了便于大家更好地理解上述的内容，我们来举个例子，在这个例子中，我们将一步步揭示泛型的作用。首先我们来定义一个通用的 <code>identity</code> 函数，该函数接收一个参数并直接返回它：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span></code></pre>

<p>现在，我们将 <code>identity</code> 函数做适当的调整，以支持 TypeScript 的 Number 类型的参数：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">identity</span><span class="token punctuation">(</span>value<span class="token operator">:</span> Number<span class="token punctuation">)</span><span class="token operator">:</span> Number <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span></code></pre>

<p>这里 <code>identity</code> 的问题是我们将 <code>Number</code> 类型分配给参数和返回类型，使该函数仅可用于该原始类型。但该函数并不是可扩展或通用的，很明显这并不是我们所希望的。</p>
<p>我们确实可以把 <code>Number</code> 换成 <code>any</code>，我们失去了定义应该返回哪种类型的能力，并且在这个过程中使编译器失去了类型保护的作用。我们的目标是让 <code>identity</code> 函数可以适用于任何特定的类型，为了实现这个目标，我们可以使用泛型来解决这个问题，具体实现方式如下：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span>Number<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span></code></pre>

<p>对于刚接触 TypeScript 泛型的读者来说，首次看到 &#96;&#96; 语法会感到陌生。但这没什么可担心的，就像传递参数一样，我们传递了我们想要用于特定函数调用的类型。</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1633570770617.png"></p>
<p>参考上面的图片，当我们调用 <code>identity(1)</code> ，<code>Number</code> 类型就像参数 <code>1</code> 一样，它将在出现 <code>T</code> 的任何位置填充该类型。图中 &#96;&#96;内部的<code>T</code>被称为类型变量，它是我们希望传递给 identity 函数的类型占位符，同时它被分配给<code>value</code>参数用来代替它的类型：此时<code>T</code> 充当的是类型，而不是特定的 Number 类型。</p>
<p>其中 <code>T</code> 代表 <strong>Type</strong>，在定义泛型时通常用作第一个类型变量名称。但实际上 <code>T</code> 可以用任何有效名称代替。除了 <code>T</code> 之外，以下是常见泛型变量代表的意思：</p>
<ul>
<li>K（Key）：表示对象中的键类型；</li>
<li>V（Value）：表示对象中的值类型；</li>
<li>E（Element）：表示元素类型。</li>
</ul>
<p>其实并不是只能定义一个类型变量，我们可以引入希望定义的任何数量的类型变量。比如我们引入一个新的类型变量 <code>U</code>，用于扩展我们定义的 <code>identity</code> 函数：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span>Number<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token string">"Semlinker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1633570839376.png"></p>
<p>除了为类型变量显式设定值之外，一种更常见的做法是使编译器自动选择这些类型，从而使代码更简洁。我们可以完全省略尖括号，比如：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token string">"Semlinker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><strong>对于上述代码，编译器足够聪明，能够知道我们的参数类型，并将它们赋值给 T 和 U，而不需要开发人员显式指定它们。</strong></p>
<p>如你所见，该函数接收你传递给它的任何类型，使得我们可以为不同类型创建可重用的组件。现在我们再来看一下 <code>identity</code> 函数：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
	<span class="token keyword">return</span> value
<span class="token punctuation">&#125;</span></code></pre>

<p>相比之前定义的 <code>identity</code> 函数，新的 <code>identity</code> 函数增加了一个类型变量 <code>U</code>，但该函数的返回类型我们仍然使用 <code>T</code>。如果我们想要返回两种类型的对象该怎么办呢？针对这个问题，我们有多种方案，其中一种就是使用元组，即为元组设置通用的类型：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> message<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>虽然使用元组解决了上述的问题，但有没有其它更好的方案呢？答案是有的，你可以使用泛型接口。</p>
<h2 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h2><p>为了解决上面提到的问题，首先让我们创建一个用于的 <code>identity</code> 函数通用 <code>Identities</code> 接口：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Identities<span class="token operator">&lt;</span><span class="token constant">V</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
	value<span class="token operator">:</span> <span class="token constant">V</span>
	message<span class="token operator">:</span> <span class="token constant">M</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>在上述的 <code>Identities</code> 接口中，我们引入了类型变量 <code>V</code> 和 <code>M</code>，来进一步说明有效的字母都可以用于表示类型变量，之后我们就可以将 <code>Identities</code> 接口作为 <code>identity</code> 函数的返回类型：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">identity</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> Identities<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> value<span class="token punctuation">)</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> message<span class="token punctuation">)</span>
	<span class="token keyword">let</span> identities<span class="token operator">:</span> Identities<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
		value<span class="token punctuation">,</span>
		message<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> identities
<span class="token punctuation">&#125;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">,</span> <span class="token string">"Semlinker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>以上代码成功运行后，在控制台会输出以下结果：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token number">68</span><span class="token operator">:</span> <span class="token builtin">number</span>
Semlinker<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#123;</span>value<span class="token operator">:</span> <span class="token number">68</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">"Semlinker"</span><span class="token punctuation">&#125;</span></code></pre>

<p>泛型除了可以应用在函数和接口之外，它也可以应用在类中，下面我们就来看一下在类中如何使用泛型。</p>
<h2 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/css/grid%E5%92%8Cflex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/css/grid%E5%92%8Cflex/" class="post-title-link" itemprop="url">grid和flex</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:01:16" itemprop="dateCreated datePublished" datetime="2021-08-29T14:01:16+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Gird：网格布局</p>
<p>Flex：弹性布局</p>
<p>应用场景：</p>
<ul>
<li>一维布局用 flex；二维布局用 grid</li>
<li>从内容出发，用 flex；从布局出发，用 grid</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/css/css%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/css/css%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">css函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:01:08" itemprop="dateCreated datePublished" datetime="2021-08-29T14:01:08+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6908962052727898125#comment">https://juejin.cn/post/6908962052727898125#comment</a></p>
<blockquote>
<p>与 Javascript 一样，CSS 中也有一些计算函数，仅对与一些常用的和个人了解的做一次分享。</p>
<p>CSS 函数较多，从常用性和实际出发，按运用比重顺序排序</p>
</blockquote>
<h2 id="Color-颜色相关"><a href="#Color-颜色相关" class="headerlink" title="Color 颜色相关"></a>Color 颜色相关</h2><h3 id="rgb-、rgba"><a href="#rgb-、rgba" class="headerlink" title="rgb()、rgba()"></a>rgb()、rgba()</h3><p>这两个函数一定是不会陌生的，对于颜色属性值通过红绿蓝三原色来进行调整。</p>
<p>区别在于 rgba() 中 a 表示透明度，取值 0-1 之间。相对来说最为常用</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437850622.png"></p>
<p>除此之外，类似的<strong>CSS 颜色函数</strong>还有：</p>
<h3 id="hsl-、hsla"><a href="#hsl-、hsla" class="headerlink" title="hsl()、hsla()"></a>hsl()、hsla()</h3><p>使用色相、饱和度、亮度、(透明度)来定义颜色</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437872054.png"></p>
<h3 id="hwb"><a href="#hwb" class="headerlink" title="hwb()"></a>hwb()</h3><p><img data-src="//img.to2b.cn/blog/lujinkai/1664437884414.png"></p>
<p>使用色相、以及黑白混合度（white\black）如上方右图所示。</p>
<blockquote>
<p>相对的，可能对于美术或设计师更能理解以色相为主的颜色选取方式，其实对于代码来说，我们使用 rgb()和 rgba()即可，兼容性也是良好的。</p>
</blockquote>
<h3 id="color-mod"><a href="#color-mod" class="headerlink" title="color-mod()"></a>color-mod()</h3><p><strong>CSS Color Module Level 4</strong> 中提出一个新的 CSS</p>
<p>其是基于一个颜色值，在不同的条件下调整参数得到的新颜色，未作深入了解。可以通过<a href="https://link.juejin.cn/?target=https://colorme.io/">colorme.io&#x2F;</a>这个网站来看下具体颜色值是如何变化的，同时大漠老师的博客中也有相关的文档解释，可以参考下。</p>
<p><a href="https://link.juejin.cn/?target=https://www.w3cplus.com/css4/color-mod.html">使用 color-mod()函数修改颜色</a></p>
<h2 id="Transform-变换相关"><a href="#Transform-变换相关" class="headerlink" title="Transform 变换相关"></a>Transform 变换相关</h2><blockquote>
<p>对于不同内核浏览器，可能需要加入私有前缀来进行对应的兼容性处理，而 3d 边换，IE 毒瘤则是一定不支持的</p>
</blockquote>
<h3 id="translate-位置变换：translate-、translateX-、translateY-、translate3d"><a href="#translate-位置变换：translate-、translateX-、translateY-、translate3d" class="headerlink" title="translate 位置变换：translate()、translateX()、translateY()、translate3d()"></a>translate 位置变换：translate()、translateX()、translateY()、translate3d()</h3><h3 id="rotate-旋转变换：rotate-、rotate3d-、rotateX-、rotateY-、rotateZ"><a href="#rotate-旋转变换：rotate-、rotate3d-、rotateX-、rotateY-、rotateZ" class="headerlink" title="rotate 旋转变换：rotate()、rotate3d()、rotateX()、rotateY()、rotateZ()"></a>rotate 旋转变换：rotate()、rotate3d()、rotateX()、rotateY()、rotateZ()</h3><h3 id="skew-倾斜变换：skew-、skewX-、skewY"><a href="#skew-倾斜变换：skew-、skewX-、skewY" class="headerlink" title="skew 倾斜变换：skew()、skewX()、skewY()"></a>skew 倾斜变换：skew()、skewX()、skewY()</h3><h3 id="scale-缩放变换：scale-、scale3d-、scaleX-、scaleY-、scaleZ"><a href="#scale-缩放变换：scale-、scale3d-、scaleX-、scaleY-、scaleZ" class="headerlink" title="scale 缩放变换：scale()、scale3d()、scaleX()、scaleY()、scaleZ()"></a>scale 缩放变换：scale()、scale3d()、scaleX()、scaleY()、scaleZ()</h3><h2 id="Background-背景相关"><a href="#Background-背景相关" class="headerlink" title="Background 背景相关"></a>Background 背景相关</h2><h3 id="linear-gradient-线性渐变"><a href="#linear-gradient-线性渐变" class="headerlink" title="linear-gradient() 线性渐变"></a>linear-gradient() 线性渐变</h3><blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437917070.png">代码实现如下：</p>
</blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437931742.png"></p>
<h3 id="radial-gradient-径向渐变"><a href="#radial-gradient-径向渐变" class="headerlink" title="radial-gradient() 径向渐变"></a>radial-gradient() 径向渐变</h3><blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437942654.png"> 代码实现如下：</p>
</blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437955974.png"></p>
<h3 id="conic-gradient-角向渐变"><a href="#conic-gradient-角向渐变" class="headerlink" title="conic-gradient() 角向渐变"></a>conic-gradient() 角向渐变</h3><blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437972830.png"> 代码实现如下：</p>
</blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437983214.png"></p>
<h3 id="element-将网站中的某部分当作图片渲染"><a href="#element-将网站中的某部分当作图片渲染" class="headerlink" title="element() 将网站中的某部分当作图片渲染"></a>element() 将网站中的某部分当作图片渲染</h3><p><strong>CSS Color Module Level 4</strong> 中提出一个新的 CSS，由于只能在 Firefox 浏览器内产生效果，可以参考大漠老师的另一篇文章，里面有更为详细的介绍</p>
<p><a href="https://link.juejin.cn/?target=https://www.w3cplus.com/css4/css-element-function.html">CSS element()函数</a></p>
<h2 id="Math-计算相关"><a href="#Math-计算相关" class="headerlink" title="Math 计算相关"></a>Math 计算相关</h2><blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664437994414.png"></p>
<p>相对来说，计算相关的函数其实兼容性一般，对于个人项目或移动端项目可以做尝试</p>
</blockquote>
<h3 id="min-取最小值"><a href="#min-取最小值" class="headerlink" title="min() 取最小值"></a>min() 取最小值</h3><p>对于 dialog 这一类元素，其长度应当适应于不同分辨率下，以往可能需要使用 vw &#x2F; % 等来渲染，但是会有一个问题，那就是在不同分辨率下可能 60vw &#x2F; 60% 下，dialog 的宽度在 1920 分辨率下看着还算正常，但是在 1366 等比较小的分辨率下会出现宽度不足以容纳内部元素，或者做适配时不太优雅展示的时候，可以考虑结合这一类计算函数来进行。</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.dialog</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">min</span><span class="token punctuation">(</span>700px<span class="token punctuation">,</span>80vw<span class="token punctuation">)</span>
  <span class="token comment">/* 解析为宽度取 700px 和 80vw 中较小的那一个数值 */</span>
<span class="token punctuation">&#125;</span>
复制代码</code></pre>

<h3 id="max-取最大值"><a href="#max-取最大值" class="headerlink" title="max() 取最大值"></a>max() 取最大值</h3><p>同 min() 取值逻辑</p>
<h3 id="clamp-取值范围"><a href="#clamp-取值范围" class="headerlink" title="clamp() 取值范围"></a>clamp() 取值范围</h3><p><strong>clamp(MIN, VAL, MAX) &#x3D; max(MIN, min(VAL, MAX))</strong></p>
<blockquote>
<p>其中 MIN 表示最小值，VAL 表示首选值，MAX 表示最大值。意思是，如果 VAL 在 MIN 和 MAX 范围之间，则使用 VAL 作为函数返回值；如果 VAL 大于 MAX，则使用 MAX 作为返回值；如果 VAL 小于 MIN，则使用 MIN 作为返回值。</p>
</blockquote>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.dialog</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>240px<span class="token punctuation">,</span> 50vw<span class="token punctuation">,</span> 600px<span class="token punctuation">)</span>
  <span class="token comment">/* 解析为当 50vw > 600px 时，.dialog width值等于600px */</span>
  <span class="token comment">/* 当 240px &lt;= 50vw &lt;= 600px 时，.dialog width值等于50vw  */</span>
    <span class="token comment">/* 进一步缩小，当 50vw &lt; 240px时，.dialog width值等于 240px */</span>
<span class="token punctuation">&#125;</span>
复制代码</code></pre>

<p>相关例子效果展示可以参考张鑫旭老师博客中的在线代码，地址如下:</p>
<p><a href="https://link.juejin.cn/?target=https://www.zhangxinxu.com/study/202004/css-clamp-function-demo.php">www.zhangxinxu.com/study/20200…</a></p>
<h3 id="calc-动态计算"><a href="#calc-动态计算" class="headerlink" title="calc() 动态计算"></a>calc() 动态计算</h3><p><strong>calc()</strong> 应该是最为常见的 css 计算函数了，可结合 四则运算来取部分的宽高等，可用于圣杯布局中主体内容的宽高计算等需要动态计算的地方</p>
<h2 id="Attr-属性函数"><a href="#Attr-属性函数" class="headerlink" title="Attr() 属性函数"></a>Attr() 属性函数</h2><blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664438020174.png"></p>
</blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664438034358.png"></p>
<blockquote>
<p>仅从官方的例子中只能看到些基础的应用，且容易理解，而张鑫旭老师博客中指出：</p>
<p>传统的 attr()语法只能让 HTML 属性作为字符串使用，且只能使用在伪元素中</p>
<p>全新的 attr()语法那可就完全不得了了，可以让 HTML 属性值转换成任意的 CSS 数据类型。</p>
<p>个人尝试代码直接报错了~😅，</p>
<p>还是建议想要了解的查看下原文章：</p>
<p><a href="https://link.juejin.cn/?target=https://www.zhangxinxu.com/wordpress/2020/10/css-attr-polyfill/">www.zhangxinxu.com/wordpress/2…</a></p>
</blockquote>
<h2 id="CSS-变量"><a href="#CSS-变量" class="headerlink" title="CSS 变量"></a>CSS 变量</h2><p>**<code>var()</code><strong>函数可以代替元素中任何属性中的值的任何部分。</strong><code>var()</code>**函数不能作为属性名、选择器或者其他除了属性值之外的值。</p>
<blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1664438044542.png"></p>
</blockquote>
<h3 id="CSS-变量声明"><a href="#CSS-变量声明" class="headerlink" title="CSS 变量声明"></a>CSS 变量声明</h3><p><code>--*</code> 用来声明变量，使用 <code>var(--*)</code> 来使用变量</p>
<ul>
<li><p>CSS 变量声明只可用于属性值，不可用以属性名</p>
</li>
<li><p>CSS 变量不支持多个同时声明</p>
</li>
<li><p>CSS 变量使用的合法性</p>
</li>
<li><p>CSS 变量与属性单位结合需要使用 * 乘法</p>
</li>
<li><p>CSS 变量的声明时可相互调用声明的变量</p>
<p>:root { –main-bg-color: pink; –ml: 20px; –mlv: 20; –primary-size: 20px; –base-font-size: var(–primary-size); &#x2F;_ 变量声明时的调用 <em>&#x2F; } body { background-color: var(–main-bg-color); &#x2F;</em> 表现结果为：背景色为粉红 <em>&#x2F; } .ml20 { margin-left: var(–ml); margin-left: calc(var(–mlv) * 1px); &#x2F;</em> 表现结果都是左间距 20px,此处的变量运用需区别带单位和不带单位的使用差异 _&#x2F; }</p>
</li>
</ul>
<h3 id="CSS-变量作用域"><a href="#CSS-变量作用域" class="headerlink" title="CSS 变量作用域"></a>CSS 变量作用域</h3><pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">:root</span> <span class="token punctuation">&#123;</span> <span class="token property">--color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token selector">div</span> <span class="token punctuation">&#123;</span> <span class="token property">--color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token selector">#alert</span> <span class="token punctuation">&#123;</span> <span class="token property">--color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token selector">*</span> <span class="token punctuation">&#123;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

&lt;p>我的紫色继承于根元素&lt;/p>
&lt;div>我的绿色来自直接设置&lt;/div>
&lt;div id=<span class="token string">'alert'</span>>
  ID选择器权重更高，因此阿拉是红色！
  &lt;p>我也是红色，占了继承的光&lt;/p>
&lt;/div>
复制代码</code></pre>

<p>上述代码中，显示出了 CSS 变量也是具有作用域的</p>
<p>: root 取全局作用域，div 取所有的 div 元素，#alert 取所有 id 为 alert 的元素使用，按照 css 解析顺序，上面案例代码的元素颜色即和文字表述一致</p>
<h3 id="JS-读取-CSS-变量"><a href="#JS-读取-CSS-变量" class="headerlink" title="JS 读取 CSS 变量"></a>JS 读取 CSS 变量</h3><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">var cssVarColor</span> <span class="token punctuation">=</span> <span class="token value attr-value">getComputedStyle(box).getPropertyValue('--color');</span>

// 输出cssVarColor
// 输出变量值是：#cd0000
console.log(cssVarColor);
复制代码</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/css/%E4%BC%AA%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/css/%E4%BC%AA%E7%B1%BB/" class="post-title-link" itemprop="url">伪类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-29 14:00:54" itemprop="dateCreated datePublished" datetime="2021-08-29T14:00:54+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、超链接"><a href="#一、超链接" class="headerlink" title="一、超链接"></a>一、超链接</h2><pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">a：link</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">a：visited</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">a：hover</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token selector">a：active</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #6600cc<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>注意：设置的顺序不能变，遵循爱恨（love&#x2F;hate）原则。 ——此原则自己在网上看别人说的，便于记忆就写在这了</p>
<h2 id="二、更多伪类"><a href="#二、更多伪类" class="headerlink" title="二、更多伪类"></a>二、更多伪类</h2><pre class="language-css" data-language="css"><code class="language-css"><span class="token punctuation">:</span>root  ------------------------------ <span class="token property">文档的根</span>

<span class="token punctuation">:</span><span class="token function">nth-child</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> --------------------- <span class="token property">作为其父元素的第n个孩子的一个元素</span>

<span class="token punctuation">:</span><span class="token function">nth-last-child</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> ---------------- <span class="token property">作为其父元素的第n个孩子的一个元素，从最后一个数起</span>

<span class="token punctuation">:</span><span class="token function">nth-of-type</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> ------------------ <span class="token property">作为其类型的第n个兄弟的一个元素</span>

<span class="token punctuation">:</span><span class="token function">nth-last-of-type</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> ----------- <span class="token property">作为其类型的第n个兄弟的一个元素，从最后一个数起</span>

<span class="token punctuation">:</span>first-child  ----------------------  <span class="token property">作为其父元素的第1个孩子的一个元素</span>

<span class="token punctuation">:</span>last-child -----------------------  <span class="token property">作为其父元素的最后1个孩子的一个元素</span>

<span class="token punctuation">:</span>first-of-type --------------------  <span class="token property">作为其类型的第1个兄弟的一个元素</span>

<span class="token punctuation">:</span>last-of-type  -------------------  <span class="token property">作为其类型的第1个兄弟的一个元素，从最后一个数起</span>

<span class="token punctuation">:</span>only-child   --------------------  <span class="token property">作为其父元素的唯一1个孩子的一个元素</span>

<span class="token punctuation">:</span>only-of-type -------------------  <span class="token property">作为其类型的唯一1个兄弟的一个元素</span>

<span class="token punctuation">:</span>empty -------------------------- 没有孩子或文本的一个元素</code></pre>

<h2 id="三、一些伪元素"><a href="#三、一些伪元素" class="headerlink" title="三、一些伪元素"></a>三、一些伪元素</h2><pre class="language-css" data-language="css"><code class="language-css"><span class="token punctuation">:</span>first-letter  <span class="token property">第一个字母</span>
<span class="token punctuation">:</span>after    <span class="token property">选择元素的后面，允许在这些位置插入内容</span>
<span class="token punctuation">:</span>before  选择元素的前面，允许在这些位置插入内容</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/TypeScript/%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/TypeScript/%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">TypeScript</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-26 16:58:07" itemprop="dateCreated datePublished" datetime="2021-05-26T16:58:07+08:00">2021-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/TypeScript/" itemprop="url" rel="index"><span itemprop="name">TypeScript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h2><h3 id="string、number、boolean"><a href="#string、number、boolean" class="headerlink" title="string、number、boolean"></a>string、number、boolean</h3><h3 id="array（数组）"><a href="#array（数组）" class="headerlink" title="array（数组）"></a>array（数组）</h3><p>ts 表示数组有两种形式，<code>元素类型[]</code> 或者 <code>Array&lt;元素类型&gt;</code>，示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> list<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> list<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>

<p>如果是只读数组，被赋值后就不能修改了，使用<code>ReadonlyArray&lt;元素类型&gt;</code>：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> rolist<span class="token operator">:</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>

<h3 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h3><h3 id="any"><a href="#any" class="headerlink" title="any"></a>any</h3><h3 id="enum（枚举）"><a href="#enum（枚举）" class="headerlink" title="enum（枚举）"></a>enum（枚举）</h3><h4 id="数字枚举"><a href="#数字枚举" class="headerlink" title="数字枚举"></a>数字枚举</h4><p>默认就是数字枚举，从 0 开始递增，如果给某个成员赋值，后面的在这个值的基础上自增。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> Direction <span class="token punctuation">&#123;</span>
  up<span class="token punctuation">,</span>
  down<span class="token punctuation">,</span>
  left<span class="token punctuation">,</span>
  right<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// up=0、down=1、left=2、right=3，从0开始依次递增</span>

<span class="token keyword">enum</span> Direction <span class="token punctuation">&#123;</span>
  up<span class="token punctuation">,</span>
  down <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
  left<span class="token punctuation">,</span>
  right<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token comment">// up=0、down=2、left=3、right=4，down后面的从2开始依次递增</span></code></pre>

<h4 id="字符串枚举"><a href="#字符串枚举" class="headerlink" title="字符串枚举"></a>字符串枚举</h4><p>字符串枚举，因为不能自增，所以需要每个成员都进行初始化。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> Direction <span class="token punctuation">&#123;</span>
  up <span class="token operator">=</span> <span class="token string">"up"</span><span class="token punctuation">,</span>
  down <span class="token operator">=</span> <span class="token string">"down"</span><span class="token punctuation">,</span>
  left <span class="token operator">=</span> <span class="token string">"left"</span><span class="token punctuation">,</span>
  right <span class="token operator">=</span> <span class="token string">"right"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="异构枚举"><a href="#异构枚举" class="headerlink" title="异构枚举"></a>异构枚举</h4><p>混合字符串和数字，但是不推荐这么做。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> BooleanLikeHeterogeneousEnum <span class="token punctuation">&#123;</span>
  No <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  Yes <span class="token operator">=</span> <span class="token string">"YES"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="外部枚举"><a href="#外部枚举" class="headerlink" title="外部枚举"></a>外部枚举</h4><h3 id="void（空值）"><a href="#void（空值）" class="headerlink" title="void（空值）"></a>void（空值）</h3><h3 id="null-和-undefined"><a href="#null-和-undefined" class="headerlink" title="null 和 undefined"></a>null 和 undefined</h3><p>当打印一个变量时，这个变量没有定义就是<code>undefined</code>，定义了没有赋值就是<code>null</code>。</p>
<p>ts 中，<code>null</code>和<code>undefined</code>各自有自己的类型，分别是 null 和 undefined，它们本身作用不大，默认情况下，null 和 undefined 类型是所有其他类型的子类型，就是说你可以把<code>null</code>和<code>undefined</code>赋值给<code>number</code>类型的变量。</p>
<p>不过，指定–strictNullChecks，<code>null</code>和<code>undefined</code>就只能赋值给 any 和它们各自的类型（有一个例外是<code>undefined</code>还可以赋值给 void 类型）</p>
<h3 id="never"><a href="#never" class="headerlink" title="never"></a>never</h3><p><code>void</code> 表示没有任何类型，<code>never</code> 表示永远不存在的值的类型。</p>
<p><code>void</code> 没有返回值，<code>never</code> 返回的值没有类型。</p>
<h3 id="object"><a href="#object" class="headerlink" title="object"></a>object</h3><h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><p>类型转换，有两种形式：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// “尖括号”语法：</span>
<span class="token keyword">let</span> someValue<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> strLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span>someValue<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">//  as 语法：</span>
<span class="token keyword">let</span> someValue<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">"this is a string"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> strLength<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span>someValue <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></code></pre>

<p>在 TypeScript 里使用 JSX 时，只有 as 语法断言是被允许的。</p>
<h3 id="关于-number、string、boolean、symbol、object"><a href="#关于-number、string、boolean、symbol、object" class="headerlink" title="关于 number、string、boolean、symbol、object"></a>关于 number、string、boolean、symbol、object</h3><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>接口的作用是规范、限制、约束。定义接口的关键字是 interface 和 type。</p>
<ul>
<li>interface 可以重复定义（merge），type 不可以</li>
<li>interface 定义的接口格式固定，type 可以定义各种格式的接口</li>
<li>interface 可以实现接口的 extends&#x2F;implements，type 不行，基于此，<strong>推荐约束变量类型的时候用 type，定义类接口的时候用 interface</strong></li>
</ul>
<h3 id="属性类接口"><a href="#属性类接口" class="headerlink" title="属性类接口"></a>属性类接口</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">&#123;</span>
  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">printLabel</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>定义接口的关键字 interface 或者 type，上例还可以写作：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">&#123;</span>
    label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="可选属性-？"><a href="#可选属性-？" class="headerlink" title="可选属性 ？"></a>可选属性 ？</h4><p>接口里的属性不全都是必需的。 有些是只在某些条件下存在，或者根本不存在。</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">PaintOptions</span> <span class="token punctuation">&#123;</span>
  shape<span class="token operator">:</span> Shape<span class="token punctuation">;</span>
  xPos<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  yPos<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">paintShape</span><span class="token punctuation">(</span>opts<span class="token operator">:</span> PaintOptions<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> shape <span class="token operator">=</span> <span class="token function">getShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">paintShape</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> shape <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">paintShape</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> shape<span class="token punctuation">,</span> xPos<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">paintShape</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> shape<span class="token punctuation">,</span> yPos<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">paintShape</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> shape<span class="token punctuation">,</span> xPos<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> yPos<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><code>xPos</code> 和 <code>yPos</code> 均被视为可选</p>
<h4 id="只读属性-readonly"><a href="#只读属性-readonly" class="headerlink" title="只读属性 readonly"></a>只读属性 readonly</h4><p>一些对象属性在创建的时候定义其值，然后就再也不能被修改，这时候就可以<strong>在属性名前用</strong> readonly 来指定只读属性：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 定义接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">readonly</span> x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// p1和p2的x、y就再也不能被改变了</span>
<span class="token keyword">let</span> p1<span class="token operator">:</span> Point <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2<span class="token operator">:</span> Point <span class="token operator">=</span> <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p>只读数组的类型是<code>ReadonlyArray&lt;元素类型&gt; </code>：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ro<span class="token operator">:</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
ro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>
ro<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>
ro<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>
a <span class="token operator">=</span> ro<span class="token punctuation">;</span> <span class="token comment">// error! 可以看到ReadonlyArray不能赋值到普通数组，不过可以通过类型断言重写：a = ro as number[]</span></code></pre>

<h5 id="readonly-和-const"><a href="#readonly-和-const" class="headerlink" title="readonly 和 const"></a>readonly 和 const</h5><p>最简单判断该用 readonly 还是 const 的方法是看要把它做为变量使用还是做为一个属性。 做为变量使用的话用 const ，若做为属性则使用 readonly 。</p>
<h4 id="额外的属性检查"><a href="#额外的属性检查" class="headerlink" title="额外的属性检查"></a>额外的属性检查</h4><p>示例一，正常：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">&#123;</span>
  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">printLabel</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>示例二，报错：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">&#123;</span>
  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">printLabel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span></code></pre>

<p>prinLabel 函数期待的参数是 LabeledValue 类型的，所以 size 属性显然是多余的，示例一中，定义变量 myObject 时没有指定类型，这么写可以绕开检查，最后没有报错，此外还有两种方式也可以绕开检查：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 使用类型断言</span>
<span class="token function">printLabel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">as</span> LabeledValue<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 添加一个字符串索引签名</span>
<span class="token keyword">interface</span> <span class="token class-name">LabeledValue</span> <span class="token punctuation">&#123;</span>
  label<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span> <span class="token comment">// key是string类型，value是any类型</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">printLabel</span><span class="token punctuation">(</span>labeledObj<span class="token operator">:</span> LabeledValue<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObj<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>labeledObl<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">printLabel</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> label<span class="token operator">:</span> <span class="token string">"Size 10 Object"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p><strong>不提倡绕开检查，除非是包含方法和内部状态的复杂对象字面量，可能需要使用这些技巧。</strong></p>
<h3 id="函数类型接口"><a href="#函数类型接口" class="headerlink" title="函数类型接口"></a>函数类型接口</h3><p>不常用</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Fn</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token comment">// 返回类型为void，则表示不限制返回类型</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> fn<span class="token operator">:</span> <span class="token function-variable function">Fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="可索引接口"><a href="#可索引接口" class="headerlink" title="可索引接口"></a>可索引接口</h3><p>不常用，用于描述哪些能够”通过索引得到”的类型（数组和对象），比如 a[10]、b[“name”]</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 索引签名：index是索引，number是索引的类型，string是索引对应的值的类型</span>
  <span class="token punctuation">[</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> a<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"string1"</span><span class="token punctuation">,</span> <span class="token string">"string2"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="类类型接口"><a href="#类类型接口" class="headerlink" title="类类型接口"></a>类类型接口</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">X</span></span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">eat</span><span class="token punctuation">(</span>food<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 虽然定义了参数，但是其实并不限制参数，只限制返回类型</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token constant">X</span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">public</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"food"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">A</span></span><span class="token punctuation">(</span><span class="token string">"lujinkai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="接口继承接口"><a href="#接口继承接口" class="headerlink" title="接口继承接口"></a>接口继承接口</h4><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">B</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> b<span class="token operator">:</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"lujinkai"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">23</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="接口继承类"><a href="#接口继承类" class="headerlink" title="接口继承类"></a>接口继承类</h4><p>接口不仅可以继承接口，还可以继承类。</p>
<p>示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Control</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> state<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">SelectableControl</span> <span class="token keyword">extends</span> <span class="token class-name">Control</span> <span class="token punctuation">&#123;</span>
  <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="类静态部分和实例部分"><a href="#类静态部分和实例部分" class="headerlink" title="类静态部分和实例部分"></a>类静态部分和实例部分</h4><p>ts 中，类分<strong>静态部分</strong>和<strong>实例部分</strong>，new 实例化对象后，对象中有的部分就是实例化的部分，对象中没有的部分就是静态部分，构造函数 constructor 就是静态部分。</p>
<p>类类型接口只检查实例部分，不检查静态部分，如果想要检查静态部分，可以使用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/class">类表达式</a>。</p>
<p>示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ClockConstructor</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token punctuation">(</span>hour<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> minute<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">interface</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> Clock<span class="token operator">:</span> ClockConstructor <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Clock</span> <span class="token keyword">implements</span> <span class="token class-name">ClockInterface</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>h<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> m<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"beep beep"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>TypeScript 为 JavaScript 函数添加了额外的功能，让我们可以更容易地使用。</p>
<h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">buildName</span><span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lastName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lastName<span class="token punctuation">)</span> <span class="token keyword">return</span> firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> firstName<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">buildName</span><span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> lastName <span class="token operator">=</span> <span class="token string">"Smith"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="剩余参数"><a href="#剩余参数" class="headerlink" title="剩余参数"></a>剩余参数</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">buildName</span><span class="token punctuation">(</span>firstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>restOfName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> firstName <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> restOfName<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token function-variable function">buildNameFun</span><span class="token operator">:</span> <span class="token punctuation">(</span>fname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span> <span class="token operator">=</span> buildName<span class="token punctuation">;</span></code></pre>

<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// myAdd 是函数名</span>
<span class="token comment">// (x:number, y:number) => number 是函数类型</span>
<span class="token comment">// (x: number, y: number): number &#123; return x + y; &#125; 是函数</span>
<span class="token keyword">let</span> <span class="token function-variable function">myAdd</span><span class="token operator">:</span><span class="token punctuation">(</span>x<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p><font color=red>注意：</font>不要混淆了 TypeScript 中的 &#x3D;&gt; 和 ES6 中的 &#x3D;&gt;，在 TypeScript 的类型定义中，&#x3D;&gt; 用来表示函数的定义，&#x3D;&gt; 的左边是输入类型，需要用括号括起来，右边是输出类型</p>
<p>上例还可以写做：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">AddFunc</span> <span class="token operator">=</span>  <span class="token punctuation">(</span>x<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span>

<span class="token keyword">let</span> myAdd<span class="token operator">:</span>AddFunc <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p>或者：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">AddFunc</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>x<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> myAdd<span class="token operator">:</span>AddFunc <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>略。。。</p>
<h3 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h3><p>略。。。</p>
<h2 id="字面量类型"><a href="#字面量类型" class="headerlink" title="字面量类型"></a>字面量类型</h2><h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><h3 id="js-基础复习"><a href="#js-基础复习" class="headerlink" title="js 基础复习"></a>js 基础复习</h3><h4 id="什么是构造函数"><a href="#什么是构造函数" class="headerlink" title="什么是构造函数"></a>什么是构造函数</h4><p>在 JavaScript 中，用 new 关键字来调用的函数，称为构造函数。构造函数首字母一般大写。</p>
<p>es6 的 class 类本质上是对构造函数的封装，示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// es6 class类</span>
<span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">&#123;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以上写法本质上和下面是一样的</span>
<span class="token keyword">function</span> <span class="token function">Greeter</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>greeting <span class="token operator">=</span> message<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
Greeter<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">greet</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string">"Hello, "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>greeting<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeter就是构造函数</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h4 id="js-中的-this-指向"><a href="#js-中的-this-指向" class="headerlink" title="js 中的 this 指向"></a>js 中的 this 指向</h4><ul>
<li>函数中的 this：window</li>
<li>方法中的 this：调用他的对象</li>
<li><strong>构造函数中的 this：通过构造函数创建的实例</strong></li>
<li>事件处理函数中的 this：触发事件的对象</li>
<li>定时器执行的 function 中的 this：window</li>
</ul>
<h3 id="pubic、private、protected"><a href="#pubic、private、protected" class="headerlink" title="pubic、private、protected"></a>pubic、private、protected</h3><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token constant">B</span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<p>B 继承 A，A 是基类，B 是派生类，基类通常被称为<strong>超类</strong>，派生类通常被称作<strong>子类</strong>，子类如果有构造函数，它必须要调用<code>super()</code>。</p>
<ul>
<li>public：类成员（属性和方法）默认是 publc</li>
<li>private：当成员被标记成 private 时，它就不能在声明它的类的外部访问</li>
<li>protected：protected 修饰符与 private 修饰符的行为很相似，但有一点不同， protected 成员在派生类中仍然可以访问</li>
</ul>
<h3 id="readonly-修饰符"><a href="#readonly-修饰符" class="headerlink" title="readonly 修饰符"></a>readonly 修饰符</h3><p>可以使用 readonly 关键字将属性设置为只读。 <strong>只读属性必须在声明时或构造函数里被初始化。</strong></p>
<h3 id="参数属性"><a href="#参数属性" class="headerlink" title="参数属性"></a>参数属性</h3><h3 id="存取器"><a href="#存取器" class="headerlink" title="存取器"></a>存取器</h3><p>首先，存取器要求你将编译器设置为输出 ECMAScript 5 或更高。 不支持降级到 ECMAScript 3。 其次，只带有 get 不带有 set 的存取器自动被推断为 readonly 。</p>
<h3 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h3><p>静态属性存在于类本身上面而不是类的实例上，关键字 <code>static</code> 定义静态属性，实例属性使用 this 访问，静态属性通过类名调用。</p>
<h3 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h3><p>关键字 <code>abstract</code> 定义抽象类和在抽象类内部定义抽象方法。</p>
<p>示例：</p>
<pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">abstract</span> <span class="token function">makeSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"roaming the earth..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h3><h4 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h4><pre class="language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Greeter</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> standardGreeting <span class="token operator">=</span> <span class="token string">"Hello, there"</span><span class="token punctuation">;</span>
  <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Greeter<span class="token punctuation">.</span>standardGreeting<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> greeter1<span class="token operator">:</span> Greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter1<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello, there</span>

<span class="token comment">// `typeof Greeter`取Greeter类的类型，而不是实例的类型。"告诉我Greeter标识符的类型"，也就是构造函数的类型</span>
<span class="token comment">// 这个类型包含了类的所有静态成员和构造函数</span>
<span class="token keyword">let</span> greeterMaker<span class="token operator">:</span> <span class="token keyword">typeof</span> Greeter <span class="token operator">=</span> Greeter<span class="token punctuation">;</span>
greeterMaker<span class="token punctuation">.</span>standardGreeting <span class="token operator">=</span> <span class="token string">"Hey there!"</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> greeter2<span class="token operator">:</span> Greeter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">greeterMaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeter2<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hey there!</span></code></pre>

<h4 id="把类当做接口使用"><a href="#把类当做接口使用" class="headerlink" title="把类当做接口使用"></a>把类当做接口使用</h4><pre class="language-typescript" data-language="typescript"><code class="language-typescript"></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/rtp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/rtp/" class="post-title-link" itemprop="url">RTP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-27 14:45:17" itemprop="dateCreated datePublished" datetime="2021-04-27T14:45:17+08:00">2021-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="直播协议"><a href="#直播协议" class="headerlink" title="直播协议"></a>直播协议</h2><h3 id="RTMP"><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h3><h3 id="HLS"><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h3><h3 id="HTTP-FLV"><a href="#HTTP-FLV" class="headerlink" title="HTTP-FLV"></a>HTTP-FLV</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/udpxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/udpxy/" class="post-title-link" itemprop="url">WebSocket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-04-26 16:33:09" itemprop="dateCreated datePublished" datetime="2021-04-26T16:33:09+08:00">2021-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <pre class="language-none"><code class="language-none">http:&#x2F;&#x2F;192.168.0.12:5056&#x2F;udp&#x2F;224.0.2.26:24012
http:&#x2F;&#x2F;192.168.0.12:5056&#x2F;rtp&#x2F;224.0.2.26:24012
http:&#x2F;&#x2F;192.168.0.15:5056&#x2F;rtp&#x2F;224.0.2.26:24055
http:&#x2F;&#x2F;192.168.0.15:5056&#x2F;status&#x2F;</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/Kubernetes/Prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/Kubernetes/Prometheus/" class="post-title-link" itemprop="url">Prometheus</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-20 08:58:39" itemprop="dateCreated datePublished" datetime="2021-03-20T08:58:39+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>metrics Server 提供核心监控指标，比如 Node 节点的 CPU 和内存使用率，其他的监控交由 Prometheus 组件完成</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>官网：<a target="_blank" rel="noopener" href="https://prometheus.io/docs/introduction/overview/">https://prometheus.io/docs/introduction/overview/</a><br>github：<a target="_blank" rel="noopener" href="https://github.com/prometheus">https://github.com/prometheus</a></p>
<p>prometheus 是基于 go 语言开发的一套开源的监控、报警和时间序列数据库的组合，是由 SoundCloud 公司开发的<br>开源监控系统，prometheus 是 CNCF（Cloud Native Computing Foundation,云原生计算基金会）继 kubernetes 之后毕业的第二个项目，prometheus 在容器和微服务领域中得到了广泛的应用，其特点主要如下：</p>
<pre class="language-none"><code class="language-none">- 使用 key-value 的多维度格式保存数据
- 数据不使用 MySQL 这样的传统数据库，而是使用时序数据库，目前是使用的 TSDB
- 支持第三方 dashboard 实现更高的图形界面，如 grafana（Grafana 2.5.0版本及以上）
- 功能组件化
- 不需要依赖存储，数据可以本地保存也可以远程保存
- 服务自动化发现
- 强大的数据查询语句功（PromQL：Prometheus Query Language）</code></pre>

<h3 id="TSDB"><a href="#TSDB" class="headerlink" title="TSDB"></a>TSDB</h3><p>TSDB：Time Series Database，时间序列数据库，简称时序数据库</p>
<p>什么是时序数据库？顾名思义，就是存储与时间相关的数据，该数据是在时间上分布的一系列值</p>
<p>时序数据库被广泛应用于物联网和运维监控系统</p>
<p><a target="_blank" rel="noopener" href="https://db-engines.com/en/ranking/time+series+dbms">这个网站</a>可以查看各种时序数据库的排名：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1616212047371.png"></p>
<pre class="language-none"><code class="language-none">小而精，性能高，数据量较小(亿级): InfluxDB
简单，数据量不大（千万级），有联合查询、关系型数据库基础：timescales
数据量较大，大数据服务基础，分布式集群需求： opentsdb、KairosDB
分布式集群需求，olap实时在线分析，资源较充足：druid
性能极致追求，数据冷热差异大：Beringei
兼顾检索加载，分布式聚合计算： elsaticsearch
如果你兼具索引和时间序列的需求。那么Druid和Elasticsearch是最好的选择。其性能都不差，同时满足检索和时间序列的特性，并且都是高可用容错架构。</code></pre>

<p>阿里云版 TSDB，文档写的还不错：<a target="_blank" rel="noopener" href="https://help.aliyun.com/product/54825.html">https://help.aliyun.com/product/54825.html</a></p>
<p>Prometheus 内置了 TSDB，目前是 V3.0 版本，是一个独立维护的 TSDB 开源项目；在单机上，每秒可处理数百万个样本</p>
<p>Prometheus TSDB 数据存储格式：</p>
<ul>
<li>以每 2 小时为一个时间窗口，并存储为一个单独的 block</li>
<li>block 会压缩、合并历史数据块，随着压缩合并，其 block 数量会减少</li>
<li>block 的大小并不固定，但最小会保存两个小时的数据</li>
</ul>
<p>P137</p>
<h3 id="PromQL"><a href="#PromQL" class="headerlink" title="PromQL"></a>PromQL</h3><p><a target="_blank" rel="noopener" href="https://songjiayang.gitbooks.io/prometheus/content/promql/summary.html">https://songjiayang.gitbooks.io/prometheus/content/promql/summary.html</a></p>
<p>PromQL：Prometheus Query Language，是 Prometheus 自己开发的数据查询 DSL 语言，语言表现力非常丰富，内置函数很多，在日常数据可视化以及 rule 告警中都会使用到它</p>
<h2 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h2><p><img data-src="//img.to2b.cn/blog/ljk/1616225085558.png"></p>
<pre class="language-none"><code class="language-none">prometheus server：主服务，接受外部http请求，收集、存储与查询数据等
prometheus targets: 静态收集的目标服务数据
service discovery：动态发现服务
prometheus alerting：报警通知
push gateway：数据收集代理服务器(类似于zabbix proxy)
data visualization and export： 数据可视化与数据导出(访问客户端)</code></pre>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>三种安装方式：docker、二进制、operator</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">https://prometheus.io/download/ <span class="token comment">#官方二进制下载及安装，prometheus server的监听端口为9090</span>
https://prometheus.io/docs/prometheus/latest/installation/ <span class="token comment">#docker镜像直接启动</span>
https://github.com/coreos/kube-prometheus <span class="token comment">#operator部署</span></code></pre>

<p>一般不使用 docker 安装，推荐 operator，但是 operator 安装会隐藏很多细节，所以要先学习二进制安装</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1616228790385.png"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">https://github.com/prometheus/prometheus/releases/download/v2.25.2/prometheus-2.25.2.linux-amd64.tar.gz
https://github.com/prometheus/alertmanager/releases/download/v0.21.0/alertmanager-0.21.0.linux-amd64.tar.gz
https://github.com/prometheus/blackbox_exporter/releases/download/v0.18.0/blackbox_exporter-0.18.0.linux-amd64.tar.gz
https://github.com/prometheus/consul_exporter/releases/download/v0.7.1/consul_exporter-0.7.1.linux-amd64.tar.gz
https://github.com/prometheus/graphite_exporter/releases/download/v0.9.0/graphite_exporter-0.9.0.linux-amd64.tar.gz
https://github.com/prometheus/haproxy_exporter/releases/download/v0.12.0/haproxy_exporter-0.12.0.linux-amd64.tar.gz
https://github.com/prometheus/memcached_exporter/releases/download/v0.8.0/memcached_exporter-0.8.0.linux-amd64.tar.gz
https://github.com/prometheus/mysqld_exporter/releases/download/v0.12.1/mysqld_exporter-0.12.1.linux-amd64.tar.gz
https://github.com/prometheus/node_exporter/releases/download/v1.1.2/node_exporter-1.1.2.linux-amd64.tar.gz
https://github.com/prometheus/pushgateway/releases/download/v1.4.0/pushgateway-1.4.0.linux-amd64.tar.gz
https://github.com/prometheus/statsd_exporter/releases/download/v0.20.0/statsd_exporter-0.20.0.linux-amd64.tar.gz</code></pre>

<h3 id="prometheus-server"><a href="#prometheus-server" class="headerlink" title="prometheus server"></a>prometheus server</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$tar</span> zxf prometheus-2.25.2.linux-amd64.tar.gz
<span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$mv</span> prometheus-2.25.2.linux-amd64 /usr/local/prometheus
<span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$cd</span> /usr/local/prometheus/

<span class="token comment"># service启动文件</span>
<span class="token punctuation">[</span>root@k8s-master prometheus<span class="token punctuation">]</span><span class="token variable">$vim</span> /lib/systemd/system/prometheus.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Prometheus Server
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://prometheus.io/docs/introduction/overview/
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">WorkingDirectory</span><span class="token operator">=</span>/usr/local/prometheus/
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/prometheus/prometheus --
<span class="token assign-left variable">config.file</span><span class="token operator">=</span>/usr/local/prometheus/prometheus.yml
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token punctuation">[</span>root@k8s-master prometheus<span class="token punctuation">]</span><span class="token variable">$systemctl</span> daemon-reload
<span class="token punctuation">[</span>root@k8s-master prometheus<span class="token punctuation">]</span><span class="token variable">$systemctl</span> start prometheus.service</code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616230172818.png"></p>
<h3 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node exporter"></a>node exporter</h3><p>收集各 k8s node 节点上的监控指标数据，监听端口为 9100</p>
<p><strong>node exporter 和 metrics server</strong>：</p>
<p>原理都是一样的，都是从 node 的 kublete 获取数据，但是 node exporter 从本机的 kubelet 获取数据，metrics server 从所有 node 的 kubelet 获取数据，所以 node exporter 需要在每个 node 都部署一份，而 metrics server 只部署一个就可以</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1616236958704.png"></p>
<p><strong>安装：</strong></p>
<p>在每个 node 都执行以下安装步骤：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$tar</span> zxf node_exporter-1.1.2.linux-amd64.tar.gz
<span class="token variable">$mv</span> node_exporter-1.1.2.linux-amd64 /usr/local/node_exporter
<span class="token variable">$cd</span> /usr/local/node_exporter/

<span class="token variable">$vim</span> /etc/systemd/system/node-exporter.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Prometheus Node Exporter
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/node_exporter/node_exporter
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token variable">$systemctl</span> daemon-reload
<span class="token variable">$systemctl</span> start node-exporter.service

<span class="token variable">$ss</span> <span class="token parameter variable">-ntlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">9100</span>
LISTEN   <span class="token number">0</span>   <span class="token number">32768</span>   *:9100   *:*   users:<span class="token variable"><span class="token punctuation">((</span>"node_exporter"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">115111</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">))</span></span></code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616239005273.png"></p>
<p><strong>与 prometheus 集成：</strong></p>
<p>在 prometheus server 中添加一个 job：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$pwd
/usr/local/prometheus
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$grep <span class="token punctuation">-</span>v "<span class="token comment">#" prometheus.yml | grep -v "^$"</span>
<span class="token key atrule">global</span><span class="token punctuation">:</span>
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'prometheus'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'localhost:9090'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'promethues-node'</span>		<span class="token comment"># job名称</span>
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">'/metrics'</span>		<span class="token comment"># 默认就是 /metrics</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'10.0.1.31:9100'</span><span class="token punctuation">,</span> <span class="token string">'10.0.1.32:9100'</span><span class="token punctuation">,</span> <span class="token string">'10.0.1.33:9100'</span><span class="token punctuation">]</span>	<span class="token comment"># 被采集的node</span></code></pre>

<p>重启 prometheus ，等一会然后观察监控情况：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1616240903058.png"></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1616240834618.png"></p>
<h3 id="haproxy-exporter"><a href="#haproxy-exporter" class="headerlink" title="haproxy exporter"></a>haproxy exporter</h3><p>除了 node_exporter，官方还提供了监控 haproxy 的 exporter</p>
<ol>
<li><p>需要将其部署在 haproxy 服务所在的节点</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> xvf haproxy_exporter-0.12.0.linux-amd64.tar.gz</code></pre>
</li>
<li><p>prometheus 添加 haproxy 数据采集</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">- job_name: <span class="token string">"prometheus-haproxy"</span>
  static_configs:
    - targets: <span class="token punctuation">[</span><span class="token string">"192.168.7.108:9101"</span><span class="token punctuation">]</span></code></pre>
</li>
<li><p>grafana 添加模板</p>
<p>367 2428</p>
</li>
</ol>
<h3 id="其他-exporter"><a href="#其他-exporter" class="headerlink" title="其他 exporter"></a>其他 exporter</h3><p>如果官方没有提供监控相应服务的 exporter，需要使用第三方或自己开发</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhangguanzhang/harbor_exporter">https://github.com/zhangguanzhang/harbor_exporter</a><br><a target="_blank" rel="noopener" href="https://github.com/nginxinc/nginx-prometheus-exporter/">https://github.com/nginxinc/nginx-prometheus-exporter/</a></p>
<h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><p>调用 prometheus 的数据，进行更专业的可视化</p>
<h2 id="cAdvisor"><a href="#cAdvisor" class="headerlink" title="cAdvisor"></a>cAdvisor</h2><p><a target="_blank" rel="noopener" href="https://www.oschina.net/p/cadvisor">https://www.oschina.net/p/cadvisor</a></p>
<p>cAdvisor 是由谷歌开源的 docker 容器性能分析工具，cAdvisor 可以对节点机器上的资源及容器进行实时监控和性能数据采集，包括 CPU 使用情况、内存使用情况、网络吞吐量及文件系统使用情况，cAdvisor 不仅可以搜集一台机器上所有运行的容器信息，还提供基础查询界面和 http 接口，方便其他组件如 prometheus 进行数据抓取</p>
<p>k8s1.12 之前 cadvisor 集成在 node 节点的上 kubelet 服务中，从 1.12 版本开始分离为两个组件，因此需要在 node 节点单独部署 cadvisor</p>
<p>官方 github 给出部署方法，可是需要 pull 国外的镜像</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cadvisor镜像准备</span>
<span class="token variable">$docker</span> load <span class="token parameter variable">-i</span> cadvisor_v0.36.0.tar.gz
<span class="token variable">$docker</span> tag gcr.io/google_containers/cadvisor:v0.36.0 harbor.ljk.local/k8s/cadvisor:v0.36.0
<span class="token variable">$docker</span> push harbor.ljk.local/k8s/cadvisor:v0.36.0

<span class="token comment"># 在每个节点 启动cadvisor容器</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span>v0.36.0
<span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span><span class="token operator">=</span>/:/rootfs:ro <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span><span class="token operator">=</span>/var/run:/var/run:ro <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span><span class="token operator">=</span>/sys:/sys:ro <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span><span class="token operator">=</span>/var/lib/docker/:/var/lib/docker:ro <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span><span class="token operator">=</span>/dev/disk/:/dev/disk:ro <span class="token punctuation">\</span>
  <span class="token parameter variable">--publish</span><span class="token operator">=</span><span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
  <span class="token parameter variable">--detach</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
  <span class="token parameter variable">--name</span><span class="token operator">=</span>cadvisor <span class="token punctuation">\</span>
  <span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--device</span><span class="token operator">=</span>/dev/kmsg <span class="token punctuation">\</span>
harbor.ljk.local/k8s/cadvisor:<span class="token variable">$&#123;VERSION&#125;</span></code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616300500701.png"></p>
<h3 id="prometheus-采集-cadvisor-数据"><a href="#prometheus-采集-cadvisor-数据" class="headerlink" title="prometheus 采集 cadvisor 数据"></a>prometheus 采集 cadvisor 数据</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$grep <span class="token punctuation">-</span>v "<span class="token comment">#" prometheus.yml | grep -v "^$"</span>
<span class="token key atrule">global</span><span class="token punctuation">:</span>
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'prometheus'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'localhost:9090'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'promethues-node'</span>
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">'/metrics'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'10.0.1.31:9100'</span><span class="token punctuation">,</span> <span class="token string">'10.0.1.32:9100'</span><span class="token punctuation">,</span> <span class="token string">'10.0.1.33:9100'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">'promethues-containers'</span>
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> <span class="token string">'/metrics'</span>
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'10.0.1.32:8080'</span><span class="token punctuation">,</span> <span class="token string">'10.0.1.33:8080'</span><span class="token punctuation">]</span>	<span class="token comment"># cadvisor采集的node</span></code></pre>

<h3 id="grafana-添加-pod-监控模板"><a href="#grafana-添加-pod-监控模板" class="headerlink" title="grafana 添加 pod 监控模板"></a>grafana 添加 pod 监控模板</h3><p>395 893 容器模板 ID</p>
<h2 id="prometheus-报警设置"><a href="#prometheus-报警设置" class="headerlink" title="prometheus 报警设置"></a>prometheus 报警设置</h2><p>prometheus 触发一条告警的过程：</p>
<pre class="language-none"><code class="language-none">prometheus--&gt;触发阈值--&gt;超出持续时间--&gt;alertmanager--&gt;分组|抑制|静默--&gt;媒体类型--&gt;邮件|钉钉|微信等

分组(group): 将类似性质的警报合并为单个通知
静默(silences): 是一种简单的特定时间静音的机制，例如：服务器要升级维护可以先设置这个时间段告警静默
抑制(inhibition): 当警报发出后，停止重复发送由此警报引发的其他警报即合并一个故障引起的多个报警事件，可以消除冗余告警</code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616301621110.png"></p>
<h3 id="安装-alertmanager"><a href="#安装-alertmanager" class="headerlink" title="安装 alertmanager"></a>安装 alertmanager</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$tar</span> zxf alertmanager-0.21.0.linux-amd64.tar.gz
<span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$mv</span> alertmanager-0.21.0.linux-amd64 /usr/local/alertmanager
<span class="token punctuation">[</span>root@k8s-master src<span class="token punctuation">]</span><span class="token variable">$cd</span> /usr/local/alertmanager/</code></pre>

<h3 id="配置-alertmanager"><a href="#配置-alertmanager" class="headerlink" title="配置 alertmanager"></a>配置 alertmanager</h3><p>官方配置文档：<a target="_blank" rel="noopener" href="https://prometheus.io/docs/alerting/configuration/">https://prometheus.io/docs/alerting/configuration/</a></p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master alertmanager<span class="token punctuation">]</span>$cat alertmanager.yml
<span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">resolve_timeout</span><span class="token punctuation">:</span> 5m
  <span class="token key atrule">smtp_smarthost</span><span class="token punctuation">:</span> <span class="token string">"smtp.qq.com:465"</span>
  <span class="token key atrule">smtp_from</span><span class="token punctuation">:</span> <span class="token string">"441757636@qq.com"</span>
  <span class="token key atrule">smtp_auth_username</span><span class="token punctuation">:</span> <span class="token string">"441757636@qq.com"</span>
  <span class="token key atrule">smtp_auth_password</span><span class="token punctuation">:</span> <span class="token string">"udwthuyxjstcdhcj"</span>	<span class="token comment"># 授权码随便写的</span>
  <span class="token key atrule">smtp_hello</span><span class="token punctuation">:</span> <span class="token string">"@qq.com"</span>
  <span class="token key atrule">smtp_require_tls</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">route</span><span class="token punctuation">:</span> <span class="token comment">#设置报警的分发策略</span>
  <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"alertname"</span><span class="token punctuation">]</span> <span class="token comment">#采用哪个标签来作为分组依据</span>
  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 10s <span class="token comment">#组告警等待时间。也就是告警产生后等待10s，如果有同组告警一起发出</span>
  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 10s <span class="token comment">#两组告警的间隔时间</span>
  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 2m <span class="token comment">#重复告警的间隔时间，减少相同邮件的发送频率</span>
  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">"web.hook"</span> <span class="token comment">#设置接收人，这个接收人在下面会有定义</span>
<span class="token key atrule">receivers</span><span class="token punctuation">:</span>	<span class="token comment"># 定义接收人</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"web.hook"</span>	<span class="token comment"># 定义接收人：web.hook，这里定义为接收人是一个邮箱</span>
    <span class="token comment">#webhook_configs:</span>
    <span class="token comment">#- url: 'http://127.0.0.1:5001/'</span>
    <span class="token key atrule">email_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">to</span><span class="token punctuation">:</span> <span class="token string">"2973707860@qq.com"</span>
<span class="token key atrule">inhibit_rules</span><span class="token punctuation">:</span> <span class="token comment">#禁止的规则</span>
  <span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span> <span class="token comment">#源匹配级别</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">"critical"</span>
    <span class="token key atrule">target_match</span><span class="token punctuation">:</span>
      <span class="token key atrule">severity</span><span class="token punctuation">:</span> <span class="token string">"warning"</span>
    <span class="token key atrule">equal</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"alertname"</span><span class="token punctuation">,</span> <span class="token string">"dev"</span><span class="token punctuation">,</span> <span class="token string">"instance"</span><span class="token punctuation">]</span></code></pre>

<h3 id="启动-alertmanager"><a href="#启动-alertmanager" class="headerlink" title="启动 alertmanager"></a>启动 alertmanager</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 二进制启动</span>
$./alertmanager <span class="token parameter variable">--config.file</span><span class="token operator">=</span>./alertmanager.yml

<span class="token comment"># service启动</span>
<span class="token variable">$vim</span> /lib/systemd/system/alertmanager.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Prometheus Server
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://prometheus.io/docs/introduction/overview/
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">WorkingDirectory</span><span class="token operator">=</span>/usr/local/prometheus/
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/prometheus/prometheus <span class="token parameter variable">--config.file</span><span class="token operator">=</span>/usr/local/prometheus/prometheus.yml
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target

<span class="token variable">$lsof</span> <span class="token parameter variable">-i:9093</span>		<span class="token comment"># 监听9093端口</span>
COMMAND     PID <span class="token environment constant">USER</span>   FD   TYPE DEVICE SIZE/OFF NODE NAME
alertmana <span class="token number">53151</span> root    9u  IPv6 <span class="token number">195688</span>      0t0  TCP *:9093 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616303518557.png"></p>
<h3 id="报警规则文件示例"><a href="#报警规则文件示例" class="headerlink" title="报警规则文件示例"></a>报警规则文件示例</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span>				<span class="token comment"># 警报规则组的名称</span>
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span>			<span class="token comment"># 警报规则的名称</span>
        <span class="token key atrule">expr</span><span class="token punctuation">:</span>			<span class="token comment"># 使用PromQL表达式完成的警报触发条件，用于计算是否有满足触发条件</span>
        <span class="token key atrule">for</span><span class="token punctuation">:</span>			<span class="token comment"># 触发报警条件，等一段时间（pending）再报警</span>
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>			<span class="token comment"># 自定义标签，允许自行定义标签附加在警报上</span>
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>	<span class="token comment"># 设置有关警报的一组描述信息，其中包括自定义的标签，以及expr计算后的值</span></code></pre>

<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$pwd
/usr/local/prometheus
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$vim rule.yml
<span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> linux_pod.rules
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> Pod_all_cpu_usage
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> (sum by(name)(rate(container_cpu_usage_seconds_total<span class="token punctuation">&#123;</span>image<span class="token tag">!=</span>""<span class="token punctuation">&#125;</span><span class="token punctuation">[</span>5m<span class="token punctuation">]</span>))<span class="token important">*100)</span> <span class="token punctuation">></span> 75
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 5m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
          <span class="token key atrule">service</span><span class="token punctuation">:</span> pods
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> 容器 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $labels.name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> CPU 资源利用率大于 75% <span class="token punctuation">,</span> (current value is <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>)
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> Dev CPU 负载告警
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> Pod_all_memory_usage
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> sort_desc(avg by(name)(irate(container_memory_usage_bytes<span class="token punctuation">&#123;</span>name<span class="token tag">!=</span>""<span class="token punctuation">&#125;</span><span class="token punctuation">[</span>5m<span class="token punctuation">]</span>))<span class="token important">*100)</span> <span class="token punctuation">></span> 1024<span class="token important">*10^3*2</span>
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> 容器 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $labels.name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> Memory 资源利用率大于 2G <span class="token punctuation">,</span> (current value is <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>)
          <span class="token key atrule">summary</span><span class="token punctuation">:</span> Dev Memory 负载告警
      <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> Pod_all_network_receive_usage
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> sum by (name)(irate(container_network_receive_bytes_total<span class="token punctuation">&#123;</span>container_name="POD"<span class="token punctuation">&#125;</span><span class="token punctuation">[</span>1m<span class="token punctuation">]</span>)) <span class="token punctuation">></span> 1024<span class="token important">*1024*50</span>
        <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical
        <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">description</span><span class="token punctuation">:</span> 容器 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $labels.name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> network_receive 资源利用率大于 50M <span class="token punctuation">,</span> (current value is <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> $value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>)</code></pre>

<h3 id="配置-prometheus"><a href="#配置-prometheus" class="headerlink" title="配置 prometheus"></a>配置 prometheus</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml">$cat prometheus.yml
<span class="token punctuation">...</span>
<span class="token comment"># Alertmanager configuration</span>
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> 10.0.1.31<span class="token punctuation">:</span><span class="token number">9093</span> <span class="token comment">#alertmanager地址</span>

<span class="token comment"># Load rules once and periodically evaluate them according to the global 'evaluation_interval'.</span>
<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
  <span class="token comment"># - "first_rules.yml"</span>
  <span class="token punctuation">-</span> <span class="token string">"/usr/local/prometheus/rule.yml"</span> <span class="token comment">#指定规则文件</span>

<span class="token punctuation">...</span>

<span class="token comment"># 验证报警规则</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$./promtool check rules ./rule.yml
Checking ./rule.yml
  <span class="token key atrule">SUCCESS</span><span class="token punctuation">:</span> 3 rules found
<span class="token comment"># 重启prometheus</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master prometheus<span class="token punctuation">]</span>$systemctl restart prometheus</code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1616389078150.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/Kubernetes/%E4%B8%9A%E5%8A%A1%E9%95%9C%E5%83%8F%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%9B%9E%E6%BB%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/Kubernetes/%E4%B8%9A%E5%8A%A1%E9%95%9C%E5%83%8F%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%8F%8A%E5%9B%9E%E6%BB%9A/" class="post-title-link" itemprop="url">业务镜像版本升级及回滚</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-20 00:25:13" itemprop="dateCreated datePublished" datetime="2021-03-20T00:25:13+08:00">2021-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><pre class="language-bash" data-language="bash"><code class="language-bash">kubectl apply <span class="token parameter variable">-f</span> nginx.yaml <span class="token parameter variable">--record</span><span class="token operator">=</span>true	<span class="token comment"># --record=true为记录执行的kubectl</span></code></pre>

<h2 id="滚动更新"><a href="#滚动更新" class="headerlink" title="滚动更新"></a>滚动更新</h2><p><strong>滚动更新策略 <code>spec.strategy</code>：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: Enter deployment name
spec:
  strategy:
    rollingUpdate:
      maxSurge: <span class="token number">1</span>			<span class="token comment"># 一次性最多添加多少pod</span>
      maxUnavailable: <span class="token number">1</span>		<span class="token comment"># 不可用Pod的数量最多是多少</span>
    type: RollingUpdate		<span class="token comment"># 指定更新策略：滚动更新</span>
  replicas: Enter the number of replicas
  template:
    metadata:
      labels:
        editor: vscode
    spec:
      containers:
      - name: name
        image: Enter containers image</code></pre>

<p>更新策略有两种：</p>
<ul>
<li>RollingUpdate ：默认的更新策略，表示滚动更新</li>
<li>Recreate：重建，会终止所有正在运行的实例，然后用较新的版本来重新创建它们，即在创建新 Pods 之前，所有现有的 Pods 会被杀死，测试环境可以使用</li>
</ul>
<p>Pod 有多个副本，滚动更新的过程就是轮流更新 pod，直至所有 pod 都更新成功，至于如何轮流更新，取决于 maxSurge 和 maxUnavailable 这两个参数，示例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 如果Pod有5个</span>
maxSurge: <span class="token number">1</span>			<span class="token comment"># 每次添加1个新版本Pod，启动成功后删除一个旧版本Pod</span>
maxUnavailable: <span class="token number">0</span>	<span class="token comment"># 不允许有不可用的Pod，即更新过程中始终保持5个Pod正常运行</span></code></pre>

<p><strong>升级命令 <code>kubectl set</code>：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">kubectl <span class="token builtin class-name">set</span> image <span class="token punctuation">(</span>-f FILENAME <span class="token operator">|</span> TYPE NAME<span class="token punctuation">)</span> <span class="token assign-left variable">CONTAINER_NAME_1</span><span class="token operator">=</span>CONTAINER_IMAGE_1 <span class="token punctuation">..</span>. <span class="token assign-left variable">CONTAINER_NAME_N</span><span class="token operator">=</span>CONTAINER_IMAGE_N <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

<span class="token comment"># 示例</span>
kubectl <span class="token builtin class-name">set</span> image deployment/nginx <span class="token assign-left variable">busybox</span><span class="token operator">=</span>busybox <span class="token assign-left variable">nginx</span><span class="token operator">=</span>nginx:1.9.1
kubectl <span class="token builtin class-name">set</span> image deployments,rc <span class="token assign-left variable">nginx</span><span class="token operator">=</span>nginx:1.9.1 <span class="token parameter variable">--all</span>
kubectl <span class="token builtin class-name">set</span> image daemonset abc *<span class="token operator">=</span>nginx:1.9.1
kubectl <span class="token builtin class-name">set</span> image <span class="token parameter variable">-f</span> path/to/file.yaml <span class="token assign-left variable">nginx</span><span class="token operator">=</span>nginx:1.9.1 <span class="token parameter variable">--local</span> <span class="token parameter variable">-o</span> yaml</code></pre>

<p>除了使用 <code>kubectl get</code> 命令升级，还可以直接 <code>kubectl apply -f</code> 升级，但是需要先手动修改 yaml 文件，所以不推荐使用</p>
<h2 id="回滚"><a href="#回滚" class="headerlink" title="回滚"></a>回滚</h2><h3 id="回滚到上一个版本"><a href="#回滚到上一个版本" class="headerlink" title="回滚到上一个版本"></a>回滚到上一个版本</h3><pre class="language-bash" data-language="bash"><code class="language-bash">kubectl rollout undo deployment/nginx-deployment <span class="token parameter variable">-n</span> linux36</code></pre>

<h3 id="回滚到指定版本"><a href="#回滚到指定版本" class="headerlink" title="回滚到指定版本"></a>回滚到指定版本</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看当前版本号</span>
kubectl rollout <span class="token function">history</span> deployment/nginx-deployment <span class="token parameter variable">-n</span> linux36
deployment.extensions/nginx-deployment
REVISION CHANGE-CAUSE
<span class="token number">1</span> 	kubectl apply <span class="token parameter variable">--filename</span><span class="token operator">=</span>nginx.yaml <span class="token parameter variable">--record</span><span class="token operator">=</span>true
<span class="token number">3</span> 	kubectl apply <span class="token parameter variable">--filename</span><span class="token operator">=</span>nginx.yaml <span class="token parameter variable">--record</span><span class="token operator">=</span>true
<span class="token number">4</span> 	kubectl apply <span class="token parameter variable">--filename</span><span class="token operator">=</span>nginx.yaml <span class="token parameter variable">--record</span><span class="token operator">=</span>true

<span class="token comment"># 回滚到指定的1版本</span>
kubectl rollout undo deployment/nginx-deployment --to-revision<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-n</span> linux36</code></pre>

<h2 id="Jenkins-持续继承与部署"><a href="#Jenkins-持续继承与部署" class="headerlink" title="Jenkins 持续继承与部署"></a>Jenkins 持续继承与部署</h2><p>参考以下脚本：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$cat</span> build-command.sh

<span class="token comment">#!/bin/bash</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> harbor.magedu.local/pub-images/nginx-base-wordpress:v1.14.2  <span class="token builtin class-name">.</span>
<span class="token function">sleep</span> <span class="token number">1</span>
<span class="token function">docker</span> push  harbor.magedu.local/pub-images/nginx-base-wordpress:v1.14.2</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$cat</span> linux36-ningx-deploy.sh

<span class="token comment">#!/bin/bash</span>
<span class="token comment">#Author: ZhangShiJie</span>
<span class="token comment">#Date: 2019-08-03</span>
<span class="token comment">#Version: v1</span>
<span class="token comment">#记录脚本开始执行时间</span>
<span class="token assign-left variable">starttime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span>
<span class="token comment">#变量</span>
<span class="token assign-left variable">SHELL_DIR</span><span class="token operator">=</span><span class="token string">"/root/scripts"</span>
<span class="token assign-left variable">SHELL_NAME</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$0</span>"</span>
<span class="token assign-left variable">K8S_CONTROLLER1</span><span class="token operator">=</span><span class="token string">"192.168.7.101"</span>
<span class="token assign-left variable">K8S_CONTROLLER2</span><span class="token operator">=</span><span class="token string">"192.168.7.102"</span>
<span class="token assign-left variable">DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%m-%d_%H_%M_%S<span class="token variable">)</span></span>
<span class="token assign-left variable">METHOD</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">Branch</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-z</span> <span class="token variable">$Branch</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">Branch</span><span class="token operator">=</span>develop
<span class="token keyword">fi</span>
<span class="token keyword">function</span> <span class="token function-name function">Code_Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token assign-left variable">Git_URL</span><span class="token operator">=</span><span class="token string">"git@172.20.100.1:linux36/app1.git"</span>
    <span class="token assign-left variable">DIR_NAME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">&#123;</span>Git_URL<span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">"/"</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">"."</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span>
    <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span><span class="token string">"/data/gitdata/linux36"</span>
    <span class="token assign-left variable">Git_Dir</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;DATA_DIR&#125;</span>/<span class="token variable">$&#123;DIR_NAME&#125;</span>"</span>
    <span class="token builtin class-name">cd</span> <span class="token variable">$&#123;DATA_DIR&#125;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"即将清空上一版本代码并获取当前分支最新代码"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span>
    <span class="token variable">$&#123;DIR_NAME&#125;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"即将开始从分支<span class="token variable">$&#123;Branch&#125;</span> 获取代码"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">git</span> clone <span class="token parameter variable">-b</span> <span class="token variable">$&#123;Branch&#125;</span> <span class="token variable">$&#123;Git_URL&#125;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"分支<span class="token variable">$&#123;Branch&#125;</span> 克隆完成，即将进行代码编译!"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token comment">#cd $&#123;Git_Dir&#125; &amp;&amp; mvn clean package</span>
    <span class="token comment">#echo "代码编译完成，即将开始将IP地址等信息替换为测试环境"</span>
    <span class="token comment">#####################################################</span>
    <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token builtin class-name">cd</span> <span class="token variable">$&#123;Git_Dir&#125;</span>
    <span class="token function">tar</span> czf <span class="token variable">$&#123;DIR_NAME&#125;</span>.tar.gz ./*
<span class="token punctuation">&#125;</span>

<span class="token comment">#将打包好的压缩文件拷贝到k8s 控制端服务器</span>
<span class="token keyword">function</span> <span class="token function-name function">Copy_File</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"压缩文件打包完成，即将拷贝到k8s 控制端服务器<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span>"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">scp</span> <span class="token variable">$&#123;Git_Dir&#125;</span>/<span class="token variable">$&#123;DIR_NAME&#125;</span>.tar.gz root@<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span>:/opt/k8s-
    data/dockerfile/linux36/nginx/
    <span class="token builtin class-name">echo</span> <span class="token string">"压缩文件拷贝完成,服务器<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span>即将开始制作Docker 镜像!"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#到控制端执行脚本制作并上传镜像</span>
<span class="token keyword">function</span> <span class="token function-name function">Make_Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"开始制作Docker镜像并上传到Harbor服务器"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">ssh</span> root@<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span> <span class="token string">"cd /opt/k8s-data/dockerfile/linux36/nginx &amp;&amp; bash build-
command.sh <span class="token variable">$&#123;DATE&#125;</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Docker镜像制作完成并已经上传到harbor服务器"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#到控制端更新k8s yaml文件中的镜像版本号,从而保持yaml文件中的镜像版本号和k8s中版本号一致</span>
<span class="token keyword">function</span> <span class="token function-name function">Update_k8s_yaml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"即将更新k8s yaml文件中镜像版本"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token function">ssh</span> root@<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span> <span class="token string">"cd /opt/k8s-data/yaml/linux36/nginx &amp;&amp; sed -i 's/image:
harbor.magedu.*/image: harbor.magedu.net\/linux36\/nginx-web1:<span class="token variable">$&#123;DATE&#125;</span>/g' nginx.yaml"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"k8s yaml文件镜像版本更新完成,即将开始更新容器中镜像版本"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#到控制端更新k8s中容器的版本号,有两种更新办法，一是指定镜像版本更新，二是apply执行修改过的yaml文件</span>
<span class="token keyword">function</span> <span class="token function-name function">Update_k8s_container</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">#第一种方法</span>
    <span class="token function">ssh</span> root@<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span> <span class="token string">"kubectl set image deployment/linux36-nginx-deployment linux36-nginx-container=harbor.magedu.net/linux36/nginx-web1:<span class="token variable">$&#123;DATE&#125;</span> -n linux36"</span>
    <span class="token comment">#第二种方法,推荐使用第一种</span>
    <span class="token comment">#ssh root@$&#123;K8S_CONTROLLER1&#125; "cd /opt/k8s-data/yaml/web-test/tomcat-app1 &amp;&amp; kubectl apply -f web-test.yam --record"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"k8s 镜像更新完成"</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"当前业务镜像版本: harbor.magedu.net/linux36/nginx-web1:<span class="token variable">$&#123;DATE&#125;</span>"</span>
    <span class="token comment">#计算脚本累计执行时间，如果不需要的话可以去掉下面四行</span>
    <span class="token assign-left variable">endtime</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token variable">)</span></span>
    <span class="token assign-left variable">start_seconds</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">--date</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$starttime</span>"</span> +%s<span class="token variable">)</span></span>
    <span class="token assign-left variable">end_seconds</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">--date</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$endtime</span>"</span> +%s<span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">"本次业务镜像更新总计耗时："</span><span class="token variable"><span class="token variable">$((</span>end_seconds <span class="token operator">-</span> start_seconds<span class="token variable">))</span></span><span class="token string">"s"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#基于k8s 内置版本管理回滚到上一个版本</span>
<span class="token keyword">function</span> <span class="token function-name function">rollback_last_version</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"即将回滚之上一个版本"</span>
    <span class="token function">ssh</span> root@<span class="token variable">$&#123;K8S_CONTROLLER1&#125;</span> <span class="token string">"kubectl rollout undo deployment/linux36-nginx-deployment -n linux36"</span>
    <span class="token function">sleep</span> <span class="token number">1</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"已执行回滚至上一个版本"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#使用帮助</span>
<span class="token function-name function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"部署使用方法为 <span class="token variable">$&#123;SHELL_DIR&#125;</span>/<span class="token variable">$&#123;SHELL_NAME&#125;</span> deploy "</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"回滚到上一版本使用方法为 <span class="token variable">$&#123;SHELL_DIR&#125;</span>/<span class="token variable">$&#123;SHELL_NAME&#125;</span> rollback_last_version"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">#主函数</span>
<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token variable">$&#123;METHOD&#125;</span> <span class="token keyword">in</span>
    deploy<span class="token punctuation">)</span>
        Code_Clone
        Copy_File
        Make_Image
        Update_k8s_yaml
        Update_k8s_container
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    rollback_last_version<span class="token punctuation">)</span>
        rollback_last_version
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
        usage
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token punctuation">&#125;</span>

main <span class="token variable">$1</span> <span class="token variable">$2</span> <span class="token variable">$3</span></code></pre>

<h2 id="代码升级和回滚"><a href="#代码升级和回滚" class="headerlink" title="代码升级和回滚"></a>代码升级和回滚</h2><p>代码升级：Jenkins 负责 pull 最新代码，编译成 war 包（如果需要），然后将编译后的包发送到 k8s 或者专门负责制作镜像的服务器，使用 dockerfile 制作完新镜像后，就上传到 harbor，最后再由 kubectl 执行更新镜像的操作</p>
<p>代码回滚：直接回滚镜像即可</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/Kubernetes/Pod%E7%9A%84%E7%8A%B6%E6%80%81%E5%92%8C%E6%8E%A2%E9%92%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/Kubernetes/Pod%E7%9A%84%E7%8A%B6%E6%80%81%E5%92%8C%E6%8E%A2%E9%92%88/" class="post-title-link" itemprop="url">Pod的状态和探针</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-18 15:56:00" itemprop="dateCreated datePublished" datetime="2021-03-18T15:56:00+08:00">2021-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Pod 的生命周期：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/">https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/</a></p>
<h2 id="Pod-状态"><a href="#Pod-状态" class="headerlink" title="Pod 状态"></a>Pod 状态</h2><p><img data-src="//img.to2b.cn/blog/ljk/1616054219990.png"></p>
<ol>
<li><p>第一阶段</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Pending		<span class="token comment"># 正在创建Pod但是Pod中的容器还没有全部被创建完成，处于此状态的Pod应该检查Pod依赖的存储是否有权限挂载、镜像是否可以下载、调度是否正常等</span>
Failed		<span class="token comment"># Pod中有容器启动失败而导致pod工作异常</span>
Unknown		<span class="token comment"># 由于某种原因无法获得pod的当前状态，通常是由于与pod所在的node节点通信错误</span>
Succeeded	<span class="token comment"># Pod中的所有容器都被成功终止即pod里所有的containers均已terminated</span></code></pre>
</li>
<li><p>第二阶段</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Unschedulable		<span class="token comment"># Pod不能被调度，kube-scheduler没有匹配到合适的node节点</span>
PodScheduled		<span class="token comment"># pod正处于调度中，在kube-scheduler刚开始调度的时候，还没有将pod分配到指定的node，在筛选出合适的节点后就会更新etcd数据，将pod分配到指定的node</span>
Initialized			<span class="token comment"># 所有pod中的初始化容器已经完成了</span>
ImagePullBackOff	<span class="token comment"># Pod所在的node节点下载镜像失败</span>
Running				<span class="token comment"># Pod内部的容器已经被创建并且启动</span>
Ready				<span class="token comment"># 表示pod中的容器已经可以提供访问服务</span></code></pre>
</li>
<li><p>第三阶段</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Succeeded
Failed</code></pre></li>
</ol>
<p><img data-src="//img.to2b.cn/blog/ljk/1616054631438.png"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Error                      <span class="token comment">#pod 启动过程中发生错误</span>
NodeLost                   <span class="token comment">#Pod 所在节点失联</span>
Unkown                     <span class="token comment">#Pod 所在节点失联或其它未知异常</span>
Waiting                    <span class="token comment">#Pod 等待启动</span>
Pending                    <span class="token comment">#Pod 等待被调度</span>
Terminating:               <span class="token comment">#Pod 正在被销毁</span>
CrashLoopBackOff           <span class="token comment">#pod，但是kubelet正在将它重启</span>
InvalidImageName           <span class="token comment">#node节点无法解析镜像名称导致的镜像无法下载</span>
ImageInspectError          <span class="token comment">#无法校验镜像，镜像不完整导致</span>
ErrImageNeverPull          <span class="token comment">#策略禁止拉取镜像，镜像中心权限是私有等</span>
ImagePullBackOff           <span class="token comment">#镜像拉取失败，但是正在重新拉取</span>
RegistryUnavailable        <span class="token comment">#镜像服务器不可用，网络原因或harbor宕机</span>
ErrImagePull               <span class="token comment">#镜像拉取出错，超时或下载被强制终止</span>
CreateContainerConfigError <span class="token comment">#不能创建kubelet使用的容器配置</span>
CreateContainerError       <span class="token comment">#创建容器失败</span>
PreStartContainer          <span class="token comment">#执行preStart hook报错，Pod hook(钩子)是由 Kubernetes 管理的 kubelet 发起的，当容器中的进程启动前或者容器中的进程终止之前运行，比如容器创建完成后里面的服务启动之前可以检查一下依赖的其它服务是否启动，或者容器退出之前可以把容器中的服务先通过命令停止。</span>
PostStartHookError         <span class="token comment">#执行 postStart hook 报错</span>
RunContainerError          <span class="token comment">#pod运行失败，容器中没有初始化PID为1的守护进程等</span>
ContainersNotInitialized   <span class="token comment">#pod没有初始化完毕</span>
ContainersNotReady         <span class="token comment">#pod没有准备完毕</span>
ContainerCreating          <span class="token comment">#pod正在创建中</span>
PodInitializing            <span class="token comment">#pod正在初始化中</span>
DockerDaemonNotReady       <span class="token comment">#node节点decker服务没有启动</span>
NetworkPluginNotReady      <span class="token comment">#网络插件还没有完全启动</span></code></pre>

<h2 id="Pod-调度过程"><a href="#Pod-调度过程" class="headerlink" title="Pod 调度过程"></a>Pod 调度过程</h2><p>参考：<a href="./%E5%9F%BA%E7%A1%80/#kube-scheduler">kube-scheduler</a></p>
<h2 id="Pod-探针"><a href="#Pod-探针" class="headerlink" title="Pod 探针"></a>Pod 探针</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#container-probes">https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#container-probes</a></p>
<p>探针是 kubelet 对容器执行的定期诊断，以保证 Pod 的状态始终处于运行状态，要执行诊断，kubelet 调用由容器实现的 Handler（处理程序），有三种类型的处理程序：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ExecAction      <span class="token comment">#在容器内执行指定命令，如果命令退出时返回码为0则认为诊断成功</span>
TCPSocketAction <span class="token comment">#对指定端口上的容器的IP地址进行TCP检查，如果端口打开，则诊断被认为是成功的</span>
HTTPGetAction   <span class="token comment">#对指定的端口和路径上的容器的IP地址执行HTTPGet请求，如果响应的状态码大于等于200且小于 400，则诊断被认为是成功的</span></code></pre>

<p>每次探测都将获得以下三种结果之一：</p>
<pre class="language-none"><code class="language-none">成功：容器通过了诊断
失败：容器未通过诊断
未知：诊断失败，因此不会采取任何行动</code></pre>

<h3 id="探针类型"><a href="#探针类型" class="headerlink" title="探针类型"></a>探针类型</h3><pre class="language-bash" data-language="bash"><code class="language-bash">livenessProbe	<span class="token comment"># 存活探针，检测容器容器是否正在运行，如果存活探测失败，则kubelet会杀死容器，并且容器将受到其重启策略的影响，如果容器不提供存活探针，则默认状态为 Success，livenessProbe用于控制是否重启pod</span>

readinessProbe	<span class="token comment"># 就绪探针，如果就绪探测失败，端点控制器将从与Pod匹配的所有Service的端点中删除该Pod的IP地址，初始延迟之前的就绪状态默认为Failure(失败)，如果容器不提供就绪探针，则默认状态为 Success，readinessProbe用于控制pod是否添加至service</span></code></pre>

<p>livenessProbe 和 readinessProbe 的对比：</p>
<pre class="language-none"><code class="language-none">1. 配置参数一样
2. livenessProbe用于控制是否重启pod，readinessProbe用于控制pod是否添加至service
3. livenessProbe连续探测失败会重启、重建pod，readinessProbe不会执行重启或者重建Pod操作
4. livenessProbe连续检测指定次数失败后会将容器置于(Crash Loop BackOff)且不可用，readinessProbe不会
5. readinessProbe 连续探测失败会从service的endpointd中删除该Pod，livenessProbe不具备此功能，但是会将容器挂起livenessProbe

建议：两个探针都配置</code></pre>

<h3 id="探针配置"><a href="#探针配置" class="headerlink" title="探针配置"></a>探针配置</h3><p>探针有很多配置字段，可以使用这些字段精确的控制存活和就绪检测的行为：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">initialDelaySeconds: <span class="token number">120</span> <span class="token comment"># 初始化延迟时间，告诉kubelet在执行第一次探测前应该等待多少秒，默认是0秒，最小值是0</span>
periodSeconds: <span class="token number">60</span>        <span class="token comment"># 探测周期间隔时间，指定了kubelet应该每多少秒秒执行一次存活探测，默认是10秒。最小值是1</span>
timeoutSeconds: <span class="token number">5</span>        <span class="token comment"># 单次探测超时时间，探测的超时后等待多少秒，默认值是1秒，最小值是1</span>
successThreshold: <span class="token number">1</span>      <span class="token comment"># 从失败转为成功的重试次数，探测器在失败后，被视为成功的最小连续成功数，默认值是1，存活探测的这个值必须是1，最小值是 1</span>
failureThreshold: <span class="token number">3</span>      <span class="token comment"># 从成功转为失败的重试次数，当Pod启动了并且探测到失败，Kubernetes的重试次数，存活探测情况下的放弃就意味着重新启动容器，就绪探测情况下的放弃Pod 会被打上未就绪的标签，默认值是3，最小值是1</span></code></pre>

<p>HTTP 探测器可以在 httpGet 上配置额外的字段：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">host:                     <span class="token comment">#连接使用的主机名，默认是Pod的 IP，也可以在HTTP头中设置 "Host" 来代替</span>
scheme: http              <span class="token comment">#用于设置连接主机的方式（HTTP 还是 HTTPS），默认是 HTTP</span>
path: /monitor/index.html <span class="token comment">#访问 HTTP 服务的路径</span>
httpHeaders:              <span class="token comment">#请求中自定义的 HTTP 头,HTTP 头字段允许重复</span>
port: <span class="token number">80</span>                  <span class="token comment">#访问容器的端口号或者端口名，如果数字必须在 1 ～ 65535 之间</span></code></pre>

<h3 id="HTTP-探针示例"><a href="#HTTP-探针示例" class="headerlink" title="HTTP 探针示例"></a>HTTP 探针示例</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#apiVersion: extensions/v1beta1</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span> <span class="token comment">#rs or deployment</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token comment">#matchExpressions:</span>
    <span class="token comment"># - &#123;key: app, operator: In, values: [ng-deploy-80,ng-rs-81]&#125;</span>
    <span class="token key atrule">template</span><span class="token punctuation">:</span>
      <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
      <span class="token key atrule">spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">containers</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
            <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.5
            <span class="token key atrule">ports</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
            <span class="token comment">#readinessProbe:</span>
            <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
              <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
                <span class="token comment">#path: /monitor/monitor.html</span>
                <span class="token key atrule">path</span><span class="token punctuation">:</span> /index.html <span class="token comment"># 探测的url</span>
                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># 等五秒才开始第一次检测</span>
              <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># 探测周期</span>
              <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># 单次探测超时时间</span>
              <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 处于失败中，探测成功一次就算成功</span>
              <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment"># 出于成功中，探测失败三次才算失败</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
<span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">40012</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
<span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token key atrule">selector</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span></code></pre>

<h3 id="TCP-探针示例"><a href="#TCP-探针示例" class="headerlink" title="TCP 探针示例"></a>TCP 探针示例</h3><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#apiVersion: extensions/v1beta1</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
  <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span> <span class="token comment">#rs or deployment</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
  <span class="token comment">#matchExpressions:</span>
  <span class="token comment"># - &#123;key: app, operator: In, values: [ng-deploy-80,ng-rs-81]&#125;</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.5
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span> <span class="token comment">#或readinessProbe:</span>
            <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">3</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">81</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">40012</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ng<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">80</span></code></pre>

<h3 id="ExecAction-探针"><a href="#ExecAction-探针" class="headerlink" title="ExecAction 探针"></a>ExecAction 探针</h3><p>基于指定的命令对 Pod 进行特定的状态检查</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#apiVersion: extensions/v1beta1</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
  <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span> <span class="token comment">#rs or deployment</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">6379</span>
  <span class="token comment">#matchExpressions:</span>
  <span class="token comment"># - &#123;key: app, operator: In, values: [redis-deploy-6379,ng-rs-81]&#125;</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">6379</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">6379</span>
      <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token comment">#readinessProbe:</span>
      <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
        <span class="token key atrule">exec</span><span class="token punctuation">:</span>
          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token comment"># 基于指定的命令对Pod进行特定的状态检查</span>
            <span class="token comment">#- /apps/redis/bin/redis-cli</span>
            <span class="token punctuation">-</span> /usr/local/bin/redis<span class="token punctuation">-</span>cli
            <span class="token punctuation">-</span> quit
        <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">3</span>
        <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">6379</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">40016</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span><span class="token number">6379</span></code></pre>

<h2 id="Pod-重启策略"><a href="#Pod-重启策略" class="headerlink" title="Pod 重启策略"></a>Pod 重启策略</h2><p>k8s 在 Pod 出现异常的时候会自动将 Pod 重启，以恢复 Pod 中的服务</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">restartPolicy：
	Always	<span class="token comment"># 当容器异常时，k8s自动重启该容器，ReplicationController/Replicaset/Deployment</span>
	OnFailure	<span class="token comment"># 当容器失败时(容器停止运行且退出码不为0)，k8s自动重启该容器</span>
	Never	<span class="token comment"># 不论容器运行状态如何都不会重启该容器,Job或CronJob</span></code></pre>

<h2 id="镜像拉取策略"><a href="#镜像拉取策略" class="headerlink" title="镜像拉取策略"></a>镜像拉取策略</h2><p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/overview/">配置最佳实践 | Kubernetes</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">imagePullPolicy:
	IfNotPresent	<span class="token comment"># node节点没有此镜像就去指定的镜像仓库拉取，node有就使用node本地镜像</span>
	Always		<span class="token comment"># 每次重建pod都会重新拉取镜像</span>
	Never		<span class="token comment"># 从不到镜像中心拉取镜像，只使用本地镜像</span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/Kubernetes/HPA%E8%87%AA%E5%8A%A8%E4%BC%B8%E7%BC%A9pod%E6%95%B0%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/Kubernetes/HPA%E8%87%AA%E5%8A%A8%E4%BC%B8%E7%BC%A9pod%E6%95%B0%E9%87%8F/" class="post-title-link" itemprop="url">HPA自动伸缩pod数量</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-03-17 22:07:20" itemprop="dateCreated datePublished" datetime="2021-03-17T22:07:20+08:00">2021-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>HPA：Horizontal Pod Autoscaler，pod 的自动水平伸缩，<strong>特别适合无状态服务</strong></p>
<p>HPA 会自动完成 pod 的扩缩容，当资源需求过高时，会自动创建出 pod 副本；当资源需求低时，会自动收缩 pod 副本数。</p>
<p>注意：通过集群内的资源监控系统（metrics-server），来获取集群中资源的使用状态，所以必须确保集群中已经安装 metrics-server 的组件</p>
<p>HPA 版本：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$kubectl</span> api-versions <span class="token operator">|</span> <span class="token function">grep</span> auto
autoscaling/v1			<span class="token comment"># 只支持通过cpu为参考依据，来改变pod副本数</span>
autoscaling/v2beta1		<span class="token comment"># 支持通过cpu、内存、连接数以及用户自定义的资源指标数据为参考依据</span>
autoscaling/v2beta2		<span class="token comment"># 同上，小的变动</span></code></pre>

<h2 id="metrics-server"><a href="#metrics-server" class="headerlink" title="metrics-server"></a>metrics-server</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>Metrics Server 是 Kubernetes 集群核心监控数据的聚合器，Metrics Server 从 Kubelet 收集资源指标，并通过 Merics API 在 Kubernetes APIServer 中提供给缩放资源对象 HPA 使用。也可以通过 Metrics API 提供的 Kubectl top 查看 Pod 资源占用情况，从而实现对资源的自动缩放。</p>
<p>Metrics Server 是 Kubernetes 监控组件中的重要一部分，Metrics Server 主要分为 API 和 Server 两大部分。</p>
<ul>
<li>Metrics API：通过 APIServer 对外暴露 Pod 资源使用情况。为 HPA、kubectl top、Kubernetes dashboard 等提供数据来源</li>
<li>Metrics Server ：定期通过 Summary API 从 Kubelet 所在集群节点获取服务指标，然后将指标汇总、存储到内存中，仅仅存储指标最新状态，一旦重启组件数据将会丢失</li>
</ul>
<img data-src="//img.to2b.cn/blog/ljk/1616237073888.png" style="zoom:50%;" />

<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>最新的 metrics-server 是 v4.0.2，但是其依赖的镜像需要翻墙，而阿里云镜像和 mirrorgooglecontainers 中都没有最新版本，最新的只有 v0.3.6 版本，勉强用吧</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$docker</span> pull registry.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6
<span class="token variable">$docker</span> tag registry.aliyuncs.com/google_containers/metrics-server-amd64 harbor.ljk.local/k8s/metrics-server-amd64:v0.3.6
<span class="token variable">$docker</span> push harbor.ljk.local/k8s/metrics-server-amd64:v0.3.6

<span class="token comment"># 下载 components.yaml</span>
<span class="token variable">$wget</span> https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.3.6/components.yaml
<span class="token variable">$vim</span> components.yaml
<span class="token punctuation">..</span>.
image: harbor.ljk.local/k8s/metrics-server-amd64:v0.3.6	 <span class="token comment">#修改为本地镜像</span>
<span class="token punctuation">..</span>.
<span class="token comment"># 安装</span>
<span class="token variable">$kubectl</span> apply <span class="token parameter variable">-f</span> components.yaml

<span class="token comment"># 测试</span>
<span class="token variable">$nohup</span> kubectl proxy <span class="token operator">&amp;</span>
<span class="token variable">$curl</span> http://localhost:8001/apis/metrics.k8s.io/v1beta1/nodes
<span class="token variable">$curl</span> http://localhost:8001/apis/metrics.k8s.io/v1beta1/pods
<span class="token variable">$kubectl</span> <span class="token function">top</span> <span class="token function">node</span>
<span class="token variable">$kubectl</span> <span class="token function">top</span> pod <span class="token parameter variable">-A</span></code></pre>

<h2 id="HPA-示例"><a href="#HPA-示例" class="headerlink" title="HPA 示例"></a>HPA 示例</h2><p>要求：我有个 deployment 叫 myapp 现在只有一个副本数，最多只能 8 个副本数，当 pod 的 cpu 平均利用率超过百分之 50 或内存平均值超过百分之 50 时，pod 将自动增加副本数以提供服务</p>
<ol>
<li><p>SVC、Deployment 资源清单：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> svc<span class="token punctuation">-</span>hpa
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort <span class="token comment">##注意这里是NodePort，下面压力测试要用到。</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>demo
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
          <span class="token key atrule">image</span><span class="token punctuation">:</span> ikubernetes/myapp<span class="token punctuation">:</span>v1
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 50m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 50Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 50m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 50Mi</code></pre>
</li>
<li><p>HPA 资源清单：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> autoscaling/v2beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HorizontalPodAutoscaler
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>hpa<span class="token punctuation">-</span>v2
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">minReplicas</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">##至少1个副本</span>
  <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">8</span> <span class="token comment">##最多8个副本</span>
  <span class="token key atrule">scaleTargetRef</span><span class="token punctuation">:</span>
    <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
    <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">metrics</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Resource
      <span class="token key atrule">resource</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cpu
        <span class="token key atrule">targetAverageUtilization</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">##注意此时是根据使用率，也可以根据使用量：targetAverageValue</span>
    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Resource
      <span class="token key atrule">resource</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> memory
        <span class="token key atrule">targetAverageUtilization</span><span class="token punctuation">:</span> <span class="token number">50</span> <span class="token comment">##注意此时是根据使用率，也可以根据使用量：targetAverageValue</span></code></pre></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
