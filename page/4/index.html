<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.to2b.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.to2b.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="LJKのBlog">
<meta property="og:url" content="http://blog.lujinkai.cn/page/4/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="像方便面一样的男子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LJKのBlog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.to2b.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%B7%A5%E5%85%B7/firefox%20userChrome.css/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%B7%A5%E5%85%B7/firefox%20userChrome.css/" class="post-title-link" itemprop="url">firefox userChrome.css</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:12:58" itemprop="dateCreated datePublished" datetime="2022-09-24T14:12:58+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <pre class="language-css" data-language="css"><code class="language-css"><span class="token comment">/* ===================================== 标签栏调整 ===================================== */</span>

<span class="token comment">/*标签高度*/</span>
<span class="token selector">#titlebar,
#tabbrowser-tabs</span> <span class="token punctuation">&#123;</span>
	<span class="token property">--tab-min-height</span><span class="token punctuation">:</span> 28px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/** 去除标签与导航栏之间的空隙 Tab Bar - Connect to window ======================================================== */</span>

<span class="token selector">.tab-background</span> <span class="token punctuation">&#123;</span>
	<span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--tab-border-radius<span class="token punctuation">)</span> <span class="token function">var</span><span class="token punctuation">(</span>--tab-border-radius<span class="token punctuation">)</span> 0px 0px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.tab-content</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--tab-block-margin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.tab-stack</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin-top</span><span class="token punctuation">:</span> 0px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* Remove line at Toolbar's top */</span>
<span class="token selector">#tabbrowser-tabs</span> <span class="token punctuation">&#123;</span>
	<span class="token property">z-index</span><span class="token punctuation">:</span> 1 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#tabbrowser-arrowscrollbox[overflowing] .tabbrowser-tab[pinned]:is([visuallyselected], [multiselected])</span> <span class="token punctuation">&#123;</span>
	<span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*= 标签页调整 Root - Reduce Padding ================================================== */</span>

<span class="token comment">/* 参考代码 source form:  https://github.com/black7375/Firefox-UI-Fix*/</span>

<span class="token selector">:root</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">/* Tab Bar */</span>
	<span class="token property">--proton-tab-block-margin</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 4px */</span>
	<span class="token property">--tab-block-margin</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* New version of --proton-tab-block-margin */</span>
	<span class="token property">--inline-tab-padding</span><span class="token punctuation">:</span> 6px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 8px */</span>
	<span class="token comment">/* Panel */</span>
	<span class="token property">--arrowpanel-menuicon-padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
	<span class="token property">--arrowpanel-menuitem-margin</span><span class="token punctuation">:</span> 0 <span class="token function">var</span><span class="token punctuation">(</span>--arrowpanel-menuicon-padding<span class="token punctuation">)</span> <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 0 8px */</span>
	<span class="token property">--arrowpanel-menuitem-padding</span><span class="token punctuation">:</span> 5px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 8px */</span>
	<span class="token property">--arrowpanel-padding</span><span class="token punctuation">:</span> 0.8em <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 16px or .cui-widget-panel, .cui-widget-panel::part(arrowcontent) => 4px 0 */</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">:root[uidensity=compact]</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">/* Tool Bar */</span>
	<span class="token property">--toolbarbutton-outer-padding</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 3px, General is 2px */</span>
	<span class="token comment">/* Panel */</span>
	<span class="token property">--arrowpanel-menuitem-padding</span><span class="token punctuation">:</span> 3px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 8px */</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">:root[uidensity=touch]</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">/* Tab Bar - Like Original */</span>
	<span class="token property">--proton-tab-block-margin</span><span class="token punctuation">:</span> 4px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 4px */</span>
	<span class="token property">--tab-block-margin</span><span class="token punctuation">:</span> 4px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* New version of --proton-tab-block-margin */</span>
	<span class="token property">--inline-tab-padding</span><span class="token punctuation">:</span> 8px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 8px */</span>
	<span class="token comment">/* Panel - Like Original */</span>
	<span class="token property">--arrowpanel-menuitem-padding</span><span class="token punctuation">:</span> 8px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token comment">/* Original: 8px */</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/* ===================================== 地址栏 =====================================*/</span>

<span class="token comment">/* 地址栏字体 Font-sizes */</span>
<span class="token selector">#urlbar-results,
#urlbar-input,
#userContext-label</span> <span class="token punctuation">&#123;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/* 放大缩小图标调整 */</span>
<span class="token selector">#urlbar-zoom-button</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin-bottom</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 0.75em <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/* 隐藏隐私跟踪图标 */</span>
<span class="token selector">#tracking-protection-icon-container</span> <span class="token punctuation">&#123;</span>
	<span class="token property">display</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#identity-icon</span> <span class="token punctuation">&#123;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#identity-icon-label</span> <span class="token punctuation">&#123;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>



<span class="token comment">/*地址栏下拉菜单切换搜索引擎模块*/</span>
<span class="token selector">.search-panel-one-offs-header</span> <span class="token punctuation">&#123;</span>
	<span class="token property">display</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#urlbar-anon-search-settings-compact</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin-left</span><span class="token punctuation">:</span> -25px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.search-one-offs</span> <span class="token punctuation">&#123;</span>
	<span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #eee <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
	<span class="token selector">.search-one-offs</span> <span class="token punctuation">&#123;</span>
		<span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #444 <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>



<span class="token comment">/*关闭地址栏自动放大*/</span>
<span class="token selector">#urlbar[breakout][breakout-extend]</span> <span class="token punctuation">&#123;</span>
	<span class="token property">width</span><span class="token punctuation">:</span> 100% <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span> 0px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#urlbar[breakout][breakout-extend][open]</span> <span class="token punctuation">&#123;</span>
	<span class="token property">box-shadow</span><span class="token punctuation">:</span> 0px 4px 8px <span class="token function">rgb</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span> <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">border-radius</span><span class="token punctuation">:</span> 8px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#urlbar[breakout][breakout-extend]>#urlbar-background</span> <span class="token punctuation">&#123;</span>
	<span class="token property">animation</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#urlbar[breakout][breakout-extend]>#urlbar-background</span> <span class="token punctuation">&#123;</span>
	<span class="token property">box-shadow</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>



<span class="token comment">/* 地址栏关键字搜索引导器 */</span>
<span class="token selector">#urlbar-search-mode-indicator</span> <span class="token punctuation">&#123;</span>
	<span class="token property">outline</span><span class="token punctuation">:</span> 0px solid #eee <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">border-radius</span><span class="token punctuation">:</span> 4px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/*地址栏高度*/</span>
<span class="token selector">#urlbar</span> <span class="token punctuation">&#123;</span>
	<span class="token property">--urlbar-height</span><span class="token punctuation">:</span> 28px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--urlbar-height<span class="token punctuation">)</span> <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">padding-right</span><span class="token punctuation">:</span> 2px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#searchbar</span> <span class="token punctuation">&#123;</span>
	<span class="token property">--urlbar-height</span><span class="token punctuation">:</span> 28px <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">min-height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--urlbar-height<span class="token punctuation">)</span> <span class="token important">!important</span><span class="token punctuation">;</span>
	<span class="token property">max-height</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--urlbar-height<span class="token punctuation">)</span> <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/*地址栏图标大小*/</span>
<span class="token selector">#urlbar .urlbar-icon</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin</span><span class="token punctuation">:</span> -1px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#pageAction-urlbar-_cd7e22de-2e34-40f0-aeff-cec824cbccac_ .urlbar-icon</span> <span class="token punctuation">&#123;</span>
	<span class="token property">margin</span><span class="token punctuation">:</span> -2px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#page-action-buttons .urlbar-icon</span> <span class="token punctuation">&#123;</span>
	<span class="token property">max-width</span><span class="token punctuation">:</span> 14px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/*书签字体大小*/</span>
<span class="token selector">#PersonalToolbar</span> <span class="token punctuation">&#123;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#PlacesToolbarItems[placespopup="true"].bookmark-item</span> <span class="token punctuation">&#123;</span>
	<span class="token property">font-size</span><span class="token punctuation">:</span> 13px <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">/*书签工具栏居中 PersonalToolbar Align Center */</span>
<span class="token selector">#PersonalToolbar #PlacesToolbarItems</span> <span class="token punctuation">&#123;</span>
	<span class="token property">-moz-box-pack</span><span class="token punctuation">:</span> center <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*深色模式下菜单字体减淡*/</span>
<span class="token selector">:-moz-lwtheme-brighttext#PlacesToolbarItems</span> <span class="token punctuation">&#123;</span>
	<span class="token property">opacity</span><span class="token punctuation">:</span> 0.9 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">:-moz-lwtheme-brighttext#PlacesToolbarItems:hover</span> <span class="token punctuation">&#123;</span>
	<span class="token property">opacity</span><span class="token punctuation">:</span> 1 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/MySQL/mysql5.7%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E5%92%8C%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/MySQL/mysql5.7%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E5%92%8C%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">mysql5.7内置函数和操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:11:42" itemprop="dateCreated datePublished" datetime="2022-09-24T14:11:42+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="表达式求值中的类型转换"><a href="#表达式求值中的类型转换" class="headerlink" title="表达式求值中的类型转换"></a>表达式求值中的类型转换</h2><h3 id="CONCAT-隐式转换"><a href="#CONCAT-隐式转换" class="headerlink" title="CONCAT() 隐式转换"></a>CONCAT() 隐式转换</h3><p>CONCAT()的参数为string类型，所以如果传入其他类型，会被隐式转换。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">mysql<span class="token operator">></span> SELECT <span class="token number">1</span>+<span class="token string">'1'</span><span class="token punctuation">;</span>
        -<span class="token operator">></span> <span class="token number">2</span>
mysql<span class="token operator">></span> SELECT CONCAT<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">' test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        -<span class="token operator">></span> <span class="token string">'2 test'</span></code></pre>

<p>如果想显式转换，请使用 CAST</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">mysql<span class="token operator">></span> SELECT <span class="token number">38.8</span>, CAST<span class="token punctuation">(</span><span class="token number">38.8</span> AS CHAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
        -<span class="token operator">></span> <span class="token number">38.8</span>, <span class="token string">'38.8'</span>
mysql<span class="token operator">></span> SELECT <span class="token number">38.8</span>, CONCAT<span class="token punctuation">(</span><span class="token number">38.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        -<span class="token operator">></span> <span class="token number">38.8</span>, <span class="token string">'38.8'</span></code></pre>

<h3 id="比较操作"><a href="#比较操作" class="headerlink" title="比较操作"></a>比较操作</h3><ul>
<li>NULL和任何数据进行对比，都返回NULL，除非使用&lt;&#x3D;&gt;运算符，&lt;&#x3D;&gt;相比&#x3D;，可以对NULL进行比较，两个NULL使用&lt;&#x3D;&gt;比较，返回true。</li>
<li>如果比较操作中的两个参数都是字符串，则将它们作为字符串进行比较。</li>
<li>如果两个参数都是整数，则将它们作为整数进行比较。</li>
<li>十六进制如果不与数字进行比较，则将十六进制值视为二进制字符串。</li>
<li>关于时间的比较需要将timestamp或datetime转成时间戳，但是我们约定：时间统统存储时间戳，避免比较时间的转换问题。</li>
<li>如果其中一个参数是 decimal 类型，则比较依赖于另一个参数。如果另一个参数是 decimal 或 integer ，则将这些参数作为 decimal 进行比较; 如果另一个参数是浮点值，则将其作为浮点值进行比较。 </li>
<li>除了以上情况，所有其他情况下，参数都作为浮点数(双精度)进行比较。例如，字符串和数值操作数的比较是作为浮点数的比较进行的。</li>
</ul>
<h3 id="字符串与数字的比较"><a href="#字符串与数字的比较" class="headerlink" title="字符串与数字的比较"></a>字符串与数字的比较</h3><ul>
<li><p><strong>对于字符串与数字的比较，如果字符串上有索引，索引会失效</strong>，例如下例中，很多不同的字符串都可以转换为1，例如“1“、” 1“或者”1a“</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM tbl_name WHERE str_col&#x3D;1;</code></pre>
</li>
<li><p>对于大数字符串和大数之间的比较，应该要把大数转成字符串再进行比较</p>
</li>
<li><p>对于浮点数字符串和浮点数的比较，应该要把浮点数转成字符串再进行比较</p>
</li>
</ul>
<h3 id="浮点数之间比较"><a href="#浮点数之间比较" class="headerlink" title="浮点数之间比较"></a>浮点数之间比较</h3><p>浮点数之间比较，不能用&#x3D;直接对比，应该先设置一个可接受的公差，例如同意精度在万分之一（0.0001）以内，它俩相等，那么ABS(a - b) &lt; 0.0001就认为a和b相等，同理：a - b &gt; 0.0001 可以认为a &gt; b，b - a &gt; 0.0001 可以认为a &lt; b</p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Introduced</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_bitwise-and"><code>&amp;</code></a></td>
<td align="left">Bitwise AND</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_greater-than"><code>&gt;</code></a></td>
<td align="left">Greater than operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_right-shift"><code>&gt;&gt;</code></a></td>
<td align="left">Right shift</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_greater-than-or-equal"><code>&gt;=</code></a></td>
<td align="left">Greater than or equal operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_less-than"><code>&lt;</code></a></td>
<td align="left">Less than operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_not-equal"><code>&lt;&gt;</code>, <code>!=</code></a></td>
<td align="left">Not equal operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_left-shift"><code>&lt;&lt;</code></a></td>
<td align="left">Left shift</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_less-than-or-equal"><code>&lt;=</code></a></td>
<td align="left">Less than or equal operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_equal-to"><code>&lt;=&gt;</code></a></td>
<td align="left">NULL-safe equal to operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_mod"><code>%</code>, <code>MOD</code></a></td>
<td align="left">Modulo operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_times"><code>*</code></a></td>
<td align="left">Multiplication operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_plus"><code>+</code></a></td>
<td align="left">Addition operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_minus"><code>-</code></a></td>
<td align="left">Minus operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_unary-minus"><code>-</code></a></td>
<td align="left">Change the sign of the argument</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/json-search-functions.html#operator_json-column-path"><code>-&gt;</code></a></td>
<td align="left">Return value from JSON column after evaluating path; equivalent to JSON_EXTRACT().</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/json-search-functions.html#operator_json-inline-path"><code>-&gt;&gt;</code></a></td>
<td align="left">Return value from JSON column after evaluating path and unquoting the result; equivalent to JSON_UNQUOTE(JSON_EXTRACT()).</td>
<td align="left">5.7.13</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_divide"><code>/</code></a></td>
<td align="left">Division operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/assignment-operators.html#operator_assign-value"><code>:=</code></a></td>
<td align="left">Assign a value</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/assignment-operators.html#operator_assign-equal"><code>=</code></a></td>
<td align="left">Assign a value (as part of a <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/set-variable.html"><code>SET</code></a> statement, or as part of the <code>SET</code> clause in an <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/update.html"><code>UPDATE</code></a> statement)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_equal"><code>=</code></a></td>
<td align="left">Equal operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_bitwise-xor"><code>^</code></a></td>
<td align="left">Bitwise XOR</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_and"><code>AND</code>, <code>&amp;&amp;</code></a></td>
<td align="left">Logical AND</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_between"><code>BETWEEN ... AND ...</code></a></td>
<td align="left">Whether a value is within a range of values</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/cast-functions.html#operator_binary"><code>BINARY</code></a></td>
<td align="left">Cast a string to a binary string</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/flow-control-functions.html#operator_case"><code>CASE</code></a></td>
<td align="left">Case operator</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/arithmetic-functions.html#operator_div"><code>DIV</code></a></td>
<td align="left">Integer division</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_in"><code>IN()</code></a></td>
<td align="left">Whether a value is within a set of values</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_is"><code>IS</code></a></td>
<td align="left">Test a value against a boolean</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_is-not"><code>IS NOT</code></a></td>
<td align="left">Test a value against a boolean</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_is-not-null"><code>IS NOT NULL</code></a></td>
<td align="left">NOT NULL value test</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_is-null"><code>IS NULL</code></a></td>
<td align="left">NULL value test</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/string-comparison-functions.html#operator_like"><code>LIKE</code></a></td>
<td align="left">Simple pattern matching</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_not"><code>NOT</code>, <code>!</code></a></td>
<td align="left">Negates value</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_not-between"><code>NOT BETWEEN ... AND ...</code></a></td>
<td align="left">Whether a value is not within a range of values</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/comparison-operators.html#operator_not-in"><code>NOT IN()</code></a></td>
<td align="left">Whether a value is not within a set of values</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/string-comparison-functions.html#operator_not-like"><code>NOT LIKE</code></a></td>
<td align="left">Negation of simple pattern matching</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/regexp.html#operator_not-regexp"><code>NOT REGEXP</code></a></td>
<td align="left">Negation of REGEXP</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">[<code>OR</code>, &#96;</td>
<td align="left"></td>
<td align="left">&#96;](<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_or">https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_or</a>)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/regexp.html#operator_regexp"><code>REGEXP</code></a></td>
<td align="left">Whether string matches regular expression</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/regexp.html#operator_regexp"><code>RLIKE</code></a></td>
<td align="left">Whether string matches regular expression</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#operator_sounds-like"><code>SOUNDS LIKE</code></a></td>
<td align="left">Compare sounds</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_xor"><code>XOR</code></a></td>
<td align="left">Logical XOR</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">[&#96;</td>
<td align="left">&#96;](<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_bitwise-or">https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_bitwise-or</a>)</td>
<td align="left">Bitwise OR</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/bit-functions.html#operator_bitwise-invert"><code>~</code></a></td>
<td align="left">Bitwise inversion</td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h3><p>以下列表中，从上到下，优先级从高到低。一行中的运算符具有相同的优先级。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">INTERVAL
BINARY, COLLATE
!
- (unary minus), ~ (unary bit inversion)
^
*, &#x2F;, DIV, %, MOD
-, +
&lt;&lt;, &gt;&gt;
&amp;
|
&#x3D; (comparison), &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN
BETWEEN, CASE, WHEN, THEN, ELSE
NOT
AND, &amp;&amp;
XOR
OR, ||
&#x3D; (assignment), :&#x3D;</code></pre>

<p>&#x3D; 的优先级取决于它是用作 比较 还是 赋值</p>
<p>记不住优先级没关系，会用括号就行。</p>
<h3 id="比较函数和运算符"><a href="#比较函数和运算符" class="headerlink" title="比较函数和运算符"></a>比较函数和运算符</h3><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&gt;</code></td>
<td align="left">大于</td>
</tr>
<tr>
<td align="left"><code>&gt;=</code></td>
<td align="left">大于等于</td>
</tr>
<tr>
<td align="left"><code>&lt;</code></td>
<td align="left">小于</td>
</tr>
<tr>
<td align="left"><code>&lt;&gt;</code>, <code>!=</code></td>
<td align="left">不等于</td>
</tr>
<tr>
<td align="left"><code>&lt;=</code></td>
<td align="left">小于等于</td>
</tr>
<tr>
<td align="left"><code>&lt;=&gt;</code></td>
<td align="left">不等于，相比&#x3D;，&lt;&#x3D;&gt;可以用于比较NULL</td>
</tr>
<tr>
<td align="left"><code>=</code></td>
<td align="left">等于</td>
</tr>
<tr>
<td align="left"><code>BETWEEN ... AND ...</code></td>
<td align="left">值是否在值的范围内</td>
</tr>
<tr>
<td align="left"><code>NOT BETWEEN ... AND ...</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>COALESCE()</code></td>
<td align="left">返回第一个非 NULL 参数</td>
</tr>
<tr>
<td align="left"><code>GREATEST()</code></td>
<td align="left">返回最大的参数</td>
</tr>
<tr>
<td align="left"><code>IN()</code></td>
<td align="left">判断值在一组值中</td>
</tr>
<tr>
<td align="left"><code>NOT IN()</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>INTERVAL()</code></td>
<td align="left">INTERVAL(N,N1,N2,N3,……….)  N是要判断的数值，N1,N2,N3,…是分段的间隔。返回值是段的位置，区间前闭后开</td>
</tr>
<tr>
<td align="left"><code>IS</code></td>
<td align="left">测试值为 TRUE&#x2F;FALSE&#x2F;UNKNOW</td>
</tr>
<tr>
<td align="left"><code>IS NOT</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>IS NULL</code></td>
<td align="left">测试值为NULL</td>
</tr>
<tr>
<td align="left"><code>IS NOT NULL</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>ISNULL()</code></td>
<td align="left">同 <code>IS NULL</code></td>
</tr>
<tr>
<td align="left"><code>LEAST()</code></td>
<td align="left">返回最小的参数</td>
</tr>
<tr>
<td align="left"><code>LIKE</code></td>
<td align="left">简单的正则匹配</td>
</tr>
<tr>
<td align="left"><code>NOT LIKE</code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>STRCMP()</code></td>
<td align="left">比较两个字符串</td>
</tr>
</tbody></table>
<h4 id="INTERVAL-N-N1-N2-N3-…"><a href="#INTERVAL-N-N1-N2-N3-…" class="headerlink" title="INTERVAL(N,N1,N2,N3,…)"></a>INTERVAL(N,N1,N2,N3,…)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT INTERVAL(23, 1, 15, 17, 30, 44, 200);		&#x2F;&#x2F; 17 &lt;&#x3D; 23 &lt; 30，1和15之间返回1,15和17之间返回2，17和30之间返回3
        -&gt; 3
mysql&gt; SELECT INTERVAL(10, 1, 10, 100, 1000);			&#x2F;&#x2F; 10 &lt;&#x3D; 10 &lt; 100，区间前闭后开
        -&gt; 2
mysql&gt; SELECT INTERVAL(22, 23, 30, 44, 200);			&#x2F;&#x2F; 22 &lt; 23
        -&gt; 0</code></pre>

<h4 id="IS-bool-value"><a href="#IS-bool-value" class="headerlink" title="IS bool_value"></a>IS bool_value</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 1 IS TRUE, 0 IS FALSE, NULL IS UNKNOWN;
        -&gt; 1, 1, 1</code></pre>

<h4 id="LEAST-value1-value2-…"><a href="#LEAST-value1-value2-…" class="headerlink" title="LEAST(value1,value2,…)"></a>LEAST(value1,value2,…)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT LEAST(2,0);
        -&gt; 0
mysql&gt; SELECT LEAST(34.0,3.0,5.0,767.0);
        -&gt; 3.0
mysql&gt; SELECT LEAST(&#39;B&#39;,&#39;A&#39;,&#39;C&#39;);
        -&gt; &#39;A&#39;</code></pre>

<ul>
<li>如果参数中有 NULL，则直接返回 NULL</li>
<li>如果参数是数字和字符串，则将他们作为数字进行比较</li>
<li>如果参数都是字符串，则按照二进制字符串进行比较</li>
</ul>
<h4 id="expr-LIKE-pattern"><a href="#expr-LIKE-pattern" class="headerlink" title="expr LIKE pattern"></a>expr LIKE pattern</h4><p>如果expr或pattern为NULL，则结果为NULL</p>
<p>在pattern中，可以使用以下两个通配符：</p>
<ul>
<li>%：匹配任意数量的字符，甚至零个字符</li>
<li>_：匹配一个字符</li>
</ul>
<p>转义符是 \</p>
<p>LIKE匹配字符串不区分大小写，除非expr或者pattern区分大小写（使用区分大小写的排序规则或二进制字符串）：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT &#39;abc&#39; LIKE &#39;ABC&#39;;
        -&gt; 1
mysql&gt; SELECT &#39;abc&#39; LIKE _latin1 &#39;ABC&#39; COLLATE latin1_general_cs;
        -&gt; 0
mysql&gt; SELECT &#39;abc&#39; LIKE _latin1 &#39;ABC&#39; COLLATE latin1_bin;
        -&gt; 0
mysql&gt; SELECT &#39;abc&#39; LIKE BINARY &#39;ABC&#39;;
        -&gt; 0</code></pre>

<p>作为标准 SQL 的扩展，MySQL 允许在数值表达式上使用 LIKE：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 10 LIKE &#39;1%&#39;;
        -&gt; 1</code></pre>

<h4 id="STRCMP-expr1-expr2"><a href="#STRCMP-expr1-expr2" class="headerlink" title="STRCMP(expr1,expr2)"></a>STRCMP(expr1,expr2)</h4><p>如果字符串相同，返回0，如果根据当前排序顺序，第一个参数小于第二个参数，返回 -1；否则返回1</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT STRCMP(&#39;text&#39;, &#39;text2&#39;);
        -&gt; -1
mysql&gt; SELECT STRCMP(&#39;text2&#39;, &#39;text&#39;);
        -&gt; 1
mysql&gt; SELECT STRCMP(&#39;text&#39;, &#39;text&#39;);
        -&gt; 0</code></pre>

<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>AND</code>, <code>&amp;&amp;</code></td>
<td align="left">逻辑与</td>
</tr>
<tr>
<td align="left"><code>NOT</code>, <code>!</code></td>
<td align="left">否</td>
</tr>
<tr>
<td align="left"><code>OR</code>, &#96;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><code>XOR</code></td>
<td align="left">逻辑异或</td>
</tr>
</tbody></table>
<p>在 SQL 中，所有逻辑运算符的计算结果为 TRUE、 FALSE 或 NULL (UNKNOWN)。在 MySQL 中，它们被实现为1(TRUE)、0(FALSE)和 NULL。</p>
<p>MySQL 将任何非零、非 NULL 值计算为 TRUE：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 10 IS TRUE;
-&gt; 1
mysql&gt; SELECT -10 IS TRUE;
-&gt; 1
mysql&gt; SELECT &#39;string&#39; IS NOT NULL;
-&gt; 1</code></pre>

<h4 id="NOT"><a href="#NOT" class="headerlink" title="NOT,!"></a>NOT,!</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT NOT 10;
        -&gt; 0
mysql&gt; SELECT NOT 0;
        -&gt; 1
mysql&gt; SELECT NOT NULL;
        -&gt; NULL
mysql&gt; SELECT ! (1+1);
        -&gt; 0
mysql&gt; SELECT ! 1+1;
        -&gt; 1</code></pre>

<h4 id="AND-amp-amp"><a href="#AND-amp-amp" class="headerlink" title="AND,&amp;&amp;"></a>AND,&amp;&amp;</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 1 AND 1;
        -&gt; 1
mysql&gt; SELECT 1 AND 0;
        -&gt; 0
mysql&gt; SELECT 1 AND NULL;
        -&gt; NULL
mysql&gt; SELECT 0 AND NULL;
        -&gt; 0
mysql&gt; SELECT NULL AND 0;
        -&gt; 0</code></pre>

<h4 id="OR"><a href="#OR" class="headerlink" title="OR,||"></a>OR,||</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 1 OR 1;
        -&gt; 1
mysql&gt; SELECT 1 OR 0;
        -&gt; 1
mysql&gt; SELECT 0 OR 0;
        -&gt; 0
mysql&gt; SELECT 0 OR NULL;
        -&gt; NULL
mysql&gt; SELECT 1 OR NULL;
        -&gt; 1</code></pre>

<h4 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/logical-operators.html#operator_xor"><code>XOR</code></a></h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT 1 XOR 1;
        -&gt; 0
mysql&gt; SELECT 1 XOR 0;
        -&gt; 1
mysql&gt; SELECT 1 XOR NULL;
        -&gt; NULL
mysql&gt; SELECT 1 XOR 1 XOR 1;
        -&gt; 1</code></pre>

<h3 id="分配运算符"><a href="#分配运算符" class="headerlink" title="分配运算符 :="></a>分配运算符 <code>:=</code></h3><p>与 <code>=</code> 不同，<code>:=</code> 运算符从不被解释为比较运算符</p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/flow-control-functions.html">流程控制</a></h2><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>CASE</code></td>
<td align="left">Case operator</td>
</tr>
<tr>
<td align="left"><code>IF()</code></td>
<td align="left">If&#x2F;else construct</td>
</tr>
<tr>
<td align="left"><code>IFNULL()</code></td>
<td align="left">Null if&#x2F;else construct</td>
</tr>
<tr>
<td align="left"><code>NULLIF()</code></td>
<td align="left">Return NULL if expr1 &#x3D; expr2</td>
</tr>
</tbody></table>
<h4 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">CASE value WHEN compare_value THEN result [WHEN compare_value THEN result ...] [ELSE result] END

CASE WHEN condition THEN result [WHEN condition THEN result ...] [ELSE result] END</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT CASE 1 WHEN 1 THEN &#39;one&#39;
    -&gt;     WHEN 2 THEN &#39;two&#39; ELSE &#39;more&#39; END;
        -&gt; &#39;one&#39;
mysql&gt; SELECT CASE WHEN 1&gt;0 THEN &#39;true&#39; ELSE &#39;false&#39; END;
        -&gt; &#39;true&#39;
mysql&gt; SELECT CASE BINARY &#39;B&#39;
    -&gt;     WHEN &#39;a&#39; THEN 1 WHEN &#39;b&#39; THEN 2 END;
        -&gt; NULL</code></pre>

<h4 id="IF-expr1-expr2-expr3"><a href="#IF-expr1-expr2-expr3" class="headerlink" title="IF(expr1,expr2,expr3)"></a>IF(expr1,expr2,expr3)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT IF(1&gt;2,2,3);
        -&gt; 3
mysql&gt; SELECT IF(1&lt;2,&#39;yes&#39;,&#39;no&#39;);
        -&gt; &#39;yes&#39;
mysql&gt; SELECT IF(STRCMP(&#39;test&#39;,&#39;test1&#39;),&#39;no&#39;,&#39;yes&#39;);
        -&gt; &#39;no&#39;</code></pre>

<h4 id="IFNULL-expr1-expr2"><a href="#IFNULL-expr1-expr2" class="headerlink" title="IFNULL(expr1,expr2)"></a>IFNULL(expr1,expr2)</h4><p>如果 expr1不为 NULL，则 IFNULL ()返回 expr1; 否则返回 expr2</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT IFNULL(1,0);
        -&gt; 1
mysql&gt; SELECT IFNULL(NULL,10);
        -&gt; 10
mysql&gt; SELECT IFNULL(1&#x2F;0,10);
        -&gt; 10
mysql&gt; SELECT IFNULL(1&#x2F;0,&#39;yes&#39;);
        -&gt; &#39;yes&#39;</code></pre>

<h4 id="NULLIF-expr1-expr2"><a href="#NULLIF-expr1-expr2" class="headerlink" title="NULLIF(expr1,expr2)"></a>NULLIF(expr1,expr2)</h4><p>如果 expr1 &#x3D; expr2为 true，则返回 NULL，否则返回 expr1。这与 <code>CASE WHEN expr1 = expr2 THEN NULL ELSE expr1 END</code> 相同。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT NULLIF(1,1);
        -&gt; NULL
mysql&gt; SELECT NULLIF(1,2);
        -&gt; 1</code></pre>

<p>注意：如果参数不相等，MySQL 将计算 expr1两次</p>
<h2 id="数值函数和运算符-Numeric"><a href="#数值函数和运算符-Numeric" class="headerlink" title="数值函数和运算符(Numeric)"></a>数值函数和运算符(Numeric)</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%</code>, <code>MOD</code></td>
<td align="left">取余</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td align="left">乘</td>
</tr>
<tr>
<td align="left"><code>+</code></td>
<td align="left">加</td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td align="left">减</td>
</tr>
<tr>
<td align="left"><code>/</code></td>
<td align="left">除</td>
</tr>
<tr>
<td align="left"><code>DIV</code></td>
<td align="left">整数除法，结果向下取整</td>
</tr>
</tbody></table>
<h3 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/mathematical-functions.html">数学函数</a></h3><p>常用的数学函数如下：</p>
<table>
<thead>
<tr>
<th align="left">Name 姓名</th>
<th align="left">Description 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ABS()</code></td>
<td align="left">返回绝对值</td>
</tr>
<tr>
<td align="left"><code>CEIL()</code></td>
<td align="left">返回不小于参数的最小整数值</td>
</tr>
<tr>
<td align="left"><code>CEILING()</code></td>
<td align="left">同 <code>CEIL()</code></td>
</tr>
<tr>
<td align="left"><code>CONV()</code></td>
<td align="left">进制转换，返回字符串</td>
</tr>
<tr>
<td align="left"><code>FLOOR()</code></td>
<td align="left">向下取整，注意负数，示例：1.23向下取整是1、-1.23向下取整是-2</td>
</tr>
<tr>
<td align="left"><code>MOD()</code></td>
<td align="left">返回余数</td>
</tr>
<tr>
<td align="left"><code>POW()</code></td>
<td align="left">求幂</td>
</tr>
<tr>
<td align="left"><code>POWER()</code></td>
<td align="left">同 <code>POW()</code></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/mathematical-functions.html#function_rand"><code>RAND()</code></a></td>
<td align="left">Return a random floating-point value 返回一个随机浮点值</td>
</tr>
<tr>
<td align="left"><code>ROUND()</code></td>
<td align="left">四舍五入</td>
</tr>
<tr>
<td align="left"><code>SIGN()</code></td>
<td align="left">根据 X 是否为负、0或正，返回参数的符号 -1、0或1</td>
</tr>
<tr>
<td align="left"><code>TRUNCATE()</code></td>
<td align="left">截断到指定的小数位数，区别与<code>ROUND()</code></td>
</tr>
</tbody></table>
<h4 id="CONV-N-from-base-to-base"><a href="#CONV-N-from-base-to-base" class="headerlink" title="CONV(N,from_base,to_base)"></a>CONV(N,from_base,to_base)</h4><p>N是待转换的数字，from_base是N当前的进制，to_base是N要输出的进制。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT CONV(2,10,2);			&#x2F;&#x2F; 将10进制中的2转换为2进制输出
		-&gt; &#39;10&#39;

mysql&gt; SELECT CONV(&#39;a&#39;,16,2);		&#x2F;&#x2F; 16进制中，a是10
        -&gt; &#39;1010&#39;
mysql&gt; SELECT CONV(&#39;6E&#39;,18,8);
        -&gt; &#39;172&#39;
mysql&gt; SELECT CONV(-17,10,-18);
        -&gt; &#39;-H&#39;
mysql&gt; SELECT CONV(10+&#39;10&#39;+&#39;10&#39;+X&#39;0a&#39;,10,10);
        -&gt; &#39;40&#39;</code></pre>

<h4 id="POW-X-Y"><a href="#POW-X-Y" class="headerlink" title="POW(X,Y)"></a>POW(X,Y)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT POW(2,3);
        -&gt; 8
mysql&gt; SELECT POW(2,-2);
        -&gt; 0.25</code></pre>

<h4 id="ROUND-X-ROUND-X-D"><a href="#ROUND-X-ROUND-X-D" class="headerlink" title="ROUND(X), ROUND(X,D)"></a>ROUND(X), ROUND(X,D)</h4><p>将参数 X 四舍五入到小数位 D，D默认是0，D可以为负，D绝对值最大30：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT ROUND(-1.23);
        -&gt; -1
mysql&gt; SELECT ROUND(-1.58);
        -&gt; -2
mysql&gt; SELECT ROUND(1.58);
        -&gt; 2
mysql&gt; SELECT ROUND(1.298, 1);
        -&gt; 1.3
mysql&gt; SELECT ROUND(1.298, 0);
        -&gt; 1
mysql&gt; SELECT ROUND(23.298, -1);
        -&gt; 20
mysql&gt; SELECT ROUND(.12345678901234567890123456789012345, 35);
        -&gt; 0.123456789012345678901234567890</code></pre>

<h4 id="SIGN-X"><a href="#SIGN-X" class="headerlink" title="SIGN(X)"></a>SIGN(X)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT SIGN(-32);
        -&gt; -1
mysql&gt; SELECT SIGN(0);
        -&gt; 0
mysql&gt; SELECT SIGN(234);
        -&gt; 1</code></pre>

<h4 id="TRUNCATE-X-D"><a href="#TRUNCATE-X-D" class="headerlink" title="TRUNCATE(X,D)"></a>TRUNCATE(X,D)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT TRUNCATE(1.223,1);
        -&gt; 1.2
mysql&gt; SELECT TRUNCATE(1.999,1);
        -&gt; 1.9
mysql&gt; SELECT TRUNCATE(1.999,0);
        -&gt; 1
mysql&gt; SELECT TRUNCATE(-1.999,1);
        -&gt; -1.9
mysql&gt; SELECT TRUNCATE(122,-2);
       -&gt; 100
mysql&gt; SELECT TRUNCATE(10.28*100,0);
       -&gt; 1028</code></pre>

<h2 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html">日期和时间函数</a></h2><h3 id="INTERVAL-运算符"><a href="#INTERVAL-运算符" class="headerlink" title="INTERVAL 运算符"></a>INTERVAL 运算符</h3><p>INTERVAL 运算符表示时间间隔，用法如下：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">INTERVAL expr unit</code></pre>

<p><code>expr</code>和<code>unit</code>的对应关系</p>
<table>
<thead>
<tr>
<th align="left"><em><code>unit</code></em></th>
<th align="left"><code>expr</code></th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>MICROSECOND</code></td>
<td align="left"><code>MICROSECONDS</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>SECOND</code></td>
<td align="left"><code>SECONDS</code></td>
<td><code>INTERVAL 1 SECOND</code></td>
</tr>
<tr>
<td align="left"><code>MINUTE</code></td>
<td align="left"><code>MINUTES</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>HOUR</code></td>
<td align="left"><code>HOURS</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>DAY</code></td>
<td align="left"><code>DAYS</code></td>
<td><code>INTERVAL 1 DAY</code></td>
</tr>
<tr>
<td align="left"><code>WEEK</code></td>
<td align="left"><code>WEEKS</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>MONTH</code></td>
<td align="left"><code>MONTHS</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>QUARTER</code></td>
<td align="left"><code>QUARTERS</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>YEAR</code></td>
<td align="left"><code>YEARS</code></td>
<td><code>INTERVAL 1 YEAR</code></td>
</tr>
<tr>
<td align="left"><code>SECOND_MICROSECOND</code></td>
<td align="left"><code>&#39;SECONDS.MICROSECONDS&#39;</code></td>
<td><code>INTERVAL &#39;1.999999&#39; SECOND_MICROSECOND</code></td>
</tr>
<tr>
<td align="left"><code>MINUTE_MICROSECOND</code></td>
<td align="left"><code>&#39;MINUTES:SECONDS.MICROSECONDS&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>MINUTE_SECOND</code></td>
<td align="left"><code>&#39;MINUTES:SECONDS&#39;</code></td>
<td><code>INTERVAL &#39;1:1&#39; MINUTE_SECOND</code></td>
</tr>
<tr>
<td align="left"><code>HOUR_MICROSECOND</code></td>
<td align="left"><code>&#39;HOURS:MINUTES:SECONDS.MICROSECONDS&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>HOUR_SECOND</code></td>
<td align="left"><code>&#39;HOURS:MINUTES:SECONDS&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>HOUR_MINUTE</code></td>
<td align="left"><code>&#39;HOURS:MINUTES&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>DAY_MICROSECOND</code></td>
<td align="left"><code>&#39;DAYS HOURS:MINUTES:SECONDS.MICROSECONDS&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>DAY_SECOND</code></td>
<td align="left"><code>&#39;DAYS HOURS:MINUTES:SECONDS&#39;</code></td>
<td><code>INTERVAL &#39;1 1:1:1&#39; DAY_SECOND</code></td>
</tr>
<tr>
<td align="left"><code>DAY_MINUTE</code></td>
<td align="left"><code>&#39;DAYS HOURS:MINUTES&#39;</code></td>
<td></td>
</tr>
<tr>
<td align="left"><code>DAY_HOUR</code></td>
<td align="left"><code>&#39;DAYS HOURS&#39;</code></td>
<td><code>INTERVAL &#39;-1 10&#39; DAY_HOUR</code></td>
</tr>
<tr>
<td align="left"><code>YEAR_MONTH</code></td>
<td align="left"><code>&#39;YEARS-MONTHS&#39;</code></td>
<td></td>
</tr>
</tbody></table>
<p>注意：</p>
<ul>
<li><code>expr</code>中可以使用任意分割符，上表中主要以<code>:</code>为例演示。</li>
<li><code>expr</code> 被视为一个字符串，所以当<code>expr</code>为非字符串时要小心。以HOUR _ MINUTE为例：’6&#x2F;4‘ 被视为6小时4分钟，而6&#x2F;4会先计算得1.5000，然后被视作‘1.5000’，也就是1小时5000分钟。<ul>
<li>如果确实想要6&#x2F;4表示1.5小时，可以将结果转一下，例如：<code>INTERVAL CAST(6/4 AS DECIMAL(3,1)) HOUR_MINUTE</code></li>
</ul>
</li>
</ul>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><ul>
<li><p>某些函数，如 DATE _ ADD ()、 DATE _ SUB ()、EXTRACT()</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT DATE_ADD(&#39;2018-05-01&#39;,INTERVAL 1 DAY);
        -&gt; &#39;2018-05-02&#39;
mysql&gt; SELECT DATE_SUB(&#39;2018-05-01&#39;,INTERVAL 1 YEAR);
        -&gt; &#39;2017-05-01&#39;
mysql&gt; SELECT EXTRACT(YEAR FROM &#39;2019-07-02&#39;);
        -&gt; 2019</code></pre>
</li>
<li><p>+&#x2F;-运算</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">date + INTERVAL expr unit
date - INTERVAL expr unit</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT &#39;2018-12-31 23:59:59&#39; + INTERVAL 1 SECOND;
        -&gt; &#39;2019-01-01 00:00:00&#39;
mysql&gt; SELECT INTERVAL 1 DAY + &#39;2018-12-31&#39;;
        -&gt; &#39;2019-01-01&#39;
mysql&gt; SELECT &#39;2025-01-01&#39; - INTERVAL 1 SECOND;
        -&gt; &#39;2024-12-31 23:59:59&#39;</code></pre>

<p>注：对于-运算，<code>INTERVAL expr</code> 只允许在右边，因为从一个间隔中减去一个日期或日期时间值是没有意义的。</p>
</li>
</ul>
<h3 id="日期和时间函数-1"><a href="#日期和时间函数-1" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h3><table>
<thead>
<tr>
<th align="left">Name 姓名</th>
<th align="left">Description 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>DATE_ADD()</code></td>
<td align="left">date 加 time</td>
</tr>
<tr>
<td align="left"><code>DATE_SUB()</code></td>
<td align="left">date 减 time</td>
</tr>
<tr>
<td align="left"><code>ADDDATE()</code></td>
<td align="left">当用三个参数调用时，同<code>DATE_ADD()</code></td>
</tr>
<tr>
<td align="left"><code>SUBDATE()</code></td>
<td align="left">当用三个参数调用时，同<code>DATE_SUB()</code></td>
</tr>
<tr>
<td align="left"><code>ADDTIME()</code></td>
<td align="left">time 或 datetime 加 time</td>
</tr>
<tr>
<td align="left"><code>TIMESTAMPADD()</code></td>
<td align="left">向 datetime 表达式添加间隔</td>
</tr>
<tr>
<td align="left"><code>SUBTIME()</code></td>
<td align="left">time 或 datetime 减 time</td>
</tr>
<tr>
<td align="left"><code>CONVERT_TZ()</code></td>
<td align="left">转换日期的时区</td>
</tr>
<tr>
<td align="left"><code>CURDATE()</code></td>
<td align="left">返回当前日期，返回 <code>YYYY-MM-DD&#39;</code>或 <code>YYYYMMDD</code> 格式</td>
</tr>
<tr>
<td align="left"><code>CURRENT_DATE()</code>, <code>CURRENT_DATE</code></td>
<td align="left">同<code>CURDATE()</code></td>
</tr>
<tr>
<td align="left"><code>CURTIME()</code></td>
<td align="left">返回当前时间，返回 <code>&#39;hh:mm:ss&#39;</code> or <em><code>hhmmss</code></em> 格式</td>
</tr>
<tr>
<td align="left"><code>CURRENT_TIME()</code>, <code>CURRENT_TIME</code></td>
<td align="left">同<code>CURTIME()</code></td>
</tr>
<tr>
<td align="left"><code>NOW()</code></td>
<td align="left">返回当前日期和时间，返回 <code>&#39;YYYY-MM-DD hh:mm:ss&#39;</code> 或 <code>YYYYMMDDhhmmss</code> 格式</td>
</tr>
<tr>
<td align="left"><code>LOCALTIME()</code>, <code>LOCALTIME</code></td>
<td align="left">同<code>NOW()</code></td>
</tr>
<tr>
<td align="left"><code>CURRENT_TIMESTAMP()</code>, <code>CURRENT_TIMESTAMP</code></td>
<td align="left">同<code>NOW()</code></td>
</tr>
<tr>
<td align="left"><code>LOCALTIMESTAMP</code>, <code>LOCALTIMESTAMP()</code></td>
<td align="left">同<code>NOW()</code></td>
</tr>
<tr>
<td align="left"><code>DATE()</code></td>
<td align="left">提取 date 或 datetime 表达式的 date 部分</td>
</tr>
<tr>
<td align="left"><code>DATE_FORMAT()</code></td>
<td align="left">格式化日期</td>
</tr>
<tr>
<td align="left"><code>TIME_FORMAT()</code></td>
<td align="left">与<code>DATE_FORMAT()</code>类似，但format只包含小时、分钟、秒和微秒的格式说明符。其他说明符产生 NULL 值或0。</td>
</tr>
<tr>
<td align="left"><code>DATEDIFF()</code></td>
<td align="left">两个日期相减，返回差的天数</td>
</tr>
<tr>
<td align="left"><code>TIMESTAMPDIFF(unit,datetime_expr1,datetime_expr2)</code></td>
<td align="left">datetime _ expr2 - datetime _ expr1</td>
</tr>
<tr>
<td align="left"><code>TIMEDIFF()</code></td>
<td align="left">expr1-expr2，返回的结果限制在 TIME 值允许的范围内</td>
</tr>
<tr>
<td align="left"><code>DAYOFMONTH()</code></td>
<td align="left">返回月份的日期(0-31)</td>
</tr>
<tr>
<td align="left"><code>DAY()</code></td>
<td align="left">同 <code>DAYOFMONTH()</code></td>
</tr>
<tr>
<td align="left"><code>DAYOFWEEK()</code></td>
<td align="left">返回一周中的第几天，1对应周日，7对应周六</td>
</tr>
<tr>
<td align="left"><code>DAYOFYEAR()</code></td>
<td align="left">返回一年当中的第几天(1-366)</td>
</tr>
<tr>
<td align="left"><code>EXTRACT()</code></td>
<td align="left">提取日期的一部分</td>
</tr>
<tr>
<td align="left"><code>TIME()</code></td>
<td align="left">提取传递的表达式的时间部分</td>
</tr>
<tr>
<td align="left"><code>FROM_DAYS()</code></td>
<td align="left">给定一个天数 N，返回一个 DATE 值。它不适用于公历(1582)出现之前的值</td>
</tr>
<tr>
<td align="left"><code>FROM_UNIXTIME()</code></td>
<td align="left">将 Unix 时间戳格式化为日期</td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT()</code></td>
<td align="left">返回日期格式字符串</td>
</tr>
<tr>
<td align="left"><code>HOUR()</code></td>
<td align="left">提取小时</td>
</tr>
<tr>
<td align="left"><code>LAST_DAY()</code></td>
<td align="left">返回日期所在月最后一天</td>
</tr>
<tr>
<td align="left"><code>MAKEDATE()</code></td>
<td align="left">从一年中的某一天创建一个日期</td>
</tr>
<tr>
<td align="left"><code>MAKETIME()</code></td>
<td align="left">从小时、分钟、秒开始创建时间</td>
</tr>
<tr>
<td align="left"><code>MICROSECOND()</code></td>
<td align="left">返回参数中的微秒</td>
</tr>
<tr>
<td align="left"><code>MINUTE()</code></td>
<td align="left">返回参数的分钟</td>
</tr>
<tr>
<td align="left"><code>MONTH()</code></td>
<td align="left">返回日期的月份，范围为1至12</td>
</tr>
<tr>
<td align="left"><code>PERIOD_DIFF()</code></td>
<td align="left">返回两个期间之间的月数</td>
</tr>
<tr>
<td align="left"><code>QUARTER()</code></td>
<td align="left">返回日期所在的季度，范围在1到4之间</td>
</tr>
<tr>
<td align="left"><code>SEC_TO_TIME()</code></td>
<td align="left">将秒数转换为‘ hh: mm: ss’格式</td>
</tr>
<tr>
<td align="left"><code>TIME_TO_SEC()</code></td>
<td align="left">time转换为秒</td>
</tr>
<tr>
<td align="left"><code>SECOND()</code></td>
<td align="left">返回秒(0-59)</td>
</tr>
<tr>
<td align="left"><code>STR_TO_DATE()</code></td>
<td align="left">将字符串转换为日期</td>
</tr>
<tr>
<td align="left"><code>SYSDATE()</code></td>
<td align="left">返回<code>SYSDATE()</code>函数开始执行的时间</td>
</tr>
<tr>
<td align="left"><code>TIMESTAMP()</code></td>
<td align="left">对于单个参数，此函数返回 date 或 datetime 表达式; 对于两个参数，返回参数之和</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_to-days"><code>TO_DAYS()</code></a></td>
<td align="left">Return the date argument converted to days 返回转换为天数的日期参数</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_to-seconds"><code>TO_SECONDS()</code></a></td>
<td align="left">Return the date or datetime argument converted to seconds since Year 0 返回自0年以来转换为秒的日期或日期时间参数</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_unix-timestamp"><code>UNIX_TIMESTAMP()</code></a></td>
<td align="left">返回一个 Unix 时间戳</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_utc-date"><code>UTC_DATE()</code></a></td>
<td align="left">Return the current UTC date 返回当前的 UTC 日期</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_utc-time"><code>UTC_TIME()</code></a></td>
<td align="left">Return the current UTC time 返回当前的 UTC 时间</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_utc-timestamp"><code>UTC_TIMESTAMP()</code></a></td>
<td align="left">Return the current UTC date and time 返回当前的 UTC 日期和时间</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_week"><code>WEEK()</code></a></td>
<td align="left">Return the week number 返回星期号码</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_weekday"><code>WEEKDAY()</code></a></td>
<td align="left">Return the weekday index 返回工作日索引</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_weekofyear"><code>WEEKOFYEAR()</code></a></td>
<td align="left">Return the calendar week of the date (1-53) 返回日期的日历周(1-53)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_year"><code>YEAR()</code></a></td>
<td align="left">Return the year 返回年份</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_yearweek"><code>YEARWEEK()</code></a></td>
<td align="left">Return the year and week 返回年份和周数</td>
</tr>
</tbody></table>
<h4 id="ADDDATE-date-INTERVAL-expr-unit-ADDDATE-expr-days"><a href="#ADDDATE-date-INTERVAL-expr-unit-ADDDATE-expr-days" class="headerlink" title="ADDDATE(date,INTERVAL expr unit), ADDDATE(expr,days)"></a>ADDDATE(date,INTERVAL expr unit), ADDDATE(expr,days)</h4><p>以下两种写法等价：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT ADDDATE(&#39;2008-01-02&#39;, INTERVAL 31 DAY);
        -&gt; &#39;2008-02-02&#39;
        
mysql&gt; SELECT ADDDATE(&#39;2008-01-02&#39;, 31);
        -&gt; &#39;2008-02-02&#39;</code></pre>

<h4 id="ADDTIME-expr1-expr2"><a href="#ADDTIME-expr1-expr2" class="headerlink" title="ADDTIME(expr1,expr2)"></a>ADDTIME(expr1,expr2)</h4><p><code>expr1</code>是time或datetime，<code>expr2</code>是time：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT ADDTIME(&#39;2007-12-31 23:59:59.999999&#39;, &#39;1 1:1:1.000002&#39;);
        -&gt; &#39;2008-01-02 01:01:01.000001&#39;
mysql&gt; SELECT ADDTIME(&#39;01:00:00.999999&#39;, &#39;02:00:00.999998&#39;);
        -&gt; &#39;03:00:01.999997&#39;</code></pre>

<h4 id="CURDATE"><a href="#CURDATE" class="headerlink" title="CURDATE()"></a>CURDATE()</h4><p>以“ YYYY-MM-DD”或 YYYYMMDD 格式返回当前日期值，具体取决于函数是在字符串上下文中使用还是在数字上下文中使用：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT CURDATE();
        -&gt; &#39;2008-06-13&#39;
mysql&gt; SELECT CURDATE() + 0;
        -&gt; 20080613</code></pre>

<h4 id="DATE-expr"><a href="#DATE-expr" class="headerlink" title="DATE(expr)"></a>DATE(expr)</h4><pre class="language-none"><code class="language-none">mysql&gt; SELECT DATE(&#39;2003-12-31 01:02:03&#39;);
        -&gt; &#39;2003-12-31&#39;</code></pre>

<h4 id="DATE-FORMAT-date-format"><a href="#DATE-FORMAT-date-format" class="headerlink" title="DATE_FORMAT(date,format)"></a>DATE_FORMAT(date,format)</h4><p>常用format：也适用于其他函数: <code>STR_TO_DATE()</code>、 <code>TIME_formAT()</code>、 <code>UNIX_TIMESTAMP()</code></p>
<table>
<thead>
<tr>
<th align="left">Specifier</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>%c</code></td>
<td align="left">月份，数字(<code>0</code>..<code>12</code>)</td>
</tr>
<tr>
<td align="left"><code>%d</code></td>
<td align="left">月份的日期，数字(<code>00</code>..<code>31</code>)</td>
</tr>
<tr>
<td align="left"><code>%e</code></td>
<td align="left">月份的日期，数字(<code>0</code>..<code>31</code>)</td>
</tr>
<tr>
<td align="left"><code>%f</code></td>
<td align="left">微秒(<code>000000</code>..<code>999999</code>)</td>
</tr>
<tr>
<td align="left"><code>%H</code></td>
<td align="left">小时(<code>00</code>..<code>23</code>)</td>
</tr>
<tr>
<td align="left"><code>%h</code></td>
<td align="left">小时(<code>01</code>..<code>12</code>)</td>
</tr>
<tr>
<td align="left"><code>%I</code></td>
<td align="left">小时(<code>01</code>..<code>12</code>)</td>
</tr>
<tr>
<td align="left"><code>%i</code></td>
<td align="left">分钟，数字(<code>00</code>..<code>59</code>)</td>
</tr>
<tr>
<td align="left"><code>%j</code></td>
<td align="left">年份日(<code>001</code>..<code>366</code>)</td>
</tr>
<tr>
<td align="left"><code>%k</code></td>
<td align="left">小时(<code>0</code>..<code>23</code>)</td>
</tr>
<tr>
<td align="left"><code>%l</code></td>
<td align="left">小时(<code>1</code>..<code>12</code>)</td>
</tr>
<tr>
<td align="left"><code>%m</code></td>
<td align="left">月份，数字(<code>00</code>..<code>12</code>)</td>
</tr>
<tr>
<td align="left"><code>%S</code></td>
<td align="left">秒(<code>00</code>..<code>59</code>)</td>
</tr>
<tr>
<td align="left"><code>%s</code></td>
<td align="left">秒(<code>00</code>..<code>59</code>)</td>
</tr>
<tr>
<td align="left"><code>%T</code></td>
<td align="left">时间，24小时(<em><code>hh:mm:ss</code></em>)</td>
</tr>
<tr>
<td align="left"><code>%w</code></td>
<td align="left">星期几(<code>0</code>&#x3D;Sunday.. &#x3D; 星期天.<code>6</code>&#x3D;Saturday) &#x3D; 星期六)</td>
</tr>
<tr>
<td align="left"><code>%Y</code></td>
<td align="left">年，数字，四位数</td>
</tr>
<tr>
<td align="left"><code>%y</code></td>
<td align="left">年份，数字(两位数字)</td>
</tr>
</tbody></table>
<h4 id="DATEDIFF-expr1-expr2"><a href="#DATEDIFF-expr1-expr2" class="headerlink" title="DATEDIFF(expr1,expr2)"></a>DATEDIFF(expr1,expr2)</h4><p>返回以天为单位表示的 <code>expr1</code> - <code>expr2</code>，计算中只使用expr1和expr2的date的部分，会直接舍弃time的部分。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT DATEDIFF(&#39;2007-12-31 23:59:59&#39;,&#39;2007-12-30&#39;);
        -&gt; 1
mysql&gt; SELECT DATEDIFF(&#39;2010-11-30 23:59:59&#39;,&#39;2010-12-31&#39;);
        -&gt; -31</code></pre>

<h4 id="DAYOFMONTH-date"><a href="#DAYOFMONTH-date" class="headerlink" title="DAYOFMONTH(date)"></a>DAYOFMONTH(date)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT DAYOFMONTH(&#39;2007-02-03&#39;);
        -&gt; 3</code></pre>

<h4 id="EXTRACT-unit-FROM-date"><a href="#EXTRACT-unit-FROM-date" class="headerlink" title="EXTRACT(unit FROM date)"></a>EXTRACT(unit FROM date)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT EXTRACT(YEAR FROM &#39;2019-07-02&#39;);
        -&gt; 2019
mysql&gt; SELECT EXTRACT(YEAR_MONTH FROM &#39;2019-07-02 01:02:03&#39;);
        -&gt; 201907
mysql&gt; SELECT EXTRACT(DAY_MINUTE FROM &#39;2019-07-02 01:02:03&#39;);
        -&gt; 20102
mysql&gt; SELECT EXTRACT(MICROSECOND
    -&gt;                FROM &#39;2003-01-02 10:30:00.000123&#39;);
        -&gt; 123</code></pre>

<h4 id="FROM-UNIXTIME-unix-timestamp-format"><a href="#FROM-UNIXTIME-unix-timestamp-format" class="headerlink" title="FROM_UNIXTIME(unix_timestamp[,format])"></a>FROM_UNIXTIME(unix_timestamp[,format])</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT FROM_UNIXTIME(1447430881);
        -&gt; &#39;2015-11-13 10:08:01&#39;
mysql&gt; SELECT FROM_UNIXTIME(1447430881) + 0;
        -&gt; 20151113100801
mysql&gt; SELECT FROM_UNIXTIME(1447430881,
    -&gt;                      &#39;%Y %D %M %h:%i:%s %x&#39;);
        -&gt; &#39;2015 13th November 10:08:01 2015&#39;</code></pre>

<h4 id="GET-FORMAT-DATE-TIME-DATETIME-‘EUR’-’USA’-’JIS’-’ISO’-’INTERNAL’"><a href="#GET-FORMAT-DATE-TIME-DATETIME-‘EUR’-’USA’-’JIS’-’ISO’-’INTERNAL’" class="headerlink" title="GET_FORMAT({DATE|TIME|DATETIME}, {‘EUR’|’USA’|’JIS’|’ISO’|’INTERNAL’})"></a>GET_FORMAT({DATE|TIME|DATETIME}, {‘EUR’|’USA’|’JIS’|’ISO’|’INTERNAL’})</h4><table>
<thead>
<tr>
<th align="left">Function Call 函数调用</th>
<th align="left">Result 结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>GET_FORMAT(DATE,&#39;USA&#39;)</code></td>
<td align="left"><code>&#39;%m.%d.%Y&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATE,&#39;JIS&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATE,&#39;ISO&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATE,&#39;EUR&#39;)</code></td>
<td align="left"><code>&#39;%d.%m.%Y&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATE,&#39;INTERNAL&#39;)</code></td>
<td align="left"><code>&#39;%Y%m%d&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATETIME,&#39;USA&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d %H.%i.%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATETIME,&#39;JIS&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d %H:%i:%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATETIME,&#39;ISO&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d %H:%i:%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATETIME,&#39;EUR&#39;)</code></td>
<td align="left"><code>&#39;%Y-%m-%d %H.%i.%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(DATETIME,&#39;INTERNAL&#39;)</code></td>
<td align="left"><code>&#39;%Y%m%d%H%i%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(TIME,&#39;USA&#39;)</code></td>
<td align="left"><code>&#39;%h:%i:%s %p&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(TIME,&#39;JIS&#39;)</code></td>
<td align="left"><code>&#39;%H:%i:%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(TIME,&#39;ISO&#39;)</code></td>
<td align="left"><code>&#39;%H:%i:%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(TIME,&#39;EUR&#39;)</code></td>
<td align="left"><code>&#39;%H.%i.%s&#39;</code></td>
</tr>
<tr>
<td align="left"><code>GET_FORMAT(TIME,&#39;INTERNAL&#39;)</code></td>
<td align="left"><code>&#39;%H%i%s&#39;</code></td>
</tr>
</tbody></table>
<h4 id="HOUR-time"><a href="#HOUR-time" class="headerlink" title="HOUR(time)"></a>HOUR(time)</h4><p>返回时间的小时。对于时间值，返回值的范围是0到23。但是，TIME 值的范围实际上要大得多，因此 HOUR 可以返回大于23的值：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT HOUR(&#39;10:05:03&#39;);
        -&gt; 10
mysql&gt; SELECT HOUR(&#39;272:59:59&#39;);
        -&gt; 272</code></pre>

<h4 id="LAST-DAY-date"><a href="#LAST-DAY-date" class="headerlink" title="LAST_DAY(date)"></a>LAST_DAY(date)</h4><p>返回date或datetime所在月最后一天。如果参数无效，返回 NULL：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT LAST_DAY(&#39;2003-02-05&#39;);
        -&gt; &#39;2003-02-28&#39;
mysql&gt; SELECT LAST_DAY(&#39;2004-02-05&#39;);
        -&gt; &#39;2004-02-29&#39;
mysql&gt; SELECT LAST_DAY(&#39;2004-01-01 01:01:01&#39;);
        -&gt; &#39;2004-01-31&#39;
mysql&gt; SELECT LAST_DAY(&#39;2003-03-32&#39;);
        -&gt; NULL</code></pre>

<h4 id="MAKEDATE-year-dayofyear"><a href="#MAKEDATE-year-dayofyear" class="headerlink" title="MAKEDATE(year,dayofyear)"></a>MAKEDATE(year,dayofyear)</h4><p>dayofyear 必须大于0，否则返回NULL</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT MAKEDATE(2011,31), MAKEDATE(2011,32);
        -&gt; &#39;2011-01-31&#39;, &#39;2011-02-01&#39;
mysql&gt; SELECT MAKEDATE(2011,365), MAKEDATE(2014,365);
        -&gt; &#39;2011-12-31&#39;, &#39;2014-12-31&#39;
mysql&gt; SELECT MAKEDATE(2011,0);
        -&gt; NULL</code></pre>

<h4 id="TIMESTAMP-expr-TIMESTAMP-expr1-expr2"><a href="#TIMESTAMP-expr-TIMESTAMP-expr1-expr2" class="headerlink" title="TIMESTAMP(expr), TIMESTAMP(expr1,expr2)"></a>TIMESTAMP(expr), TIMESTAMP(expr1,expr2)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; SELECT TIMESTAMP(&#39;2003-12-31&#39;);
        -&gt; &#39;2003-12-31 00:00:00&#39;
mysql&gt; SELECT TIMESTAMP(&#39;2003-12-31 12:00:00&#39;,&#39;12:00:00&#39;);
        -&gt; &#39;2004-01-01 00:00:00&#39;</code></pre>



<h2 id="字符串函数和运算符"><a href="#字符串函数和运算符" class="headerlink" title="字符串函数和运算符"></a>字符串函数和运算符</h2><h2 id="强制转换函数和运算符"><a href="#强制转换函数和运算符" class="headerlink" title="强制转换函数和运算符"></a>强制转换函数和运算符</h2><table>
<thead>
<tr>
<th>Name</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>BINARY</td>
<td>运算符</td>
<td>将expr的字符集（character）转成binary、排序规则（collation）转成binary，注意：只转字符集和排序规则，便于字符串进行比较</td>
</tr>
<tr>
<td>CAST()</td>
<td>函数</td>
<td></td>
</tr>
<tr>
<td>CONVERT()</td>
<td>函数</td>
<td></td>
</tr>
</tbody></table>
<h3 id="BINARY-expr"><a href="#BINARY-expr" class="headerlink" title="BINARY expr"></a>BINARY expr</h3><p>一般情况下，我们将字符集设置为 utf8mb4，排序规则设置为 utf8mb4_general_ci，这种排序规则在使用 &#x3D; 进行比较的时候不区分大小写，而binary排序规则是区分大小写的</p>
<p>mysql中字符串使用 &#x3D; 进行比较的时候，会忽略掉尾部的空空格，这符合SQL标准，无需设置也无法更改。利用BINARY将字符串的排序规则转成binary后，尾部的空格就不会忽略了</p>
<h3 id="CAST-expr-AS-type"><a href="#CAST-expr-AS-type" class="headerlink" title="CAST(expr AS type)"></a>CAST(expr AS type)</h3><p>type： []表示可选</p>
<ul>
<li>BINARY[(N)]</li>
<li>CHAR[(N)]</li>
<li>DATE </li>
<li>DATETIME[(M)]</li>
<li>DECIMAL[(M[,D])]</li>
<li>JSON</li>
<li>NCHAR[(N)]</li>
<li>SIGNED [INTEGER]</li>
<li>TIME[(M)]</li>
<li>UNSIGNED [INTEGER]</li>
</ul>
<p><strong>CAST(expr, type)</strong> 和 <strong>CONVERT(expr, type)</strong> 同 CAST(expr AS type) </p>
<h3 id="CONVERT-expr-USING-transcoding-name"><a href="#CONVERT-expr-USING-transcoding-name" class="headerlink" title="CONVERT(expr USING transcoding_name)"></a>CONVERT(expr USING transcoding_name)</h3><p>字符集转换</p>
<h2 id="位函数和运算符"><a href="#位函数和运算符" class="headerlink" title="位函数和运算符"></a>位函数和运算符</h2><h2 id="加密和压缩函数"><a href="#加密和压缩函数" class="headerlink" title="加密和压缩函数"></a>加密和压缩函数</h2><p>略…</p>
<h2 id="信息函数"><a href="#信息函数" class="headerlink" title="信息函数"></a>信息函数</h2><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_benchmark"><code>BENCHMARK()</code></a></td>
<td align="left">Repeatedly execute an expression 重复执行一个表达式</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_charset"><code>CHARSET()</code></a></td>
<td align="left">Return the character set of the argument 返回参数的字符集</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_coercibility"><code>COERCIBILITY()</code></a></td>
<td align="left">Return the collation coercibility value of the string argument 返回字符串参数的排序规则强制性值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_collation"><code>COLLATION()</code></a></td>
<td align="left">Return the collation of the string argument 返回字符串参数的排序规则</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_connection-id"><code>CONNECTION_ID()</code></a></td>
<td align="left">Return the connection ID (thread ID) for the connection 返回连接的连接 ID (线程 ID)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_current-user"><code>CURRENT_USER()</code>, <code>CURRENT_USER</code></a></td>
<td align="left">The authenticated user name and host name 经过身份验证的用户名和主机名</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_database"><code>DATABASE()</code></a></td>
<td align="left">Return the default (current) database name 返回默认(当前)数据库名称</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_found-rows"><code>FOUND_ROWS()</code></a></td>
<td align="left">For a SELECT with a LIMIT clause, the number of rows that would be returned were there no LIMIT clause 对于带有 LIMIT 子句的 SELECT，如果没有 LIMIT 子句，则返回的行数</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_last-insert-id"><code>LAST_INSERT_ID()</code></a></td>
<td align="left">Value of the AUTOINCREMENT column for the last INSERT 最后一次 INSERT 的 AUTOINCREMENT 列的值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_row-count"><code>ROW_COUNT()</code></a></td>
<td align="left">The number of rows updated 更新的行数</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_schema"><code>SCHEMA()</code></a></td>
<td align="left">Synonym for DATABASE() DATABASE ()的同义词</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_session-user"><code>SESSION_USER()</code></a></td>
<td align="left">Synonym for USER() USER ()的同义词</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_system-user"><code>SYSTEM_USER()</code></a></td>
<td align="left">Synonym for USER() USER ()的同义词</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_user"><code>USER()</code></a></td>
<td align="left">The user name and host name provided by the client 客户端提供的用户名和主机名</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/information-functions.html#function_version"><code>VERSION()</code></a></td>
<td align="left">Return a string that indicates the MySQL server version 返回指示 MySQL 服务器版本的字符串</td>
</tr>
</tbody></table>
<h2 id="json函数"><a href="#json函数" class="headerlink" title="json函数"></a>json函数</h2><h2 id="与全局事务标识符-GTID-一起使用的函数"><a href="#与全局事务标识符-GTID-一起使用的函数" class="headerlink" title="与全局事务标识符(GTID)一起使用的函数"></a>与全局事务标识符(GTID)一起使用的函数</h2><p>…</p>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>聚合函数通常与 <code>GROUP BY</code> 子句一起使用，以将值分组为子集。</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Name 姓名</td>
<td align="left">Description 描述</td>
<td align="left">Introduced 介绍</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_avg"><code>AVG()</code></a></td>
<td align="left">Return the average value of the argument 返回参数的平均值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_bit-and"><code>BIT_AND()</code></a></td>
<td align="left">Return bitwise AND 按位返回 AND</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_bit-or"><code>BIT_OR()</code></a></td>
<td align="left">Return bitwise OR 按位返回 OR</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_bit-xor"><code>BIT_XOR()</code></a></td>
<td align="left">Return bitwise XOR 返回按位异或</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_count"><code>COUNT()</code></a></td>
<td align="left">Return a count of the number of rows returned 返回返回行数的计数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_count-distinct"><code>COUNT(DISTINCT)</code></a></td>
<td align="left">Return the count of a number of different values 返回许多不同值的计数</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_group-concat"><code>GROUP_CONCAT()</code></a></td>
<td align="left">Return a concatenated string 返回连接的字符串</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_json-arrayagg"><code>JSON_ARRAYAGG()</code></a></td>
<td align="left">Return result set as a single JSON array 以单个 JSON 数组的形式返回结果集</td>
<td align="left">5.7.22</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_json-objectagg"><code>JSON_OBJECTAGG()</code></a></td>
<td align="left">Return result set as a single JSON object 将结果集作为单个 JSON 对象返回</td>
<td align="left">5.7.22</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_max"><code>MAX()</code></a></td>
<td align="left">Return the maximum value 返回最大值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_min"><code>MIN()</code></a></td>
<td align="left">Return the minimum value 返回最小值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_std"><code>STD()</code></a></td>
<td align="left">Return the population standard deviation 返回人口标准差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_stddev"><code>STDDEV()</code></a></td>
<td align="left">Return the population standard deviation 返回人口标准差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_stddev-pop"><code>STDDEV_POP()</code></a></td>
<td align="left">Return the population standard deviation 返回人口标准差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_stddev-samp"><code>STDDEV_SAMP()</code></a></td>
<td align="left">Return the sample standard deviation 返回样本标准差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_sum"><code>SUM()</code></a></td>
<td align="left">Return the sum 把钱退回去</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_var-pop"><code>VAR_POP()</code></a></td>
<td align="left">Return the population standard variance 返回总体标准方差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_var-samp"><code>VAR_SAMP()</code></a></td>
<td align="left">Return the sample variance 返回样本方差</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/aggregate-functions.html#function_variance"><code>VARIANCE()</code></a></td>
<td align="left">Return the population standard variance 返回总体标准方差</td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h2><table>
<thead>
<tr>
<th align="left">Name 姓名</th>
<th align="left">Description 描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_any-value"><code>ANY_VALUE()</code></a></td>
<td align="left">Suppress ONLY_FULL_GROUP_BY value rejection 禁止拒绝 ONLY _ FULL _ GROUP _ BY 值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_default"><code>DEFAULT()</code></a></td>
<td align="left">Return the default value for a table column 返回表列的默认值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-aton"><code>INET_ATON()</code></a></td>
<td align="left">Return the numeric value of an IP address 返回 IP 地址的数值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet-ntoa"><code>INET_NTOA()</code></a></td>
<td align="left">Return the IP address from a numeric value 从数值返回 IP 地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet6-aton"><code>INET6_ATON()</code></a></td>
<td align="left">Return the numeric value of an IPv6 address 返回 IPv6地址的数值</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_inet6-ntoa"><code>INET6_NTOA()</code></a></td>
<td align="left">Return the IPv6 address from a numeric value 从数值中返回 IPv6地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_is-ipv4"><code>IS_IPV4()</code></a></td>
<td align="left">Whether argument is an IPv4 address 参数是否为 IPv4地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_is-ipv4-compat"><code>IS_IPV4_COMPAT()</code></a></td>
<td align="left">Whether argument is an IPv4-compatible address 参数是否为 IPv4兼容地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_is-ipv4-mapped"><code>IS_IPV4_MAPPED()</code></a></td>
<td align="left">Whether argument is an IPv4-mapped address 参数是否为 IPv4映射的地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_is-ipv6"><code>IS_IPV6()</code></a></td>
<td align="left">Whether argument is an IPv6 address 参数是否为 IPv6地址</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_master-pos-wait"><code>MASTER_POS_WAIT()</code></a></td>
<td align="left">Block until the replica has read and applied all updates up to the specified position 块，直到副本读取并应用到指定位置的所有更新</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_name-const"><code>NAME_CONST()</code></a></td>
<td align="left">Cause the column to have the given name 使列具有给定的名称</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_sleep"><code>SLEEP()</code></a></td>
<td align="left">Sleep for a number of seconds 睡几秒钟</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_uuid"><code>UUID()</code></a></td>
<td align="left">Return a Universal Unique Identifier (UUID) 返回通用唯一标识符(UUID)</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_uuid-short"><code>UUID_SHORT()</code></a></td>
<td align="left">Return an integer-valued universal identifier 返回整数值通用标识符</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_values"><code>VALUES()</code></a></td>
<td align="left">Define the values to be used during an INSERT 定义在 INSERT 过程中使用的值</td>
</tr>
</tbody></table>
<h2 id="精确数学"><a href="#精确数学" class="headerlink" title="精确数学"></a>精确数学</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">数据结构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:09:36" itemprop="dateCreated datePublished" datetime="2022-09-24T14:09:36+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:22" itemprop="dateModified" datetime="2023-05-29T16:58:22+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">数据结构</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>郝斌数据结构自学笔记</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1675919757176.png"></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="什么叫数据结构"><a href="#什么叫数据结构" class="headerlink" title="什么叫数据结构"></a>什么叫数据结构</h3><p>数据结构是软件中最核心的课程</p>
<p>我们如何把现实中大量而复杂的问题以特定的<strong>数据类型</strong>和特定的<strong>存储结构</strong>保存到主存储器（内存）中，以及在此基础上为实现某个功能（比如查找某个元素，删除某个元素，对所有元素进行排序）而执行的相应操作，这个相应的操作也叫算法。</p>
<p>数据结构 &#x3D; 个体的存储 + 个体的关系存储</p>
<p>算法 &#x3D; 对存储数据的操作</p>
<p>程序 &#x3D; 数据的存储 + 数据的操作 + 可以被计算机执行的语言</p>
<h3 id="什么是算法"><a href="#什么是算法" class="headerlink" title="什么是算法"></a>什么是算法</h3><p>通俗的说算法是解题的方法和步骤</p>
<p>衡量算法的标准：</p>
<ul>
<li>时间复杂度：程序大概要执行的次数，而非执行的时间。</li>
<li>空间复杂度：程序执行过程中大概所占用的最大内存空间。</li>
<li>难易程度：用易懂，避免过于复杂。</li>
<li>健壮性</li>
</ul>
<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>指针是 C 语言的灵魂。</p>
<p>地址：内存单元的编号，从 0 开始的非负整数。</p>
<p>指针：指针就是地址，地址就是指针。指针变量是存放地址的变量。指针的本质是一个操作受限的非负整数。</p>
<p>分类：类型的指针；指针和数组的关系。</p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>为什么会出现结构体：为了表示一些复杂的数据，而普通的基本类型变量无法满足要求；</p>
<p>定义：结构体是用户根据实际需要自己定义的复合数类型；</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E7%AE%97%E6%B3%95/%E8%BD%AC%E8%BD%BD-raft/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%AE%97%E6%B3%95/%E8%BD%AC%E8%BD%BD-raft/" class="post-title-link" itemprop="url">转载-raft</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:09:36" itemprop="dateCreated datePublished" datetime="2022-09-24T14:09:36+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="寻找一种易于理解的一致性算法（扩展版）"><a href="#寻找一种易于理解的一致性算法（扩展版）" class="headerlink" title="寻找一种易于理解的一致性算法（扩展版）"></a>寻找一种易于理解的一致性算法（扩展版）</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>Raft 是一种为了管理复制日志的一致性算法。它提供了和 Paxos 算法相同的功能和性能，但是它的算法结构和 Paxos 不同，使得 Raft 算法更加容易理解并且更容易构建实际的系统。为了提升可理解性，Raft 将一致性算法分解成了几个关键模块，例如领导人选举、日志复制和安全性。同时它通过实施一个更强的一致性来减少需要考虑的状态的数量。一项用户研究的结果表明，对于学生而言，Raft 算法比 Paxos 算法更加容易学习。Raft 算法还包括一个新的机制来允许集群成员的动态改变，它利用重叠的大多数来保证安全性。</p>
<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h2><p>一致性算法允许一组机器像一个整体一样工作，即使其中一些机器出现故障也能够继续工作下去。正因为如此，一致性算法在构建可信赖的大规模软件系统中扮演着重要的角色。在过去的 10 年里，Paxos 算法统治着一致性算法这一领域：绝大多数的实现都是基于 Paxos 或者受其影响。同时 Paxos 也成为了教学领域里讲解一致性问题时的示例。</p>
<p>但是不幸的是，尽管有很多工作都在尝试降低它的复杂性，但是 Paxos 算法依然十分难以理解。并且，Paxos 自身的算法结构需要进行大幅的修改才能够应用到实际的系统中。因此工业界和学术界都对 Paxos 算法感到十分头疼。</p>
<p>努力研究过 Paxos 算法之后，我们开始寻找一种新的一致性算法，可以为构建实际的系统和教学提供更好的基础。与 Paxos 不同，我们的首要目标是可理解性：我们是否可以在实际系统中定义一个一致性算法，并且比 Paxos 算法更容易学习。此外，我们希望该算法方便系统构建者的直觉的发展。重要的不仅仅是算法能够工作，更重要的是能够很清楚地知道它为什么能工作。</p>
<p>Raft 一致性算法就是这些工作的结果。在设计 Raft 算法的时候，我们使用一些特别的技巧来提升它的可理解性，包括算法分解（Raft 主要被分成了领导人选举，日志复制和安全三个模块）和减少状态机的状态（相对于 Paxos，Raft 减少了非确定性和服务器互相处于非一致性的方式）。一份针对两所大学 43 个学生的研究表明 Raft 明显比 Paxos 算法更加容易理解。在这些学生同时学习了这两种算法之后，和 Paxos 比起来，其中 33 个学生能够回答有关于 Raft 的问题。</p>
<p>Raft 算法在许多方面和现有的一致性算法都很相似（主要是 Oki 和 Liskov 的 Viewstamped Replication），但是它也有一些独特的特性：</p>
<ul>
<li><strong>强领导人</strong>：和其他一致性算法相比，Raft 使用一种更强的领导能力形式。比如，日志条目只从领导人发送给其他的服务器。这种方式简化了对复制日志的管理并且使得 Raft 算法更加易于理解。</li>
<li><strong>领导选举</strong>：Raft 算法使用一个随机计时器来选举领导人。这种方式只是在任何一致性算法都必须实现的心跳机制上增加了一点机制。在解决冲突的时候会更加简单快捷。</li>
<li><strong>成员关系调整</strong>：Raft 使用一种共同一致的方法来处理集群成员变换的问题，在这种方法下，处于调整过程中的两种不同的配置集群中大多数机器会有重叠，这就使得集群在成员变换的时候依然可以继续工作。</li>
</ul>
<p>我们相信，Raft 算法不论出于教学目的还是作为实践项目的基础都是要比 Paxos 或者其他一致性算法要优异的。它比其他算法更加简单，更加容易理解；它的算法描述足以实现一个现实的系统；它有好多开源的实现并且在很多公司里使用；它的安全特性已经被正式定义和证明；它的效率和其他算法比起来也不相上下。</p>
<p>接下来，这篇论文会介绍以下内容：复制状态机问题（第 2 节），讨论 Paxos 的优点和缺点（第 3 节），讨论我们为了可理解性而采取的方法（第 4 节），阐述 Raft 一致性算法（第 5-8 节），评价 Raft 算法（第 9 节），以及一些相关的工作（第 10 节）。</p>
<h2 id="2-复制状态机"><a href="#2-复制状态机" class="headerlink" title="2 复制状态机"></a>2 复制状态机</h2><p>一致性算法是从复制状态机的背景下提出的（参考英文原文引用 37）。在这种方法中，一组服务器上的状态机产生相同状态的副本，并且在一些机器宕掉的情况下也可以继续运行。复制状态机在分布式系统中被用于解决很多容错的问题。例如，大规模的系统中通常都有一个集群领导人，像 GFS、HDFS 和 RAMCloud，典型应用就是一个独立的复制状态机去管理领导选举和存储配置信息并且在领导人宕机的情况下也要存活下来。比如 Chubby 和 ZooKeeper。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657180939949.png"></p>
<blockquote>
<p>图 1 ：复制状态机的结构。一致性算法管理着来自客户端指令的复制日志。状态机从日志中处理相同顺序的相同指令，所以产生的结果也是相同的。</p>
</blockquote>
<p>复制状态机通常都是基于复制日志实现的，如图 1。每一个服务器存储一个包含一系列指令的日志，并且按照日志的顺序进行执行。每一个日志都按照相同的顺序包含相同的指令，所以每一个服务器都执行相同的指令序列。因为每个状态机都是确定的，每一次执行操作都产生相同的状态和同样的序列。</p>
<p>一致性算法的任务是保证复制日志的一致性。服务器上的一致性模块接收客户端发送的指令然后添加到自己的日志中。它和其他服务器上的一致性模块进行通信来保证每一个服务器上的日志最终都以相同的顺序包含相同的请求，即使有些服务器发生故障。一旦指令被正确的复制，每一个服务器的状态机按照日志顺序处理他们，然后输出结果被返回给客户端。因此，服务器集群看起来形成了一个高可靠的状态机。</p>
<p>实际系统中使用的一致性算法通常含有以下特性：</p>
<ul>
<li>安全性保证（绝对不会返回一个错误的结果）：在非拜占庭错误情况下，包括网络延迟、分区、丢包、重复和乱序等错误都可以保证正确。</li>
<li>可用性：集群中只要有大多数的机器可运行并且能够相互通信、和客户端通信，就可以保证可用。因此，一个典型的包含 5 个节点的集群可以容忍两个节点的失败。服务器被停止就认为是失败。它们稍后可能会从可靠存储的状态中恢复并重新加入集群。</li>
<li>不依赖时序来保证一致性：物理时钟错误或者极端的消息延迟只有在最坏情况下才会导致可用性问题。</li>
<li>通常情况下，一条指令可以尽可能快的在集群中大多数节点响应一轮远程过程调用时完成。小部分比较慢的节点不会影响系统整体的性能。</li>
</ul>
<h2 id="3-Paxos-算法的问题"><a href="#3-Paxos-算法的问题" class="headerlink" title="3 Paxos 算法的问题"></a>3 Paxos 算法的问题</h2><p>在过去的 10 年里，Leslie Lamport 的 Paxos 算法几乎已经成为一致性的代名词：Paxos 是在课程教学中最经常使用的算法，同时也是大多数一致性算法实现的起点。Paxos 首先定义了一个能够达成单一决策一致的协议，比如单条的复制日志项。我们把这一子集叫做单决策 Paxos。然后通过组合多个 Paxos 协议的实例来促进一系列决策的达成。Paxos 保证安全性和活性，同时也支持集群成员关系的变更。Paxos 的正确性已经被证明，在通常情况下也很高效。</p>
<p>不幸的是，Paxos 有两个明显的缺点。第一个缺点是 Paxos 算法特别的难以理解。完整的解释是出了名的不透明；通过极大的努力之后，也只有少数人成功理解了这个算法。因此，有了几次用更简单的术语来解释 Paxos 的尝试。尽管这些解释都只关注了单决策的子集问题，但依然很具有挑战性。在 2012 年 NSDI 的会议中的一次调查显示，很少有人对 Paxos 算法感到满意，甚至在经验老道的研究者中也是如此。我们自己也尝试去理解 Paxos；我们一直没能理解 Paxos 直到我们读了很多对 Paxos 的简化解释并且设计了我们自己的算法之后，这一过程花了近一年时间。</p>
<p>我们假设 Paxos 的不透明性来自它选择单决策问题作为它的基础。单决策 Paxos 是晦涩微妙的，它被划分成了两种没有简单直观解释和无法独立理解的情景。因此，这导致了很难建立起直观的感受为什么单决策 Paxos 算法能够工作。构成多决策 Paxos 增加了很多错综复杂的规则。我们相信，在多决策上达成一致性的问题（一份日志而不是单一的日志记录）能够被分解成其他的方式并且更加直接和明显。</p>
<p>Paxos 算法的第二个问题就是它没有提供一个足够好的用来构建一个现实系统的基础。一个原因是还没有一种被广泛认同的多决策问题的算法。Lamport 的描述基本上都是关于单决策 Paxos 的；他简要描述了实施多决策 Paxos 的方法，但是缺乏很多细节。当然也有很多具体化 Paxos 的尝试，但是他们都互相不一样，和 Paxos 的概述也不同。例如 Chubby 这样的系统实现了一个类似于 Paxos 的算法，但是大多数的细节并没有被公开。</p>
<p>而且，Paxos 算法的结构也不是十分易于构建实践的系统；单决策分解也会产生其他的结果。例如，独立的选择一组日志条目然后合并成一个序列化的日志并没有带来太多的好处，仅仅增加了不少复杂性。围绕着日志来设计一个系统是更加简单高效的；新日志条目以严格限制的顺序增添到日志中去。另一个问题是，Paxos 使用了一种对等的点对点的方式作为它的核心（尽管它最终提议了一种弱领导人的方法来优化性能）。在只有一个决策会被制定的简化世界中是很有意义的，但是很少有现实的系统使用这种方式。如果有一系列的决策需要被制定，首先选择一个领导人，然后让他去协调所有的决议，会更加简单快速。</p>
<p>因此，实际的系统中很少有和 Paxos 相似的实践。每一种实现都是从 Paxos 开始研究，然后发现很多实现上的难题，再然后开发了一种和 Paxos 明显不一样的结构。这样是非常费时和容易出错的，并且理解 Paxos 的难度使得这个问题更加糟糕。Paxos 算法在理论上被证明是正确可行的，但是现实的系统和 Paxos 差别是如此的大，以至于这些证明没有什么太大的价值。下面来自 Chubby 实现非常典型：</p>
<blockquote>
<p>在 Paxos 算法描述和实现现实系统中间有着巨大的鸿沟。最终的系统建立在一种没有经过证明的算法之上。</p>
</blockquote>
<p>由于以上问题，我们认为 Paxos 算法既没有提供一个良好的基础给实践的系统，也没有给教学很好的帮助。基于一致性问题在大规模软件系统中的重要性，我们决定看看我们是否可以设计一个拥有更好特性的替代 Paxos 的一致性算法。Raft 算法就是这次实验的结果。</p>
<h2 id="4-为了可理解性的设计"><a href="#4-为了可理解性的设计" class="headerlink" title="4 为了可理解性的设计"></a>4 为了可理解性的设计</h2><p>设计 Raft 算法我们有几个初衷：它必须提供一个完整的实际的系统实现基础，这样才能大大减少开发者的工作；它必须在任何情况下都是安全的并且在大多数的情况下都是可用的；并且它的大部分操作必须是高效的。但是我们最重要也是最大的挑战是可理解性。它必须保证对于普遍的人群都可以十分容易的去理解。另外，它必须能够让人形成直观的认识，这样系统的构建者才能够在现实中进行必然的扩展。</p>
<p>在设计 Raft 算法的时候，有很多的点需要我们在各种备选方案中进行选择。在这种情况下，我们评估备选方案基于可理解性原则：解释各个备选方案有多大的难度（例如，Raft 的状态空间有多复杂，是否有微妙的暗示）？对于一个读者而言，完全理解这个方案和暗示是否容易？</p>
<p>我们意识到对这种可理解性分析上具有高度的主观性；尽管如此，我们使用了两种通常适用的技术来解决这个问题。第一个技术就是众所周知的问题分解：我们尽可能地将问题分解成几个相对独立的，可被解决的、可解释的和可理解的子问题。例如，Raft 算法被我们分成领导人选举，日志复制，安全性和成员变更几个部分。</p>
<p>我们使用的第二个方法是通过减少状态的数量来简化需要考虑的状态空间，使得系统更加连贯并且在可能的时候消除不确定性。特别的，所有的日志是不允许有空洞的，并且 Raft 限制了日志之间变成不一致状态的可能。尽管在大多数情况下我们都试图消除不确定性，但是也有一些情况下不确定性可以提升可理解性。尤其是，随机化方法增加了不确定性，但是他们有利于减少状态空间数量，通过处理所有可能选择时使用相似的方法。我们使用随机化来简化 Raft 中领导人选举算法。</p>
<h2 id="5-Raft-一致性算法"><a href="#5-Raft-一致性算法" class="headerlink" title="5 Raft 一致性算法"></a>5 Raft 一致性算法</h2><p>Raft 是一种用来管理章节 2 中描述的复制日志的算法。图 2 为了参考之用，总结这个算法的简略版本，图 3 列举了这个算法的一些关键特性。图中的这些元素会在剩下的章节逐一介绍。</p>
<p>Raft 通过选举一个杰出的领导人，然后给予他全部的管理复制日志的责任来实现一致性。领导人从客户端接收日志条目（log entries），把日志条目复制到其他服务器上，并告诉其他的服务器什么时候可以安全地将日志条目应用到他们的状态机中。拥有一个领导人大大简化了对复制日志的管理。例如，领导人可以决定新的日志条目需要放在日志中的什么位置而不需要和其他服务器商议，并且数据都从领导人流向其他服务器。一个领导人可能会发生故障，或者和其他服务器失去连接，在这种情况下一个新的领导人会被选举出来。</p>
<p>通过领导人的方式，Raft 将一致性问题分解成了三个相对独立的子问题，这些问题会在接下来的子章节中进行讨论：</p>
<ul>
<li><strong>领导选举</strong>：当现存的领导人发生故障的时候, 一个新的领导人需要被选举出来（章节 5.2）</li>
<li><strong>日志复制</strong>：领导人必须从客户端接收日志条目（log entries）然后复制到集群中的其他节点，并强制要求其他节点的日志和自己保持一致。</li>
<li><strong>安全性</strong>：在 Raft 中安全性的关键是在图 3 中展示的状态机安全：如果有任何的服务器节点已经应用了一个确定的日志条目到它的状态机中，那么其他服务器节点不能在同一个日志索引位置应用一个不同的指令。章节 5.4 阐述了 Raft 算法是如何保证这个特性的；这个解决方案涉及到选举机制（5.2 节）上的一个额外限制。</li>
</ul>
<p>在展示一致性算法之后，这一章节会讨论一些可用性的问题和计时在系统中的作用。</p>
<p><strong>状态</strong>：</p>
<p>所有服务器上的持久性状态<br>(在响应 RPC 请求之前，已经更新到了稳定的存储设备)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>currentTerm</td>
<td>服务器已知最新的任期（在服务器首次启动时初始化为 0，单调递增）</td>
</tr>
<tr>
<td>votedFor</td>
<td>当前任期内收到选票的 candidateId，如果没有投给任何候选人 则为空</td>
</tr>
<tr>
<td>log[]</td>
<td>日志条目；每个条目包含了用于状态机的命令，以及领导人接收到该条目时的任期（初始索引为 1）</td>
</tr>
</tbody></table>
<p>所有服务器上的易失性状态</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>commitIndex</td>
<td>已知已提交的最高的日志条目的索引（初始值为 0，单调递增）</td>
</tr>
<tr>
<td>lastApplied</td>
<td>已经被应用到状态机的最高的日志条目的索引（初始值为 0，单调递增）</td>
</tr>
</tbody></table>
<p>领导人（服务器）上的易失性状态<br>(选举后已经重新初始化)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>nextIndex[]</td>
<td>对于每一台服务器，发送到该服务器的下一个日志条目的索引（初始值为领导人最后的日志条目的索引+1）</td>
</tr>
<tr>
<td>matchIndex[]</td>
<td>对于每一台服务器，已知的已经复制到该服务器的最高日志条目的索引（初始值为 0，单调递增）</td>
</tr>
</tbody></table>
<p><strong>追加条目（AppendEntries）RPC</strong>：</p>
<p>由领导人调用，用于日志条目的复制，同时也被当做心跳使用</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>领导人的任期</td>
</tr>
<tr>
<td>leaderId</td>
<td>领导人 ID 因此跟随者可以对客户端进行重定向（译者注：跟随者根据领导人 ID 把客户端的请求重定向到领导人，比如有时客户端把请求发给了跟随者而不是领导人）</td>
</tr>
<tr>
<td>prevLogIndex</td>
<td>紧邻新日志条目之前的那个日志条目的索引</td>
</tr>
<tr>
<td>prevLogTerm</td>
<td>紧邻新日志条目之前的那个日志条目的任期</td>
</tr>
<tr>
<td>entries[]</td>
<td>需要被保存的日志条目（被当做心跳使用时，则日志条目内容为空；为了提高效率可能一次性发送多个）</td>
</tr>
<tr>
<td>leaderCommit</td>
<td>领导人的已知已提交的最高的日志条目的索引</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>返回值</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>当前任期，对于领导人而言 它会更新自己的任期</td>
</tr>
<tr>
<td>success</td>
<td>如果跟随者所含有的条目和 prevLogIndex 以及 prevLogTerm 匹配上了，则为 true</td>
</tr>
</tbody></table>
<p>接收者的实现：</p>
<ol>
<li>返回假 如果领导人的任期小于接收者的当前任期（译者注：这里的接收者是指跟随者或者候选人）（5.1 节）</li>
<li>返回假 如果接收者日志中没有包含这样一个条目 即该条目的任期在 prevLogIndex 上能和 prevLogTerm 匹配上<br>（译者注：在接收者日志中 如果能找到一个和 prevLogIndex 以及 prevLogTerm 一样的索引和任期的日志条目 则继续执行下面的步骤 否则返回假）（5.3 节）</li>
<li>如果一个已经存在的条目和新条目（译者注：即刚刚接收到的日志条目）发生了冲突（因为索引相同，任期不同），那么就删除这个已经存在的条目以及它之后的所有条目 （5.3 节）</li>
<li>追加日志中尚未存在的任何新条目</li>
<li>如果领导人的已知已提交的最高日志条目的索引大于接收者的已知已提交最高日志条目的索引（<code>leaderCommit &gt; commitIndex</code>），则把接收者的已知已经提交的最高的日志条目的索引 commitIndex 重置为 领导人的已知已经提交的最高的日志条目的索引 leaderCommit 或者是 上一个新条目的索引 取两者的最小值</li>
</ol>
<p><strong>请求投票（RequestVote）RPC</strong>：</p>
<p>由候选人负责调用用来征集选票（5.2 节）</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>候选人的任期号</td>
</tr>
<tr>
<td>candidateId</td>
<td>请求选票的候选人的 ID</td>
</tr>
<tr>
<td>lastLogIndex</td>
<td>候选人的最后日志条目的索引值</td>
</tr>
<tr>
<td>lastLogTerm</td>
<td>候选人最后日志条目的任期号</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>返回值</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>当前任期号，以便于候选人去更新自己的任期号</td>
</tr>
<tr>
<td>voteGranted</td>
<td>候选人赢得了此张选票时为真</td>
</tr>
</tbody></table>
<p>接收者实现：</p>
<ol>
<li>如果<code>term &lt; currentTerm</code>返回 false （5.2 节）</li>
<li>如果 votedFor 为空或者为 candidateId，并且候选人的日志至少和自己一样新，那么就投票给他（5.2 节，5.4 节）</li>
</ol>
<p><strong>所有服务器需遵守的规则</strong>：</p>
<p>所有服务器：</p>
<ul>
<li>如果<code>commitIndex &gt; lastApplied</code>，则 lastApplied 递增，并将<code>log[lastApplied]</code>应用到状态机中（5.3 节）</li>
<li>如果接收到的 RPC 请求或响应中，任期号<code>T &gt; currentTerm</code>，则令 <code>currentTerm = T</code>，并切换为跟随者状态（5.1 节）</li>
</ul>
<p>跟随者（5.2 节）：</p>
<ul>
<li>响应来自候选人和领导人的请求</li>
<li>如果在超过选举超时时间的情况之前没有收到<strong>当前领导人</strong>（即该领导人的任期需与这个跟随者的当前任期相同）的心跳&#x2F;附加日志，或者是给某个候选人投了票，就自己变成候选人</li>
</ul>
<p>候选人（5.2 节）：</p>
<ul>
<li>在转变成候选人后就立即开始选举过程<ul>
<li>自增当前的任期号（currentTerm）</li>
<li>给自己投票</li>
<li>重置选举超时计时器</li>
<li>发送请求投票的 RPC 给其他所有服务器</li>
</ul>
</li>
<li>如果接收到大多数服务器的选票，那么就变成领导人</li>
<li>如果接收到来自新的领导人的附加日志（AppendEntries）RPC，则转变成跟随者</li>
<li>如果选举过程超时，则再次发起一轮选举</li>
</ul>
<p>领导人：</p>
<ul>
<li>一旦成为领导人：发送空的附加日志（AppendEntries）RPC（心跳）给其他所有的服务器；在一定的空余时间之后不停的重复发送，以防止跟随者超时（5.2 节）</li>
<li>如果接收到来自客户端的请求：附加条目到本地日志中，在条目被应用到状态机后响应客户端（5.3 节）</li>
<li>如果对于一个跟随者，最后日志条目的索引值大于等于 nextIndex（<code>lastLogIndex ≥ nextIndex</code>），则发送从 nextIndex 开始的所有日志条目：<ul>
<li>如果成功：更新相应跟随者的 nextIndex 和 matchIndex</li>
<li>如果因为日志不一致而失败，则 nextIndex 递减并重试</li>
</ul>
</li>
<li>假设存在 N 满足<code>N &gt; commitIndex</code>，使得大多数的 <code>matchIndex[i] ≥ N</code>以及<code>log[N].term == currentTerm</code> 成立，则令 <code>commitIndex = N</code>（5.3 和 5.4 节）</li>
</ul>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657180957592.png"></p>
<blockquote>
<p>图 2：一个关于 Raft 一致性算法的浓缩总结（不包括成员变换和日志压缩）。</p>
</blockquote>
<table>
<thead>
<tr>
<th>特性</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>选举安全特性</td>
<td>对于一个给定的任期号，最多只会有一个领导人被选举出来（5.2 节）</td>
</tr>
<tr>
<td>领导人只附加原则</td>
<td>领导人绝对不会删除或者覆盖自己的日志，只会增加（5.3 节）</td>
</tr>
<tr>
<td>日志匹配原则</td>
<td>如果两个日志在某一相同索引位置日志条目的任期号相同，那么我们就认为这两个日志从头到该索引位置之间的内容完全一致（5.3 节）</td>
</tr>
<tr>
<td>领导人完全特性</td>
<td>如果某个日志条目在某个任期号中已经被提交，那么这个条目必然出现在更大任期号的所有领导人中（5.4 节）</td>
</tr>
<tr>
<td>状态机安全特性</td>
<td>如果某一服务器已将给定索引位置的日志条目应用至其状态机中，则其他任何服务器在该索引位置不会应用不同的日志条目（5.4.3 节）</td>
</tr>
</tbody></table>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657180992608.png"></p>
<blockquote>
<p>图 3：Raft 在任何时候都保证以上的各个特性。</p>
</blockquote>
<h3 id="5-1-Raft-基础"><a href="#5-1-Raft-基础" class="headerlink" title="5.1 Raft 基础"></a>5.1 Raft 基础</h3><p>一个 Raft 集群包含若干个服务器节点；5 个服务器节点是一个典型的例子，这允许整个系统容忍 2 个节点失效。在任何时刻，每一个服务器节点都处于这三个状态之一：领导人、跟随者或者候选人。在通常情况下，系统中只有一个领导人并且其他的节点全部都是跟随者。跟随者都是被动的：他们不会发送任何请求，只是简单的响应来自领导人或者候选人的请求。领导人处理所有的客户端请求（如果一个客户端和跟随者联系，那么跟随者会把请求重定向给领导人）。第三种状态，候选人，是用来在 5.2 节描述的选举新领导人时使用。图 4 展示了这些状态和他们之间的转换关系；这些转换关系会在接下来进行讨论。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181004800.png"></p>
<blockquote>
<p>图 4：服务器状态。跟随者只响应来自其他服务器的请求。如果跟随者接收不到消息，那么他就会变成候选人并发起一次选举。获得集群中大多数选票的候选人将成为领导人。在一个任期内，领导人一直都会是领导人，直到自己宕机了。</p>
</blockquote>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181028912.png"></p>
<blockquote>
<p>图 5：时间被划分成一个个的任期，每个任期开始都是一次选举。在选举成功后，领导人会管理整个集群直到任期结束。有时候选举会失败，那么这个任期就会没有领导人而结束。任期之间的切换可以在不同的时间不同的服务器上观察到。</p>
</blockquote>
<p>Raft 把时间分割成任意长度的<strong>任期</strong>，如图 5。任期用连续的整数标记。每一段任期从一次<strong>选举</strong>开始，就像章节 5.2 描述的一样，一个或者多个候选人尝试成为领导人。如果一个候选人赢得选举，然后他就在接下来的任期内充当领导人的职责。在某些情况下，一次选举过程会造成选票的瓜分。在这种情况下，这一任期会以没有领导人结束；一个新的任期（和一次新的选举）会很快重新开始。Raft 保证了在一个给定的任期内，最多只有一个领导人。</p>
<p>不同的服务器节点可能多次观察到任期之间的转换，但在某些情况下，一个节点也可能观察不到任何一次选举或者整个任期全程。任期在 Raft 算法中充当逻辑时钟的作用，任期使得服务器可以检测一些过期的信息：比如过期的领导人。每个节点存储一个当前任期号，这一编号在整个时期内单调递增。每当服务器之间通信的时候都会交换当前任期号；如果一个服务器的当前任期号比其他人小，那么他会更新自己的编号到较大的编号值。如果一个候选人或者领导人发现自己的任期号过期了，那么他会立即恢复成跟随者状态。如果一个节点接收到一个包含过期的任期号的请求，那么他会直接拒绝这个请求。</p>
<p>Raft 算法中服务器节点之间通信使用远程过程调用（RPCs），并且基本的一致性算法只需要两种类型的 RPCs。请求投票（RequestVote） RPCs 由候选人在选举期间发起（章节 5.2），然后附加条目（AppendEntries）RPCs 由领导人发起，用来复制日志和提供一种心跳机制（章节 5.3）。第 7 节为了在服务器之间传输快照增加了第三种 RPC。当服务器没有及时的收到 RPC 的响应时，会进行重试， 并且他们能够并行的发起 RPCs 来获得最佳的性能。</p>
<h3 id="5-2-领导人选举"><a href="#5-2-领导人选举" class="headerlink" title="5.2 领导人选举"></a>5.2 领导人选举</h3><p>Raft 使用一种心跳机制来触发领导人选举。当服务器程序启动时，他们都是跟随者身份。一个服务器节点继续保持着跟随者状态只要他从领导人或者候选人处接收到有效的 RPCs。领导人周期性的向所有跟随者发送心跳包（即不包含日志项内容的附加条目（AppendEntries） RPCs）来维持自己的权威。如果一个跟随者在一段时间里没有接收到任何消息，也就是<strong>选举超时</strong>，那么他就会认为系统中没有可用的领导人,并且发起选举以选出新的领导人。</p>
<p>要开始一次选举过程，跟随者先要增加自己的当前任期号并且转换到候选人状态。然后他会并行的向集群中的其他服务器节点发送请求投票的 RPCs 来给自己投票。候选人会继续保持着当前状态直到以下三件事情之一发生：(a) 他自己赢得了这次的选举，(b) 其他的服务器成为领导人，(c) 一段时间之后没有任何一个获胜的人。这些结果会分别的在下面的段落里进行讨论。</p>
<p>当一个候选人从整个集群的大多数服务器节点获得了针对同一个任期号的选票，那么他就赢得了这次选举并成为领导人。每一个服务器最多会对一个任期号投出一张选票，按照先来先服务的原则（注意：5.4 节在投票上增加了一点额外的限制）。要求大多数选票的规则确保了最多只会有一个候选人赢得此次选举（图 3 中的选举安全性）。一旦候选人赢得选举，他就立即成为领导人。然后他会向其他的服务器发送心跳消息来建立自己的权威并且阻止发起新的选举。</p>
<p>在等待投票的时候，候选人可能会从其他的服务器接收到声明它是领导人的附加条目（AppendEntries）RPC。如果这个领导人的任期号（包含在此次的 RPC 中）不小于候选人当前的任期号，那么候选人会承认领导人合法并回到跟随者状态。 如果此次 RPC 中的任期号比自己小，那么候选人就会拒绝这次的 RPC 并且继续保持候选人状态。</p>
<p>第三种可能的结果是候选人既没有赢得选举也没有输：如果有多个跟随者同时成为候选人，那么选票可能会被瓜分以至于没有候选人可以赢得大多数人的支持。当这种情况发生的时候，每一个候选人都会超时，然后通过增加当前任期号来开始一轮新的选举。然而，没有其他机制的话，选票可能会被无限的重复瓜分。</p>
<p>Raft 算法使用随机选举超时时间的方法来确保很少会发生选票瓜分的情况，就算发生也能很快的解决。为了阻止选票起初就被瓜分，选举超时时间是从一个固定的区间（例如 150-300 毫秒）随机选择。这样可以把服务器都分散开以至于在大多数情况下只有一个服务器会选举超时；然后他赢得选举并在其他服务器超时之前发送心跳包。同样的机制被用在选票瓜分的情况下。每一个候选人在开始一次选举的时候会重置一个随机的选举超时时间，然后在超时时间内等待投票的结果；这样减少了在新的选举中另外的选票瓜分的可能性。9.3 节展示了这种方案能够快速的选出一个领导人。</p>
<p>领导人选举这个例子，体现了可理解性原则是如何指导我们进行方案设计的。起初我们计划使用一种排名系统：每一个候选人都被赋予一个唯一的排名，供候选人之间竞争时进行选择。如果一个候选人发现另一个候选人拥有更高的排名，那么他就会回到跟随者状态，这样高排名的候选人能够更加容易的赢得下一次选举。但是我们发现这种方法在可用性方面会有一点问题（如果高排名的服务器宕机了，那么低排名的服务器可能会超时并再次进入候选人状态。而且如果这个行为发生得足够快，则可能会导致整个选举过程都被重置掉）。我们针对算法进行了多次调整，但是每次调整之后都会有新的问题。最终我们认为随机重试的方法是更加明显和易于理解的。</p>
<h3 id="5-3-日志复制"><a href="#5-3-日志复制" class="headerlink" title="5.3 日志复制"></a>5.3 日志复制</h3><p>一旦一个领导人被选举出来，他就开始为客户端提供服务。客户端的每一个请求都包含一条被复制状态机执行的指令。领导人把这条指令作为一条新的日志条目附加到日志中去，然后并行的发起附加条目 RPCs 给其他的服务器，让他们复制这条日志条目。当这条日志条目被安全的复制（下面会介绍），领导人会应用这条日志条目到它的状态机中然后把执行的结果返回给客户端。如果跟随者崩溃或者运行缓慢，再或者网络丢包，领导人会不断的重复尝试附加日志条目 RPCs （尽管已经回复了客户端）直到所有的跟随者都最终存储了所有的日志条目。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181039296.png"></p>
<blockquote>
<p>图 6：日志由有序序号标记的条目组成。每个条目都包含创建时的任期号（图中框中的数字），和一个状态机需要执行的指令。一个条目当可以安全的被应用到状态机中去的时候，就认为是可以提交了。</p>
</blockquote>
<p>日志以图 6 展示的方式组织。每一个日志条目存储一条状态机指令和从领导人收到这条指令时的任期号。日志中的任期号用来检查是否出现不一致的情况，同时也用来保证图 3 中的某些性质。每一条日志条目同时也都有一个整数索引值来表明它在日志中的位置。</p>
<p>领导人来决定什么时候把日志条目应用到状态机中是安全的；这种日志条目被称为<strong>已提交</strong>。Raft 算法保证所有已提交的日志条目都是持久化的并且最终会被所有可用的状态机执行。在领导人将创建的日志条目复制到大多数的服务器上的时候，日志条目就会被提交（例如在图 6 中的条目 7）。同时，领导人的日志中之前的所有日志条目也都会被提交，包括由其他领导人创建的条目。5.4 节会讨论某些当在领导人改变之后应用这条规则的隐晦内容，同时他也展示了这种提交的定义是安全的。领导人跟踪了最大的将会被提交的日志项的索引，并且索引值会被包含在未来的所有附加日志 RPCs （包括心跳包），这样其他的服务器才能最终知道领导人的提交位置。一旦跟随者知道一条日志条目已经被提交，那么他也会将这个日志条目应用到本地的状态机中（按照日志的顺序）。</p>
<p>我们设计了 Raft 的日志机制来维护不同服务器日志之间的高层次的一致性。这么做不仅简化了系统的行为也使其更具有可预测性，同时它也是安全性保证的一个重要组件。Raft 维护着以下的特性，这些特性共同组成了图 3 中的<strong>日志匹配特性（Log Matching Property）</strong>：</p>
<ul>
<li>如果在不同的日志中的两个条目拥有相同的索引和任期号，那么他们存储了相同的指令。</li>
<li>如果在不同的日志中的两个条目拥有相同的索引和任期号，那么他们之前的所有日志条目也全部相同。</li>
</ul>
<p>第一个特性来自这样的一个事实，领导人最多在一个任期里在指定的一个日志索引位置创建一条日志条目，同时日志条目在日志中的位置也从来不会改变。第二个特性由附加日志 RPC 的一个简单的一致性检查所保证。在发送附加日志 RPC 的时候，领导人会把新的日志条目前紧挨着的条目的索引位置和任期号包含在日志内。如果跟随者在它的日志中找不到包含相同索引位置和任期号的条目，那么他就会拒绝接收新的日志条目。一致性检查就像一个归纳步骤：一开始空的日志状态肯定是满足日志匹配特性的，然后一致性检查在日志扩展的时候保护了日志匹配特性。因此，每当附加日志 RPC 返回成功时，领导人就知道跟随者的日志一定是和自己相同的了。</p>
<p>在正常的操作中，领导人和跟随者的日志保持一致性，所以附加日志 RPC 的一致性检查从来不会失败。然而，领导人崩溃的情况会使得日志处于不一致的状态（老的领导人可能还没有完全复制所有的日志条目）。这种不一致问题会在领导人和跟随者的一系列崩溃下加剧。图 7 展示了跟随者的日志可能和新的领导人不同。跟随者可能会丢失一些在新的领导人中存在的日志条目，他也可能拥有一些领导人没有的日志条目，或者两者都发生。丢失或者多出日志条目可能会持续多个任期。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181050192.png"></p>
<blockquote>
<p>图 7：当一个领导人成功当选时，跟随者可能是任何情况（a-f）。每一个盒子表示是一个日志条目；里面的数字表示任期号。跟随者可能会缺少一些日志条目（a-b），可能会有一些未被提交的日志条目（c-d），或者两种情况都存在（e-f）。例如，场景 f 可能会这样发生，某服务器在任期 2 的时候是领导人，已附加了一些日志条目到自己的日志中，但在提交之前就崩溃了；很快这个机器就被重启了，在任期 3 重新被选为领导人，并且又增加了一些日志条目到自己的日志中；在任期 2 和任期 3 的日志被提交之前，这个服务器又宕机了，并且在接下来的几个任期里一直处于宕机状态。</p>
</blockquote>
<p>在 Raft 算法中，领导人是通过强制跟随者直接复制自己的日志来处理不一致问题的。这意味着在跟随者中的冲突的日志条目会被领导人的日志覆盖。5.4 节会阐述如何通过增加一些限制来使得这样的操作是安全的。</p>
<p>要使得跟随者的日志进入和自己一致的状态，领导人必须找到最后两者达成一致的地方，然后删除跟随者从那个点之后的所有日志条目，并发送自己在那个点之后的日志给跟随者。所有的这些操作都在进行附加日志 RPCs 的一致性检查时完成。领导人针对每一个跟随者维护了一个 <strong>nextIndex</strong>，这表示下一个需要发送给跟随者的日志条目的索引地址。当一个领导人刚获得权力的时候，他初始化所有的 nextIndex 值为自己的最后一条日志的 index 加 1（图 7 中的 11）。如果一个跟随者的日志和领导人不一致，那么在下一次的附加日志 RPC 时的一致性检查就会失败。在被跟随者拒绝之后，领导人就会减小 nextIndex 值并进行重试。最终 nextIndex 会在某个位置使得领导人和跟随者的日志达成一致。当这种情况发生，附加日志 RPC 就会成功，这时就会把跟随者冲突的日志条目全部删除并且加上领导人的日志。一旦附加日志 RPC 成功，那么跟随者的日志就会和领导人保持一致，并且在接下来的任期里一直继续保持。</p>
<blockquote>
<p>如果需要的话，算法可以通过减少被拒绝的附加日志 RPCs 的次数来优化。例如，当附加日志 RPC 的请求被拒绝的时候，跟随者可以(返回)冲突条目的任期号和该任期号对应的最小索引地址。借助这些信息，领导人可以减小 nextIndex 一次性越过该冲突任期的所有日志条目；这样就变成每个任期需要一次附加条目 RPC 而不是每个条目一次。在实践中，我们十分怀疑这种优化是否是必要的，因为失败是很少发生的并且也不大可能会有这么多不一致的日志。</p>
</blockquote>
<p>通过这种机制，领导人在获得权力的时候就不需要任何特殊的操作来恢复一致性。他只需要进行正常的操作，然后日志就能在回复附加日志 RPC 的一致性检查失败的时候自动趋于一致。领导人从来不会覆盖或者删除自己的日志（图 3 的领导人只附加特性）。</p>
<p>日志复制机制展示出了第 2 节中形容的一致性特性：Raft 能够接受，复制并应用新的日志条目只要大部分的机器是工作的；在通常的情况下，新的日志条目可以在一次 RPC 中被复制给集群中的大多数机器；并且单个的缓慢的跟随者不会影响整体的性能。</p>
<h3 id="5-4-安全性"><a href="#5-4-安全性" class="headerlink" title="5.4 安全性"></a>5.4 安全性</h3><p>前面的章节里描述了 Raft 算法是如何选举和复制日志的。然而，到目前为止描述的机制并不能充分的保证每一个状态机会按照相同的顺序执行相同的指令。例如，一个跟随者可能会进入不可用状态同时领导人已经提交了若干的日志条目，然后这个跟随者可能会被选举为领导人并且覆盖这些日志条目；因此，不同的状态机可能会执行不同的指令序列。</p>
<p>这一节通过在领导选举的时候增加一些限制来完善 Raft 算法。这一限制保证了任何的领导人对于给定的任期号，都拥有了之前任期的所有被提交的日志条目（图 3 中的领导人完整特性）。增加这一选举时的限制，我们对于提交时的规则也更加清晰。最终，我们将展示对于<strong>领导人完整特性（Leader Completeness Property）</strong> 的简要证明，并且说明该特性是如何引导复制状态机做出正确行为的。</p>
<h4 id="5-4-1-选举限制"><a href="#5-4-1-选举限制" class="headerlink" title="5.4.1 选举限制"></a>5.4.1 选举限制</h4><p>在任何基于领导人的一致性算法中，领导人都必须存储所有已经提交的日志条目。在某些一致性算法中，例如 Viewstamped Replication，某个节点即使是一开始并没有包含所有已经提交的日志条目，它也能被选为领导人。这些算法都包含一些额外的机制来识别丢失的日志条目并把他们传送给新的领导人，要么是在选举阶段要么在之后很快进行。不幸的是，这种方法会导致相当大的额外的机制和复杂性。Raft 使用了一种更加简单的方法，它可以保证在选举的时候新的领导人拥有所有之前任期中已经提交的日志条目，而不需要传送这些日志条目给领导人。这意味着日志条目的传送是单向的，只从领导人传给跟随者，并且领导人从不会覆盖自身本地日志中已经存在的条目。</p>
<p>Raft 使用投票的方式来阻止一个候选人赢得选举，除非这个候选人包含了所有已经提交的日志条目。候选人为了赢得选举必须联系集群中的大部分节点，这意味着每一个已经提交的日志条目在这些服务器节点中肯定存在于至少一个节点上。如果候选人的日志至少和大多数的服务器节点一样新（这个新的定义会在下面讨论），那么他一定持有了所有已经提交的日志条目。请求投票（RequestVote） RPC 实现了这样的限制：RPC 中包含了候选人的日志信息，然后投票人会拒绝掉那些日志没有自己新的投票请求。</p>
<p>Raft 通过比较两份日志中最后一条日志条目的索引值和任期号定义谁的日志比较新。如果两份日志最后的条目的任期号不同，那么任期号大的日志更加新。如果两份日志最后的条目任期号相同，那么日志比较长的那个就更加新。</p>
<h4 id="5-4-2-提交之前任期内的日志条目"><a href="#5-4-2-提交之前任期内的日志条目" class="headerlink" title="5.4.2 提交之前任期内的日志条目"></a>5.4.2 提交之前任期内的日志条目</h4><p>如同 5.3 节介绍的那样，领导人知道一条当前任期内的日志记录是可以被提交的，只要它被存储到了大多数的服务器上。如果一个领导人在提交日志条目之前崩溃了，未来后续的领导人会继续尝试复制这条日志记录。然而，一个领导人不能断定一个之前任期里的日志条目被保存到大多数服务器上的时候就一定已经提交了。图 8 展示了一种情况，一条已经被存储到大多数节点上的老日志条目，也依然有可能会被未来的领导人覆盖掉。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181060920.png"></p>
<blockquote>
<p>图 8：如图的时间序列展示了为什么领导人无法决定对老任期号的日志条目进行提交。在 (a) 中，S1 是领导人，部分的(跟随者)复制了索引位置 2 的日志条目。在 (b) 中，S1 崩溃了，然后 S5 在任期 3 里通过 S3、S4 和自己的选票赢得选举，然后从客户端接收了一条不一样的日志条目放在了索引 2 处。然后到 (c)，S5 又崩溃了；S1 重新启动，选举成功，开始复制日志。在这时，来自任期 2 的那条日志已经被复制到了集群中的大多数机器上，但是还没有被提交。如果 S1 在 (d) 中又崩溃了，S5 可以重新被选举成功（通过来自 S2，S3 和 S4 的选票），然后覆盖了他们在索引 2 处的日志。反之，如果在崩溃之前，S1 把自己主导的新任期里产生的日志条目复制到了大多数机器上，就如 (e) 中那样，那么在后面任期里面这些新的日志条目就会被提交（因为 S5 就不可能选举成功）。 这样在同一时刻就同时保证了，之前的所有老的日志条目就会被提交。</p>
</blockquote>
<p>为了消除图 8 里描述的情况，Raft 永远不会通过计算副本数目的方式去提交一个之前任期内的日志条目。只有领导人当前任期里的日志条目通过计算副本数目可以被提交；一旦当前任期的日志条目以这种方式被提交，那么由于日志匹配特性，之前的日志条目也都会被间接的提交。在某些情况下，领导人可以安全的知道一个老的日志条目是否已经被提交（例如，该条目是否存储到所有服务器上），但是 Raft 为了简化问题使用一种更加保守的方法。</p>
<p>当领导人复制之前任期里的日志时，Raft 会为所有日志保留原始的任期号, 这在提交规则上产生了额外的复杂性。在其他的一致性算法中，如果一个新的领导人要重新复制之前的任期里的日志时，它必须使用当前新的任期号。Raft 使用的方法更加容易辨别出日志，因为它可以随着时间和日志的变化对日志维护着同一个任期编号。另外，和其他的算法相比，Raft 中的新领导人只需要发送更少日志条目（其他算法中必须在他们被提交之前发送更多的冗余日志条目来为他们重新编号）。</p>
<h4 id="5-4-3-安全性论证"><a href="#5-4-3-安全性论证" class="headerlink" title="5.4.3 安全性论证"></a>5.4.3 安全性论证</h4><p>在给定了完整的 Raft 算法之后，我们现在可以更加精确的讨论领导人完整性特性（这一讨论基于 9.2 节的安全性证明）。我们假设领导人完全性特性是不存在的，然后我们推出矛盾来。假设任期 T 的领导人（领导人 T）在任期内提交了一条日志条目，但是这条日志条目没有被存储到未来某个任期的领导人的日志中。设大于 T 的最小任期 U 的领导人 U 没有这条日志条目。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181074048.png"></p>
<blockquote>
<p>图 9：如果 S1 （任期 T 的领导人）在它的任期里提交了一条新的日志，然后 S5 在之后的任期 U 里被选举为领导人，那么至少会有一个机器，如 S3，既拥有来自 S1 的日志，也给 S5 投票了。</p>
</blockquote>
<ol>
<li>在领导人 U 选举的时候一定没有那条被提交的日志条目（领导人从不会删除或者覆盖任何条目）。</li>
<li>领导人 T 复制这条日志条目给集群中的大多数节点，同时，领导人 U 从集群中的大多数节点赢得了选票。因此，至少有一个节点（投票者、选民）同时接受了来自领导人 T 的日志条目，并且给领导人 U 投票了，如图 9。这个投票者是产生这个矛盾的关键。</li>
<li>这个投票者必须在给领导人 U 投票之前先接受了从领导人 T 发来的已经被提交的日志条目；否则他就会拒绝来自领导人 T 的附加日志请求（因为此时他的任期号会比 T 大）。</li>
<li>投票者在给领导人 U 投票时依然保存有这条日志条目，因为任何中间的领导人都包含该日志条目（根据上述的假设），领导人从不会删除条目，并且跟随者只有在和领导人冲突的时候才会删除条目。</li>
<li>投票者把自己选票投给领导人 U 时，领导人 U 的日志必须和投票者自己一样新。这就导致了两者矛盾之一。</li>
<li>首先，如果投票者和领导人 U 的最后一条日志的任期号相同，那么领导人 U 的日志至少和投票者一样长，所以领导人 U 的日志一定包含所有投票者的日志。这是另一处矛盾，因为投票者包含了那条已经被提交的日志条目，但是在上述的假设里，领导人 U 是不包含的。</li>
<li>除此之外，领导人 U 的最后一条日志的任期号就必须比投票人大了。此外，他也比 T 大，因为投票人的最后一条日志的任期号至少和 T 一样大（他包含了来自任期 T 的已提交的日志）。创建了领导人 U 最后一条日志的之前领导人一定已经包含了那条被提交的日志（根据上述假设，领导人 U 是第一个不包含该日志条目的领导人）。所以，根据日志匹配特性，领导人 U 一定也包含那条被提交的日志，这里产生矛盾。</li>
<li>这里完成了矛盾。因此，所有比 T 大的领导人一定包含了所有来自 T 的已经被提交的日志。</li>
<li>日志匹配原则保证了未来的领导人也同时会包含被间接提交的条目，例如图 8 (e) 中的索引 2。</li>
</ol>
<p>通过领导人完全特性，我们就能证明图 3 中的状态机安全特性，即如果服务器已经在某个给定的索引值应用了日志条目到自己的状态机里，那么其他的服务器不会应用一个不一样的日志到同一个索引值上。在一个服务器应用一条日志条目到他自己的状态机中时，他的日志必须和领导人的日志，在该条目和之前的条目上相同，并且已经被提交。现在我们来考虑在任何一个服务器应用一个指定索引位置的日志的最小任期；日志完全特性保证拥有更高任期号的领导人会存储相同的日志条目，所以之后的任期里应用某个索引位置的日志条目也会是相同的值。因此，状态机安全特性是成立的。</p>
<p>最后，Raft 要求服务器按照日志中索引位置顺序应用日志条目。和状态机安全特性结合起来看，这就意味着所有的服务器会应用相同的日志序列集到自己的状态机中，并且是按照相同的顺序。</p>
<h3 id="5-5-跟随者和候选人崩溃"><a href="#5-5-跟随者和候选人崩溃" class="headerlink" title="5.5 跟随者和候选人崩溃"></a>5.5 跟随者和候选人崩溃</h3><p>到目前为止，我们都只关注了领导人崩溃的情况。跟随者和候选人崩溃后的处理方式比领导人要简单的多，并且他们的处理方式是相同的。如果跟随者或者候选人崩溃了，那么后续发送给他们的 RPCs 都会失败。Raft 中处理这种失败就是简单的通过无限的重试；如果崩溃的机器重启了，那么这些 RPC 就会完整的成功。如果一个服务器在完成了一个 RPC，但是还没有响应的时候崩溃了，那么在他重新启动之后就会再次收到同样的请求。Raft 的 RPCs 都是幂等的，所以这样重试不会造成任何问题。例如一个跟随者如果收到附加日志请求但是他已经包含了这一日志，那么他就会直接忽略这个新的请求。</p>
<h3 id="5-6-时间和可用性"><a href="#5-6-时间和可用性" class="headerlink" title="5.6 时间和可用性"></a>5.6 时间和可用性</h3><p>Raft 的要求之一就是安全性不能依赖时间：整个系统不能因为某些事件运行的比预期快一点或者慢一点就产生了错误的结果。但是，可用性（系统可以及时的响应客户端）不可避免的要依赖于时间。例如，如果消息交换比服务器故障间隔时间长，候选人将没有足够长的时间来赢得选举；没有一个稳定的领导人，Raft 将无法工作。</p>
<p>领导人选举是 Raft 中对时间要求最为关键的方面。Raft 可以选举并维持一个稳定的领导人,只要系统满足下面的时间要求：</p>
<blockquote>
<p>广播时间（broadcastTime） &lt;&lt; 选举超时时间（electionTimeout） &lt;&lt; 平均故障间隔时间（MTBF）</p>
</blockquote>
<p>在这个不等式中，广播时间指的是从一个服务器并行的发送 RPCs 给集群中的其他服务器并接收响应的平均时间；选举超时时间就是在 5.2 节中介绍的选举的超时时间限制；然后平均故障间隔时间就是对于一台服务器而言，两次故障之间的平均时间。广播时间必须比选举超时时间小一个量级，这样领导人才能够发送稳定的心跳消息来阻止跟随者开始进入选举状态；通过随机化选举超时时间的方法，这个不等式也使得选票瓜分的情况变得不可能。选举超时时间应该要比平均故障间隔时间小上几个数量级，这样整个系统才能稳定的运行。当领导人崩溃后，整个系统会大约相当于选举超时的时间里不可用；我们希望这种情况在整个系统的运行中很少出现。</p>
<p>广播时间和平均故障间隔时间是由系统决定的，但是选举超时时间是我们自己选择的。Raft 的 RPCs 需要接收方将信息持久化的保存到稳定存储中去，所以广播时间大约是 0.5 毫秒到 20 毫秒，取决于存储的技术。因此，选举超时时间可能需要在 10 毫秒到 500 毫秒之间。大多数的服务器的平均故障间隔时间都在几个月甚至更长，很容易满足时间的需求。</p>
<h2 id="6-集群成员变化"><a href="#6-集群成员变化" class="headerlink" title="6 集群成员变化"></a>6 集群成员变化</h2><p>到目前为止，我们都假设集群的配置（加入到一致性算法的服务器集合）是固定不变的。但是在实践中，偶尔是会改变集群的配置的，例如替换那些宕机的机器或者改变复制级别。尽管可以通过暂停整个集群，更新所有配置，然后重启整个集群的方式来实现，但是在更改的时候集群会不可用。另外，如果存在手工操作步骤，那么就会有操作失误的风险。为了避免这样的问题，我们决定自动化配置改变并且将其纳入到 Raft 一致性算法中来。</p>
<p>为了让配置修改机制能够安全，那么在转换的过程中不能够存在任何时间点使得两个领导人在同一个任期里同时被选举成功。不幸的是，任何服务器直接从旧的配置直接转换到新的配置的方案都是不安全的。一次性原子地转换所有服务器是不可能的，所以在转换期间整个集群存在划分成两个独立的大多数群体的可能性（见图 10）。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181083032.png"></p>
<blockquote>
<p>图 10：直接从一种配置转到新的配置是十分不安全的，因为各个机器可能在任何的时候进行转换。在这个例子中，集群配额从 3 台机器变成了 5 台。不幸的是，存在这样的一个时间点，两个不同的领导人在同一个任期里都可以被选举成功。一个是通过旧的配置，一个通过新的配置。</p>
</blockquote>
<p>为了保证安全性，配置更改必须使用两阶段方法。目前有很多种两阶段的实现。例如，有些系统在第一阶段停掉旧的配置所以集群就不能处理客户端请求；然后在第二阶段在启用新的配置。在 Raft 中，集群先切换到一个过渡的配置，我们称之为共同一致（<em>joint consensus</em>)；一旦共同一致已经被提交了，那么系统就切换到新的配置上。共同一致是老配置和新配置的结合：</p>
<ul>
<li>日志条目被复制给集群中新、老配置的所有服务器。</li>
<li>新、旧配置的服务器都可以成为领导人。</li>
<li>达成一致（针对选举和提交）需要分别在两种配置上获得大多数的支持。</li>
</ul>
<p>共同一致允许独立的服务器在不影响安全性的前提下，在不同的时间进行配置转换过程。此外，共同一致可以让集群在配置转换的过程中依然响应客户端的请求。</p>
<p>集群配置在复制日志中以特殊的日志条目来存储和通信；图 11 展示了配置转换的过程。当一个领导人接收到一个改变配置从 C-old 到 C-new 的请求，他会为了共同一致存储配置（图中的 C-old,new），以前面描述的日志条目和副本的形式。一旦一个服务器将新的配置日志条目增加到它的日志中，他就会用这个配置来做出未来所有的决定（服务器总是使用最新的配置，无论他是否已经被提交）。这意味着领导人要使用 C-old,new 的规则来决定日志条目 C-old,new 什么时候需要被提交。如果领导人崩溃了，被选出来的新领导人可能是使用 C-old 配置也可能是 C-old,new 配置，这取决于赢得选举的候选人是否已经接收到了 C-old,new 配置。在任何情况下， C-new 配置在这一时期都不会单方面的做出决定。</p>
<p>一旦 C-old,new 被提交，那么无论是 C-old 还是 C-new，如果不经过另一个配置的允许都不能单独做出决定，并且领导人完全特性保证了只有拥有 C-old,new 日志条目的服务器才有可能被选举为领导人。这个时候，领导人创建一条关于 C-new 配置的日志条目并复制给集群就是安全的了。再者，每个服务器在见到新的配置的时候就会立即生效。当新的配置在 C-new 的规则下被提交，旧的配置就变得无关紧要，同时不使用新的配置的服务器就可以被关闭了。如图 11，C-old 和 C-new 没有任何机会同时做出单方面的决定；这保证了安全性。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181091496.png"></p>
<blockquote>
<p>图 11：一个配置切换的时间线。虚线表示已经被创建但是还没有被提交的配置日志条目，实线表示最后被提交的配置日志条目。领导人首先创建了 C-old,new 的配置条目在自己的日志中，并提交到 C-old,new 中（C-old 的大多数和 C-new 的大多数）。然后他创建 C-new 条目并提交到 C-new 中的大多数。这样就不存在 C-new 和 C-old 可以同时做出决定的时间点。</p>
</blockquote>
<p>在关于重新配置还有三个问题需要提出。第一个问题是，新的服务器可能初始化没有存储任何的日志条目。当这些服务器以这种状态加入到集群中，那么他们需要一段时间来更新追赶，这时还不能提交新的日志条目。为了避免这种可用性的间隔时间，Raft 在配置更新之前使用了一种额外的阶段，在这个阶段，新的服务器以没有投票权身份加入到集群中来（领导人复制日志给他们，但是不考虑他们是大多数）。一旦新的服务器追赶上了集群中的其他机器，重新配置可以像上面描述的一样处理。</p>
<p>第二个问题是，集群的领导人可能不是新配置的一员。在这种情况下，领导人就会在提交了 C-new 日志之后退位（回到跟随者状态）。这意味着有这样的一段时间，领导人管理着集群，但是不包括他自己；他复制日志但是不把他自己算作是大多数之一。当 C-new 被提交时，会发生领导人过渡，因为这时是最早新的配置可以独立工作的时间点（将总是能够在 C-new 配置下选出新的领导人）。在此之前，可能只能从 C-old 中选出领导人。</p>
<p>第三个问题是，移除不在 C-new 中的服务器可能会扰乱集群。这些服务器将不会再接收到心跳，所以当选举超时，他们就会进行新的选举过程。他们会发送拥有新的任期号的请求投票 RPCs，这样会导致当前的领导人回退成跟随者状态。新的领导人最终会被选出来，但是被移除的服务器将会再次超时，然后这个过程会再次重复，导致整体可用性大幅降低。</p>
<p>为了避免这个问题，当服务器确认当前领导人存在时，服务器会忽略请求投票 RPCs。特别的，当服务器在当前最小选举超时时间内收到一个请求投票 RPC，他不会更新当前的任期号或者投出选票。这不会影响正常的选举，每个服务器在开始一次选举之前，至少等待一个最小选举超时时间。然而，这有利于避免被移除的服务器扰乱：如果领导人能够发送心跳给集群，那么他就不会被更大的任期号废黜。</p>
<h2 id="7-日志压缩"><a href="#7-日志压缩" class="headerlink" title="7 日志压缩"></a>7 日志压缩</h2><p>Raft 的日志在正常操作中不断的增长，但是在实际的系统中，日志不能无限制的增长。随着日志不断增长，他会占用越来越多的空间，花费越来越多的时间来重置。如果没有一定的机制去清除日志里积累的陈旧的信息，那么会带来可用性问题。</p>
<p>快照是最简单的压缩方法。在快照系统中，整个系统的状态都以快照的形式写入到稳定的持久化存储中，然后到那个时间点之前的日志全部丢弃。快照技术被使用在 Chubby 和 ZooKeeper 中，接下来的章节会介绍 Raft 中的快照技术。</p>
<p>增量压缩的方法，例如日志清理或者日志结构合并树，都是可行的。这些方法每次只对一小部分数据进行操作，这样就分散了压缩的负载压力。首先，他们先选择一个已经积累的大量已经被删除或者被覆盖对象的区域，然后重写那个区域还活跃的对象，之后释放那个区域。和简单操作整个数据集合的快照相比，需要增加复杂的机制来实现。状态机可以实现 LSM tree 使用和快照相同的接口，但是日志清除方法就需要修改 Raft 了。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181100744.png"></p>
<blockquote>
<p>图 12：一个服务器用新的快照替换了从 1 到 5 的条目，快照值存储了当前的状态。快照中包含了最后的索引位置和任期号。</p>
</blockquote>
<p>图 12 展示了 Raft 中快照的基础思想。每个服务器独立的创建快照，只包括已经被提交的日志。主要的工作包括将状态机的状态写入到快照中。Raft 也包含一些少量的元数据到快照中：<strong>最后被包含索引</strong>指的是被快照取代的最后的条目在日志中的索引值（状态机最后应用的日志），<strong>最后被包含的任期</strong>指的是该条目的任期号。保留这些数据是为了支持快照后紧接着的第一个条目的附加日志请求时的一致性检查，因为这个条目需要前一日志条目的索引值和任期号。为了支持集群成员更新（第 6 节），快照中也将最后的一次配置作为最后一个条目存下来。一旦服务器完成一次快照，他就可以删除最后索引位置之前的所有日志和快照了。</p>
<p>尽管通常服务器都是独立的创建快照，但是领导人必须偶尔的发送快照给一些落后的跟随者。这通常发生在当领导人已经丢弃了下一条需要发送给跟随者的日志条目的时候。幸运的是这种情况不是常规操作：一个与领导人保持同步的跟随者通常都会有这个条目。然而一个运行非常缓慢的跟随者或者新加入集群的服务器（第 6 节）将不会有这个条目。这时让这个跟随者更新到最新的状态的方式就是通过网络把快照发送给他们。</p>
<p><strong>安装快照 RPC</strong>：</p>
<p>由领导人调用以将快照的分块发送给跟随者。领导人总是按顺序发送分块。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>领导人的任期号</td>
</tr>
<tr>
<td>leaderId</td>
<td>领导人的 ID，以便于跟随者重定向请求</td>
</tr>
<tr>
<td>lastIncludedIndex</td>
<td>快照中包含的最后日志条目的索引值</td>
</tr>
<tr>
<td>lastIncludedTerm</td>
<td>快照中包含的最后日志条目的任期号</td>
</tr>
<tr>
<td>offset</td>
<td>分块在快照中的字节偏移量</td>
</tr>
<tr>
<td>data[]</td>
<td>从偏移量开始的快照分块的原始字节</td>
</tr>
<tr>
<td>done</td>
<td>如果这是最后一个分块则为 true</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>结果</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>term</td>
<td>当前任期号（currentTerm），便于领导人更新自己</td>
</tr>
</tbody></table>
<p><strong>接收者实现</strong>：</p>
<ol>
<li>如果<code>term &lt; currentTerm</code>就立即回复</li>
<li>如果是第一个分块（offset 为 0）就创建一个新的快照</li>
<li>在指定偏移量写入数据</li>
<li>如果 done 是 false，则继续等待更多的数据</li>
<li>保存快照文件，丢弃具有较小索引的任何现有或部分快照</li>
<li>如果现存的日志条目与快照中最后包含的日志条目具有相同的索引值和任期号，则保留其后的日志条目并进行回复</li>
<li>丢弃整个日志</li>
<li>使用快照重置状态机（并加载快照的集群配置）</li>
</ol>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181110368.png"></p>
<blockquote>
<p>图 13：一个关于安装快照的简要概述。为了便于传输，快照都是被分成分块的；每个分块都给了跟随者生命的迹象，所以跟随者可以重置选举超时计时器。</p>
</blockquote>
<p>在这种情况下领导人使用一种叫做安装快照的新的 RPC 来发送快照给太落后的跟随者；见图 13。当跟随者通过这种 RPC 接收到快照时，他必须自己决定对于已经存在的日志该如何处理。通常快照会包含没有在接收者日志中存在的信息。在这种情况下，跟随者丢弃其整个日志；它全部被快照取代，并且可能包含与快照冲突的未提交条目。如果接收到的快照是自己日志的前面部分（由于网络重传或者错误），那么被快照包含的条目将会被全部删除，但是快照后面的条目仍然有效，必须保留。</p>
<p>这种快照的方式背离了 Raft 的强领导人原则，因为跟随者可以在不知道领导人情况下创建快照。但是我们认为这种背离是值得的。领导人的存在，是为了解决在达成一致性的时候的冲突，但是在创建快照的时候，一致性已经达成，这时不存在冲突了，所以没有领导人也是可以的。数据依然是从领导人传给跟随者，只是跟随者可以重新组织他们的数据了。</p>
<p>我们考虑过一种替代的基于领导人的快照方案，即只有领导人创建快照，然后发送给所有的跟随者。但是这样做有两个缺点。第一，发送快照会浪费网络带宽并且延缓了快照处理的时间。每个跟随者都已经拥有了所有产生快照需要的信息，而且很显然，自己从本地的状态中创建快照比通过网络接收别人发来的要经济。第二，领导人的实现会更加复杂。例如，领导人需要发送快照的同时并行的将新的日志条目发送给跟随者，这样才不会阻塞新的客户端请求。</p>
<p>还有两个问题影响了快照的性能。首先，服务器必须决定什么时候应该创建快照。如果快照创建的过于频繁，那么就会浪费大量的磁盘带宽和其他资源；如果创建快照频率太低，他就要承受耗尽存储容量的风险，同时也增加了从日志重建的时间。一个简单的策略就是当日志大小达到一个固定大小的时候就创建一次快照。如果这个阈值设置的显著大于期望的快照的大小，那么快照对磁盘压力的影响就会很小了。</p>
<p>第二个影响性能的问题就是写入快照需要花费显著的一段时间，并且我们还不希望影响到正常操作。解决方案是通过写时复制的技术，这样新的更新就可以被接收而不影响到快照。例如，具有函数式数据结构的状态机天然支持这样的功能。另外，操作系统的写时复制技术的支持（如 Linux 上的 fork）可以被用来创建完整的状态机的内存快照（我们的实现就是这样的）。</p>
<h2 id="8-客户端交互"><a href="#8-客户端交互" class="headerlink" title="8 客户端交互"></a>8 客户端交互</h2><p>这一节将介绍客户端是如何和 Raft 进行交互的，包括客户端如何发现领导人和 Raft 是如何支持线性化语义的。这些问题对于所有基于一致性的系统都存在，并且 Raft 的解决方案和其他的也差不多。</p>
<p>Raft 中的客户端发送所有请求给领导人。当客户端启动的时候，他会随机挑选一个服务器进行通信。如果客户端第一次挑选的服务器不是领导人，那么那个服务器会拒绝客户端的请求并且提供他最近接收到的领导人的信息（附加条目请求包含了领导人的网络地址）。如果领导人已经崩溃了，那么客户端的请求就会超时；客户端之后会再次重试随机挑选服务器的过程。</p>
<p>我们 Raft 的目标是要实现线性化语义（每一次操作立即执行，只执行一次，在他调用和收到回复之间）。但是，如上述，Raft 是可能执行同一条命令多次的：例如，如果领导人在提交了这条日志之后，但是在响应客户端之前崩溃了，那么客户端会和新的领导人重试这条指令，导致这条命令就被再次执行了。解决方案就是客户端对于每一条指令都赋予一个唯一的序列号。然后，状态机跟踪每条指令最新的序列号和相应的响应。如果接收到一条指令，它的序列号已经被执行了，那么就立即返回结果，而不重新执行指令。</p>
<p>只读的操作可以直接处理而不需要记录日志。但是，在不增加任何限制的情况下，这么做可能会冒着返回脏数据的风险，因为响应客户端请求的领导人可能在他不知道的时候已经被新的领导人取代了。线性化的读操作必须不能返回脏数据，Raft 需要使用两个额外的措施在不使用日志的情况下保证这一点。首先，领导人必须有关于被提交日志的最新信息。领导人完全特性保证了领导人一定拥有所有已经被提交的日志条目，但是在他任期开始的时候，他可能不知道哪些是已经被提交的。为了知道这些信息，他需要在他的任期里提交一条日志条目。Raft 中通过领导人在任期开始的时候提交一个空白的没有任何操作的日志条目到日志中去来实现。第二，领导人在处理只读的请求之前必须检查自己是否已经被废黜了（他自己的信息已经变脏了如果一个更新的领导人被选举出来）。Raft 中通过让领导人在响应只读请求之前，先和集群中的大多数节点交换一次心跳信息来处理这个问题。可选的，领导人可以依赖心跳机制来实现一种租约的机制，但是这种方法依赖时间来保证安全性（假设时间误差是有界的）。</p>
<h2 id="9-算法实现和评估"><a href="#9-算法实现和评估" class="headerlink" title="9 算法实现和评估"></a>9 算法实现和评估</h2><p>我们已经为 RAMCloud 实现了 Raft 算法作为存储配置信息的复制状态机的一部分，并且帮助 RAMCloud 协调故障转移。这个 Raft 实现包含大约 2000 行 C++ 代码，其中不包括测试、注释和空行。这些代码是开源的。同时也有大约 25 个其他独立的第三方的基于这篇论文草稿的开源实现，针对不同的开发场景。同时，很多公司已经部署了基于 Raft 的系统。</p>
<p>这一节会从三个方面来评估 Raft 算法：可理解性、正确性和性能。</p>
<h3 id="9-1-可理解性"><a href="#9-1-可理解性" class="headerlink" title="9.1 可理解性"></a>9.1 可理解性</h3><p>为了和 Paxos 比较 Raft 算法的可理解能力，我们针对高层次的本科生和研究生，在斯坦福大学的高级操作系统课程和加州大学伯克利分校的分布式计算课程上，进行了一次学习的实验。我们分别拍了针对 Raft 和 Paxos 的视频课程，并准备了相应的小测验。Raft 的视频讲课覆盖了这篇论文的所有内容除了日志压缩；Paxos 讲课包含了足够的资料来创建一个等价的复制状态机，包括单决策 Paxos，多决策 Paxos，重新配置和一些实际系统需要的性能优化（例如领导人选举）。小测验测试一些对算法的基本理解和解释一些边角的示例。每个学生都是看完第一个视频，回答相应的测试，再看第二个视频，回答相应的测试。大约有一半的学生先进行 Paxos 部分，然后另一半先进行 Raft 部分，这是为了说明两者从第一部分的算法学习中获得的表现和经验的差异。我们计算参加人员的每一个小测验的得分来看参与者是否在 Raft 算法上更加容易理解。</p>
<p>我们尽可能的使得 Paxos 和 Raft 的比较更加公平。这个实验偏爱 Paxos 表现在两个方面：43 个参加者中有 15 个人在之前有一些 Paxos 的经验，并且 Paxos 的视频要长 14%。如表格 1 总结的那样，我们采取了一些措施来减轻这种潜在的偏见。我们所有的材料都可供审查。</p>
<table>
<thead>
<tr>
<th>关心</th>
<th>缓和偏见采取的手段</th>
<th>可供查看的材料</th>
</tr>
</thead>
<tbody><tr>
<td>相同的讲课质量</td>
<td>两者使用同一个讲师。Paxos 使用的是现在很多大学里经常使用的。Paxos 会长 14%。</td>
<td>视频</td>
</tr>
<tr>
<td>相同的测验难度</td>
<td>问题以难度分组，在两个测验里成对出现。</td>
<td>小测验</td>
</tr>
<tr>
<td>公平评分</td>
<td>使用评价量规。随机顺序打分，两个测验交替进行。</td>
<td>评价量规（rubric）</td>
</tr>
</tbody></table>
<blockquote>
<p>表 1：考虑到可能会存在的偏见，对于每种情况的解决方法，和相应的材料。</p>
</blockquote>
<p>参加者平均在 Raft 的测验中比 Paxos 高 4.9 分（总分 60，那么 Raft 的平均得分是 25.7，而 Paxos 是 20.8）；图 14 展示了每个参与者的得分。配置 t-检验（又称 student‘s t-test）表明，在 95% 的可信度下，真实的 Raft 分数分布至少比 Paxos 高 2.5 分。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181121545.png"></p>
<blockquote>
<p>图 14：一个散点图表示了 43 个学生在 Paxos 和 Raft 的小测验中的成绩。在对角线之上的点表示在 Raft 获得了更高分数的学生。</p>
</blockquote>
<p>我们也建立了一个线性回归模型来预测一个新的学生的测验成绩，基于以下三个因素：他们使用的是哪个小测验，之前对 Paxos 的经验，和学习算法的顺序。模型预测，对小测验的选择会产生 12.5 分的差别。这显著的高于之前的 4.9 分，因为很多学生在之前都已经有了对于 Paxos 的经验，这相当明显的帮助 Paxos，对 Raft 就没什么太大影响了。但是奇怪的是，模型预测对于先进行 Paxos 小测验的人而言，Raft 的得分低了 6.3 分; 虽然我们不知道为什么，这似乎在统计上是有意义的。</p>
<p>我们同时也在测验之后调查了参与者，他们认为哪个算法更加容易实现和解释；这个的结果在图 15 上。压倒性的结果表明 Raft 算法更加容易实现和解释（41 人中的 33 个）。但是，这种自己报告的结果不如参与者的成绩更加可信，并且参与者可能因为我们的 Raft 更加易于理解的假说而产生偏见。</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181130280.png"></p>
<blockquote>
<p>图 15：通过一个 5 分制的问题，参与者（左边）被问哪个算法他们觉得在一个高效正确的系统里更容易实现，右边被问哪个更容易向学生解释。</p>
</blockquote>
<p>关于 Raft 用户学习有一个更加详细的讨论。</p>
<h3 id="9-2-正确性"><a href="#9-2-正确性" class="headerlink" title="9.2 正确性"></a>9.2 正确性</h3><p>在第 5 节，我们已经制定了正式的规范，和对一致性机制的安全性证明。这个正式规范使用 TLA+ 规范语言使图 2 中总结的信息非常清晰。它长约 400 行，并作为证明的主题。同时对于任何想实现 Raft 的人也是十分有用的。我们通过 TLA 证明系统非常机械的证明了日志完全特性。然而，这个证明依赖的约束前提还没有被机械证明（例如，我们还没有证明规范的类型安全）。而且，我们已经写了一个非正式的证明关于状态机安全性是完备的，并且是相当清晰的（大约 3500 个词）。</p>
<h3 id="9-3-性能"><a href="#9-3-性能" class="headerlink" title="9.3 性能"></a>9.3 性能</h3><p>Raft 和其他一致性算法例如 Paxos 有着差不多的性能。在性能方面，最重要的关注点是，当领导人被选举成功时，什么时候复制新的日志条目。Raft 通过很少数量的消息包（一轮从领导人到集群大多数机器的消息）就达成了这个目的。同时，进一步提升 Raft 的性能也是可行的。例如，很容易通过支持批量操作和管道操作来提高吞吐量和降低延迟。对于其他一致性算法已经提出过很多性能优化方案；其中有很多也可以应用到 Raft 中来，但是我们暂时把这个问题放到未来的工作中去。</p>
<p>我们使用我们自己的 Raft 实现来衡量 Raft 领导人选举的性能并且回答两个问题。首先，领导人选举的过程收敛是否快速？第二，在领导人宕机之后，最小的系统宕机时间是多久？</p>
<p><img data-src="//img.to2b.cn/blog/lujinkai/1657181142609.png"></p>
<blockquote>
<p>图 16：发现并替换一个已经崩溃的领导人的时间。上面的图考察了在选举超时时间上的随机化程度，下面的图考察了最小选举超时时间。每条线代表了 1000 次实验（除了 150-150 毫秒只试了 100 次），和相应的确定的选举超时时间。例如，150-155 毫秒意思是，选举超时时间从这个区间范围内随机选择并确定下来。这个实验在一个拥有 5 个节点的集群上进行，其广播时延大约是 15 毫秒。对于 9 个节点的集群，结果也差不多。</p>
</blockquote>
<p>为了衡量领导人选举，我们反复的使一个拥有五个节点的服务器集群的领导人宕机，并计算需要多久才能发现领导人已经宕机并选出一个新的领导人（见图 16）。为了构建一个最坏的场景，在每一的尝试里，服务器都有不同长度的日志，意味着有些候选人是没有成为领导人的资格的。另外，为了促成选票瓜分的情况，我们的测试脚本在终止领导人之前同步的发送了一次心跳广播（这大约和领导人在崩溃前复制一个新的日志给其他机器很像）。领导人均匀的随机的在心跳间隔里宕机，也就是最小选举超时时间的一半。因此，最小宕机时间大约就是最小选举超时时间的一半。</p>
<p>图 16 中上面的图表明，只需要在选举超时时间上使用很少的随机化就可以大大避免选票被瓜分的情况。在没有随机化的情况下，在我们的测试里，选举过程往往都需要花费超过 10 秒钟由于太多的选票瓜分的情况。仅仅增加 5 毫秒的随机化时间，就大大的改善了选举过程，现在平均的宕机时间只有 287 毫秒。增加更多的随机化时间可以大大改善最坏情况：通过增加 50 毫秒的随机化时间，最坏的完成情况（1000 次尝试）只要 513 毫秒。</p>
<p>图 16 中下面的图显示，通过减少选举超时时间可以减少系统的宕机时间。在选举超时时间为 12-24 毫秒的情况下，只需要平均 35 毫秒就可以选举出新的领导人（最长的一次花费了 152 毫秒）。然而，进一步降低选举超时时间的话就会违反 Raft 的时间不等式需求：在选举新领导人之前，领导人就很难发送完心跳包。这会导致没有意义的领导人改变并降低了系统整体的可用性。我们建议使用更为保守的选举超时时间，比如 150-300 毫秒；这样的时间不大可能导致没有意义的领导人改变，而且依然提供不错的可用性。</p>
<h2 id="10-相关工作"><a href="#10-相关工作" class="headerlink" title="10 相关工作"></a>10 相关工作</h2><p>已经有很多关于一致性算法的工作被发表出来，其中很多都可以归到下面的类别中：</p>
<ul>
<li>Lamport 关于 Paxos 的原始描述，和尝试描述的更清晰。</li>
<li>关于 Paxos 的更详尽的描述，补充遗漏的细节并修改算法，使得可以提供更加容易的实现基础。</li>
<li>实现一致性算法的系统，例如 Chubby，ZooKeeper 和 Spanner。对于 Chubby 和 Spanner 的算法并没有公开发表其技术细节，尽管他们都声称是基于 Paxos 的。ZooKeeper 的算法细节已经发表，但是和 Paxos 着实有着很大的差别。</li>
<li>Paxos 可以应用的性能优化。</li>
<li>Oki 和 Liskov 的 Viewstamped Replication（VR），一种和 Paxos 差不多的替代算法。原始的算法描述和分布式传输协议耦合在了一起，但是核心的一致性算法在最近的更新里被分离了出来。VR 使用了一种基于领导人的方法，和 Raft 有很多相似之处。</li>
</ul>
<p>Raft 和 Paxos 最大的不同之处就在于 Raft 的强领导特性：Raft 使用领导人选举作为一致性协议里必不可少的部分，并且将尽可能多的功能集中到了领导人身上。这样就可以使得算法更加容易理解。例如，在 Paxos 中，领导人选举和基本的一致性协议是正交的：领导人选举仅仅是性能优化的手段，而且不是一致性所必须要求的。但是，这样就增加了多余的机制：Paxos 同时包含了针对基本一致性要求的两阶段提交协议和针对领导人选举的独立的机制。相比较而言，Raft 就直接将领导人选举纳入到一致性算法中，并作为两阶段一致性的第一步。这样就减少了很多机制。</p>
<p>像 Raft 一样，VR 和 ZooKeeper 也是基于领导人的，因此他们也拥有一些 Raft 的优点。但是，Raft 比 VR 和 ZooKeeper 拥有更少的机制因为 Raft 尽可能的减少了非领导人的功能。例如，Raft 中日志条目都遵循着从领导人发送给其他人这一个方向：附加条目 RPC 是向外发送的。在 VR 中，日志条目的流动是双向的（领导人可以在选举过程中接收日志）；这就导致了额外的机制和复杂性。根据 ZooKeeper 公开的资料看，它的日志条目也是双向传输的，但是它的实现更像 Raft。</p>
<p>和上述我们提及的其他基于一致性的日志复制算法中，Raft 的消息类型更少。例如，我们数了一下 VR 和 ZooKeeper 使用的用来基本一致性需要和成员改变的消息数（排除了日志压缩和客户端交互，因为这些都比较独立且和算法关系不大）。VR 和 ZooKeeper 都分别定义了 10 种不同的消息类型，相对的，Raft 只有 4 种消息类型（两种 RPC 请求和对应的响应）。Raft 的消息都稍微比其他算法的要信息量大，但是都很简单。另外，VR 和 ZooKeeper 都在领导人改变时传输了整个日志；所以为了能够实践中使用，额外的消息类型就很必要了。</p>
<p>Raft 的强领导人模型简化了整个算法，但是同时也排斥了一些性能优化的方法。例如，平等主义 Paxos （EPaxos）在某些没有领导人的情况下可以达到很高的性能。平等主义 Paxos 充分发挥了在状态机指令中的交换性。任何服务器都可以在一轮通信下就提交指令，除非其他指令同时被提出了。然而，如果指令都是并发的被提出，并且互相之间不通信沟通，那么 EPaxos 就需要额外的一轮通信。因为任何服务器都可以提交指令，所以 EPaxos 在服务器之间的负载均衡做的很好，并且很容易在 WAN 网络环境下获得很低的延迟。但是，他在 Paxos 上增加了非常明显的复杂性。</p>
<p>一些集群成员变换的方法已经被提出或者在其他的工作中被实现，包括 Lamport 的原始的讨论，VR 和 SMART。我们选择使用共同一致的方法因为他对一致性协议的其他部分影响很小，这样我们只需要很少的一些机制就可以实现成员变换。Lamport 的基于 α 的方法之所以没有被 Raft 选择是因为它假设在没有领导人的情况下也可以达到一致性。和 VR 和 SMART 相比较，Raft 的重新配置算法可以在不限制正常请求处理的情况下进行；相比较的，VR 需要停止所有的处理过程，SMART 引入了一个和 α 类似的方法，限制了请求处理的数量。Raft 的方法同时也需要更少的额外机制来实现，和 VR、SMART 比较而言。</p>
<h2 id="11-结论"><a href="#11-结论" class="headerlink" title="11 结论"></a>11 结论</h2><p>算法的设计通常会把正确性，效率或者简洁作为主要的目标。尽管这些都是很有意义的目标，但是我们相信，可理解性也是一样的重要。在开发者把算法应用到实际的系统中之前，这些目标没有一个会被实现，这些都会必然的偏离发表时的形式。除非开发人员对这个算法有着很深的理解并且有着直观的感觉，否则将会对他们而言很难在实现的时候保持原有期望的特性。</p>
<p>在这篇论文中，我们尝试解决分布式一致性问题，但是一个广为接受但是十分令人费解的算法 Paxos 已经困扰了无数学生和开发者很多年了。我们创造了一种新的算法 Raft，显而易见的比 Paxos 要容易理解。我们同时也相信，Raft 也可以为实际的实现提供坚实的基础。把可理解性作为设计的目标改变了我们设计 Raft 的方式；随着设计的进展，我们发现自己重复使用了一些技术，比如分解问题和简化状态空间。这些技术不仅提升了 Raft 的可理解性，同时也使我们坚信其正确性。</p>
<h2 id="12-感谢"><a href="#12-感谢" class="headerlink" title="12 感谢"></a>12 感谢</h2><p>这项研究必须感谢以下人员的支持：Ali Ghodsi，David Mazie`res，和伯克利 CS 294-91 课程、斯坦福 CS 240 课程的学生。Scott Klemmer 帮我们设计了用户调查，Nelson Ray 建议我们进行统计学的分析。在用户调查时使用的关于 Paxos 的幻灯片很大一部分是从 Lorenzo Alvisi 的幻灯片上借鉴过来的。特别的，非常感谢 DavidMazieres 和 Ezra Hoch，他们找到了 Raft 中一些难以发现的漏洞。许多人提供了关于这篇论文十分有用的反馈和用户调查材料，包括 Ed Bugnion，Michael Chan，Hugues Evrard，Daniel Giffin，Arjun Gopalan，Jon Howell，Vimalkumar Jeyakumar，Ankita Kejriwal，Aleksandar Kracun，Amit Levy，Joel Martin，Satoshi Matsushita，Oleg Pesok，David Ramos，Robbert van Renesse，Mendel Rosenblum，Nicolas Schiper，Deian Stefan，Andrew Stone，Ryan Stutsman，David Terei，Stephen Yang，Matei Zaharia 以及 24 位匿名的会议审查人员（可能有重复），并且特别感谢我们的领导人 Eddie Kohler。Werner Vogels 发了一条早期草稿链接的推特，给 Raft 带来了极大的关注。我们的工作由 Gigascale 系统研究中心和 Multiscale 系统研究中心给予支持，这两个研究中心由关注中心研究程序资金支持，一个是半导体研究公司的程序，由 STARnet 支持，一个半导体研究公司的程序由 MARCO 和 DARPA 支持，在国家科学基金会的 0963859 号批准，并且获得了来自 Facebook，Google，Mellanox，NEC，NetApp，SAP 和 Samsung 的支持。Diego Ongaro 由 Junglee 公司，斯坦福的毕业团体支持。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>略</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8CKVM/%E5%AE%89%E8%A3%85windows/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8CKVM/%E5%AE%89%E8%A3%85windows/" class="post-title-link" itemprop="url">安装windows</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-24 14:08:37" itemprop="dateCreated datePublished" datetime="2022-09-24T14:08:37+08:00">2022-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%92%8CKVM/" itemprop="url" rel="index"><span itemprop="name">虚拟化和KVM</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>virtio-win：</p>
<p><a target="_blank" rel="noopener" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/</a></p>
<p><a target="_blank" rel="noopener" href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.189-1/virtio-win-0.1.189_amd64.vfd">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.189-1/virtio-win-0.1.189_amd64.vfd</a></p>
<p>示例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">qemu-img create <span class="token parameter variable">-f</span> qcow2 /var/lib/libvirt/images/windows_10_enterprise_ltsc_2019_x64.qcow2 100G

virt-install <span class="token punctuation">\</span>
--virt-type kvm <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> windows_10_enterprise_ltsc_2019_x64 <span class="token punctuation">\</span>
<span class="token parameter variable">--memory</span> <span class="token number">4096</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--vcpus</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
--os-variant<span class="token operator">=</span>win10 <span class="token punctuation">\</span>
<span class="token parameter variable">--cdrom</span><span class="token operator">=</span>/data/isos/cn_windows_10_enterprise_ltsc_2019_x64_dvd_9c09ff24.iso <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/var/lib/libvirt/images/windows_10_enterprise_ltsc_2019_x64.qcow2,format<span class="token operator">=</span>qcow2,bus<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/data/isos/virtio-win-0.1.189_amd64.vfd,device<span class="token operator">=</span>floppy <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token assign-left variable">bridge</span><span class="token operator">=</span>virbr0,model<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--graphics</span> vnc,listen<span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token punctuation">\</span>
<span class="token parameter variable">--noautoconsole</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--autostart</span></code></pre>



<pre class="language-bash" data-language="bash"><code class="language-bash">qemu-img create <span class="token parameter variable">-f</span> qcow2 /var/lib/libvirt/images/win7_sp1_x64.qcow2 100G


virt-install <span class="token punctuation">\</span>
--virt-type kvm <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> win7_sp1_x64 <span class="token punctuation">\</span>
<span class="token parameter variable">--memory</span> <span class="token number">4096</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--vcpus</span><span class="token operator">=</span><span class="token number">2</span> <span class="token punctuation">\</span>
--os-variant<span class="token operator">=</span>win7 <span class="token punctuation">\</span>
<span class="token parameter variable">--cdrom</span><span class="token operator">=</span>/data/isos/win7_sp1_7601.25685_x64.iso <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/var/lib/libvirt/images/win7_sp1_x64.qcow2,format<span class="token operator">=</span>qcow2,bus<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>/data/isos/virtio-win-0.1.141_amd64.vfd,device<span class="token operator">=</span>floppy <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token assign-left variable">bridge</span><span class="token operator">=</span>virbr0,model<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--graphics</span> vnc,listen<span class="token operator">=</span><span class="token number">0.0</span>.0.0 <span class="token punctuation">\</span>
<span class="token parameter variable">--noautoconsole</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--autostart</span></code></pre>



<pre class="language-none"><code class="language-none">virt-install --name win7 --os-variant&#x3D;win7 --ram 512 --vcpus&#x3D;1 --disk path&#x3D;&#x2F;opt&#x2F;win7.img,size&#x3D;30,format&#x3D;qcow2,bus&#x3D;ide --accelerate --disk device&#x3D;cdrom,path&#x3D;&#x2F;opt&#x2F;cn_windows_7_ultimate_with_sp1_x64_dvd_618537\(1\).iso --disk device&#x3D;cdrom,path&#x3D;&#x2F;opt&#x2F;virtio-win-0.1.102.iso --vnc --vncport&#x3D;5922 --vnclisten&#x3D;0.0.0.0 --network bridge&#x3D;br0,model&#x3D;virtio --noautoconsole</code></pre>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/C/gdb%E8%B0%83%E8%AF%95php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/C/gdb%E8%B0%83%E8%AF%95php/" class="post-title-link" itemprop="url">gdb的基本使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-28 10:55:57" itemprop="dateCreated datePublished" datetime="2022-06-28T10:55:57+08:00">2022-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>调试 php 的时候,可以在 ZEND_ECHO_SPEC_CV_HANDLER 打断点, 这样 echo 变量的时候, 会断点调试;</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> b ZEND_ECHO_SPEC_CV_HANDLER</code></pre>

<p>打印数组</p>
<p>int _array &#x3D; (int _) malloc (len * sizeof (int));<br>p *array@len @左边是数组地址，右边是数组长度</p>
<p>在提示符下直接敲回车表示重复上一条命令。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E5%89%8D%E7%AB%AF/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%89%8D%E7%AB%AF/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">性能优化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-23 15:46:51" itemprop="dateCreated datePublished" datetime="2022-02-23T15:46:51+08:00">2022-02-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:22" itemprop="dateModified" datetime="2023-05-29T16:58:22+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li><p>静态资源尽量使用cdn，且使用单独域名</p>
</li>
<li><p>做好loading</p>
</li>
<li><p>小图片使用 精灵图&#x2F;雪碧图，如果使用HTTP2.0，则此项无需优化</p>
</li>
<li><p>图片懒加载</p>
</li>
<li><p>代码切割，懒加载</p>
</li>
<li><p>防抖和节流</p>
<p>持续触发事件，例如 缩放、滚动、鼠标移动，键盘输入，多次快速点击等，如果每次都触发执行函数，则会有性能下降、频繁请求等问题。这种情况就适合使用防抖和节流。</p>
<ul>
<li>防抖：触发事件后 n 秒后才执行函数，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</li>
<li>节流：连续触发事件但是在 n 秒中只执行一次函数。稀释函数的执行频率。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/PHP/EasySwoole/%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E5%92%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/PHP/EasySwoole/%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E5%92%8C%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">局部变量和全局变量</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:48:29" itemprop="dateCreated datePublished" datetime="2022-01-25T23:48:29+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/PHP/EasySwoole/" itemprop="url" rel="index"><span itemprop="name">EasySwoole</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><p>在事件回调函数返回后，所有局部对象和变量会全部回收，不需要 <code>unset</code> 。如果变量是一个资源类型，那么对应的资源也会被 <code>PHP</code> 底层释放。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword type-declaration">Object</span><span class="token punctuation">;</span>
    <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/data/t.log'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'r+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">swoole_client</span><span class="token punctuation">(</span><span class="token constant">SWOOLE_SYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">swoole_client</span><span class="token punctuation">(</span><span class="token constant">SWOOLE_SYNC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">global</span> <span class="token variable">$e</span><span class="token punctuation">;</span>
    <span class="token variable">$e</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'client'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$d</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>$a, $b, $c</code> 都是局部变量，当此函数 <code>return</code> 时，这 3 个变量会立即释放，对应的内存会立即释放，打开的 <code>IO</code> 资源文件句柄会立即关闭。 <code>$d</code> 也是局部变量，但是 <code>return</code> 前将它保存到了全局变量 <code>$e</code>，所以不会释放。当执行 <code>unset($e[&#39;client&#39;])</code> 时，并且没有任何其他 <code>PHP</code> 变量仍然在引用 <code>$d</code> 变量，那么 <code>$d</code> 就会被释放。</p>
<h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><p>在 <code>PHP</code> 中，有 3 类全局变量。</p>
<ul>
<li>使用 <code>global</code> 关键词声明的变量</li>
<li>使用 <code>static</code> 关键词声明的类静态变量、函数静态变量</li>
<li><code>PHP</code> 的超全局变量，包括 <code>$_GET、$_POST、$GLOBALS</code> 等</li>
</ul>
<p>全局变量和对象，类静态变量，保存在 <code>swoole_server</code> 对象上的变量不会被释放。需要程序员自行处理这些变量和对象的销毁工作。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Test</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function-definition function">onReceive</span><span class="token punctuation">(</span><span class="token variable">$serv</span><span class="token punctuation">,</span> <span class="token variable">$fd</span><span class="token punctuation">,</span> <span class="token variable">$reactorId</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token class-name static-context">Test</span><span class="token operator">::</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fd</span><span class="token punctuation">;</span>
    <span class="token class-name static-context">Test</span><span class="token operator">::</span><span class="token variable">$string</span> <span class="token operator">.=</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<ul>
<li>在事件回调函数中需要特别注意非局部变量的 <code>array</code> 类型值，某些操作如 <code>TestClass::$array[] = &quot;string&quot;</code> 可能会造成内存泄漏，严重时可能发生爆内存，必要时应当注意清理大数组。</li>
<li>在事件回调函数中，非局部变量的字符串进行拼接操作是必须小心内存泄漏，如 <code>TestClass::$string .= $data</code>，可能会有内存泄漏，严重时可能发生爆内存。</li>
</ul>
<p>解决方法</p>
<ul>
<li>同步阻塞并且请求响应式无状态的 <code>Server</code> 程序可以设置 <code>max_request</code>，当 <code>Worker进程/Task进程</code> 结束运行时或达到任务上限后进程自动退出。该进程的所有变量&#x2F;对象&#x2F;资源均会被释放回收。</li>
<li>程序内在 <code>onClose</code> 或设置定时器及时使用 <code>unset</code> 清理变量，回收资源</li>
</ul>
<blockquote>
<p>内存管理部分参照了 <code>Swoole</code> 官方文档。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/umount%E6%97%A0%E6%B3%95%E8%A7%A3%E9%99%A4%E6%8C%82%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/umount%E6%97%A0%E6%B3%95%E8%A7%A3%E9%99%A4%E6%8C%82%E8%BD%BD/" class="post-title-link" itemprop="url">umount无法解除挂载</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:47:16" itemprop="dateCreated datePublished" datetime="2022-01-25T23:47:16+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">磁盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>问题：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@zabbix /<span class="token punctuation">]</span><span class="token comment"># umount /dev/sdc1</span>
umount: /data1: target is busy.
        <span class="token punctuation">(</span>In some cases useful info about processes that use
         the device is found by lsof<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> or fuser<span class="token punctuation">(</span><span class="token number">1</span></code></pre>

<p>解决：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@zabbix /<span class="token punctuation">]</span><span class="token comment"># fuser -m /dev/sdc1</span>
/dev/sdc1:           10246c
<span class="token punctuation">[</span>root@zabbix /<span class="token punctuation">]</span><span class="token comment"># kill -9 10246</span>

<span class="token comment"># 再umount就成功了</span>
<span class="token punctuation">[</span>root@zabbix /<span class="token punctuation">]</span><span class="token comment"># umount /dev/sdc1</span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/pvcreate%E6%97%A0%E6%B3%95%E5%88%9B%E5%BB%BA%E7%89%A9%E7%90%86%E5%8D%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/pvcreate%E6%97%A0%E6%B3%95%E5%88%9B%E5%BB%BA%E7%89%A9%E7%90%86%E5%8D%B7/" class="post-title-link" itemprop="url">pvcreate无法创建物理卷</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:47:04" itemprop="dateCreated datePublished" datetime="2022-01-25T23:47:04+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">磁盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>问题：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@484288 ~<span class="token punctuation">]</span><span class="token comment"># pvcreate /dev/sdc</span>
  Device /dev/sdc excluded by a filter.</code></pre>

<p>解决方法：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">wipefs <span class="token parameter variable">-a</span> /dev/sdc</code></pre>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://serverfault.com/questions/917650/vgextend-device-excluded-by-a-filter">https://serverfault.com/questions/917650/vgextend-device-excluded-by-a-filter</a></p>
<p><a target="_blank" rel="noopener" href="http://it.ckcest.cn/article-3986563-1.html">http://it.ckcest.cn/article-3986563-1.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/mount%E6%97%A0%E6%B3%95%E6%8C%82%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/mount%E6%97%A0%E6%B3%95%E6%8C%82%E8%BD%BD/" class="post-title-link" itemprop="url">mount无法挂载</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:46:44" itemprop="dateCreated datePublished" datetime="2022-01-25T23:46:44+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E7%A3%81%E7%9B%98/" itemprop="url" rel="index"><span itemprop="name">磁盘</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>如果目标目录在&#x2F;etc&#x2F;fstab 中，则将其注释，并执行：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">systemctl daemon-reload</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/ffmpeg-go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/ffmpeg-go/" class="post-title-link" itemprop="url">ffmpeg-go</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:19:59" itemprop="dateCreated datePublished" datetime="2022-01-25T23:19:59+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">第三方库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <pre class="language-none"><code class="language-none">func AssertType(hasType, expectType string, action string)
func ConvertKwargsToCmdLineArgs(kwargs KwArgs) []string
func DebugNodes(node []DagNode)
func DebugOutGoingMap(node []DagNode, m map[int]map[Label][]NodeInfo)
func Probe(fileName string, kwargs ...KwArgs) (string, error)
func ProbeWithTimeout(fileName string, timeOut time.Duration, kwargs KwArgs) (string, error)
func ProbeWithTimeoutExec(fileName string, timeOut time.Duration, kwargs KwArgs) (string, error)
type Args
    func (a Args) EscapeWith(chars string) Args
    func (a Args) Sorted() Args
type DagEdge
    func GetInComingEdges(downStreamNode DagNode, inComingEdgeMap map[Label]NodeInfo) []DagEdge
    func GetOutGoingEdges(upStreamNode DagNode, outOutingEdgeMap map[Label][]NodeInfo) []DagEdge
type DagNode
    func TopSort(downStreamNodes []DagNode) (sortedNodes []DagNode, outOutingEdgeMaps map[int]map[Label][]NodeInfo, ...)
type Graph
type GraphNode
type GraphOptions
type KwArgs
	func MergeKwArgs(args []KwArgs) KwArgs
    func (a KwArgs) Copy() KwArgs
    func (a KwArgs) EscapeWith(chars string) KwArgs
    func (a KwArgs) GetDefault(k string, defaultV interface&#123;&#125;) interface&#123;&#125;
    func (a KwArgs) GetString(k string) string
    func (a KwArgs) HasKey(k string) bool
    func (a KwArgs) PopDefault(k string, defaultV interface&#123;&#125;) interface&#123;&#125;
    func (a KwArgs) PopString(k string) string
    func (a KwArgs) SortedKeys() []string
type Label
type Node
    func FilterMultiOutput(streamSpec []*Stream, filterName string, args Args, kwArgs ...KwArgs) *Node
    func NewFilterNode(name string, streamSpec []*Stream, maxInput int, args []string, kwargs KwArgs) *Node
    func NewGlobalNode(name string, streamSpec []*Stream, args []string, kwargs KwArgs) *Node
    func NewInputNode(name string, args []string, kwargs KwArgs) *Node
    func NewMergeOutputsNode(name string, streamSpec []*Stream) *Node
    func NewNode(streamSpec []*Stream, name string, incomingStreamTypes sets.String, ...) *Node
    func NewOutputNode(name string, streamSpec []*Stream, args []string, kwargs KwArgs) *Node
    func (n *Node) Equal(other DagNode) bool
    func (n *Node) Get(a string) *Stream
    func (n *Node) GetFilter(outgoingEdges []DagEdge) string
    func (n *Node) GetInComingEdges() []DagEdge
    func (n *Node) Hash() int
    func (n *Node) IncomingEdgeMap() map[Label]NodeInfo
    func (n *Node) ShortRepr() string
    func (n *Node) Stream(label Label, selector Selector) *Stream
    func (n *Node) String() string
type NodeInfo
type RunHook
type Selector
type Stream
	func Concat(streams []*Stream, kwargs ...KwArgs) *Stream
    func Filter(streamSpec []*Stream, filterName string, args Args, kwArgs ...KwArgs) *Stream
    func Input(filename string, kwargs ...KwArgs) *Stream
    func MergeOutputs(streams ...*Stream) *Stream
    func NewStream(node *Node, streamType string, label Label, selector Selector) *Stream
    func Output(streams []*Stream, fileName string, kwargs ...KwArgs) *Stream
    func (s *Stream) ASplit() *Node
    func (s *Stream) Audio() *Stream
    func (s *Stream) ColorChannelMixer(kwargs ...KwArgs) *Stream
    func (s *Stream) Compile() *exec.Cmd
    func (s *Stream) Concat(streams []*Stream, kwargs ...KwArgs) *Stream
    func (s *Stream) Crop(x, y, w, h int, kwargs ...KwArgs) *Stream
    func (s *Stream) DrawBox(x, y, w, h int, color string, thickness int, kwargs ...KwArgs) *Stream
    func (s *Stream) Drawtext(text string, x, y int, escape bool, kwargs ...KwArgs) *Stream
    func (s *Stream) Equal(other Stream) bool
    func (s *Stream) ErrorToStdOut() *Stream
    func (s *Stream) Filter(filterName string, args Args, kwArgs ...KwArgs) *Stream
    func (s *Stream) Get(index string) *Stream
    func (s *Stream) GetArgs() []string
    func (s *Stream) GlobalArgs(args ...string) *Stream
    func (s *Stream) HFlip(kwargs ...KwArgs) *Stream
    func (s *Stream) Hash() int
    func (s *Stream) Hue(kwargs ...KwArgs) *Stream
    func (s *Stream) Output(fileName string, kwargs ...KwArgs) *Stream
    func (s *Stream) OverWriteOutput() *Stream
    func (s *Stream) Overlay(overlayParentNode *Stream, eofAction string, kwargs ...KwArgs) *Stream
    func (s *Stream) OverwriteOutput(stream *Stream) *Stream
    func (s *Stream) Run() error
    func (s *Stream) RunLinux() error
    func (s *Stream) RunWithResource(cpuRequest, cpuLimit float32) error
    func (s *Stream) SetPts(expr string) *Node
    func (s *Stream) Split() *Node
    func (s *Stream) String() string
    func (s *Stream) Trim(kwargs ...KwArgs) *Stream
    func (s *Stream) VFlip(kwargs ...KwArgs) *Stream
    func (s *Stream) Video() *Stream
    func (s *Stream) View(viewType ViewType) (string, error)
    func (s *Stream) WithCpuCoreLimit(n float32) *Stream
    func (s *Stream) WithCpuCoreRequest(n float32) *Stream
    func (s *Stream) WithCpuSet(n string) *Stream
    func (s *Stream) WithErrorOutput(out io.Writer) *Stream
    func (s *Stream) WithInput(reader io.Reader) *Stream
    func (s *Stream) WithMemSet(n string) *Stream
    func (s *Stream) WithOutput(out ...io.Writer) *Stream
    func (s *Stream) WithTimeout(timeOut time.Duration) *Stream
    func (s *Stream) ZoomPan(kwargs ...KwArgs) *Stream</code></pre>

<pre class="language-none"><code class="language-none">type DagNode interface &#123;
	Hash() int
	&#x2F;&#x2F; Compare two nodes
	Equal(other DagNode) bool
	&#x2F;&#x2F; Return a full string representation of the node.
	String() string
	&#x2F;&#x2F; Return a partial&#x2F;concise representation of the node
	ShortRepr() string
	&#x2F;&#x2F; Provides information about all incoming edges that connect to this node.
	&#x2F;&#x2F;
	&#x2F;&#x2F;        The edge map is a dictionary that maps an “incoming_label“ to “(outgoing_node, outgoing_label)“.  Note that
	&#x2F;&#x2F;        implicity, “incoming_node“ is “self“.  See &quot;Edges&quot; section above.
	IncomingEdgeMap() map[Label]NodeInfo
&#125;</code></pre>

<p>Node in a directed-acyclic graph (DAG).</p>
<p>Edges: DagNodes are connected by edges. An edge connects two nodes with a label for each side: - “upstream_node“: upstream&#x2F;parent node - “upstream_label“: label on the outgoing side of the upstream node - “downstream_node“: downstream&#x2F;child node - “downstream_label“: label on the incoming side of the downstream node</p>
<p>For example, DagNode A may be connected to DagNode B with an edge labelled “foo” on A’s side, and “bar” on B’s side:</p>
<p>_____ _____ | | | | | A &gt;[foo]—[bar]&gt; B | |<em><strong><strong>| |</strong></strong></em>|</p>
<p>Edge labels may be integers or strings, and nodes cannot have more than one incoming edge with the same label.</p>
<p>DagNodes may have any number of incoming edges and any number of outgoing edges. DagNodes keep track only of their incoming edges, but the entire graph structure can be inferred by looking at the furthest downstream nodes and working backwards.</p>
<p>Hashing: DagNodes must be hashable, and two nodes are considered to be equivalent if they have the same hash value.</p>
<p>Nodes are immutable, and the hash should remain constant as a result. If a node with new contents is required, create a new node and throw the old one away.</p>
<p>String representation: In order for graph visualization tools to show useful information, nodes must be representable as strings. The “String“ operator should provide a more or less “full” representation of the node, and the “ShortRepr“ property should be a shortened, concise representation.</p>
<p>Again, because nodes are immutable, the string representations should remain constant.</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 节点</span>
<span class="token keyword">type</span> Node <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	streamSpec          <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Stream
	name                <span class="token builtin">string</span>			<span class="token comment">// input、global_args、overwrite_output、merge_output、output </span>
	incomingStreamTypes sets<span class="token punctuation">.</span>String
	outgoingStreamType  <span class="token builtin">string</span>
	minInputs           <span class="token builtin">int</span>
	maxInputs           <span class="token builtin">int</span>
	args                <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	kwargs              KwArgs
	nodeType            <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span></code></pre>



<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 流</span>
<span class="token keyword">type</span> Stream <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Node     <span class="token operator">*</span>Node					<span class="token comment">// </span>
	Label    Label					<span class="token comment">// </span>
	Selector Selector				<span class="token comment">// </span>
	Type     <span class="token builtin">string</span>					<span class="token comment">// </span>
	Context  context<span class="token punctuation">.</span>Context		<span class="token comment">// </span>
<span class="token punctuation">&#125;</span></code></pre>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/gopsutil/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/gopsutil/" class="post-title-link" itemprop="url">gopsutil</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:19:59" itemprop="dateCreated datePublished" datetime="2022-01-25T23:19:59+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">第三方库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/shirou/gopsutil">https://pkg.go.dev/github.com/shirou/gopsutil</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://darjun.github.io/2020/04/05/godailylib/gopsutil/">Go 每日一库之 gopsutil - 大俊的博客 (darjun.github.io)</a></p>
<h2 id="mem"><a href="#mem" class="headerlink" title="mem"></a>mem</h2><p>数据来自  <code>/proc/meminfo</code></p>
<pre class="language-none"><code class="language-none">MemTotal:          45964 kB    &#x2F;&#x2F;所有可用的内存大小，物理内存减去预留位和内核使用。系统从加电开始到引导完成，firmware&#x2F;BIOS要预留一些内存，内核本身要占用一些内存，最后剩下可供内核支配的内存就是MemTotal。这个值在系统运行期间一般是固定不变的，重启会改变。
MemFree:            1636 kB    &#x2F;&#x2F;表示系统尚未使用的内存。
MemAvailable:       8496 kB    &#x2F;&#x2F;真正的系统可用内存，系统中有些内存虽然已被使用但是可以回收的，比如cache&#x2F;buffer、slab都有一部分可以回收，所以这部分可回收的内存加上MemFree才是系统可用的内存 
Buffers:               0 kB    &#x2F;&#x2F;用来给块设备做缓存的内存，(文件系统的 metadata、pages)
Cached:             7828 kB    &#x2F;&#x2F;分配给文件缓冲区的内存,例如vi一个文件，就会将未保存的内容写到该缓冲区
SwapCached:            0 kB    &#x2F;&#x2F;被高速缓冲存储用的交换空间（硬盘的swap）的大小
Active:            19772 kB    &#x2F;&#x2F;经常使用的高速缓冲存储器页面文件大小
Inactive:           3128 kB    &#x2F;&#x2F;不经常使用的高速缓冲存储器文件大小
Active(anon):      15124 kB    &#x2F;&#x2F;活跃的匿名内存
Inactive(anon):       52 kB    &#x2F;&#x2F;不活跃的匿名内存
Active(file):       4648 kB    &#x2F;&#x2F;活跃的文件使用内存
Inactive(file):     3076 kB    &#x2F;&#x2F;不活跃的文件使用内存
Unevictable:           0 kB    &#x2F;&#x2F;不能被释放的内存页
Mlocked:               0 kB    &#x2F;&#x2F;系统调用 mlock 家族允许程序在物理内存上锁住它的部分或全部地址空间。这将阻止Linux 将这个内存页调度到交换空间（swap space），即使该程序已有一段时间没有访问这段空间
SwapTotal:             0 kB    &#x2F;&#x2F;交换空间总内存
SwapFree:              0 kB    &#x2F;&#x2F;交换空间空闲内存
Dirty:                 4 kB    &#x2F;&#x2F;等待被写回到磁盘的
Writeback:             0 kB    &#x2F;&#x2F;正在被写回的
AnonPages:         15100 kB    &#x2F;&#x2F;未映射页的内存&#x2F;映射到用户空间的非文件页表大小
Mapped:             7160 kB    &#x2F;&#x2F;映射文件内存
Shmem:               100 kB    &#x2F;&#x2F;已经被分配的共享内存
Slab:               9236 kB    &#x2F;&#x2F;内核数据结构缓存
SReclaimable:       2316 kB    &#x2F;&#x2F;可收回slab内存
SUnreclaim:         6920 kB    &#x2F;&#x2F;不可收回slab内存
KernelStack:        2408 kB    &#x2F;&#x2F;内核消耗的内存
PageTables:         1268 kB    &#x2F;&#x2F;管理内存分页的索引表的大小
NFS_Unstable:          0 kB    &#x2F;&#x2F;不稳定页表的大小
Bounce:                0 kB    &#x2F;&#x2F;在低端内存中分配一个临时buffer作为跳转，把位于高端内存的缓存数据复制到此处消耗的内存
WritebackTmp:          0 kB    &#x2F;&#x2F;FUSE用于临时写回缓冲区的内存
CommitLimit:       22980 kB    &#x2F;&#x2F;系统实际可分配内存
Committed_AS:     536244 kB    &#x2F;&#x2F;系统当前已分配的内存
VmallocTotal:     892928 kB    &#x2F;&#x2F;预留的虚拟内存总量
VmallocUsed:       29064 kB    &#x2F;&#x2F;已经被使用的虚拟内存
VmallocChunk:     860156 kB    &#x2F;&#x2F;可分配的最大的逻辑连续的虚拟内存</code></pre>

<pre class="language-none"><code class="language-none">MemAvailable &#x3D; MemFree+Active(file)+Inactive(file)-(watermark+min(watermark,Active(file)+Inactive(file)&#x2F;2)) </code></pre>

<h3 id="type-SwapDevice"><a href="#type-SwapDevice" class="headerlink" title="type SwapDevice"></a>type SwapDevice</h3><h4 id="func-SwapDevices-SwapDevice-error"><a href="#func-SwapDevices-SwapDevice-error" class="headerlink" title="func SwapDevices() ([]*SwapDevice, error)"></a>func SwapDevices() ([]*SwapDevice, error)</h4><h4 id="func-SwapDevicesWithContext-ctx-context-Context-SwapDevice-error"><a href="#func-SwapDevicesWithContext-ctx-context-Context-SwapDevice-error" class="headerlink" title="func SwapDevicesWithContext(ctx context.Context) ([]*SwapDevice, error)"></a>func SwapDevicesWithContext(ctx context.Context) ([]*SwapDevice, error)</h4><h4 id="func-m-SwapDevice-String-string"><a href="#func-m-SwapDevice-String-string" class="headerlink" title="func (m SwapDevice) String() string"></a>func (m SwapDevice) String() string</h4><h3 id="type-SwapMemoryStat"><a href="#type-SwapMemoryStat" class="headerlink" title="type SwapMemoryStat"></a>type SwapMemoryStat</h3><h4 id="func-SwapMemory-SwapMemoryStat-error"><a href="#func-SwapMemory-SwapMemoryStat-error" class="headerlink" title="func SwapMemory() (*SwapMemoryStat, error)"></a>func SwapMemory() (*SwapMemoryStat, error)</h4><h3 id="type-VirtualMemoryExStat"><a href="#type-VirtualMemoryExStat" class="headerlink" title="type VirtualMemoryExStat"></a>type VirtualMemoryExStat</h3><h3 id="type-VirtualMemoryStat"><a href="#type-VirtualMemoryStat" class="headerlink" title="type VirtualMemoryStat"></a>type VirtualMemoryStat</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/cli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/cli/" class="post-title-link" itemprop="url">cli</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:19:42" itemprop="dateCreated datePublished" datetime="2022-01-25T23:19:42+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">第三方库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考：<a target="_blank" rel="noopener" href="https://darjun.github.io/2020/06/22/godailylib/cli/">Go 每日一库之 cli - 大俊的博客 (darjun.github.io)</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%8C%96/" class="post-title-link" itemprop="url">go变量初始化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:18:38" itemprop="dateCreated datePublished" datetime="2022-01-25T23:18:38+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="var"><a href="#var" class="headerlink" title="var"></a>var</h2><p><strong>var</strong> 关键字用于初始化变量（所有类型）并赋值，如果没有显示赋值，则隐式赋该类型的零值：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> name <span class="token keyword">type</span> <span class="token punctuation">[</span><span class="token operator">=</span> value<span class="token punctuation">]</span></code></pre>

<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> i <span class="token builtin">int</span>				<span class="token comment">// i = 0</span>
<span class="token keyword">var</span> s <span class="token builtin">string</span>			<span class="token comment">// s = ""</span>
<span class="token keyword">var</span> b <span class="token builtin">bool</span>				<span class="token comment">// b = false</span>
<span class="token keyword">var</span> u1 User				<span class="token comment">// u1 = &#123;Name: "", Age: 0&#125;</span>
<span class="token keyword">var</span> u2 <span class="token operator">*</span>User			<span class="token comment">// u2 = nil 因为指针的零值就是nil</span>
<span class="token keyword">var</span> ss <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> 		<span class="token comment">// ss = [] 一个空的string类型的切片</span></code></pre>

<p>使用<code>var</code>一般不会显式赋值，如果需要显式赋值，一般使用<code>:=</code>。</p>
<pre class="language-go" data-language="go"><code class="language-go">s <span class="token operator">:=</span> <span class="token string">"hello word"</span></code></pre>

<h2 id="new"><a href="#new" class="headerlink" title="new()"></a>new()</h2><pre class="language-go" data-language="go"><code class="language-go"><span class="token function">new</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span></code></pre>

<p><code>T</code>可以是任何类型，<code>new(T)</code>会初始化变量，并赋值变量<code>T</code>类型的零值，然后返回该变量的指针。</p>
<p>以<code>T</code>为<code>string</code>为例，模拟 <code>new(string)</code> ：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">newString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> s <span class="token builtin">string</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>s
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	s1 <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
	s2 <span class="token operator">:=</span> <span class="token function">newString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">*</span>s1 <span class="token operator">==</span> <span class="token operator">*</span>s2<span class="token punctuation">)</span> 	<span class="token comment">// true	都是空字符串的指针</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="make"><a href="#make" class="headerlink" title="make()"></a>make()</h2><p><code>new(T)</code>适合初始化值类型的变量，因为返回其指针，后续传递可以传递该指针，避免值拷贝。</p>
<p><code>new(T</code>不适合初始化引用类型的变量，因为传递引用类型的变量没有值拷贝的问题。<code>T</code>是引用类型，则返回指针的指针，意义不大。</p>
<p><code>make()</code> 用于初始化 slice、map 或 chan（只有这三种类型）的变量。</p>
<h3 id="make-T-len-cap"><a href="#make-T-len-cap" class="headerlink" title="make([]T, len[, cap])"></a><code>make([]T, len[, cap])</code></h3><p>初始化 slice 类型的变量，指定 len 和 cap。</p>
<p>如果不指定 cap，则 cap 等于 len。</p>
<h3 id="make-map-T1-T2"><a href="#make-map-T1-T2" class="headerlink" title="make(map[T1]T2)"></a><code>make(map[T1]T2)</code></h3><p>初始化 map 类型的变量，不指定 len，更没有 cap。</p>
<h3 id="make-chan-T-len"><a href="#make-chan-T-len" class="headerlink" title="make(chan T[, len])"></a>make(chan T[, len])</h3><p>channel 必须通过 make 创建，<code>var c chan int</code> 这种形式创建的是 nil channel，是不能用的，无论收发都会被堵塞。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 无缓存channel</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token comment">// 有缓存channel</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>

<h3 id="nil-切片与空切片"><a href="#nil-切片与空切片" class="headerlink" title="nil 切片与空切片"></a>nil 切片与空切片</h3><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> s1 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>   	<span class="token comment">// nil切片</span>
s2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> 	<span class="token comment">// 空切片，或者用 make([]int,0)</span></code></pre>

<ul>
<li>nil 切片和空切片指向的地址不一样。nil 空切片引用数组指针地址为 0（无指向任何实际地址）；</li>
<li>空切片的引用数组指针地址是有的，且固定为一个值。</li>
</ul>
<p><img data-src="//img.to2b.cn/blog/ljk/1677136498557.png"></p>
<p><img data-src="//img.to2b.cn/blog/ljk/1677136542565.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/go%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/go%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-title-link" itemprop="url">go连接数据库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:18:25" itemprop="dateCreated datePublished" datetime="2022-01-25T23:18:25+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>选择 <code>_ &quot;github.com/go-sql-driver/mysql&quot;</code> 驱动连接数据库，重点关注以下四个参数：</p>
<pre class="language-go" data-language="go"><code class="language-go">maxOpen				<span class="token comment">// 使用 SetMaxOpenConns 函数进行配置</span>
maxIdleCount		<span class="token comment">// 使用 SetMaxIdleConns 函数进行配置</span>
maxLifetime			<span class="token comment">// 使用 SetConnMaxLifetime 函数进行配置</span>
maxIdleTime			<span class="token comment">// 使用 SetConnMaxIdleTime 函数进行配置</span></code></pre>

<ul>
<li><p>maxOpen</p>
<p>可以支持的最大并发连接（会话）：这个值可以设置的大一些，只要不超过 my.cnf 中<code>max-connections</code>即可，默认 0 表示不限制</p>
<p>假设 maxOpen 设置为 4，如果同时来了 5 个连接，就只能先处理 4 个，剩下 1 个在排队。</p>
<blockquote>
<p>多说一句，所谓的排队等，本质上就是先（在一个 map 里）登记一下，然后守着一个 chanel 等，等正在运行的请求结束了，开始收尾了，再去 map 里查看这个请求，并往 chanel 塞上一个连接。</p>
</blockquote>
</li>
<li><p>maxIdleConut</p>
<p>连接池大小：最多可以存储多少连接（会话），连接池中的连接即为<strong>长连接</strong>，设置值&lt;&#x3D;0 表示不存储连接</p>
<p>一个数据库操作完成后，会将连接（会话）放到连接池中；如果连接满了没有位置了，就直接关闭该连接，该连接就是<strong>短链接</strong>。</p>
</li>
<li><p>maxLifetime</p>
<p>连接的存活时间：注意和 my.cnf 中<code>wait-timeout</code>的区别，前者是存活时间，从该连接被创建起开始计算，不管你状态，时间到了就关闭；后者则是计算连接的 idle 时间，只有长时间处于空闲状态才会被关闭。</p>
<blockquote>
<p>一个连接有 idle 以及 open 两种状态，一个长期处于 idle 的连接，MySQL 服务器就会想要关掉它。</p>
</blockquote>
</li>
<li><p>maxIdleTime</p>
<p>空闲（idle）连接的存活时间：该值和 my.cnf 中<code>wait-timeout</code>表示的意义一致。</p>
</li>
</ul>
<p><strong>如何设置？</strong></p>
<p>理想的情况：尽量使用长连接，避免使用短链接</p>
<p>目前：峰值并发 100，日常 20-50</p>
<pre class="language-go" data-language="go"><code class="language-go">DB<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
DB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">// DB.SetConnMaxLifetime()		// 无所谓，可以不设置</span>
DB<span class="token punctuation">.</span><span class="token function">SetConnMaxIdleTime</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span>		<span class="token comment">// 这个要设置，只要比wait-time小就行</span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">值类型和引用类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:18:02" itemprop="dateCreated datePublished" datetime="2022-01-25T23:18:02+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="堆栈"><a href="#堆栈" class="headerlink" title="堆栈"></a>堆栈</h2><h3 id="C-代码和内存布局之间的对应关系"><a href="#C-代码和内存布局之间的对应关系" class="headerlink" title="C 代码和内存布局之间的对应关系"></a>C 代码和内存布局之间的对应关系</h3><img data-src="//img.to2b.cn/blog/ljk/1598447438700.png" style="zoom: 67%;" />

<p>每个进程都包括 5 种不同的数据段：</p>
<ol>
<li>代码段：可执行程序在内存中的镜像，只读，不可写。</li>
<li>数据段：存放已初始化全局变量</li>
<li>BSS 段：Block Started by Symbol”的缩写,意为“以符号开始的块，BSS 段包含了程序中未初始化的全局变量，在内存中 bss 段全部置零。</li>
<li>堆：heap，存放数组和对象，堆是用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用 malloc 等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用 free 等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）</li>
<li>栈：stack，栈是用户存放程序临时创建的局部变量，也就是说我们函数括弧“{}”中定义的变量（但不包括 static 声明的变量，static 意味着在数据段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的后进先出特点，所以栈特别方便用来保存&#x2F;恢复调用现场。可以把堆栈看成一个寄存、交换临时数据的内存区</li>
</ol>
<h3 id="堆和栈的区别"><a href="#堆和栈的区别" class="headerlink" title="堆和栈的区别"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/K346K346/article/details/80849966">堆和栈的区别</a></h3><ul>
<li>程序内存布局场景下，堆与栈表示两种内存管理方式；</li>
<li>数据结构场景下，堆与栈表示两种常见的数据结构；</li>
</ul>
<h4 id="程序内存分区中的堆和栈"><a href="#程序内存分区中的堆和栈" class="headerlink" title="程序内存分区中的堆和栈"></a>程序内存分区中的堆和栈</h4><ul>
<li>栈 由操作系统自动分配释放，用与存放函数的参数值，局部变量等，其操作方式类似与数据结构中的栈。栈区向地址减小的方向增长。程序员无法控制，若分配失败，则提示栈移出错误。</li>
<li>堆 由开发人员分配和释放，若开发人员不释放，程序结束时由 OS 回收，分配方式类似与链表。php 中 new 等可以申请内存，delete 等可以删除内存。</li>
</ul>
<h2 id="值类型"><a href="#值类型" class="headerlink" title="值类型"></a>值类型</h2><p>变量直接存储值，内存通常在栈中分配。</p>
<p><strong>值类型：基本数据类型 <code>int</code>、<code>float</code>、<code>bool</code>、<code>string</code> 以及<code>数组</code>和 <code>结构体</code></strong></p>
<h2 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h2><p>变量存储的是一个地址，这个地址存储最终的值。内存通常在 堆上分配。通过 GC 回收。</p>
<p><strong>引用类型：<code>pointer(指针)</code>、<code>slice</code>、<code>map</code>、<code>chan</code>、<code>interface</code>、<code>function</code></strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">鸭子类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:17:56" itemprop="dateCreated datePublished" datetime="2022-01-25T23:17:56+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在鸭子类型中，关注点在于对象的行为（func），能作什么；而不是关注对象所属的类型（type）。</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">var</span> drivers <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Driver<span class="token punctuation">)</span>

<span class="token keyword">type</span> Driver <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> DriverContext <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">OpenConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> MySQLDriver <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>d MySQLDriver<span class="token punctuation">)</span> <span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	driveri <span class="token operator">:=</span> drivers<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
	<span class="token comment">// MySQLDriver 实现了 Driver 的所有方法（Open），所以这里可以类型断言</span>
	<span class="token keyword">if</span> driverCtx<span class="token punctuation">,</span> ok <span class="token operator">:=</span> driveri<span class="token punctuation">.</span><span class="token punctuation">(</span>DriverContext<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> driverCtx<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>d MySQLDriver<span class="token punctuation">)</span> <span class="token function">OpenConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">Register</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> d Driver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">// main.MySQLDriver</span>
	drivers<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> d     <span class="token comment">// MySQLDriver 实现了 Driver 的所有方法（Open），所以这里可以赋值</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">var</span> d MySQLDriver
	<span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">// MySQLDriver 实现了 Driver 的所有方法（Open），所以这里可以传参</span>
<span class="token punctuation">&#125;</span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%85%B3%E9%97%ADchannel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%85%B3%E9%97%ADchannel/" class="post-title-link" itemprop="url">如何优雅的关闭channel</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:17:46" itemprop="dateCreated datePublished" datetime="2022-01-25T23:17:46+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="单一生产者，单一消费者"><a href="#单一生产者，单一消费者" class="headerlink" title="单一生产者，单一消费者"></a>单一生产者，单一消费者</h2><h2 id="单一生产者，多消费者"><a href="#单一生产者，多消费者" class="headerlink" title="单一生产者，多消费者"></a>单一生产者，多消费者</h2><h2 id="多生产者，单一消费者"><a href="#多生产者，单一消费者" class="headerlink" title="多生产者，单一消费者"></a>多生产者，单一消费者</h2><h2 id="多生产者，多消费者"><a href="#多生产者，多消费者" class="headerlink" title="多生产者，多消费者"></a>多生产者，多消费者</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/32529039">https://zhuanlan.zhihu.com/p/32529039</a></p>
<p>原则：遇到chan的场景，首先要界定清生产者和消费者，生产者负责生产与关闭chan，消费者只管消费，消费者千万不要去关闭chan。</p>
<p>一、for range 读取chan，当chan关闭时程序会跳出for range</p>
<p>二、使用v,ok :&#x3D;  &lt;-chan channel 模式，每次判断ok，当ok为false时代表chan已关闭，就不要再读取已经关闭的chan了 </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block ljk-index-post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/Golang/%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Golang/%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-25 23:12:15" itemprop="dateCreated datePublished" datetime="2022-01-25T23:12:15+08:00">2022-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <pre class="language-bash" data-language="bash"><code class="language-bash">go <span class="token builtin class-name">help</span>									<span class="token comment"># `go` 命令帮助</span>
go <span class="token builtin class-name">help</span> build							<span class="token comment"># `go build` 命令帮助</span>

go build hello.go						<span class="token comment"># 打包 hello.go</span>
go build <span class="token parameter variable">-o</span> <span class="token builtin class-name">test</span> hello.go				<span class="token comment"># 打包 hello.go，并命令编译后的可执行文件为 test</span>
go build <span class="token parameter variable">-work</span> <span class="token parameter variable">-x</span> <span class="token parameter variable">-o</span> <span class="token builtin class-name">test</span> hello.go		<span class="token comment"># -x		打印编译过程中使用的命令</span>
										<span class="token comment"># -work		打印编译过程中创建的临时目录，并且在编译结束后不删除（默认删除）</span>
go build <span class="token parameter variable">-x</span> <span class="token parameter variable">-o</span> <span class="token builtin class-name">test</span> hello.go

go run hello.go							<span class="token comment"># 执行hello.go，不生成编译后的二进制文件</span>
go <span class="token function">install</span> hello.go						<span class="token comment"># 打包helllo.go，并将生成的可执行二进制文件移动到GOPATH/bin</span></code></pre>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="布尔"><a href="#布尔" class="headerlink" title="布尔"></a>布尔</h3><p>bool</p>
<p>常用操作：&amp;&amp;	||	!	&#x3D;&#x3D;	!&#x3D;</p>
<h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><p>Go 语言提供了 5 种有符号、5 种无符号、1 种指针、1 种单字节、1 种单个 unicode 字符（unicode 码点），共 13 种整数类型，零值均为 0</p>
<p>变量的声明：如果没有赋值 默认值为 0</p>
<p>int, uint, rune, int8, int16, int32, int64, uint8, uint16, uint32, uint64, byte, uintptr</p>
<ul>
<li><p>无符号</p>
<ul>
<li>uint：根据操作系统位数不同在内存中占的字节也不同 uint64 或 uint32，如果出现了负数 会溢出从最小值变成最大值</li>
<li>uint8： 无符号 8 位整型 (0 到 255)</li>
<li>uint16： 无符号 16 位整型 (0 到 65535)</li>
<li>uint32：无符号 32 位整型 (0 到 4294967295)</li>
<li>uint64：无符号 64 位整型 (0 到 18446744073709551615)</li>
</ul>
</li>
<li><p>有符号</p>
<ul>
<li>int：根据操作系统位数不同在内存中占的字节也不同 int64 或 int32</li>
<li>int8： 有符号 8 位整型 (-128 到 127)</li>
<li>int16： 有符号 16 位整型 (-32768 到 32767)</li>
<li>int32： 有符号 32 位整型 (-2147483648 到 2147483647)</li>
<li>int64： 有符号 64 位整型 (-9223372036854775808 到 9223372036854775807)</li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li><p>byte： 类似 uint8，1 字节</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main0201</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//byte字符类型 同时也是uint8的别名</span>
	<span class="token keyword">var</span> a <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'a'</span>

	<span class="token comment">//所有的字符都对应ASCII中的整型数据</span>
	<span class="token comment">//'0'对应的48  'A'对应的65 'a' 对应的97</span>
	<span class="token comment">//fmt.Println(a)</span>

	<span class="token comment">//%c是一个占位符 表示打印输出一个字符</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c\n"</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
	<span class="token keyword">var</span> b <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'0'</span> <span class="token comment">//字符0  对应的ASCII值为为48</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c\n"</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c\n"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">main0202</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">var</span> a <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token char">'a'</span>
	<span class="token comment">//将小写字母转成大写字母输出</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> a<span class="token operator">-</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//转义字符 \n 换行</span>

	<span class="token comment">//var a byte = '\n'</span>
	<span class="token comment">//\0  对应的ASCII 值为0 用于字符串的结束标志</span>
	<span class="token comment">//\t 对应的ASCII 值为9 水平制表符 一次跳八个空格</span>
	<span class="token keyword">var</span> a <span class="token builtin">byte</span> <span class="token operator">=</span><span class="token char">'\t'</span>
	<span class="token comment">//fmt.Println(a)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>rune： 类似 int32</p>
</li>
<li><p>uintptr：无符号整型，用于存放一个指针，32 位或 64 位</p>
</li>
</ul>
</li>
</ul>
<p>定义 int 和 int64 需要使用类型转换才可以计算</p>
<h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><p>通过自动推到类型创建的浮点型变量 默认类型为 float64</p>
<ul>
<li>float32： 有效位数 6 或 7，第 7 位不一定有效，前 6 位一定有效，示例：π 有效 3.14159</li>
<li>float64：有效位数 15</li>
</ul>
<p>注意：浮点型不能进行&#x3D;&#x3D;或!&#x3D;比较，可选择使用两个浮点数的差在一定区间内则认为相等</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>string</p>
<ul>
<li>可解析字符串：通过双引号(“)来创建，不能包含多行，支持特殊字符转义序列</li>
<li>原生字符串：通过反引号(&#96;)来创建，可包含多行，不支持特殊字符转义序列</li>
</ul>
<p>特殊字符：</p>
<pre class="language-none"><code class="language-none">\a：响铃
\b：退格
\f：换页
\n：换行
\r：回车
\t：制表符
\v：垂直制表符</code></pre>

<h3 id="iota"><a href="#iota" class="headerlink" title="iota"></a>iota</h3><p><strong>特殊</strong>常量，可以认为是一个可以被编译器修改的常量。在每一个 const 关键字出现时，被重置为 0，然后在下一个 const 出现之前，每出现一次 iota，值自动加 1。</p>
<p>iota 生成器用于初始化一系列相同规则的常量。</p>
<p>实力：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 枚举值</span>
	<span class="token comment">// iota 在一个小括号内, 初始化为0, 每调用一次+1</span>
	<span class="token comment">// const (</span>
	<span class="token comment">// 	statusNew      = iota // 0</span>
	<span class="token comment">// 	statusComplete = iota // 1</span>
	<span class="token comment">// 	statusDeleted  = iota // 2</span>
	<span class="token comment">// )</span>

	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		statusNew      <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token comment">// 0</span>
		statusComplete        <span class="token comment">// 1</span>
		statusDeleted         <span class="token comment">// 2</span>
	<span class="token punctuation">)</span>

	<span class="token keyword">const</span> <span class="token punctuation">(</span>
		Monday <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">*</span> <span class="token number">10</span>
		Tuesday
		Wednesday
	<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>statusNew<span class="token punctuation">,</span> statusComplete<span class="token punctuation">,</span> statusDeleted<span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>Monday<span class="token punctuation">,</span> Tuesday<span class="token punctuation">,</span> Wednesday<span class="token punctuation">)</span>
</code></pre>

<h3 id="数组-和-切片"><a href="#数组-和-切片" class="headerlink" title="数组 和 切片"></a>数组 和 切片</h3><p>数组在定义时即固定<strong>长度</strong>，切片在定义时可以指定<strong>长度</strong>和<strong>容量</strong>，也可以不指定。</p>
<p>切片是长度可变的数组（具有相同数据类型的数据项组成的一组长度可变的序列），切片由三部分组成：</p>
<ul>
<li>指针：指向切片第一个元素指向的数组元素的地址</li>
<li>长度：切片元素的数量</li>
<li>容量：切片开始到结束位置元素的数量</li>
</ul>
<p>注意：<font color=red><strong>数组是 值类型，切片是 引用类型</strong></font></p>
<p>注意：切片长度不能超过容量。</p>
<p>关于…</p>
<pre class="language-go" data-language="go"><code class="language-go">arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">&#125;</span></code></pre>

<p>如果没有三个点，右边类型推导赋值是切片，有三个点推导的类型是数组，数组个数由后面实际初始化个数确定，数组是长度不能改变的</p>
<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>pointer</p>
<p>指针是用来存储变量地址的变量。</p>
<p>该使用值还是指针，取决于是否现需要修改原始数据。</p>
<ul>
<li><p>声明：*type</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> p <span class="token operator">*</span><span class="token builtin">int</span>			<span class="token comment">// 声明指针变量 默认值为0x0 (nil) 空指针</span></code></pre>
</li>
<li><p>初始化：&amp;variable &#x2F; new()</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span>
<span class="token keyword">var</span> p <span class="token operator">:=</span> <span class="token operator">&amp;</span>a				<span class="token comment">// 初始化</span>

<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>		<span class="token comment">// 初始化，默认为0</span></code></pre>
</li>
<li><p>操作：*pointerVariable</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">123</span>
<span class="token keyword">var</span> p <span class="token operator">:=</span> <span class="token operator">&amp;</span>a
<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token number">456</span>				<span class="token comment">// 赋值</span></code></pre></li>
</ul>
<h4 id="数组指针"><a href="#数组指针" class="headerlink" title="数组指针"></a>数组指针</h4><p>数组指针操作数组，可以省略*</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go">arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>
p <span class="token operator">:=</span> <span class="token operator">&amp;</span>arr
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment">// &amp;[1 2 3] [1 2 3] 1 1</span></code></pre>

<p>上例中，(*p)[0] 可以简化为 p[0]</p>
<h4 id="切片指针"><a href="#切片指针" class="headerlink" title="切片指针"></a>切片指针</h4><p>因为切片是引用类型，所以*不能省略</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go">slice <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>
p <span class="token operator">:=</span> <span class="token operator">&amp;</span>slice
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>			<span class="token comment">// &amp;[1 2 3] [1 2 3] 1</span></code></pre>

<h4 id="指针变量作为函数参数"><a href="#指针变量作为函数参数" class="headerlink" title="指针变量作为函数参数"></a>指针变量作为函数参数</h4><p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">swap</span><span class="token punctuation">(</span>a <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token operator">*</span>a
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	a <span class="token operator">:=</span> <span class="token number">10</span>
	b <span class="token operator">:=</span> <span class="token number">20</span>
	<span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>映射是存储一系列无序的 key&#x2F;value 对，通过 key 来对 value 进行操作（增、删、改、查）。<br>映射的 key 只能为可使用 &#x3D;&#x3D; 运算符的 <strong>值类型</strong>（字符串、数字、布尔、数组），value 可以为任意类型</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go">names <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"Go001"</span><span class="token punctuation">:</span> <span class="token string">"小明"</span><span class="token punctuation">&#125;</span>	<span class="token comment">// 一定要进行初始化，不能只声明类型</span>
names<span class="token punctuation">[</span><span class="token string">"Go002"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"小刚"</span>
names<span class="token punctuation">[</span><span class="token string">"Go003"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"小红"</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span>		<span class="token comment">// map[Go001:小明 Go002:小刚 Go003:小红]</span></code></pre>

<h4 id="获取元素的数量"><a href="#获取元素的数量" class="headerlink" title="获取元素的数量"></a>获取元素的数量</h4><p>len()</p>
<h4 id="判断-key-是否存在"><a href="#判断-key-是否存在" class="headerlink" title="判断 key 是否存在"></a>判断 key 是否存在</h4><p>通过 key 访问元素时可接收两个值，第一个值为 value，第二个值为 bool 类型表示元素是否存在，若存在为 true，否则为 false</p>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>delete(map, key)</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token function">delete</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token string">"Go001"</span><span class="token punctuation">)</span></code></pre>

<h4 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h4><p>for range</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	m <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"lujinkai"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token string">"18"</span><span class="token punctuation">,</span> <span class="token string">"gender"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> m <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h3><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> TypeName Format</code></pre>

<p>Format 可以是任意内置类型、函数签名、结构体、接口。</p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>struct</p>
<p>结构体是 <strong>值类型</strong>。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">type</span> Author <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
		id   <span class="token builtin">int</span>
		name <span class="token builtin">string</span>
		addr <span class="token builtin">string</span>
		tel  <span class="token builtin">string</span>
		desc <span class="token builtin">string</span>
	<span class="token punctuation">&#125;</span>

	lujinkai <span class="token operator">:=</span> Author<span class="token punctuation">&#123;</span>
		id<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
		name<span class="token punctuation">:</span> <span class="token string">"lujinkai"</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%#v\n"</span><span class="token punctuation">,</span> lujinkai<span class="token punctuation">)</span>		<span class="token comment">// main.Author&#123;id:1, name:"lujinkai", addr:"", tel:"", desc:""&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>lujinkai<span class="token punctuation">.</span>name<span class="token punctuation">)</span>			<span class="token comment">// lujinkai</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="匿名结构体"><a href="#匿名结构体" class="headerlink" title="匿名结构体"></a>匿名结构体</h4><pre class="language-go" data-language="go"><code class="language-go">me <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"lujiknai"</span><span class="token punctuation">&#125;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span>		<span class="token comment">// &#123;1 lujiknai&#125;</span></code></pre>

<h4 id="命名嵌入-amp-匿名嵌入"><a href="#命名嵌入-amp-匿名嵌入" class="headerlink" title="命名嵌入 &amp; 匿名嵌入"></a>命名嵌入 &amp; 匿名嵌入</h4><p><strong>命名嵌入：</strong></p>
<p>调用的时候属性名不能省略。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    a    A
    tel  <span class="token builtin">string</span>
    addr <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

b <span class="token operator">:=</span> B<span class="token punctuation">&#123;</span>
    a<span class="token punctuation">:</span> A<span class="token punctuation">&#123;</span>
        id<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">"ljk"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    tel<span class="token punctuation">:</span>  <span class="token string">"1767427610"</span><span class="token punctuation">,</span>
    addr<span class="token punctuation">:</span> <span class="token string">"北京海淀"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>a<span class="token punctuation">.</span>id<span class="token punctuation">)</span>		<span class="token comment">// 1</span></code></pre>

<p><strong>匿名嵌入：</strong></p>
<p>结构体类型和属性名必须一致，调用的时候可以省略属性名。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    A
    tel  <span class="token builtin">string</span>
    addr <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

b <span class="token operator">:=</span> B<span class="token punctuation">&#123;</span>
    A<span class="token punctuation">:</span> A<span class="token punctuation">&#123;</span>
        id<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">"ljk"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    tel<span class="token punctuation">:</span>  <span class="token string">"1767427610"</span><span class="token punctuation">,</span>
    addr<span class="token punctuation">:</span> <span class="token string">"北京海淀"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>		<span class="token comment">// 1</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>A<span class="token punctuation">.</span>id<span class="token punctuation">)</span>		<span class="token comment">// 1</span></code></pre>

<h4 id="指针类型嵌入"><a href="#指针类型嵌入" class="headerlink" title="指针类型嵌入"></a>指针类型嵌入</h4><p>结构体嵌入（命名&amp;匿名）类型也可以为结构体指针。</p>
<ul>
<li><p>使用属性为指针类型，底层共享数据结构，当底层数据发生变化，所有引用都会发生影响。</p>
</li>
<li><p>使用属性为值类型，则在复制时发生拷贝，两者不相互影响</p>
</li>
</ul>
<p><strong>命名嵌入指针结构体：</strong></p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    a    <span class="token operator">*</span>A
    tel  <span class="token builtin">string</span>
    addr <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

b <span class="token operator">:=</span> B<span class="token punctuation">&#123;</span>
    a<span class="token punctuation">:</span> <span class="token operator">&amp;</span>A<span class="token punctuation">&#123;</span>
        id<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">"ljk"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    tel<span class="token punctuation">:</span>  <span class="token string">"1767427610"</span><span class="token punctuation">,</span>
    addr<span class="token punctuation">:</span> <span class="token string">"北京海淀"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>a<span class="token punctuation">.</span>id<span class="token punctuation">)</span></code></pre>

<p><strong>匿名嵌入指针结构体：</strong></p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> B <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span>A
    tel  <span class="token builtin">string</span>
    addr <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

b <span class="token operator">:=</span> B<span class="token punctuation">&#123;</span>
    A<span class="token punctuation">:</span> <span class="token operator">&amp;</span>A<span class="token punctuation">&#123;</span>
        id<span class="token punctuation">:</span>   <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> <span class="token string">"ljk"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    tel<span class="token punctuation">:</span>  <span class="token string">"1767427610"</span><span class="token punctuation">,</span>
    addr<span class="token punctuation">:</span> <span class="token string">"北京海淀"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>		<span class="token comment">// 1</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>A<span class="token punctuation">.</span>id<span class="token punctuation">)</span>		<span class="token comment">// 1</span></code></pre>

<h4 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h4><p>结构体首字母大写则包外可见（公开），否者仅包内可访问（内部）</p>
<p>结构体属性名首字母大写包外可见（公开），否者仅包内可访问（内部）<br>组合：</p>
<ul>
<li>结构体名首字母大写，属性名大写：结构体可在包外使用，且访问其大写的属性名</li>
<li>结构体名首字母大写，属性名小写：结构体可在包外使用，且不能访问其小写的属性名</li>
<li>结构体名首字母小写，属性名大写：结构体只能在包内使用，属性访问在结构体嵌入时由被嵌入结构体（外层）决定，被嵌入结构体名首字母大写时属性名包外可见，否者只能在包内使用</li>
<li>结构体名首字母小写，属性名小写：结构体只能在包内使用</li>
</ul>
<h4 id="结构体和指针"><a href="#结构体和指针" class="headerlink" title="结构体和指针"></a>结构体和指针</h4><p>结构体是值类型，指针是引用类型。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> File <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    Context <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//扩展理解部分, 这部分可以先略过,下面会单独讲解</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>File<span class="token punctuation">)</span> <span class="token function">Clone1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>File <span class="token punctuation">&#123;</span> <span class="token comment">// 返回新File 不同步</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>File<span class="token punctuation">&#123;</span>Context<span class="token punctuation">:</span> t<span class="token punctuation">.</span>Context <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>File<span class="token punctuation">)</span> <span class="token function">Clone2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>File <span class="token punctuation">&#123;</span> <span class="token comment">//返回 t 同步改</span>
    <span class="token keyword">return</span> t
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>File<span class="token punctuation">)</span> <span class="token function">Clone3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> File <span class="token punctuation">&#123;</span> <span class="token comment">// 返回 *t 不同步</span>
    <span class="token keyword">return</span> <span class="token operator">*</span>t
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t File<span class="token punctuation">)</span> <span class="token function">Clone4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>File <span class="token punctuation">&#123;</span> <span class="token comment">// 返回 &amp;t 不同步</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>t
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t File<span class="token punctuation">)</span> <span class="token function">Clone5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> File <span class="token punctuation">&#123;</span> <span class="token comment">// 返回 t 不同步</span>
    <span class="token keyword">return</span> t
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h3><p>不要通过共享内存来通信，而通过通信来共享内存。</p>
<h4 id="基本定义与使用"><a href="#基本定义与使用" class="headerlink" title="基本定义与使用"></a>基本定义与使用</h4><p>channel 必须通过 make 创建，<code>var c chan int</code> 这种形式创建的是 nil channel，是不能用的，无论收发都会被堵塞。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 无缓存channel</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment">// 有缓存channel</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></code></pre>

<h5 id="读取和写入"><a href="#读取和写入" class="headerlink" title="读取和写入"></a>读取和写入</h5><p>可通过操作符 <code>&lt;- </code> 和 <code>-&gt;</code> 对管道进行读取和写入操作，当写入无缓冲区管道或由缓冲区管道已满时写入则会阻塞直到管道中元素被其他例程读取。同理，当管道中无元素时读取时也会<strong>阻塞</strong>到管道被其他例程写入元素。</p>
<h5 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h5><pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// func close(c chan&lt;- Type)</span>

<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>		<span class="token comment">// 关闭channel c</span></code></pre>

<h4 id="有缓存和有缓存的区别"><a href="#有缓存和有缓存的区别" class="headerlink" title="有缓存和有缓存的区别"></a>有缓存和有缓存的区别</h4><p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 发送者</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
    
	ch <span class="token operator">&lt;-</span> <span class="token number">1</span> <span class="token comment">// 发送</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"发送"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

	<span class="token comment">// 接收者</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch <span class="token comment">// 接收</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"接收"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>输出：</p>
<pre class="language-none"><code class="language-none">deadlock</code></pre>

<p>使用无缓存通道，稍不留神就会死锁。</p>
<p>有缓存和无缓存channel，除了有无缓存空间外，其阻塞策略也不同。</p>
<p>在无缓存通道下，发送者的发送操作将阻塞，直到接收者执行接受操作。同样接受者的接受操作将阻塞，直到发送者执行发送操作。发送者的发送操作和接受者的接受操作是<strong>同步</strong>的。</p>
<p>在有缓存通道下，如果缓存空间满了，那么发送者的发送操作将阻塞。直到接受者取走数据，有了缓存空间，发送者的发送操作才会继续执行。如果缓存是空的，那么接受者的接受操作将阻塞。</p>
<p>上面的示例中，有两种解决方法：</p>
<ol>
<li><p>使用有缓存通道。</p>
<pre class="language-go" data-language="go"><code class="language-go">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>
</li>
<li><p>还是使用无缓存通道，但要先创建接受者，再发送数据。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>

	<span class="token comment">// 接收者</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch <span class="token comment">// 这里阻塞</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"收到："</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 发送者</span>
	ch <span class="token operator">&lt;-</span> <span class="token number">1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"发送："</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ol>
<h4 id="range-遍历"><a href="#range-遍历" class="headerlink" title="range 遍历"></a>range 遍历</h4><h4 id="select-case-监听多个-channel"><a href="#select-case-监听多个-channel" class="headerlink" title="select-case 监听多个 channel"></a>select-case 监听多个 channel</h4><p>使用select-case对多个channel进行监听（写入或者读取），则可以使用 select-case</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	c <span class="token operator">&lt;-</span> <span class="token number">999</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	ch01 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	ch02 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	ch01 <span class="token operator">&lt;-</span> <span class="token number">0</span>
	ch02 <span class="token operator">&lt;-</span> <span class="token number">0</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch01<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ch01"</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch02<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ch02"</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<ul>
<li><p>每个case语句都必须是管道操作，即channel的读或者写;</p>
</li>
<li><p>在一个select-case操作中，select检查所有的case语句，只要是合法的管道操作，这个case就可以执行，select会随机执行一个可以执行的case，其他的忽略;</p>
</li>
<li><p>case语句中如果有函数，则会执行一遍这个函数（函数中对管道的操作不会真的执行），上例中，done() 2秒后返回管道，所以select-case需要等2秒后才会随机选择一个case进行执行;</p>
<p>如果使用time.After，则无需等待，因为time.Sleep是同步，而time.After是异步：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	ch01 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	ch02 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	ch01 <span class="token operator">&lt;-</span> <span class="token number">0</span>
	ch02 <span class="token operator">&lt;-</span> <span class="token number">0</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">case</span> c <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch01<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ch01: "</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
	<span class="token keyword">case</span> c <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch02<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ch02: "</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"2 time.Second"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>如果所有的case都不可执行，就走default，如果没有default，则整个select-case就会一直堵塞</p>
</li>
</ul>
<p>select-case 通常搭配 for 使用，在某种情况下，通过break退出for循环（或return退出函数）</p>
<h4 id="只读和只写管道"><a href="#只读和只写管道" class="headerlink" title="只读和只写管道"></a>只读和只写管道</h4><p><code>chan&lt;- type</code>  单向只写管道，只能写数据到管道里面</p>
<p><code> &lt;-chan type</code> 单向只读管道，只能从管道里面读出数据</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li><p>在声明函数中若存在多个连续形参类型相同可只保留最后一个参数类型名。</p>
</li>
<li><p>运算符…声明可变参数函数或在调用时传递可变参数</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> args<span class="token punctuation">)</span>  <span class="token comment">//	1 2 [3 4 5]</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token comment">// []int 切片类型</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 两种调用方式</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre></li>
</ul>
<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><h5 id="多返回值"><a href="#多返回值" class="headerlink" title="多返回值"></a>多返回值</h5><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">,</span> n1 <span class="token operator">*</span> n2<span class="token punctuation">,</span> n1 <span class="token operator">-</span> n2<span class="token punctuation">,</span> n1 <span class="token operator">/</span> n2
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5 6 -1 0</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="命名返回值"><a href="#命名返回值" class="headerlink" title="命名返回值"></a>命名返回值</h5><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> difference<span class="token punctuation">,</span> product<span class="token punctuation">,</span> quotient <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	sum<span class="token punctuation">,</span> difference<span class="token punctuation">,</span> product<span class="token punctuation">,</span> quotient <span class="token operator">=</span> n1<span class="token operator">+</span>n2<span class="token punctuation">,</span> n1<span class="token operator">*</span>n2<span class="token punctuation">,</span> n1<span class="token operator">-</span>n2<span class="token punctuation">,</span> n1<span class="token operator">/</span>n2
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 5 6 -1 0</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><h4 id="值类型-amp-引用类型"><a href="#值类型-amp-引用类型" class="headerlink" title="值类型 &amp; 引用类型"></a>值类型 &amp; 引用类型</h4><p>值类型和引用类型的差异在于赋值同类型新变量后，对新变量进行修改是否能够影响原来的变量，若不能影响则为值类型，若能影响则为引用类型</p>
<ul>
<li>值类型：数值、布尔、字符串、指针、数组、结构体</li>
<li>引用类型：切片、映射、接口等</li>
</ul>
<blockquote>
<ul>
<li>值类型：基本数据类型 int 系列, float 系列, bool, string 、数组和结构体 struct</li>
<li>引用类型：指针、slice 切片、map、管道 chan、interface 、函数都是引用类型</li>
</ul>
</blockquote>
<h4 id="值传递-amp-引用传递"><a href="#值传递-amp-引用传递" class="headerlink" title="值传递 &amp; 引用传递"></a>值传递 &amp; 引用传递</h4><ul>
<li>默认就是值值传递</li>
<li>传引用类型（最常用的是切片[]byte 和指针）作为参数，就是引用传递，可以在函数内修改函数外的变量</li>
</ul>
<p>如果要直接修改传入的参数，一定要引用传递</p>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><h5 id="error-接口"><a href="#error-接口" class="headerlink" title="error 接口"></a>error 接口</h5><p>go 语言通过 error 接口实现错误处理的标准模式，通过使用函数返回值列表中的最后一个值返回错误信息，将错误的处理交由程序员主动进行处理。</p>
<p>error 接口的初始化方法：</p>
<ul>
<li>errors.New</li>
<li>fmt.Errorf</li>
</ul>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">division</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">float64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> n2 <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"除数为0"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> <span class="token function">float64</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">float64</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	r<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">division</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%0.2f %v\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h5><p>defer 关键字用户声明函数，不论函数是否发生错误都在函数执行最后执行（return 之前），类似 php 中的析构函数。</p>
<p>若使用 defer 声明多个函数，则按照声明的顺序，先声明后执行（堆）。</p>
<p>常用来做资源释放，记录日志等工作。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"defer 01"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"defer 02"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">defer</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>输出：</p>
<pre class="language-none"><code class="language-none">defer 02
defer 01</code></pre>

<h5 id="panic-和-recover-函数"><a href="#panic-和-recover-函数" class="headerlink" title="panic 和 recover 函数"></a>panic 和 recover 函数</h5><p>go 语言提供 panic 和 recover 函数用于处理运行时错误：</p>
<p>panic 抛出异常，中断代码继续往下执行，异常在 defer 中“冒泡”，recover 只能用于 defer 语句声明的函数，用于捕获“冒泡”的异常，被 recover 捕获的异常就不继续往上“冒泡”了，但是不会阻止 defer 的继续执行。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"err: "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"未捕获到error"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"defer 01"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"err: "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"未捕获到error"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"defer 02"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">defer</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"this is panic"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>输出：</p>
<pre class="language-none"><code class="language-none">err:  this is panic
defer 02
未捕获到error
defer 01</code></pre>

<p>panic 抛出异常，在 defer 中向上冒泡，要注意以下几点：</p>
<ul>
<li>panic 后面的代码就不执行了，包括 defer，异常只在 panic 之前的 defer 中冒泡</li>
<li>只有 panic 抛出的异常，才会在 defer 中冒泡，return、log.Fatal 等中止程序运行的语句，会直接中止，并不会执行 defer</li>
</ul>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>interface</p>
<p><strong>接口是引用类型。</strong></p>
<p>接口是自定义类型，是对是其他类型行为的抽象。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Sender <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Send</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token function">SendAll</span><span class="token punctuation">(</span>tos <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>若两个接口声明同样的函数签名，则两个接口完全等价。</p>
<p>当接口 A 包含接口 B 中声明的所有函数时（接口 A 函数是接口 B 函数的父集），则接口 A 的对象赋值给接口 B 的对象，只不过接口 B 对象只能调用接口 B 中定义的函数（方法）。</p>
<p>示例：</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// 定义Sender接口，声明Send和SendAll两个方法</span>
<span class="token keyword">type</span> Sender <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">Send</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">SendAll</span><span class="token punctuation">(</span>tos <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 定义EmailSender结构体</span>
<span class="token keyword">type</span> EmailSender <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	addr           <span class="token builtin">string</span>
	port           <span class="token builtin">int</span>
	user<span class="token punctuation">,</span> password <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// EmailSender结构体添加Send和SendAll两个方法</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>sender <span class="token operator">*</span>EmailSender<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"发送邮件给:  %s, 内容：%s\n"</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>sender <span class="token operator">*</span>EmailSender<span class="token punctuation">)</span> <span class="token function">SendAll</span><span class="token punctuation">(</span>tos <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> to <span class="token operator">:=</span> <span class="token keyword">range</span> tos <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"发送邮件给:  %s, 内容：%s\n"</span><span class="token punctuation">,</span> to<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 因为EmailSender结构体实现了Sender接口中声明的两个方法，所以这里可以指定变量sender的类型为Sender接口</span>
<span class="token keyword">var</span> sender Sender <span class="token operator">=</span> <span class="token operator">&amp;</span>EmailSender<span class="token punctuation">&#123;</span><span class="token string">"smtp.qq.com"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">"lujinkai"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">&#125;</span>

sender<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"441757636@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"hi lujinkai"</span><span class="token punctuation">)</span>											<span class="token comment">// 调用Send方法</span>
sender<span class="token punctuation">.</span><span class="token function">SendAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"441757636@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"1076956365@qq.com"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"good morning"</span><span class="token punctuation">)</span>		<span class="token comment">// 调用SendAll方法</span>

<span class="token comment">// 定义SingleSender接口，只声明Send方法</span>
<span class="token keyword">type</span> SingleSender <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">Send</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 定义SingleSender类型的变量singleSender，赋值sender</span>
<span class="token keyword">var</span> singleSender SingleSender <span class="token operator">=</span> sender

singleSender<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"441757636@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"hi ljk"</span><span class="token punctuation">)</span>											<span class="token comment">// 调用Send方法</span>
singleSender<span class="token punctuation">.</span><span class="token function">SendAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"441757636@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"1076956365@qq.com"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"hi error"</span><span class="token punctuation">)</span>		<span class="token comment">// 报错，无法调用SendAll方法</span></code></pre>

<h4 id="匿名接口"><a href="#匿名接口" class="headerlink" title="匿名接口"></a>匿名接口</h4><p>在定义变量时将类型指定为接口的函数签名的接口，此时叫匿名接口。匿名接口常用于初始化一次接口变量的场景。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> singleSender <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Send</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span> <span class="token operator">=</span> sender

singleSender<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token string">"441757636@qq.com"</span><span class="token punctuation">,</span> <span class="token string">"hi ljk"</span><span class="token punctuation">)</span></code></pre>

<h4 id="接口匿名嵌入"><a href="#接口匿名嵌入" class="headerlink" title="接口匿名嵌入"></a>接口匿名嵌入</h4><p>接口之中也可以嵌入已存在的接口，从而实现接口的扩展。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
    <span class="token function">A</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> B <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
    <span class="token function">B</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> C <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
    A
    B
    <span class="token function">C</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    id   <span class="token builtin">int</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 给T添加方法 A()、B()、C()</span>
<span class="token operator">...</span>

<span class="token comment">// 使用</span>
<span class="token keyword">var</span> t C <span class="token operator">=</span> T<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"lujinkai"</span><span class="token punctuation">&#125;</span>
t<span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token string">"test 1"</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token string">"test 2"</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string">"test 3"</span><span class="token punctuation">)</span></code></pre>

<h4 id="类型断言-amp-查询"><a href="#类型断言-amp-查询" class="headerlink" title="类型断言 &amp; 查询"></a>类型断言 &amp; 查询</h4><h5 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h5><p>格式：<code>v,ok := x.(类型)</code>，x 必须为接口类型，x 转换类型得到 v，ok 表示转换类型是否成功，如果不设置第二个参数，也就是 ok，断言失败时会直接造成一个 panic，如果 x 为 nil 同样也会 panic</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> A <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> AB <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>
	<span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> T <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	id   <span class="token builtin">int</span>
	name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>i T<span class="token punctuation">)</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>i T<span class="token punctuation">)</span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a A <span class="token operator">=</span> T<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">&#125;</span>		<span class="token comment">// 只能用var，写法 a := T&#123;1, "test"&#125; 是不对的</span>
	a<span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    a<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>						<span class="token comment">// 会报错</span>
	v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token punctuation">(</span>AB<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>			<span class="token comment">// &lt;nil> false</span>
	v<span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>						<span class="token comment">// 不会报错</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h5><p>格式：<code>x.(type)</code>，x 必须为接口类型</p>
<p>只能用于 switch 的判断</p>
<p>示例：参考下面的空接口示例</p>
<h4 id="空接口"><a href="#空接口" class="headerlink" title="空接口"></a>空接口</h4><p>不包含任何函数签名的接口叫空接口，空接口声明的变量可以赋值为任何类型的变量（任意接口）</p>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>常声明函数参数类型为 <code>interface&#123;&#125;</code>，用于接收任意类型的变量</p>
<p>go 中没有泛型，空接口搭配 switch 可以部分实现泛型的功能</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">printTypes</span><span class="token punctuation">(</span>vs <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> vs <span class="token punctuation">&#123;</span>
		<span class="token keyword">switch</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">case</span> <span class="token boolean">nil</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"nil"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"int"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"bool"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"string"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"[5]int"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"[]int"</span><span class="token punctuation">)</span>
		<span class="token keyword">case</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"map[string]string"</span><span class="token punctuation">)</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"unknow"</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>golang 中的类型转换分为强制类型转换、类型断言、以及“向上造型”</p>
<p>这里先只介绍 强制类型转换：</p>
<ul>
<li><p>等价类型</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token function">type_name</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span></code></pre>

<p>type_name 为类型，expression 为表达式。</p>
<p>什么是等价类型？即实现了相同的方法，[]byte 和 string 是等价类型，int32 和 int64 也是等价类型，但是 int 和 string 不是等价类型。</p>
<pre class="language-go" data-language="go"><code class="language-go"></code></pre>
</li>
<li><p>不等价类型</p>
<p>使用 strconv 包</p>
</li>
</ul>
<h2 id="fmt-格式化输入输出"><a href="#fmt-格式化输入输出" class="headerlink" title="fmt 格式化输入输出"></a>fmt 格式化输入输出</h2><p><a target="_blank" rel="noopener" href="https://studygolang.com/static/pkgdoc/pkg/fmt.htm">https://studygolang.com/static/pkgdoc/pkg/fmt.htm</a></p>
<h3 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h3><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><p>go 中的循环只有 for 和 for range</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="for-range"><a href="#for-range" class="headerlink" title="for range"></a>for range</h4><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="break-和-continue"><a href="#break-和-continue" class="headerlink" title="break 和 continue"></a>break 和 continue</h4><p>break 和 continue 语句和其他语言中的 break 和 continue 无异</p>
<h4 id="类-while"><a href="#类-while" class="headerlink" title="类 while"></a>类 while</h4><p>for 子语句只保留条件子语句，此时类似于其他语言中的 while 循环</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	i <span class="token operator">:=</span> <span class="token number">1</span>
	<span class="token keyword">for</span> i <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">&#123;</span>
		i <span class="token operator">++</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="死循环"><a href="#死循环" class="headerlink" title="死循环"></a>死循环</h4><p>for 子语句全部省略，则为无限循环（死循环），常与 break 与 continue 结合使用，类似其他语言中的 <code>while(true) &#123;&#125;</code></p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	i <span class="token operator">:=</span> <span class="token number">1</span>
	<span class="token keyword">for</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="label-和-goto"><a href="#label-和-goto" class="headerlink" title="label 和 goto"></a>label 和 goto</h3><p>可以通过 goto 语句任意跳转到当前函数指定的 label 位置。</p>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>Go 源文件都需要在开头使用 package 声明所在包。</p>
<p>包名使用简短的小写字母，常与所在目录名保持一致，一个包中可以由多个 Go 源文件，但必须使用相同包名。</p>
<p>main 包用于声明告知编译器将包编译为二进制可执行文件，在 main 包中的 main 函数是程序的入口，无返回值，无参数。</p>
<h3 id="成员可见性"><a href="#成员可见性" class="headerlink" title="成员可见性"></a>成员可见性</h3><p>Go 使用名称首字母大小写来判断对象（<strong>常量、变量、函数、类型、结构体、方法等</strong>）的访问权限，首字母大写标识包外可见(公开的)，否者仅包内可访（内部的）。</p>
<h3 id="init-函数"><a href="#init-函数" class="headerlink" title="init 函数"></a>init 函数</h3><p>init 函数用于初始化包，无返回值，无参数。建议每个包只定义一个，相当于 php 中的构造函数__construct()。</p>
<p>Go 不允许包导入但未使用，在某些情况下需要初始化包，使用空白符作为别名进行导入，从而使得包中的 init 函数可以执行。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token boolean">_</span> <span class="token string">"fmt"</span></code></pre>

<h3 id="Go-包管理"><a href="#Go-包管理" class="headerlink" title="Go 包管理"></a>Go 包管理</h3><p>标准包：</p>
<p><a target="_blank" rel="noopener" href="https://studygolang.com/pkgdoc">Go 语言标准库文档中文版 | Go 语言中文网 | Golang 中文社区 | Golang 中国 (studygolang.com)</a></p>
<p>第三方包查找地址：<br><a target="_blank" rel="noopener" href="https://godoc.org/">https://godoc.org</a><br><a target="_blank" rel="noopener" href="https://gowalker.org/">https://gowalker.org/</a></p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>方法是为特定类型定义的，只能由该类型调用的函数。</p>
<p>方法是添加了接受者的函数，接受者必须是自定义的类型。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token function">method</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> returns <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<p><strong>调用</strong>：通过点 . 调用。</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Dog <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    name <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>dog Dog<span class="token punctuation">)</span> <span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

dog <span class="token operator">:=</span> Dog<span class="token punctuation">&#123;</span><span class="token string">"豆豆"</span><span class="token punctuation">&#125;</span>

dog<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">// 豆豆 调用</span></code></pre>

<h3 id="接受者为指针"><a href="#接受者为指针" class="headerlink" title="接受者为指针"></a>接受者为指针</h3><pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>dog <span class="token operator">*</span>Dog<span class="token punctuation">)</span> <span class="token function">SetName</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    dog<span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">&#125;</span>
<span class="token punctuation">(</span><span class="token operator">&amp;</span>dog<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetName</span><span class="token punctuation">(</span><span class="token string">"大黄"</span><span class="token punctuation">)</span>	<span class="token comment">// 调用</span>
dog<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>				<span class="token comment">// 大黄</span></code></pre>

<p><strong>该使用值接收者还是指针接收者，取决于是否现需要修改原始结构体：</strong></p>
<ul>
<li>若不需要修改则使用值，若需要修改则使用指针</li>
<li>若存在指针接收者，则所有方法使用指针接收者</li>
</ul>
<p>对于接收者为指针类型的方法，需要注意在运行时若接收者为 nil 会发生错误。</p>
<h3 id="匿名嵌入"><a href="#匿名嵌入" class="headerlink" title="匿名嵌入"></a>匿名嵌入</h3><p>若结构体匿名嵌入带有方法的结构体时，则在外部结构体可以调用嵌入结构体的方法</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	name <span class="token builtin">string</span>
	addr <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> user<span class="token punctuation">.</span>name
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">type</span> Employee <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
		<span class="token operator">*</span>User
		name  <span class="token builtin">string</span>
		title <span class="token builtin">string</span>
	<span class="token punctuation">&#125;</span>
	a <span class="token operator">:=</span> Employee<span class="token punctuation">&#123;</span>
		User<span class="token punctuation">:</span>  <span class="token operator">&amp;</span>User<span class="token punctuation">&#123;</span><span class="token string">"aaaaa"</span><span class="token punctuation">,</span> <span class="token string">"海淀"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		name<span class="token punctuation">:</span>  <span class="token string">"bbbbbbb"</span><span class="token punctuation">,</span>
		title<span class="token punctuation">:</span> <span class="token string">"运维工程师"</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>		<span class="token comment">// aaaaa  调用User.GetName</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><p>反射是指在运行时动态的访问和修改任意类型对象的结构和成员，在 go 语言中提供 reflect 包提供反射的功能，</p>
<p>每一个变量都有两个属性：类型（Type）和 值（Value）</p>
<h3 id="变量、interface-、reflect-Value-相互转换"><a href="#变量、interface-、reflect-Value-相互转换" class="headerlink" title="变量、interface{}、reflect.Value 相互转换"></a>变量、interface{}、reflect.Value 相互转换</h3><ul>
<li>interface{} -&gt; reflect.Value</li>
<li>reflect.Value -&gt; interface{}</li>
<li>interface{} -&gt; 原来的变量类型</li>
</ul>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>b <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// interface&#123;&#125; -> reflect.Value</span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T: %#v\n"</span><span class="token punctuation">,</span> rVal<span class="token punctuation">,</span> rVal<span class="token punctuation">)</span>
	<span class="token comment">// reflect.Value -> interface&#123;&#125;</span>
	iVal <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T: %#v\n"</span><span class="token punctuation">,</span> iVal<span class="token punctuation">,</span> iVal<span class="token punctuation">)</span>

    <span class="token comment">// interface&#123;&#125; -> 原来的变量类型</span>
	v <span class="token operator">:=</span> iVal<span class="token punctuation">.</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T: %#v\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="Go-Modules"><a href="#Go-Modules" class="headerlink" title="Go Modules"></a>Go Modules</h2><p>Go Modules 的出现就是为了淘汰 GOPATH</p>
<p>设置如下环境变量：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span>/data/go
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GO111MODULE</span><span class="token operator">=</span>on
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.cn,direct
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPRIVATE</span><span class="token operator">=</span>cctv.local</code></pre>

<p>最常用：<code>go mod tidy</code> 查缺补漏</p>
<h2 id="单元测试-amp-性能测试"><a href="#单元测试-amp-性能测试" class="headerlink" title="单元测试 &amp; 性能测试"></a>单元测试 &amp; 性能测试</h2><p>标准库 testing 可以单元测试和性能测试</p>
<h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-1 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.to2b.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.to2b.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.to2b.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.to2b.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
