<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="1openssl command [ command_opts ] [ command_args ]  两种运行模式：交互模式、批处理模式 直接输入 openssl 回车进入交互模式，输入带命令选项的 openssl 进入批处理模式。 OpenSSL 整个软件包大概可以分成三个主要的功能部分：密码算法库、SSL 协议库以及应用程序。OpenSSL 的目录结构自然也是围绕这三个功能部分进行规划的。">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenSSL命令">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/OpenSSL%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="1openssl command [ command_opts ] [ command_args ]  两种运行模式：交互模式、批处理模式 直接输入 openssl 回车进入交互模式，输入带命令选项的 openssl 进入批处理模式。 OpenSSL 整个软件包大概可以分成三个主要的功能部分：密码算法库、SSL 协议库以及应用程序。OpenSSL 的目录结构自然也是围绕这三个功能部分进行规划的。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1599473431892.png">
<meta property="article:published_time" content="2020-12-09T15:03:59.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.506Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="OpenSSL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1599473431892.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/OpenSSL%E5%91%BD%E4%BB%A4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/OpenSSL%E5%91%BD%E4%BB%A4/","path":"运维/基础/加密和安全/OpenSSL命令/","title":"OpenSSL命令"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OpenSSL命令 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#command"><span class="nav-number">1.</span> <span class="nav-text">command</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="nav-number">1.1.</span> <span class="nav-text">对称加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">摘要算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="nav-number">1.3.</span> <span class="nav-text">非对称加密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DH%EF%BC%88Diffie-Hellman%EF%BC%89"><span class="nav-number">1.3.1.</span> <span class="nav-text">DH（Diffie-Hellman）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DSA"><span class="nav-number">1.3.2.</span> <span class="nav-text">DSA</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RSA"><span class="nav-number">1.4.</span> <span class="nav-text">RSA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="nav-number">1.5.</span> <span class="nav-text">生成用户密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="nav-number">1.6.</span> <span class="nav-text">生成随机数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-CentOS8-%E4%B8%8A%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89-CA-%E5%92%8C%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%E9%A2%81%E5%8F%91"><span class="nav-number">1.7.</span> <span class="nav-text">在 CentOS8 上实现私有 CA 和证书申请颁发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89-CA"><span class="nav-number">1.7.1.</span> <span class="nav-text">1. 创建私有 CA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%94%B3%E8%AF%B7%E8%AF%81%E4%B9%A6%E5%B9%B6%E9%A2%81%E5%8F%91%E8%AF%81%E4%B9%A6"><span class="nav-number">1.7.2.</span> <span class="nav-text">2. 申请证书并颁发证书</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%AF%B4%E6%98%8E"><span class="nav-number">1.7.3.</span> <span class="nav-text">3. 说明</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CentOS7-%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="nav-number">1.8.</span> <span class="nav-text">CentOS7 创建自签名证书</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/OpenSSL%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="OpenSSL命令 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenSSL命令
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 23:03:59" itemprop="dateCreated datePublished" datetime="2020-12-09T23:03:59+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">加密和安全</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><img data-src="//img.to2b.cn/blog/ljk/1599473431892.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl <span class="built_in">command</span> [ command_opts ] [ command_args ]</span><br></pre></td></tr></table></figure>

<p>两种运行模式：交互模式、<strong>批处理模式</strong></p>
<p>直接输入 openssl 回车进入交互模式，输入带命令选项的 openssl 进入批处理模式。</p>
<p>OpenSSL 整个软件包大概可以分成三个主要的功能部分：<strong>密码算法库</strong>、<strong>SSL 协议库</strong>以及<strong>应用程序</strong>。OpenSSL 的目录结构自然也是围绕这三个功能部分进行规划的。</p>
<p>openssl 子命令分为三类：1、标准命令、2、消息摘要命令、3、加密命令</p>
<p>标准命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> list -commands</span><br><span class="line">asn1parse         ca                ciphers           cms</span><br><span class="line">crl               crl2pkcs7         dgst              dhparam</span><br><span class="line">dsa               dsaparam          ec                ecparam</span><br><span class="line">enc               engine            errstr            gendsa</span><br><span class="line">genpkey           genrsa            <span class="built_in">help</span>              list</span><br><span class="line">nseq              ocsp              passwd            pkcs12</span><br><span class="line">pkcs7             pkcs8             pkey              pkeyparam</span><br><span class="line">pkeyutl           prime             rand              <span class="built_in">rehash</span></span><br><span class="line">req               rsa               rsautl            s_client</span><br><span class="line">s_server          s_time            sess_id           smime</span><br><span class="line">speed             spkac             srp               storeutl</span><br><span class="line">ts                verify            version           x509</span><br></pre></td></tr></table></figure>

<p>消息摘要命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> list -digest-commands</span><br><span class="line">blake2b512        blake2s256        gost              md2</span><br><span class="line">md4               md5               rmd160            sha1</span><br><span class="line">sha224            sha256            sha3-224          sha3-256</span><br><span class="line">sha3-384          sha3-512          sha384            sha512</span><br><span class="line">sha512-224        sha512-256        shake128          shake256</span><br><span class="line">sm3</span><br></pre></td></tr></table></figure>

<p>加密命令：对称加密和 base64 编码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> list -cipher-commands</span><br><span class="line">aes-128-cbc       aes-128-ecb       aes-192-cbc       aes-192-ecb</span><br><span class="line">aes-256-cbc       aes-256-ecb       aria-128-cbc      aria-128-cfb</span><br><span class="line">aria-128-cfb1     aria-128-cfb8     aria-128-ctr      aria-128-ecb</span><br><span class="line">aria-128-ofb      aria-192-cbc      aria-192-cfb      aria-192-cfb1</span><br><span class="line">aria-192-cfb8     aria-192-ctr      aria-192-ecb      aria-192-ofb</span><br><span class="line">aria-256-cbc      aria-256-cfb      aria-256-cfb1     aria-256-cfb8</span><br><span class="line">aria-256-ctr      aria-256-ecb      aria-256-ofb      <span class="built_in">base64</span></span><br><span class="line">bf                bf-cbc            bf-cfb            bf-ecb</span><br><span class="line">bf-ofb            camellia-128-cbc  camellia-128-ecb  camellia-192-cbc</span><br><span class="line">camellia-192-ecb  camellia-256-cbc  camellia-256-ecb  cast</span><br><span class="line">cast-cbc          cast5-cbc         cast5-cfb         cast5-ecb</span><br><span class="line">cast5-ofb         des               des-cbc           des-cfb</span><br><span class="line">des-ecb           des-ede           des-ede-cbc       des-ede-cfb</span><br><span class="line">des-ede-ofb       des-ede3          des-ede3-cbc      des-ede3-cfb</span><br><span class="line">des-ede3-ofb      des-ofb           des3              desx</span><br><span class="line">idea              idea-cbc          idea-cfb          idea-ecb</span><br><span class="line">idea-ofb          rc2               rc2-40-cbc        rc2-64-cbc</span><br><span class="line">rc2-cbc           rc2-cfb           rc2-ecb           rc2-ofb</span><br><span class="line">rc4               rc4-40            rc5               rc5-cbc</span><br><span class="line">rc5-cfb           rc5-ecb           rc5-ofb           seed</span><br><span class="line">seed-cbc          seed-cfb          seed-ecb          seed-ofb</span><br><span class="line">zlib</span><br></pre></td></tr></table></figure>

<p>消息摘要命令和加密命令初学不推荐直接使用，推荐通过标准命令 dgst 和 enc 调用。</p>
<h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version  <span class="comment"># 查看版本信息</span></span><br><span class="line">enc      <span class="comment"># 对称加密</span></span><br><span class="line">dgst     <span class="comment"># 摘要</span></span><br><span class="line">dhparam  <span class="comment"># 生成DH参数文件</span></span><br><span class="line">dsaparam <span class="comment"># 生成DSA参数文件</span></span><br><span class="line">gendsa   <span class="comment"># 从DSA参数文件生成DSA私钥</span></span><br><span class="line">dsa      <span class="comment"># 管理DSA密钥，可以给解密加密的私钥，可以给私钥设置密码，还可以从DSA私钥中生成公钥</span></span><br><span class="line">passwd   <span class="comment"># 生成密码</span></span><br><span class="line">rand     <span class="comment"># 生成随机数</span></span><br><span class="line">ca       <span class="comment"># CA管理，例如对证书进行签名</span></span><br><span class="line">req      <span class="comment"># 主要用于创建和处理PKCS#10格式的证书请求，可以创建自签名证书</span></span><br><span class="line">x509     <span class="comment"># 显示证书信息、将证书转换为各种形式、签署类似“迷你CA”的证书请求或编辑证书信任设置</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://linux.51yip.com/search/openssl">http://linux.51yip.com/search/openssl</a></p>
<p><strong>1. 对称加密：</strong></p>
<blockquote>
<p>OpenSSL 一共提供了 8 种对称加密算法，DES 是最常用的。</p>
</blockquote>
<p><strong>2. 非对称加密：</strong></p>
<blockquote>
<p>OpenSSL 一共实现了 4 种非对称加密算法，包括 DH 算法、RSA 算法、DSA 算法和椭圆曲线算法（EC）。DH 算法一般用户密钥交换。RSA 算法既可以用于密钥交换，也可以用于数字签名，当然，如果你能够忍受其缓慢的速度，那么也可以用于数据加密。DSA 算法则一般只用于数字签名。</p>
</blockquote>
<p><strong>3. 信息摘要算法：</strong></p>
<blockquote>
<p>OpenSSL 实现了 5 种信息摘要算法，分别是 MD2、MD5、MDC2、SHA（SHA1）和 RIPEMD。SHA 算法事实上包括了 SHA 和 SHA1 两种信息摘要算法，此外，OpenSSL 还实现了 DSS 标准中规定的两种信息摘要算法 DSS 和 DSS1。</p>
</blockquote>
<p><strong>4. 密钥和证书管理：</strong></p>
<p>OpenSSL 为密钥和证书提供了丰富的功能，支持多种标准。</p>
<blockquote>
<p>首先，OpenSSL 实现了 ASN.1 的证书和密钥相关标准，提供了对证书、公钥、私钥、证书请求以及 CRL 等数据对象的 DER、PEM 和 BASE64 的编解码功能。OpenSSL 提供了产生各种公开密钥对和对称密钥的方法、函数和应用程序，同时提供了对公钥和私钥的 DER 编解码功能。并实现了私钥的 PKCS#12 和 PKCS#8 的编解码功能。OpenSSL 在标准中提供了对私钥的加密保护功能，使得密钥可以安全地进行存储和分发。</p>
<p>在此基础上，OpenSSL 实现了对证书的 X.509 标准编解码、PKCS#12 格式的编解码以及 PKCS#7 的编解码功能。并提供了一种文本数据库，支持证书的管理功能，包括证书密钥产生、请求产生、证书签发、吊销和验证等功能。</p>
<p><strong>事实上，OpenSSL 提供的 CA 应用程序就是一个小型的证书管理中心（CA），实现了证书签发的整个流程和证书管理的大部分机制。</strong></p>
</blockquote>
<h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p>openssl 提供了两种方式调用对称加密算法：</p>
<p>一种就是直接调用对称加密指令；一种是使用 enc，对称加密指令作为 enc 的参数。例如下面两种写法是完全一样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl des-cbc -<span class="keyword">in</span> plain.txt -out encrypt.txt -pass pass:12345678</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl enc -des-cbc -<span class="keyword">in</span> plain.txt -out encrypt.txt -pass pass:12345678</span><br></pre></td></tr></table></figure>

<p>初学推荐使用 enc，更宜读</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl enc [option]...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>-help</p>
</li>
<li><p>-ciphers：列出所有 enc 的对称加密算法 option，上面的示例中的 -des-cba 就在其中</p>
</li>
<li><p>-in file：从 file 中读取内容，默认是从标准输入中读取</p>
</li>
<li><p>-out file：输出到 file，默认是输出到标准输出</p>
</li>
<li><p>-pass arg：设置加密或解密密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密</span></span><br><span class="line">openssl enc -des3 -<span class="keyword">in</span> a.log -out b.bin -pass pass:123456</span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">openssl enc -des3 -d -<span class="keyword">in</span> b.bin -out b.log -pass pass:123456</span><br><span class="line"><span class="comment"># 命令行输入密码</span></span><br><span class="line">pass:123456</span><br><span class="line"><span class="comment"># 文件输入密码</span></span><br><span class="line">file:passwd.txt</span><br><span class="line"><span class="comment"># 环境变量输入密码</span></span><br><span class="line"><span class="built_in">export</span> passwd=123456</span><br><span class="line"><span class="built_in">env</span>:passwd</span><br><span class="line"><span class="comment"># 从文件描述符输入密码</span></span><br><span class="line">fd:1</span><br><span class="line"><span class="comment"># 从标准输入输入密码</span></span><br><span class="line"><span class="comment"># stdin</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>-e：加密，默认选项，可以省略</p>
</li>
<li><p>-d：解密</p>
</li>
<li><p>-a：base64 虽然不是加密，但是 enc 也支持了 base64 编码</p>
</li>
<li><p>-base64：同 -a</p>
</li>
<li><p>-A：如果设置了-a，则-A 让 base64 输出的结果不分行</p>
</li>
<li><p>-k：已淘汰</p>
</li>
<li><p>-md：指定 hash 算法，将 hash 处理后的 passwd 作为密码</p>
</li>
<li><p>-S：手动指定盐值</p>
</li>
</ul>
<h3 id="摘要算法"><a href="#摘要算法" class="headerlink" title="摘要算法"></a>摘要算法</h3><p>支持的摘要算法命令使用<code>openssl list -digest-commands</code>查看，可以作为 openssl 的子命令直接调用，也可以作为 dgst 的<strong>短选项</strong>调用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> list -digest-commands</span><br><span class="line">blake2b512        blake2s256        gost              md2</span><br><span class="line">md4               md5               rmd160            sha1</span><br><span class="line">sha224            sha256            sha3-224          sha3-256</span><br><span class="line">sha3-384          sha3-512          sha384            sha512</span><br><span class="line">sha512-224        sha512-256        shake128          shake256</span><br><span class="line">sm3</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dgst [options] [file...]</span><br></pre></td></tr></table></figure>

<p>file…：files to digest (default is stdin)</p>
<ul>
<li>-help Display this summary</li>
<li>-c 输出的摘要信息以分号隔离，和-hex 同时使用</li>
<li>-out outfile 指定输出文件，默认标准输出</li>
<li>-、、、</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准输入 生成摘要</span></span><br><span class="line">[root@centos8 data]<span class="variable">$echo</span> &#123;0..10&#125; | openssl md5</span><br><span class="line">(stdin)= da0feb828a99053332f6d08e0a58f33e</span><br><span class="line">[root@centos8 data]<span class="variable">$echo</span> &#123;0..10&#125; | openssl dgst -md5</span><br><span class="line">(stdin)= da0feb828a99053332f6d08e0a58f33e</span><br><span class="line"><span class="comment"># 文件内容 生成摘要</span></span><br><span class="line">[root@centos8 data]<span class="variable">$echo</span> &#123;0..10&#125; &gt; a.log</span><br><span class="line">[root@centos8 data]<span class="variable">$openssl</span> dgst -md5 ./a.log</span><br><span class="line">MD5(./a.log)= da0feb828a99053332f6d08e0a58f33e</span><br><span class="line">[root@centos8 data]<span class="variable">$openssl</span> dgst -out a.md5 -md5 ./a.log</span><br><span class="line">[root@centos8 data]<span class="variable">$cat</span> a.md5</span><br><span class="line">MD5(./a.log)= da0feb828a99053332f6d08e0a58f33e</span><br></pre></td></tr></table></figure>

<p>补充：coreutils 包提供了很多核心工具，例如 cat、cp、ls 等等，其中也有摘要算法相关的工具：md5sum，sha1sum，sha224sum，sha256sum ，sha384sum，sha512sum 等，以 md5 为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">md5sum</span> [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>非对称加密相关命令都是 openssl 的标准命令，没有额外再单独设置一个命令管理它们。</p>
<ul>
<li>dhparam：生成 DH 参数文件</li>
<li>dsaparam：生成 DSA 参数文件</li>
<li>gendsa：从 DSA 参数文件生成 DSA 私钥</li>
<li>dsa：管理 DSA 密钥，可以给解密加密的私钥，可以给私钥设置密码，还可以从 DSA 私钥中生成公钥</li>
<li>genrsa：生成 RSA 私钥</li>
<li>rsa：管理 RSA 密钥</li>
</ul>
<h4 id="DH（Diffie-Hellman）"><a href="#DH（Diffie-Hellman）" class="headerlink" title="DH（Diffie-Hellman）"></a>DH（Diffie-Hellman）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用生成因子2和随机的1024-bit的素数产生D0ffie-Hellman参数</span></span><br><span class="line"><span class="comment"># 输出保存到文件dhparam.pem</span></span><br><span class="line">openssl dhparam -out dhparam.pem -2 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从dhparam.pem中读取Diffie-Hell参数，以C代码的形式</span></span><br><span class="line"><span class="comment"># 输出到stdout</span></span><br><span class="line">penssl dhparam -<span class="keyword">in</span> dhparam.pem -noout -C</span><br></pre></td></tr></table></figure>

<h4 id="DSA"><a href="#DSA" class="headerlink" title="DSA"></a>DSA</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成1024位DSA参数集，并输出到文件dsaparam.pem</span></span><br><span class="line">openssl dsaparam -out dsaparam.pem 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用参数文件dsaparam.pem生成DSA私钥匙，</span></span><br><span class="line"><span class="comment"># 采用3DES加密后输出到文件dsaprivatekey.pem</span></span><br><span class="line">openssl gendsa -out dsaprivatekey.pem -des3 dsaparam.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用私钥匙dsaprivatekey.pem生成公钥匙，</span></span><br><span class="line"><span class="comment"># 输出到dsapublickey.pem</span></span><br><span class="line">openssl dsa -<span class="keyword">in</span> dsaprivatekey.pem -pubout -out dsapublickey.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从dsaprivatekey.pem中读取私钥匙，解密并输入新口令进行加密，</span></span><br><span class="line"><span class="comment"># 然后写回文件dsaprivatekey.pem</span></span><br><span class="line">openssl dsa -<span class="keyword">in</span> dsaprivatekey.pem -out dsaprivatekey.pem -des3 -passin</span><br></pre></td></tr></table></figure>

<h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>生成私钥，并 3des 加密：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> genrsa -out rsa.key -des3 1024</span><br><span class="line">Generating RSA private key, 1024 bit long modulus (2 primes)</span><br><span class="line">...............+++++</span><br><span class="line">............+++++</span><br><span class="line">e is 65537 (0x010001)</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> rsa.key:</span><br><span class="line">Verifying - Enter pass phrase <span class="keyword">for</span> rsa.key:</span><br><span class="line">[root@centos8 data]<span class="variable">$cat</span> rsa.key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: DES-EDE3-CBC,B81F9992681E3346</span><br><span class="line"></span><br><span class="line">fi2XSHajJUAhKHNeUFB+nJqog0R8qiBfQ3yEljQHadyq7U7P+7evDV9JQxpwtDC1</span><br><span class="line">gZ3BpjY1+4NmN1lXbzoADLwx/tRIgHqQXgkIgY/tSeKTOtaaFbRsg7DZXjcq3YMX</span><br><span class="line">seo8DoZEbyyzAVIYVdR/Z40niYNoaEWiXiwzT8Wz11BORftqJER+07s2NRDSpQNj</span><br><span class="line">8Q7R9L6uT+RWnde5IeCZjZ9X9cj9ZBlMw1trKpiwbqTeq1YtRHcpKLSyg69f5ERy</span><br><span class="line">sW9qaf00qNHR6LTHL3Hgw+EBo9JYmspflvhGWO0QmWKNbBLnjEGS6QgbxgxQT0mP</span><br><span class="line">d0Imwn/3Xit8c/ACdoHZiqwYkzrreR9K7CHD2USiMlun08vcWyal3EzPOAfshZWq</span><br><span class="line">g6MXdLSs3nOA03dkP4mjjb3iCca8xxSFKQPWb3viZzg14gWRAlVo1Fp9+0d+U1An</span><br><span class="line">hHpqX/64MiPZakRPyGfPA6uycJgxIxKzhnam/mKSAFkQoxt61zKst9JFKWwCnEAv</span><br><span class="line">ucKZXIGPJGsMW5bXkVFdMdnx3iUZDHFBQmFLuA5+w8CQTBw3wLY1PKfvtpoLY2S3</span><br><span class="line">qP9xnqqjPzg+RzBgNvWPIQ+y5SECZq5CdnGK/vLrysUBy3eUdfgiyZ5h7i2Bugnu</span><br><span class="line">wieFH5FvaGHAljN6tcGo4xPjfPb+SEujkl+Ot6R1lCzHXvEgvaCBVBN5qx5rFH9H</span><br><span class="line">CQ8ZeIKjs/jscCvgMhqhzRfOkhzvKruShQ1G3t1prvZ5JNZCy0ePkh/g9PMxIaVv</span><br><span class="line">DIZbEiA+Yy5NrXmkCxHmVIACg4mxetPJCtg7yTG4P/dQKE/3PPLwZA==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>解密私钥：</p>
<p>不需要指定加密用的算法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> rsa -<span class="keyword">in</span> rsa.key</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> rsa.key:</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXAIBAAKBgQC3SFoUHD+Jk8dt2l7MWqDvhDUF/jMlzCMs2VhnWytPdWWjTHeO</span><br><span class="line">zNj0rt6L8uMq45C3CmTzaBz6v6fdAH5RKLkv78ZqjhxfRwIgRtUCRCa+b+lqq0qc</span><br><span class="line">9paKTFl+gAnSAkx0ua90XAx65DAs9XpL5HkGHI7Jj7Cb0ERluZNV0Sv8YwIDAQAB</span><br><span class="line">AoGAfB61UfUnWiYH4m8Fz+J4Jnwj5GEXhjtOfurZoXTuSas5H3ODa+Nx8ZITCDd+</span><br><span class="line">e+cMc8jIQMZ7CZyNM29IG/I2JgkXEk6apyLy7UAiQF0CbYljLOy7qBkrcYCo2RBa</span><br><span class="line">IGUoTX7RJwC+3Dxa3/12Tx4ufqZ5/+RAJoqqV90rx8EFLnECQQDat+/KaEte9xJ0</span><br><span class="line">+NgmOGna68p4B1zNR/LQ5/n3yEweBLaseOke2o3BnsIAcL5LLNC5d3jun9UWyl2R</span><br><span class="line">Xtflcly/AkEA1oYgAs//M4M/o3bZxYBaQkWiC+u+YsKMwMA+DPYs/H2fzwprP+4N</span><br><span class="line">mjoKYrjL214nchuDE1fM1YErcvkn5AN1XQJBAJCDVBbizloS2ckb2oV2ZMrXXNHt</span><br><span class="line">221vioppnAoR9+klqCVRRoayVVOHOBveYn19QPQqcmcIiF0knKo+hlv+MjUCQDw/</span><br><span class="line">syHXFM983xSjvomvgKn4MIi0juXhyfIgi8zMHtpS1d0qCfEMhJl6D4ymZeqYSO/N</span><br><span class="line">NkTqdcbI3lEOFNv+9KkCQHGLnBuVcZ6IaneTIl6Dj5fuSH4JcTgWpeXJNbfWO+iR</span><br><span class="line">7bpy5LnVqTM2rrvEjAdhMOD5xLbaxwRxSAMnG9lDyD8=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>从私钥中生成公钥：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> rsa -<span class="keyword">in</span> rsa.key -pubout -out rsa.key.pub</span><br><span class="line">Enter pass phrase <span class="keyword">for</span> rsa.key:</span><br><span class="line">writing RSA key</span><br><span class="line">[root@centos8 data]<span class="variable">$cat</span> rsa.key.pub</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3SFoUHD+Jk8dt2l7MWqDvhDUF</span><br><span class="line">/jMlzCMs2VhnWytPdWWjTHeOzNj0rt6L8uMq45C3CmTzaBz6v6fdAH5RKLkv78Zq</span><br><span class="line">jhxfRwIgRtUCRCa+b+lqq0qc9paKTFl+gAnSAkx0ua90XAx65DAs9XpL5HkGHI7J</span><br><span class="line">j7Cb0ERluZNV0Sv8YwIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>

<h3 id="生成用户密码"><a href="#生成用户密码" class="headerlink" title="生成用户密码"></a>生成用户密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd [options] &#123;passwords&#125;</span><br></pre></td></tr></table></figure>

<p>默认使用 标准 Unix 密码算法 生成密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> passwd 123456</span><br><span class="line">pPVKzob9muWhI</span><br><span class="line">[root@centos8 data]<span class="variable">$openssl</span> passwd 123456</span><br><span class="line">RGMogKjCYuqRo</span><br><span class="line">[root@centos8 data]<span class="variable">$openssl</span> passwd 123456 admin</span><br><span class="line">RmxJ4CJbLmGUs</span><br><span class="line">ziknRF1V5vFSs</span><br></pre></td></tr></table></figure>

<p><strong>options：</strong></p>
<ul>
<li>-in file：从文件中读入密码，默认交互式输入</li>
<li>-stdin：从标准输入读取密码，默认交互式输入</li>
<li>-salt val：加盐，指定盐值</li>
<li>-6：SHA512</li>
<li>-5：SHA256</li>
<li>-1：MD5</li>
<li>-、、、</li>
</ul>
<h3 id="生成随机数"><a href="#生成随机数" class="headerlink" title="生成随机数"></a>生成随机数</h3><p>&#x2F;dev&#x2F;random 和&#x2F;dev&#x2F;urandom 根据硬件信息生成随机数，是伪随机数生成器，openssl rand 是真随机数生成器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rand [options] num</span><br></pre></td></tr></table></figure>

<p>num：指定随机数的字节数。</p>
<p><strong>options：</strong></p>
<ul>
<li>-out file：将输出的随机数写入到文件</li>
<li>-base64：将输出的随机数转成 base64 格式</li>
<li>-hex：将输出的随机数转成 16 进制格式</li>
</ul>
<p>范例：生成 10 位随机数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#openssl rand -hex 5</span></span><br><span class="line">2ce882e4e7</span><br><span class="line">[root@centos7 ~]<span class="comment">#openssl rand -base64 9 |head -c10</span></span><br><span class="line">7yTjuE+FAC</span><br></pre></td></tr></table></figure>

<h3 id="在-CentOS8-上实现私有-CA-和证书申请颁发"><a href="#在-CentOS8-上实现私有-CA-和证书申请颁发" class="headerlink" title="在 CentOS8 上实现私有 CA 和证书申请颁发"></a>在 CentOS8 上实现私有 CA 和证书申请颁发</h3><p>相关文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 tls]<span class="variable">$rpm</span> -ql openssl-libs</span><br><span class="line">/etc/pki/tls</span><br><span class="line">/etc/pki/tls/certs</span><br><span class="line">/etc/pki/tls/ct_log_list.cnf</span><br><span class="line">/etc/pki/tls/misc</span><br><span class="line">/etc/pki/tls/openssl.cnf <span class="comment"># 配置文件</span></span><br><span class="line">/etc/pki/tls/private</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 私有CA 目录</span></span><br><span class="line"></span><br><span class="line">./demoCA                       - main CA directory</span><br><span class="line">./demoCA/cacert.pem            - 证书，也就是自签名公钥</span><br><span class="line">./demoCA/private/cakey.pem     - 自签名私钥</span><br><span class="line">./demoCA/serial                - CA serial number file</span><br><span class="line">./demoCA/serial.old            - CA serial number backup file</span><br><span class="line">./demoCA/index.txt             - 数据库文件</span><br><span class="line">./demoCA/index.txt.old         - CA text database backup file</span><br><span class="line">./demoCA/certs                 - 颁发的证书存放目录</span><br><span class="line">./demoCA/.rnd                  - CA random seed information</span><br></pre></td></tr></table></figure>

<h4 id="1-创建私有-CA"><a href="#1-创建私有-CA" class="headerlink" title="1. 创建私有 CA"></a>1. 创建私有 CA</h4><p>私有 CA 的目录位置在 openssl.conf 中可以更改，默认设置如下，我们就不改了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[ CA_default ]</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>             = /etc/pki/CA           <span class="comment"># Where everything is kept</span></span><br><span class="line">certs           = <span class="variable">$dir</span>/certs            <span class="comment"># Where the issued certs are kept</span></span><br><span class="line">crl_dir         = <span class="variable">$dir</span>/crl              <span class="comment"># Where the issued crl are kept</span></span><br><span class="line">database        = <span class="variable">$dir</span>/index.txt        <span class="comment"># database index file.</span></span><br><span class="line"><span class="comment">#unique_subject = no                    # Set to &#x27;no&#x27; to allow creation of</span></span><br><span class="line">                                        <span class="comment"># several certs with same subject.</span></span><br><span class="line">new_certs_dir   = <span class="variable">$dir</span>/newcerts         <span class="comment"># default place for new certs.</span></span><br><span class="line"></span><br><span class="line">certificate     = <span class="variable">$dir</span>/cacert.pem       <span class="comment"># The CA certificate</span></span><br><span class="line">serial          = <span class="variable">$dir</span>/serial           <span class="comment"># The current serial number</span></span><br><span class="line">crlnumber       = <span class="variable">$dir</span>/crlnumber        <span class="comment"># the current crl number</span></span><br><span class="line">                                        <span class="comment"># must be commented out to leave a V1 CRL</span></span><br><span class="line">crl             = <span class="variable">$dir</span>/crl.pem          <span class="comment"># The current CRL</span></span><br><span class="line">private_key     = <span class="variable">$dir</span>/private/cakey.pem<span class="comment"># The private key</span></span><br></pre></td></tr></table></figure>

<ol>
<li>按照 openssl.conf 中的设置，创建私有 CA 目录及相关文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="variable">$mkdir</span> /etc/pki/CA</span><br><span class="line">[root@centos8 ~]<span class="variable">$cd</span> /etc/pki/CA</span><br><span class="line">[root@centos8 CA]<span class="variable">$mkdir</span> certs crl newcerts private</span><br><span class="line">[root@centos8 CA]<span class="variable">$touch</span> index.txt</span><br><span class="line">[root@centos8 CA]<span class="variable">$echo</span> 01 &gt; serial <span class="comment"># 指定第一个颁发证书的序列号</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>生成私钥，这里选择 RSA 私钥，比较简单</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 CA]<span class="variable">$openssl</span> genrsa -out private/cakey.pem 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus (2 primes)</span><br><span class="line">.......................+++++</span><br><span class="line">..................+++++</span><br><span class="line">e is 65537 (0x010001)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>生成 CA 自签名证书</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 CA]<span class="variable">$openssl</span> req -new -x509 -key private/cakey.pem -days 3650 -out cacert.pem</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:henan</span><br><span class="line">Locality Name (eg, city) [Default City]:</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:ljk</span></span><br><span class="line"><span class="string">Email Address []:ljk@qq.com</span></span><br><span class="line"><span class="string">[root@centos8 CA]$</span></span><br><span class="line"><span class="string">[root@centos8 CA]$openssl x509 -noout -in cacert.pem -text</span></span><br><span class="line"><span class="string">Certificate:</span></span><br><span class="line"><span class="string">    Data:</span></span><br><span class="line"><span class="string">        Version: 3 (0x2)</span></span><br><span class="line"><span class="string">        Serial Number:</span></span><br><span class="line"><span class="string">            26:c2:97:d3:b0:0e:f4:8d:d7:3e:1c:a1:e2:95:08:31:20:aa:f1:b7</span></span><br><span class="line"><span class="string">        Signature Algorithm: sha256WithRSAEncryption</span></span><br><span class="line"><span class="string">        Issuer: C = CN, ST = henan, L = Default City, O = Default Company Ltd, CN = ljk, emailAddress = ljk@qq.com</span></span><br><span class="line"><span class="string">        Validity</span></span><br><span class="line"><span class="string">            Not Before: Sep  8 08:17:04 2020 GMT</span></span><br><span class="line"><span class="string">            Not After : Sep  6 08:17:04 2030 GMT</span></span><br><span class="line"><span class="string">        Subject: C = CN, ST = henan, L = Default City, O = Default Company Ltd, CN = ljk, emailAddress = ljk@qq.com</span></span><br><span class="line"><span class="string">        Subject Public Key Info:</span></span><br><span class="line"><span class="string">            Public Key Algorithm: rsaEncryption</span></span><br><span class="line"><span class="string">                RSA Public-Key: (2048 bit)</span></span><br><span class="line"><span class="string">                Modulus:</span></span><br><span class="line"><span class="string">                    00:bc:30:93:e4:81:8f:aa:ed:c7:27:c3:66:6b:17:</span></span><br><span class="line"><span class="string">                    7d:f2:40:f2:1c:5e:12:86:89:5a:ca:e1:d2:6d:61:</span></span><br><span class="line"><span class="string">                    fa:3c:0e:36:d6:88:bc:c3:1c:e9:a3:a4:f7:28:14:</span></span><br><span class="line"><span class="string">                    4b:7f:5a:48:e0:1f:3e:3a:dc:45:12:27:a9:ef:94:</span></span><br><span class="line"><span class="string">                    51:95:1b:84:79:ae:6b:11:3d:77:92:a4:72:ee:4a:</span></span><br><span class="line"><span class="string">                    47:c9:c6:13:84:03:f7:be:48:48:8d:ac:d4:b5:7b:</span></span><br><span class="line"><span class="string">                    fd:36:04:6a:90:22:6f:5d:06:cc:52:c6:21:a2:0f:</span></span><br><span class="line"><span class="string">                    48:fb:d1:cb:5b:66:f7:05:e5:35:10:14:6a:07:bc:</span></span><br><span class="line"><span class="string">                    35:66:fd:d9:c4:30:35:91:bb:ca:6c:bb:77:79:4d:</span></span><br><span class="line"><span class="string">                    e2:9e:03:71:72:e4:bd:7b:cf:2e:96:30:0e:7e:2d:</span></span><br><span class="line"><span class="string">                    10:c4:5a:b3:66:03:7a:68:95:78:e1:31:28:86:35:</span></span><br><span class="line"><span class="string">                    43:f6:be:7c:b8:d2:36:8f:ed:d0:0e:0a:98:49:59:</span></span><br><span class="line"><span class="string">                    63:42:45:70:f2:a1:8d:30:b9:6b:6f:b2:49:c9:e2:</span></span><br><span class="line"><span class="string">                    ae:0c:08:b2:47:bf:48:c7:be:d6:e8:26:8c:21:07:</span></span><br><span class="line"><span class="string">                    e4:a9:16:e9:f1:c6:30:e0:41:de:3c:d8:81:fd:fe:</span></span><br><span class="line"><span class="string">                    86:b2:6f:b1:04:35:73:ac:67:36:a8:39:ee:ff:15:</span></span><br><span class="line"><span class="string">                    6b:4c:30:7e:6f:dd:9e:02:16:af:ae:46:e1:5c:e9:</span></span><br><span class="line"><span class="string">                    b1:e5</span></span><br><span class="line"><span class="string">                Exponent: 65537 (0x10001)</span></span><br><span class="line"><span class="string">        X509v3 extensions:</span></span><br><span class="line"><span class="string">            X509v3 Subject Key Identifier:</span></span><br><span class="line"><span class="string">                62:CE:34:13:29:DA:F0:67:D8:CB:8D:6C:90:1A:3C:C8:E5:15:4D:D9</span></span><br><span class="line"><span class="string">            X509v3 Authority Key Identifier:</span></span><br><span class="line"><span class="string">                keyid:62:CE:34:13:29:DA:F0:67:D8:CB:8D:6C:90:1A:3C:C8:E5:15:4D:D9</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            X509v3 Basic Constraints: critical</span></span><br><span class="line"><span class="string">                CA:TRUE</span></span><br><span class="line"><span class="string">    Signature Algorithm: sha256WithRSAEncryption</span></span><br><span class="line"><span class="string">         4c:87:4d:25:3f:3d:5f:b9:9e:b1:35:2f:7e:be:26:da:6b:e0:</span></span><br><span class="line"><span class="string">         4a:77:56:79:80:9e:a7:8b:80:02:71:75:1c:12:28:e7:73:49:</span></span><br><span class="line"><span class="string">         c8:b4:44:41:3f:1a:b4:b6:db:8e:33:8e:29:8f:01:2f:9e:dc:</span></span><br><span class="line"><span class="string">         34:1c:45:78:a2:8c:82:25:9e:da:5f:69:fb:3c:15:98:db:36:</span></span><br><span class="line"><span class="string">         d7:a7:41:09:bc:b0:36:b7:ae:77:10:7a:7a:0e:00:ed:cd:22:</span></span><br><span class="line"><span class="string">         28:99:d3:a1:28:47:cd:6a:01:88:e5:d4:cc:42:be:d5:2a:16:</span></span><br><span class="line"><span class="string">         72:af:44:d8:b0:b9:83:99:e9:f3:08:c1:ea:f6:b1:11:ee:51:</span></span><br><span class="line"><span class="string">         d7:83:b8:1e:7c:45:47:25:0d:bc:5e:9d:78:cc:c1:26:0c:33:</span></span><br><span class="line"><span class="string">         5b:78:e5:1a:5f:31:79:11:54:a7:42:3a:dc:ed:43:66:b5:6c:</span></span><br><span class="line"><span class="string">         e1:f5:61:82:d5:92:19:f6:6c:e8:20:01:b4:0a:07:9f:5b:63:</span></span><br><span class="line"><span class="string">         1e:29:49:f0:58:4a:ed:ef:1a:67:a3:f1:ec:e3:e6:b3:50:3a:</span></span><br><span class="line"><span class="string">         c4:5b:ef:23:55:13:69:0a:ac:42:77:22:4b:0b:34:c1:f4:e9:</span></span><br><span class="line"><span class="string">         80:89:ff:ff:43:af:84:4e:a7:ef:f0:28:7a:14:c0:ce:f9:4b:</span></span><br><span class="line"><span class="string">         aa:db:29:4b:fb:5c:ac:bf:c9:5f:ce:cd:45:62:dc:6e:18:a0:</span></span><br><span class="line"><span class="string">         cc:f5:07:e9</span></span><br><span class="line"><span class="string">[root@centos8 CA]$</span></span><br><span class="line"><span class="string">[root@centos8 CA]$tree</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">├── cacert.pem</span></span><br><span class="line"><span class="string">├── certs</span></span><br><span class="line"><span class="string">├── crl</span></span><br><span class="line"><span class="string">├── index.txt</span></span><br><span class="line"><span class="string">├── newcerts</span></span><br><span class="line"><span class="string">├── private</span></span><br><span class="line"><span class="string">│   └── cakey.pem</span></span><br><span class="line"><span class="string">└── serial</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4 directories, 4 files</span></span><br></pre></td></tr></table></figure>

<p><strong>req</strong>：主要用于创建和处理 PKCS#10 格式的证书请求，可以创建自签名证书</p>
<ul>
<li>-new：生成新证书签署请求</li>
<li>-x509：专用于 CA 生成自签证书</li>
<li>-key：生成请求时用到的私钥文件</li>
<li>-days n：证书的有效期限</li>
<li>-out &#x2F;PATH&#x2F;TO&#x2F;SOMECERTFILE: 证书的保存路径</li>
<li>-key val：指定已有的秘钥文件生成秘钥请求，只与-new 配合</li>
<li>-newkey：与 <code>-key</code> 互斥，在生成证书请求或者自签名证书的时候自动生成密钥，生成的密钥名称由 <code>-keyout</code> 参数指定。当指定<code>-newkey</code> 选项时，后面指定 <code>rsa:bits</code> 说明产生 <code>rsa</code> 密钥，位数由 <code>bits</code> 指定。 <strong>如果没有指定选项<code>-key</code> 和<code>-newkey</code>，默认<code>-newkey</code></strong></li>
<li>-nodes：如果指定 <code>-newkey</code>，那么 <code>-nodes</code> 选项说明生成的秘钥不需要加密</li>
</ul>
<p><strong>x509</strong>：显示证书信息、将证书转换为各种形式、签署类似“迷你 CA”的证书请求或编辑证书信任设置</p>
<h4 id="2-申请证书并颁发证书"><a href="#2-申请证书并颁发证书" class="headerlink" title="2. 申请证书并颁发证书"></a>2. 申请证书并颁发证书</h4><ol>
<li>申请证书，就是申请一个认证过的公钥，首先生成私钥</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> genrsa -out test.key 2048</span><br><span class="line">Generating RSA private key, 2048 bit long modulus (2 primes)</span><br><span class="line">.............................................................................................+++++</span><br><span class="line">........................................................................................................+++++</span><br><span class="line">e is 65537 (0x010001)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用私钥生成证书申请文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> req -new -key ./test.key -out ./test.csr</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:henan</span><br><span class="line">Locality Name (eg, city) [Default City]:</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:ljk</span></span><br><span class="line"><span class="string">Email Address []:ljk@qq.com</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please enter the following &#x27;</span>extra<span class="string">&#x27; attributes</span></span><br><span class="line"><span class="string">to be sent with your certificate request</span></span><br><span class="line"><span class="string">A challenge password []:123456</span></span><br><span class="line"><span class="string">An optional company name []:ljk</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>三种策略：默认是 match</p>
<ul>
<li>match：要求申请填写的信息跟 CA 设置信息必须一致，</li>
<li>optional：可有可无，跟 CA 设置信息可不一致</li>
<li>supplied：必须填写这项申请信息</li>
</ul>
<ol start="3">
<li>CA 签署证书</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 data]<span class="variable">$openssl</span> ca -<span class="keyword">in</span> ./test.csr -out /etc/pki/CA/certs/test.pem -days 100</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>吊销证书</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看serial与subject信息，对比检验是否与index.txt文件中的信息一致，一致则删除</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> x509 -<span class="keyword">in</span> ./test.crt -noout -serial -subject</span><br><span class="line">serial=01</span><br><span class="line">subject=C = CN, ST = henan, O = Default Company Ltd, CN = ljk, emailAddress = ljk@qq.com</span><br><span class="line">[root@centos8 certs]$</span><br><span class="line">[root@centos8 certs]<span class="variable">$cat</span> ../index.txt</span><br><span class="line">V       201217092506Z           01      unknown /C=CN/ST=henan/O=Default Company Ltd/CN=ljk/emailAddress=ljk@qq.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 吊销之前，查看一下状态</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> ca -status 1</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">01=Valid (V)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 吊销，注意目录</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> ca -revoke ../newcerts/01.pem</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Revoking Certificate 01.</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line"><span class="comment"># 吊销之后，再看一下状态</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> ca -status 1</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">01=Revoked (R)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定第一个吊销证书的编号,注意：第一次更新证书吊销列表前，才需要执行</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$echo</span> 01 &gt; /etc/pki/CA/crlnumber</span><br><span class="line"><span class="comment"># 更新证书吊销列表</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> ca -gencrl -out /etc/pki/CA/crl.pem</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看crl文件</span></span><br><span class="line">[root@centos8 certs]<span class="variable">$openssl</span> crl -<span class="keyword">in</span> /etc/pki/CA/crl.pem -noout -text</span><br><span class="line">Certificate Revocation List (CRL):</span><br><span class="line">        Version 2 (0x1)</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C = CN, ST = henan, L = Default City, O = Default Company Ltd, CN = ljk, emailAddress = ljk@qq.com</span><br><span class="line">        Last Update: Sep  8 09:39:42 2020 GMT</span><br><span class="line">        Next Update: Oct  8 09:39:42 2020 GMT</span><br><span class="line">        CRL extensions:</span><br><span class="line">            X509v3 CRL Number:</span><br><span class="line">                1</span><br><span class="line">Revoked Certificates:</span><br><span class="line">    Serial Number: 01</span><br><span class="line">        Revocation Date: Sep  8 09:35:55 2020 GMT</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         09:a1:00:89:ed:5a:4d:71:3d:39:f0:34:72:7a:<span class="built_in">df</span>:49:91:a1:</span><br><span class="line">         82:86:4f:76:7f:f9:b9:54:13:b1:b5:05:18:aa:4b:88:28:33:</span><br><span class="line">         7a:cf:0e:e5:ff:e4:41:36:33:62:95:82:20:aa:de:1e:76:f5:</span><br><span class="line">         61:10:11:d7:1e:da:19:2e:cc:b5:3a:96:17:4d:98:b2:f3:23:</span><br><span class="line">         78:1a:af:20:7b:e9:f9:eb:3a:a7:b5:58:46:67:c1:60:8c:e6:</span><br><span class="line">         2f:79:3b:16:24:f6:09:<span class="built_in">fc</span>:09:12:96:de:60:09:2e:78:60:e4:</span><br><span class="line">         18:1a:36:aa:b2:eb:a1:31:23:7c:33:9a:dc:59:7c:b0:<span class="built_in">dd</span>:a6:</span><br><span class="line">         fa:a6:72:23:9b:35:b7:4e:d3:98:44:49:44:66:9c:d4:82:56:</span><br><span class="line">         07:0d:23:da:1e:62:3e:6e:87:de:9e:6e:88:0f:0d:e7:50:3f:</span><br><span class="line">         67:9f:3f:86:89:c3:6a:bc:b8:bc:89:c4:8e:e8:d6:7b:12:81:</span><br><span class="line">         7f:85:07:3b:e0:34:d7:29:fd:67:fb:cb:7f:f3:51:f2:3f:a4:</span><br><span class="line">         68:ce:e2:f1:3c:c2:49:fd:72:e0:27:f5:e6:23:e8:ae:a6:8f:</span><br><span class="line">         b4:ba:eb:bc:1b:c3:4b:<span class="built_in">dd</span>:1b:9e:39:5e:a8:ed:87:1d:5b:9f:</span><br><span class="line">         ef:42:02:68:2a:b4:c3:2d:31:24:3c:85:e7:d7:66:40:e2:07:</span><br><span class="line">         2e:61:77:0f</span><br></pre></td></tr></table></figure>

<h4 id="3-说明"><a href="#3-说明" class="headerlink" title="3. 说明"></a>3. 说明</h4><p>以上是常规的步骤，为了方便，还有其他简单的操作，例如在一个目录中创建 CA，并给 harbor 主机颁发证书，只需要三步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@u1:~$ <span class="built_in">mkdir</span> -p /usr/local/harbor/certs</span><br><span class="line">root@u1:~$ <span class="built_in">cd</span> /usr/local/harbor/certs</span><br><span class="line">root@u1:/usr/local/harbor/certs$</span><br><span class="line"><span class="comment"># 1. 创建私有CA</span></span><br><span class="line">root@u1:/usr/local/harbor/certs$ openssl req \</span><br><span class="line">-newkey rsa:1024 -nodes -sha256 -keyout ca.key -x509 -subj <span class="string">&quot;/CN=ca.ljk.org&quot;</span> -days 3650 -out ca.crt</span><br><span class="line">Generating a RSA private key</span><br><span class="line">..............+++++</span><br><span class="line">...................................+++++</span><br><span class="line">writing new private key to <span class="string">&#x27;ca.key&#x27;</span></span><br><span class="line">-----</span><br><span class="line">root@u1:/usr/local/harbor/certs$ <span class="built_in">ls</span></span><br><span class="line">ca.crt  ca.key</span><br><span class="line"><span class="comment"># 2. 生成harbor主机的证书申请</span></span><br><span class="line">root@u1:/usr/local/harbor/certs$ openssl req \</span><br><span class="line">-newkey rsa:1024 -nodes -sha256 -subj <span class="string">&quot;/CN=harbor.ljk.org&quot;</span> -keyout harbor.ljk.org.key -out harbor.ljk.org.csr</span><br><span class="line">Generating a RSA private key</span><br><span class="line">.....................................................................+++++</span><br><span class="line">..........+++++</span><br><span class="line">writing new private key to <span class="string">&#x27;harbor.ljk.org.key&#x27;</span></span><br><span class="line">-----</span><br><span class="line">root@u1:/usr/local/harbor/certs$ <span class="built_in">ls</span></span><br><span class="line">ca.crt  ca.key  harbor.ljk.org.csr  harbor.ljk.org.key</span><br><span class="line"><span class="comment"># 3. 给harbor主机颁发证书</span></span><br><span class="line">root@u1:/usr/local/harbor/certs$ openssl x509 -req -<span class="keyword">in</span> harbor.ljk.org.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out harbor.ljk.org.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=CN = harbor.ljk.org</span><br><span class="line">Getting CA Private Key</span><br><span class="line">root@u1:/usr/local/harbor/certs$ tree</span><br><span class="line">.</span><br><span class="line">├── ca.crt</span><br><span class="line">├── ca.key</span><br><span class="line">├── ca.srl</span><br><span class="line">├── harbor.ljk.org.crt</span><br><span class="line">├── harbor.ljk.org.csr</span><br><span class="line">└── harbor.ljk.org.key</span><br><span class="line"></span><br><span class="line">0 directories, 6 files</span><br></pre></td></tr></table></figure>

<h3 id="CentOS7-创建自签名证书"><a href="#CentOS7-创建自签名证书" class="headerlink" title="CentOS7 创建自签名证书"></a>CentOS7 创建自签名证书</h3><p>CentOS7 和 8 步骤不一样。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/OpenSSL/" rel="tag"><i class="fa fa-tag"></i> OpenSSL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/OpenSSH%E6%9C%8D%E5%8A%A1/" rel="prev" title="OpenSSH服务">
                  <i class="fa fa-chevron-left"></i> OpenSSH服务
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/ulimit/" rel="next" title="ulimit">
                  ulimit <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
