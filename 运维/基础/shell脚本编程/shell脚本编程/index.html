<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="基本用法脚本调试脚本错误分为三种：  语法错误，导致后续命令不继续执行，使用 bash -n 检查错误 命令错误，默认后续命令继续执行，使用 bash -x 检查错误 逻辑错误，只能使用 bash -x 检查  变量shell 脚本中的所有变量值都是字符串，其中的数字也是字符串 shell 中变量命名规则- 只能使用数字、字母及下划线，且不能以数字开头 - 区分大小写 - 变量、等号、值中间不能出">
<meta property="og:type" content="article">
<meta property="og:title" content="shell脚本编程">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="基本用法脚本调试脚本错误分为三种：  语法错误，导致后续命令不继续执行，使用 bash -n 检查错误 命令错误，默认后续命令继续执行，使用 bash -x 检查错误 逻辑错误，只能使用 bash -x 检查  变量shell 脚本中的所有变量值都是字符串，其中的数字也是字符串 shell 中变量命名规则- 只能使用数字、字母及下划线，且不能以数字开头 - 区分大小写 - 变量、等号、值中间不能出">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1596809556035.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1599050885616.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1599052693808.png">
<meta property="article:published_time" content="2020-12-09T14:23:41.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.506Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="shell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1596809556035.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/","path":"运维/基础/shell脚本编程/shell脚本编程/","title":"shell脚本编程"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>shell脚本编程 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">1.</span> <span class="nav-text">基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95"><span class="nav-number">1.1.</span> <span class="nav-text">脚本调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#shell-%E4%B8%AD%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-number">1.2.1.</span> <span class="nav-text">shell 中变量命名规则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.2.</span> <span class="nav-text">定义变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.3.</span> <span class="nav-text">引用变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.4.</span> <span class="nav-text">删除变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#declare-%E2%98%85%E2%98%85%E2%98%85"><span class="nav-number">1.2.5.</span> <span class="nav-text">declare ★★★</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eval-%E2%98%85%E2%98%85%E2%98%85"><span class="nav-number">1.2.6.</span> <span class="nav-text">eval ★★★</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0"><span class="nav-number">1.2.7.</span> <span class="nav-text">练习</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.8.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.9.</span> <span class="nav-text">位置变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">1.2.10.</span> <span class="nav-text">退出状态码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%80%98%E2%80%99-%E2%80%9C%E2%80%9D"><span class="nav-number">1.2.11.</span> <span class="nav-text">‘’ “” &#96;&#96; $()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E5%AE%89%E5%85%A8%E5%92%8C-set"><span class="nav-number">1.2.12.</span> <span class="nav-text">脚本安全和 set</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA-printf"><span class="nav-number">1.3.</span> <span class="nav-text">格式化输出 printf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="nav-number">1.4.</span> <span class="nav-text">算术运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97-amp-amp-%E3%80%81-%E3%80%81%EF%BC%81"><span class="nav-number">1.5.</span> <span class="nav-text">逻辑运算 &amp;&amp;、||、！</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-read-%E5%91%BD%E4%BB%A4%E6%9D%A5%E6%8E%A5%E5%8F%97%E8%BE%93%E5%85%A5"><span class="nav-number">1.6.</span> <span class="nav-text">使用 read 命令来接受输入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="nav-number">1.7.</span> <span class="nav-text">条件测试命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bash-shell-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">bash shell 的配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%95%88%E8%8C%83%E5%9B%B4"><span class="nav-number">2.1.</span> <span class="nav-text">生效范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%96%B9%E5%BC%8F"><span class="nav-number">2.2.</span> <span class="nav-text">登录方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F"><span class="nav-number">2.2.1.</span> <span class="nav-text">交互式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8F"><span class="nav-number">2.2.2.</span> <span class="nav-text">非交互式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bash-%E9%80%80%E5%87%BA%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.3.</span> <span class="nav-text">bash 退出任务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9"><span class="nav-number">3.</span> <span class="nav-text">流程控制 - 条件选择</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if"><span class="nav-number">3.1.</span> <span class="nav-text">if</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#case"><span class="nav-number">3.2.</span> <span class="nav-text">case</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6-%E5%BE%AA%E7%8E%AF"><span class="nav-number">4.</span> <span class="nav-text">流程控制 - 循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#for-in"><span class="nav-number">4.1.</span> <span class="nav-text">for in</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#while"><span class="nav-number">4.2.</span> <span class="nav-text">while</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#while-read"><span class="nav-number">4.2.1.</span> <span class="nav-text">while read</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#until"><span class="nav-number">4.3.</span> <span class="nav-text">until</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6-continue-%E5%92%8C-break"><span class="nav-number">4.4.</span> <span class="nav-text">循环控制 continue 和 break</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6-shift"><span class="nav-number">4.5.</span> <span class="nav-text">循环控制 shift</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#select"><span class="nav-number">4.6.</span> <span class="nav-text">select</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">定义函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">调用函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.</span> <span class="nav-text">删除函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">5.4.</span> <span class="nav-text">函数返回值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%8F%98%E9%87%8F"><span class="nav-number">5.5.</span> <span class="nav-text">函数变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="nav-number">6.</span> <span class="nav-text">脚本相关工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#trap"><span class="nav-number">6.1.</span> <span class="nav-text">trap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mktemp"><span class="nav-number">6.2.</span> <span class="nav-text">mktemp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#expect"><span class="nav-number">6.3.</span> <span class="nav-text">expect</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84"><span class="nav-number">7.</span> <span class="nav-text">数组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">7.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8"><span class="nav-number">7.2.</span> <span class="nav-text">调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">8.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%87%E7%89%87"><span class="nav-number">8.1.</span> <span class="nav-text">切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%9B%BF%E6%8D%A2"><span class="nav-number">8.2.</span> <span class="nav-text">查找替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="nav-number">8.3.</span> <span class="nav-text">大小写转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%95"><span class="nav-number">8.4.</span> <span class="nav-text">变量测试</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="shell脚本编程 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          shell脚本编程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 22:23:41" itemprop="dateCreated datePublished" datetime="2020-12-09T22:23:41+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">shell脚本编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="脚本调试"><a href="#脚本调试" class="headerlink" title="脚本调试"></a>脚本调试</h3><p>脚本错误分为三种：</p>
<ul>
<li>语法错误，导致后续命令不继续执行，使用 <code>bash -n</code> 检查错误</li>
<li>命令错误，默认后续命令继续执行，使用 <code>bash -x</code> 检查错误</li>
<li>逻辑错误，只能使用 <code>bash -x</code> 检查</li>
</ul>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>shell 脚本中的所有变量值都是字符串，其中的数字也是字符串</p>
<h4 id="shell-中变量命名规则"><a href="#shell-中变量命名规则" class="headerlink" title="shell 中变量命名规则"></a>shell 中变量命名规则</h4><pre class="language-none"><code class="language-none">- 只能使用数字、字母及下划线，且不能以数字开头
- 区分大小写
- 变量、等号、值中间不能出现任何空格</code></pre>

<p>注意： 不支持短横线 “-”，这点和主机名相反</p>
<h4 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">'value'</span>

<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">'root'</span>		<span class="token comment"># 直接字符串赋值</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$user</span>"</span>    <span class="token comment"># 变量引用，注意一定要用双引号</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>COMMAND<span class="token variable">`</span></span>  或者 <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>COMMAND<span class="token variable">)</span></span>		<span class="token comment"># 命令引用</span></code></pre>

<h4 id="引用变量"><a href="#引用变量" class="headerlink" title="引用变量"></a>引用变量</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$name</span>
<span class="token variable">$&#123;name&#125;</span></code></pre>

<p>关于$：</p>
<pre class="language-none"><code class="language-none">- js中变量名前不加$，只有在上引号包裹的字符串中才使用$&#123;&#125;引用变量
- php变量名前加$，无论什么情况，$和变量名不可分离
- shell变量名前不加$，只有在引用的时候加$，在容易起因歧义的时候，使用$&#123;&#125;引用变量</code></pre>

<p>拼接字符串：</p>
<pre class="language-none"><code class="language-none">- php使用点 .
- js使用加号 +
- shell中什么也不需要，直接写在一起就可以了，也可以用+&#x3D;拼接自身</code></pre>

<h4 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">unset</span> name</code></pre>

<h4 id="declare-★★★"><a href="#declare-★★★" class="headerlink" title="declare ★★★"></a>declare ★★★</h4><p>declare 是 bash 内置命令，用来声明变量</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">declare</span> <span class="token punctuation">[</span>-aAfFgilnrtux<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> <span class="token punctuation">[</span>name<span class="token punctuation">[</span><span class="token operator">=</span>value<span class="token punctuation">]</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

f    <span class="token comment"># 显示已定义的函数</span>
F    <span class="token comment"># 显示已定义的函数名</span>
g    <span class="token comment"># 声明一个全局变量，name="value" 这种方式就是省略参数g，完整的写法是declare -g name="value"，所以在函数中请使用 declare name="value"，不要使用 name="value"，除非你想声明一个全局变量</span>
<span class="token parameter variable">-p</span>   <span class="token comment"># 显示所有变量及其属性和值，不包括函数</span>

为变量设置属性，如果没有声明变量，则显示设置此属性的变量：
a    <span class="token comment"># 声明索引数组</span>
A    <span class="token comment"># 声明关联数组</span>
i    <span class="token comment"># 声明整数，可以进行算数运算</span>
l    <span class="token comment"># 声明变量为小写字母</span>
n    <span class="token comment"># 为value设置引用属性</span>
r    <span class="token comment"># 声明只读变量，相当于 readonly，当前进程内，只能定义，不能修改，不能删除</span>
t    <span class="token comment"># 为变量设置trace属性，跟踪函数从调用shell继承DEBUG和RETURN类型的。trace属性对变量没有特殊意义</span>
u    <span class="token comment"># 声明变量为大写字母</span>
x    <span class="token comment"># 声明环境变量，相当于 export</span></code></pre>

<p>Shell 内建命令之 trap：<a target="_blank" rel="noopener" href="https://blog.csdn.net/asty9000/article/details/88393166">https://blog.csdn.net/asty9000/article/details/88393166</a></p>
<ul>
<li><p>i 示例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">let</span> <span class="token assign-left variable">var</span><span class="token operator">=</span>算术表达式
<span class="token variable"><span class="token punctuation">((</span>var<span class="token operator">=</span>算术表达式<span class="token punctuation">))</span></span>
<span class="token assign-left variable">var</span><span class="token operator">=</span>$<span class="token punctuation">[</span>算术表达式<span class="token punctuation">]</span>
<span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>算术表达式<span class="token variable">))</span></span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-i</span> <span class="token assign-left variable">var</span><span class="token operator">=</span>算术表达式
<span class="token builtin class-name">echo</span> <span class="token string">'算术表达式'</span> <span class="token operator">|</span> <span class="token function">bc</span></code></pre>
</li>
<li><p>n 示例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">declare</span> <span class="token assign-left variable">a</span><span class="token operator">=</span><span class="token number">123</span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-n</span> <span class="token assign-left variable">b</span><span class="token operator">=</span>a		<span class="token comment"># b=123		等同于 declare b=$a</span></code></pre></li>
</ul>
<h4 id="eval-★★★"><a href="#eval-★★★" class="headerlink" title="eval ★★★"></a>eval ★★★</h4><p>先扫描一遍，进行置换，再执行命令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例一</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">..</span>z<span class="token punctuation">&#125;</span>
a b c d e f g h i j k l m n o p q r s t u <span class="token function">v</span> w x y z
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">..</span>z<span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span>
abcdefghijklmnopqrstuvwxyz
lujinkai@Z510:~$ <span class="token assign-left variable">words</span><span class="token operator">=</span><span class="token string">"echo &#123;a..z&#125; | tr -d ' '"</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$words</span>
<span class="token builtin class-name">echo</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">..</span>z<span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $words<span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">..</span>z<span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">' '</span>
lujinkai@Z510:~$ <span class="token builtin class-name">eval</span> <span class="token variable">$words</span>
abcdefghijklmnopqrstuvwxyz

<span class="token comment"># 范例二</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># CMD=whoami</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># echo</span>
<span class="token variable">$CMD</span>
<span class="token function">whoami</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># eval $CMD</span>
root

<span class="token comment"># 范例三</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># n=10</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># echo &#123;0..$n&#125;</span>
<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment"># eval echo &#123;0..$n&#125;</span>
<span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">8</span> <span class="token number">9</span> <span class="token number">10</span></code></pre>

<h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h4><p>1、编写脚本 systeminfo.sh,显示当前主机系统信息,包括:主机名,IPv4 地址,操作系统版本,内核版本,CPU 型号,内存大小,硬盘大小</p>
<pre class="language-none"><code class="language-none">主机名：hostname
ipv4地址：hostname -I
操作系统版本：os-release NAME VERSION
内核版本：echo &#96;uname -s;uname -r&#96;
内存大小：&#96;free -m | awk &#39;&#x2F;Mem:&#x2F;&#123;print $2&#125;&#39;&#96;
硬盘大小：lsblk -m | awk &#39;&#x2F;sda&#x2F;&#123;print $2&#125;&#39;| head -n1</code></pre>

<p>2、编写脚本 backup.sh,可实现每日将 &#x2F;etc&#x2F; 目录备份到 &#x2F;backup&#x2F;etcYYYY-mm-dd 中</p>
<p>3、编写脚本 disk.sh,显示当前硬盘分区中空间利用率最大的值</p>
<p>4、编写脚本 links.sh,显示正连接本主机的每个远程主机的 IPv4 地址和连接数,并按连接数从大到小排序</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>对所有用户生效的环境变量：<code>/etc/profile</code><br>对特定用户生效的环境变量：<code>~/.bashrc</code> 或者 <code>~/.bash_profile</code><br>临时有效的环境变量：脚本或命令行使用 export 定义</p>
<p>常用环境变量：</p>
<pre class="language-none"><code class="language-none">PATH、HOME、LOGNAME、PWD、HISTFILE、HISTSIZE、HOSTNAME、SHELL、PS1、TMOUT、IFS、OFS</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 声明环境变量，除了使用 declare -x 还可以使用export</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>VALUE</code></pre>

<p>显示所有环境变量：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">env</span>
<span class="token function">printenv</span>
<span class="token builtin class-name">export</span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-x</span></code></pre>

<h4 id="位置变量"><a href="#位置变量" class="headerlink" title="位置变量"></a>位置变量</h4><p>位置变量，在 bash shell 中内置的变量，在脚本代码中调用通过命令行传递给脚本的参数</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">1,2</span><span class="token punctuation">..</span>.   对应第一个，第二个等参数，当参数小于10个的时候，<span class="token variable">$n</span>可以表示，当参数大于10个的时候，使用<span class="token variable">$&#123;n&#125;</span>表示
<span class="token number">0</span>        命令本身，包括路径在内
*        传递给脚本所有的参数，全部参数合为一个字符串，每个参数区别对待
@        传递给脚本的所有参数，每个参数为独立字符串，所有参数视为一个整体
<span class="token comment">#        传递给脚本的参数个数</span></code></pre>

<p>注意：<code>$@</code> 和 <code>$*</code> 只有在被双引号包起来的时候才会有差异，在 <code>for in</code> 循环中，不加引号的时候，<code>$*</code> 和 <code>$@</code> 都可以正常遍历，加双引号的时候，<code>$*</code> 只有一个字符串变量</p>
<p>清空所有位置变量：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> --</code></pre>

<p>范例：利用软链接实现同一个脚本不同功能</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"></code></pre>

<h4 id="退出状态码"><a href="#退出状态码" class="headerlink" title="退出状态码"></a>退出状态码</h4><p>用于无条件终止当前脚本的执行 <code>exit n</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">n <span class="token operator">==</span> <span class="token number">0</span>         <span class="token comment">#脚本执行成功</span>
n <span class="token operator">==</span> <span class="token number">1</span>-125     <span class="token comment">#出错，这些对应的错误值由用户在脚本中定义</span>
  n <span class="token operator">==</span> <span class="token number">1</span>        <span class="token comment">#一般未知错误</span>
  n <span class="token operator">==</span> <span class="token number">2</span>        <span class="token comment">#不合适的shell命令</span>
n <span class="token operator">==</span> <span class="token number">126</span>       <span class="token comment">#文件不可执行</span>
n <span class="token operator">==</span> <span class="token number">127</span>       <span class="token comment">#不存在该命令</span>
n <span class="token operator">==</span> <span class="token number">128</span>       <span class="token comment">#无效的退出参数</span>
n <span class="token operator">==</span> <span class="token number">128</span>+x     <span class="token comment">#与linux信号x相关的严重错误</span>
n <span class="token operator">==</span> <span class="token number">130</span>       <span class="token comment">#通过ctrl+c终止的命令</span>
n <span class="token operator">></span>  <span class="token number">255</span>       <span class="token comment">#正常范围之外的退出状态码</span></code></pre>

<p>1-125 这些错误值可以由用户自定义<br>如果不给定 n 的值，而直接使用 exit，那么返回 exit 之前最后一条语句的状态，等于 <code>exit $?</code></p>
<h4 id="‘’-“”"><a href="#‘’-“”" class="headerlink" title="‘’ “” `` $()"></a>‘’ “” `` $()</h4><p>单引号不解析变量，双引号解析变量，反引号中必须是有输出的命令，$() 和 ``是等价的, 但是 $() 可以嵌套</p>
<h4 id="脚本安全和-set"><a href="#脚本安全和-set" class="headerlink" title="脚本安全和 set"></a>脚本安全和 set</h4><p>set 命令：可以用来定制 shell 环境，set + 关闭设置，set - 打开设置</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> $-
himBHs</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">h <span class="token comment">#hashall，外部命令使用过一次后就会被hash下来，后面再使用这个命令就优先从hash中获取，通过`set +h`将h选项关闭</span>
i <span class="token comment">#interactive-comments，说明当前shell是交互式shell，在脚本中，i选项是被关闭的</span>
m <span class="token comment">#monitor，打开监控</span>
B <span class="token comment">#braceexpand，大括号扩展</span>
H <span class="token comment">#history，H选项打开，可以展开历史列表中的命令，可以通过!来完成，例如!!返回上一个历史命令，!n返回第n个历史命令</span></code></pre>

<p><strong>set 命令实现脚本安全：</strong></p>
<p>参考：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2017/11/bash-set.html?utm_source=tool.lu">http://www.ruanyifeng.com/blog/2017/11/bash-set.html?utm_source=tool.lu</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-u</span> 变量未定义就报错， 等同 <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> nounset<span class="token variable">`</span></span>
<span class="token parameter variable">-e</span> 遇到错误（exit不等于0）就退出，等同 <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> errexit<span class="token variable">`</span></span>
<span class="token parameter variable">-o</span> option 显示，打开或关闭选项
  显示选项 <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span><span class="token variable">`</span></span>
  打开选项 <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> 选项<span class="token variable">`</span></span>
  关闭选项 <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span> 选项<span class="token variable">`</span></span>
<span class="token parameter variable">-x</span> 当执行命令的时候，打印命令及其参数，类似 <span class="token variable"><span class="token variable">`</span><span class="token function">bash</span> <span class="token parameter variable">-x</span><span class="token variable">`</span></span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~/data/test$ <span class="token builtin class-name">set</span> <span class="token parameter variable">-o</span>
allexport      	off
braceexpand    	on
emacs          	on
errexit        	off
errtrace       	off
functrace      	off
hashall        	on
histexpand     	on
<span class="token function">history</span>        	on
<span class="token punctuation">..</span>.</code></pre>

<h3 id="格式化输出-printf"><a href="#格式化输出-printf" class="headerlink" title="格式化输出 printf"></a>格式化输出 printf</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">printf</span> <span class="token string">"指定的格式"</span> <span class="token string">"文本1"</span> <span class="token string">"文本2"</span><span class="token punctuation">..</span>.</code></pre>

<p><img data-src="//img.to2b.cn/blog/ljk/1596809556035.png"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">%s       <span class="token comment">#字符串</span>
%f       <span class="token comment">#浮点数</span>
%b       <span class="token comment">#解析转义符</span>
%c       <span class="token comment">#ASCI字符串，即显示对应参数的第一个字符</span>
%d,%i    <span class="token comment">#十进制整数</span>
%o       <span class="token comment">#八进制值</span>
%u       <span class="token comment">#不带正负号的十进制值</span>
%x       <span class="token comment">#十六进制值（a-f）</span>
%X       <span class="token comment">#十六进制值（A-Z)</span>
%%       <span class="token comment">#表示%本身</span>
%n       <span class="token comment">#指定输出宽度为n，不足补空格，默认右对齐，例如：%-10s 表示10个字符宽，- 表示左对齐</span></code></pre>

<p>常用转义字符：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">\</span>a    <span class="token comment">#警告字符</span>
<span class="token punctuation">\</span>b    <span class="token comment">#后退</span>
<span class="token punctuation">\</span>f    <span class="token comment">#换页</span>
<span class="token punctuation">\</span>n    <span class="token comment">#换行</span>
<span class="token punctuation">\</span>r    <span class="token comment">#回车</span>
<span class="token punctuation">\</span>t    <span class="token comment">#水平制表符，就是tab键</span>
<span class="token punctuation">\</span>v    <span class="token comment">#水平制表符</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~/data/test$ <span class="token builtin class-name">printf</span> <span class="token string">"%.2f<span class="token entity" title="\n">\n</span>"</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token number">1.00</span>
<span class="token number">2.00</span>
<span class="token number">3.00</span>
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">printf</span> <span class="token string">"hello: %s<span class="token entity" title="\n">\n</span>"</span> daming xiaohong tom
hello: daming
hello: xiaohong
hello: tom</code></pre>

<h3 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h3><p>bash 只支持整数运算，不支持小数运算。复杂的运算请使用 bc</p>
<p>加减乘除、自加自减，取余，异或取反，三元运算等都和 php 一样。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">let</span> <span class="token assign-left variable">var</span><span class="token operator">=</span>算术表达式
<span class="token variable"><span class="token punctuation">((</span>var<span class="token operator">=</span>算术表达式<span class="token punctuation">))</span></span>
<span class="token assign-left variable">var</span><span class="token operator">=</span>$<span class="token punctuation">[</span>算术表达式<span class="token punctuation">]</span>
<span class="token assign-left variable">var</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>算术表达式<span class="token variable">))</span></span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-i</span> <span class="token assign-left variable">var</span><span class="token operator">=</span>算术表达式
<span class="token builtin class-name">echo</span> <span class="token string">'算术表达式'</span> <span class="token operator">|</span> <span class="token function">bc</span></code></pre>

<p>$RANDOM：内建的随机数生成器变量</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token environment constant">$RANDOM</span> 取值范围: <span class="token number">0</span>-32767 <span class="token punctuation">(</span><span class="token number">2</span>^15<span class="token operator">=</span><span class="token number">32768</span><span class="token punctuation">)</span></code></pre>

<p>示例：生成 0-49 随机数</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span><span class="token environment constant">$RANDOM</span>%50<span class="token punctuation">]</span> <span class="token comment"># 除以50取余</span></code></pre>

<p>示例：鸡兔同笼</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">head</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">foot</span><span class="token operator">=</span><span class="token variable">$2</span>

<span class="token builtin class-name">let</span> <span class="token assign-left variable">tu</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$foot</span>-2*<span class="token variable">$head</span><span class="token punctuation">)</span>/2
<span class="token builtin class-name">let</span> <span class="token assign-left variable">ji</span><span class="token operator">=</span><span class="token variable">$head</span>-<span class="token variable">$tu</span>

<span class="token builtin class-name">echo</span> 兔子：<span class="token variable">$tu</span>
<span class="token builtin class-name">echo</span> 鸡：<span class="token variable">$ji</span>
</code></pre>

<h3 id="逻辑运算-amp-amp-、-、！"><a href="#逻辑运算-amp-amp-、-、！" class="headerlink" title="逻辑运算 &amp;&amp;、||、！"></a>逻辑运算 &amp;&amp;、||、！</h3><pre class="language-bash" data-language="bash"><code class="language-bash">与  <span class="token operator">&amp;&amp;</span>
或  <span class="token operator">||</span>
非  <span class="token operator">!</span></code></pre>

<p>短路运算</p>
<h3 id="使用-read-命令来接受输入"><a href="#使用-read-命令来接受输入" class="headerlink" title="使用 read 命令来接受输入"></a>使用 read 命令来接受输入</h3><p>read 是 shell 内置命令，从标准输入中读取数据并赋值给变量。如果没有重定向，默认是从键盘读取用户输入的数据，如果进行了重定向，那么可以从文件中都去数据。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># read [options] [name ...]</span>
read: <span class="token builtin class-name">read</span> <span class="token punctuation">[</span>-ers<span class="token punctuation">]</span> <span class="token punctuation">[</span>-a array<span class="token punctuation">]</span> <span class="token punctuation">[</span>-d delim<span class="token punctuation">]</span> <span class="token punctuation">[</span>-i text<span class="token punctuation">]</span> <span class="token punctuation">[</span>-n nchars<span class="token punctuation">]</span> <span class="token punctuation">[</span>-N nchars<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p prompt<span class="token punctuation">]</span> <span class="token punctuation">[</span>-t timeout<span class="token punctuation">]</span> <span class="token punctuation">[</span>-u fd<span class="token punctuation">]</span> <span class="token punctuation">[</span>name <span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre>

<p>如果没有提供变量名，那么读取的数据默认存放到环境变量 REPLY 中。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-a</span> array     <span class="token comment">#读取的数据赋值给数组</span>
<span class="token parameter variable">-d</span> delimiter <span class="token comment">#用字符串delimiter指定读取结束的位置，而不是一个换行符（读取到的数据不包括delimiter）</span>
<span class="token parameter variable">-n</span> num       <span class="token comment">#指定输入字符串的长度，到达指定长度自动退出</span>
<span class="token parameter variable">-t</span> seconds   <span class="token comment">#设置超时时间，用户超过时间没有输入，自动退出，exit非零</span>
<span class="token parameter variable">-s</span>           <span class="token comment">#静默输入，一般用于密码</span>
<span class="token parameter variable">-p</span> prompt    <span class="token comment">#显示提示内容，提示内容不能换行</span>
<span class="token parameter variable">-e</span>           <span class="token comment">#在用户输入的时候，对功能键进行编码转换，更人性化</span>
<span class="token parameter variable">-r</span>           <span class="token comment">#不允许反斜杠转义，选项一般都要加上，pycharm中如果不加会警告提示</span>
<span class="token parameter variable">-u</span>           <span class="token comment">#从文件描述符fd中读取内容</span></code></pre>

<p>read 就像表单提交，所有用户提交的信息都是不可信的，一定要做好校验</p>
<h3 id="条件测试命令"><a href="#条件测试命令" class="headerlink" title="条件测试命令"></a><a href="./test/">条件测试命令</a></h3><h2 id="bash-shell-的配置文件"><a href="#bash-shell-的配置文件" class="headerlink" title="bash shell 的配置文件"></a>bash shell 的配置文件</h2><p>bash shell 配置文件有： <code>/etc/profile</code>、<code>~/.bash_profile</code>、<code>~/.bash_login</code>、<code>~/.profile</code>、<code>~/.bashrc</code>、<code>/etc/bashrc</code>、<code>/etc/profile.d/\*.sh</code>，不同的启动方式会加载不同的配置文件</p>
<h3 id="生效范围"><a href="#生效范围" class="headerlink" title="生效范围"></a>生效范围</h3><p>&#x2F;etc 目录下的配置文件是全局生效，家目录下的配置文件是对当前用户生效</p>
<p>配置文件太多，为了避免混乱，默认：对所有用户添加配置，添加到 &#x2F;etc&#x2F;profile.d&#x2F; 目录下，当前用户添加配置，添加到 ~&#x2F;.bashrc 中</p>
<h3 id="登录方式"><a href="#登录方式" class="headerlink" title="登录方式"></a>登录方式</h3><p>shell 登录有两种方式：交互式登录和非交互式登录</p>
<h4 id="交互式"><a href="#交互式" class="headerlink" title="交互式"></a>交互式</h4><ol>
<li>帐号密码登录；</li>
<li><ol start="2">
<li><code>su - userName</code></li>
</ol>
</li>
</ol>
<p>配置文件生效和执行顺序：</p>
<p>Ubuntu18.4</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>. /etc/profile
<span class="token number">2</span>. /etc/profile/*.sh
<span class="token number">3</span>. /etc/bash.bashrc
<span class="token number">4</span>. ~/.profile
<span class="token number">5</span>. ~/.etc/bashrc</code></pre>

<p>CentOS7</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>. /etc/profile
<span class="token number">2</span>. /etc/profile.d/<span class="token punctuation">\</span>*.sh
<span class="token number">3</span>. ~/.bash_profile
<span class="token number">4</span>. ~/.bashrc
<span class="token number">5</span>. /etc/bashrc</code></pre>

<h4 id="非交互式"><a href="#非交互式" class="headerlink" title="非交互式"></a>非交互式</h4><ol>
<li><code>su userName</code>；</li>
<li>图形化界面下打开的终端；</li>
<li>执行脚本；</li>
<li>任何其他的 bash 实例</li>
</ol>
<p>非交互式登录，只加载 <code>~/.bashrc</code>（centos 的~&#x2F;.bashrc 中会加载&#x2F;etc&#x2F;bashrc 文件）</p>
<p>所以按照功能划分：profile 类只在交互式登录中加载，而 bashrc 类在交互式和非交互式登录中都有加载</p>
<h3 id="bash-退出任务"><a href="#bash-退出任务" class="headerlink" title="bash 退出任务"></a>bash 退出任务</h3><p>退出 shell 时自动运行 <code>~/.bash_logout</code> 文件，可以用来创建自动备份文件、清除临时文件</p>
<h2 id="流程控制-条件选择"><a href="#流程控制-条件选择" class="headerlink" title="流程控制 - 条件选择"></a>流程控制 - 条件选择</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>if&#x2F;then&#x2F;elif&#x2F;else&#x2F;fi</p>
<p>单分支</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> ~/.bashrc <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">.</span> ~/.bashrc
<span class="token keyword">fi</span></code></pre>

<p>双分支</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	code<span class="token punctuation">..</span>.
<span class="token keyword">else</span>
	code<span class="token punctuation">..</span>.
<span class="token keyword">fi</span></code></pre>

<p>多分支</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	code<span class="token punctuation">..</span>.
<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	code<span class="token punctuation">..</span>.
<span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	code<span class="token punctuation">..</span>.
	<span class="token punctuation">..</span>.
<span class="token keyword">else</span>
	code<span class="token punctuation">..</span>.
<span class="token keyword">fi</span></code></pre>

<h3 id="case"><a href="#case" class="headerlink" title="case"></a>case</h3><p>类似 php 中的 switch</p>
<p>case&#x2F;esac</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/sh</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Is it morning? Please answer yes or no."</span>
<span class="token builtin class-name">read</span> YES_OR_NO
<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$YES_OR_NO</span>"</span> <span class="token keyword">in</span>
<span class="token function">yes</span><span class="token operator">|</span>y<span class="token operator">|</span>Yes<span class="token operator">|</span>YES<span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Good Morning!"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>nN<span class="token punctuation">]</span>*<span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Good Afternoon!"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
*<span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Sorry, <span class="token variable">$YES_OR_NO</span> not recognized. Enter yes or no."</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span></code></pre>

<p>case 支持 glob 风格的通配符：*、?、[]、|</p>
<h2 id="流程控制-循环"><a href="#流程控制-循环" class="headerlink" title="流程控制 - 循环"></a>流程控制 - 循环</h2><h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h3><p>for in&#x2F;do&#x2F;done</p>
<p>递归遍历当前目录下的所有文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span>readlink <span class="token parameter variable">-f</span> $0<span class="token variable">`</span></span>"</span><span class="token variable">)</span></span>
<span class="token function-name function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token for-or-select variable">filename</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> $1<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
		<span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token variable">$&#123;1&#125;</span>/<span class="token variable">$&#123;filename&#125;</span>
		<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$file</span><span class="token entity" title="\n">\n</span>"</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			fn <span class="token variable">$file</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">done</span>
<span class="token punctuation">&#125;</span>
fn <span class="token variable">$dir</span></code></pre>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p>while&#x2F;do&#x2F;done</p>
<p>无限循环</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	循环体
<span class="token keyword">done</span></code></pre>

<p>验证密码，限制尝试输入不超过 5 次</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">'enter password:'</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-s</span> try
<span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$try</span> <span class="token operator">!=</span> <span class="token string">'123456'</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	<span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$num<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$num</span> <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token builtin class-name">echo</span> <span class="token string">'no change'</span>
		<span class="token builtin class-name">break</span>
	<span class="token keyword">fi</span>
	<span class="token builtin class-name">echo</span> <span class="token string">'try again'</span>
	<span class="token builtin class-name">read</span> <span class="token parameter variable">-s</span> try
<span class="token keyword">done</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$try</span> <span class="token operator">==</span> <span class="token string">'123456'</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">'yes'</span>
<span class="token keyword">fi</span></code></pre>

<h4 id="while-read"><a href="#while-read" class="headerlink" title="while read"></a>while read</h4><p>while 循环的特殊用法,遍历文件或文本的每一行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 依次读取file文件中的每一行,且将行赋值给变量X</span>
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> X<span class="token punctuation">;</span> <span class="token keyword">do</span>
循环体
<span class="token keyword">done</span> <span class="token operator">&lt;</span> <span class="token function">file</span></code></pre>

<p>练习，使用 while 实现：</p>
<ol>
<li>编写脚本，求 100 以内所有正奇数之和</li>
<li>编写脚本，提示请输入网络地址，如 192.168.0.0，判断输入的网段中主机在线状态，并统计在线和离线主机各多少</li>
<li>编写脚本，打印九九乘法表</li>
<li>编写脚本，利用变量 RANDOM 生成 10 个随机数字，输出这个 10 数字，并显示其中的最大值和最小值</li>
<li>编写脚本，实现打印国际象棋棋盘</li>
<li>后续六个字符串: efbaf275cd、4be9c40b8b、44b2395c46、f8c8873ce0、b902c16c8b、ad865d2f63 是通过对随机数变量 RANDOM 随机执行命令: <code>echo $RANDOM | md5sum | cut -c1-10</code> 后的结果，请破解这些字符串对应的 RANDOM 值</li>
</ol>
<h3 id="until"><a href="#until" class="headerlink" title="until"></a>until</h3><p>while 判断条件为真则循环，until 判断条件为假则循环</p>
<p>无限循环</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">until</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	循环体
Done</code></pre>

<h3 id="循环控制-continue-和-break"><a href="#循环控制-continue-和-break" class="headerlink" title="循环控制 continue 和 break"></a>循环控制 continue 和 break</h3><p>continue 跳过本次循环，break 跳出所有循环</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-u</span>

<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">--</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">echo</span> <span class="token string">'i is 5'</span>
	  <span class="token comment"># continue</span>
      <span class="token builtin class-name">break</span>
  <span class="token keyword">fi</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$i</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">unset</span> i</code></pre>

<h3 id="循环控制-shift"><a href="#循环控制-shift" class="headerlink" title="循环控制 shift"></a>循环控制 shift</h3><p>将参数列表最左边的参数删除，while 循环遍历位置参量列表时,常用到 shift</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span>$# <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$@</span>"</span>
    <span class="token builtin class-name">shift</span>
<span class="token keyword">done</span></code></pre>

<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>select 用于生成菜单，并显示 PS3 提示符，然后等待用户输入，无论输入什么都执行一遍循环，常搭配 case 来处理用户输入，select 通过 break 退出循环</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">select</span> <span class="token for-or-select variable">variable</span> <span class="token keyword">in</span> list <span class="token punctuation">;</span><span class="token keyword">do</span>
	循环体命令
<span class="token keyword">done</span></code></pre>

<p>示例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable"><span class="token environment constant">PS3</span></span><span class="token operator">=</span><span class="token string">"请点菜(1-6): "</span>
<span class="token keyword">select</span> <span class="token for-or-select variable">MENU</span> <span class="token keyword">in</span> 北京烤鸭 佛跳墙 小龙虾 羊蝎子 火锅 点菜结束<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">case</span> <span class="token environment constant">$REPLY</span> <span class="token keyword">in</span>
    <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$MENU</span> 价格是 <span class="token number">100</span>
        <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> <span class="token number">100</span><span class="token punctuation">))</span></span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$MENU</span> 价格是 <span class="token number">88</span>
        <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> <span class="token number">88</span><span class="token punctuation">))</span></span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$MENU</span>价格是 <span class="token number">66</span>
        <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> <span class="token number">66</span><span class="token punctuation">))</span></span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$MENU</span> 价格是 <span class="token number">166</span>
        <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> <span class="token number">166</span><span class="token punctuation">))</span></span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token variable">$MENU</span> 价格是 <span class="token number">200</span>
        <span class="token variable"><span class="token punctuation">((</span>sum <span class="token operator">+=</span> <span class="token number">200</span><span class="token punctuation">))</span></span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"点菜结束,退出"</span>
        <span class="token builtin class-name">break</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"点菜错误,重新选择"</span>
        <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"总价格是: <span class="token variable">$sum</span>"</span></code></pre>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数运行在当前 shell 进程</p>
<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#语法一:</span>
<span class="token function-name function">func_name</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
<span class="token punctuation">..</span>.函数体<span class="token punctuation">..</span>.
<span class="token punctuation">&#125;</span>
<span class="token comment">#语法二:</span>
<span class="token keyword">function</span> <span class="token function-name function">func_name</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">..</span>.函数体<span class="token punctuation">..</span>.
<span class="token punctuation">&#125;</span>
<span class="token comment">#语法三:</span>
<span class="token keyword">function</span> <span class="token function-name function">func_name</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">..</span>.函数体<span class="token punctuation">..</span>.
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 声明环境函数</span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-xf</span> function_name
<span class="token builtin class-name">export</span> <span class="token parameter variable">-f</span> function_name</code></pre>

<h3 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h3><pre class="language-bash" data-language="bash"><code class="language-bash">func_name		<span class="token comment"># 注意不要加（）</span>
<span class="token comment"># 参数用空格分割，在函数内部使用位置变量接收传入的参数</span>
func_name arg1 arg2 arg3 <span class="token punctuation">..</span>.</code></pre>

<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">unset</span> func_name</code></pre>

<h3 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h3><p>函数返回值：</p>
<ul>
<li>使用 echo 等命令进行输出</li>
<li>函数体中调用命令的输出结果</li>
</ul>
<p>函数的退出状态码：</p>
<ul>
<li>默认取决于函数中执行的最后一条命令的退出状态码</li>
<li>自定义退出状态码,其格式为:<br>return 从函数中返回,用最后状态命令决定返回值<br>return 0 无错误返回<br>return 1-255 有错误返回</li>
</ul>
<h3 id="函数变量"><a href="#函数变量" class="headerlink" title="函数变量"></a>函数变量</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">local</span> <span class="token assign-left variable">NAME</span><span class="token operator">=</span>VALUE
<span class="token comment"># 等于</span>
<span class="token builtin class-name">declare</span> <span class="token assign-left variable">NAME</span><span class="token operator">=</span>VALUE</code></pre>

<h2 id="脚本相关工具"><a href="#脚本相关工具" class="headerlink" title="脚本相关工具"></a>脚本相关工具</h2><h3 id="trap"><a href="#trap" class="headerlink" title="trap"></a>trap</h3><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/3482.html">信号</a>捕捉，捕捉一个或多个信号，替换为自定义操作</p>
<p>trap 捕捉的信号包括系统信号和 shell 信号，系统信号通过<code>trap -l</code>或<code>kill -l</code>查看，shell 信号有四个：EXIT(或信号代码 0)、ERR、DEBUG 和 RETURN。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">trap</span> <span class="token builtin class-name">command</span> signal_list <span class="token comment"># 捕捉信号列表，替换为自定义command</span>
<span class="token builtin class-name">trap</span> <span class="token string">''</span> signal_list      <span class="token comment"># 捕捉信号列表，不做任何操作</span>
<span class="token builtin class-name">trap</span> <span class="token string">'-'</span> signal_list     <span class="token comment"># 捕捉信号列表，恢复这些信号</span>
<span class="token builtin class-name">trap</span> <span class="token parameter variable">-p</span>                  <span class="token comment"># 列出自定义捕捉信号操作</span>
<span class="token builtin class-name">trap</span> <span class="token parameter variable">-l</span>                  <span class="token comment"># 列出所有系统信</span></code></pre>

<p>信号名是 SIG 后面的部分，捕捉的时候可以写信号的编号，也可以写信号名称，不区分大小写</p>
<p>由于不少信号在不同架构的计算机上数值不同，所以在不确定编号是否唯一的时候，最好写信号名称</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">trap</span> <span class="token string">"echo 'Press ctrl+c or ctrl+\ '"</span> int quit</code></pre>

<p>DEBUG 和 RETURN 这两种信号陷阱无需关注，EXIT 是退出状态码为 0 时发出的信号，退出状态码非 0 时则发出 ERR 信号</p>
<p>系统信号的编号从 1 到 64，EXIT 的编号是 0</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function-name function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token builtin class-name">echo</span> finish<span class="token operator">|</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /root/finish.log
<span class="token punctuation">&#125;</span>
<span class="token builtin class-name">trap</span> finish <span class="token builtin class-name">exit</span></code></pre>

<h3 id="mktemp"><a href="#mktemp" class="headerlink" title="mktemp"></a>mktemp</h3><p>创建临时文件，可以避免文件名冲突</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># X至少3个，大写X</span>
lujinkai@Z510:~/data/test$ mktemp fileXXXXX
fileS9vLK
<span class="token comment"># -d 创建临时目录</span>
lujinkai@Z510:~/data/test$ mktemp <span class="token parameter variable">-d</span> dirXXX
diresA</code></pre>

<h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><p>expect 基于 Tcl( Tool Command Language )语言开发，主要应用于自动化交互式操作的场景,借助 expect 处理交互的命令,可以将交互过程如:ssh 登录,ftp 登录等写在一个脚本上,使之自动化完成。尤其适用于需要对多台服务器执行相同操作的环境中,可以大大提高系统管理人员的工作效率</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">expect</span> <span class="token punctuation">[</span> <span class="token parameter variable">-dDinN</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token parameter variable">-c</span> cmds <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> -<span class="token punctuation">[</span>f<span class="token operator">|</span>b<span class="token punctuation">]</span> <span class="token punctuation">]</span> cmdfile <span class="token punctuation">]</span> <span class="token punctuation">[</span> args <span class="token punctuation">]</span></code></pre>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>shell 和 php 一样，支持索引数组和关联数组。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 索引数组</span>
<span class="token assign-left variable">arr</span><span class="token operator">=</span><span class="token punctuation">(</span>val1 val2 val3 val4 <span class="token punctuation">..</span>.<span class="token punctuation">)</span>
<span class="token comment"># 关联数组</span>
<span class="token builtin class-name">declare</span> <span class="token parameter variable">-A</span> <span class="token assign-left variable">brr</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'lujinkai'</span> <span class="token punctuation">[</span>age<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'18'</span> <span class="token punctuation">[</span>gender<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'男'</span><span class="token punctuation">)</span></code></pre>

<p>注意：声明索引数组可以省略 declare，声明关联数组不能省略 declare，如果省略不报错，但是数据会乱。</p>
<h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~/data/test$ <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"Allen"</span> <span class="token string">"Mike"</span> <span class="token string">"Messi"</span> <span class="token string">"Jerry"</span> <span class="token string">"Hanmeimei"</span> <span class="token string">"Wang"</span><span class="token punctuation">)</span>
<span class="token comment"># 打印数组长度</span>
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;<span class="token operator">#</span>array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>&#125;</span>
<span class="token number">6</span>
<span class="token comment"># 打印元素长度</span>
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;<span class="token operator">#</span>array<span class="token punctuation">[</span>1<span class="token punctuation">]</span>&#125;</span>	<span class="token comment"># 打印第1个元素 Mike的长度</span>
<span class="token number">4</span>
<span class="token comment"># 分片访问</span>
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">:</span>1<span class="token operator">:</span>2&#125;</span>
Mike Messi
<span class="token comment"># 元素内容替换</span>
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">/</span>e<span class="token operator">/</span>E&#125;</span>
AllEn MikE MEssi JErry HanmEimei Wang
lujinkai@Z510:~/data/test$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;array<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token operator">/</span><span class="token operator">/</span>e<span class="token operator">/</span>E&#125;</span>
AllEn MikE MEssi JErry HanmEimEi Wang
<span class="token comment"># 数组的遍历</span>
<span class="token keyword">for</span> <span class="token keyword">in</span> <span class="token variable">$&#123;array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>&#125;</span>
<span class="token keyword">do</span>
	<span class="token builtin class-name">echo</span> <span class="token variable">$val</span>
<span class="token keyword">done</span></code></pre>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~$ <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">'abcdefghijklmnopqrstuvwxyz'</span></code></pre>

<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p>假设有一个指针 pointer，始终指向字符串的“间隙”，从前往后，“间隙”号依次为 0、1、2、3…，而且显然“间隙”数量比字符数量多 1 个，如果字符串有 2 个字符，那就有 3 个“间隙”。指针默认指向 0，指针的位置就是切片位置。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 字符串长度</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;<span class="token operator">#</span>str&#125;</span>
<span class="token number">26</span>

<span class="token comment"># 从切片位置往后截取length个字符：$&#123;str:offset:length&#125;</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>0<span class="token operator">:</span>6&#125;</span>
abcdef
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>4<span class="token operator">:</span>2&#125;</span>
ef

<span class="token comment"># 截取后length个字符：$&#123;str:0-length&#125; 0可以用空格代替</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span> -3&#125;</span>
xyz
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>0-3&#125;</span>
xyz

<span class="token comment">#  截取后length个字符，然后再处理：$&#123;str:0-length:offset&#125;、$&#123;str:0-length:-offset&#125;</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>0-3<span class="token operator">:</span>1&#125;</span>
x
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>0-3<span class="token operator">:-</span>1&#125;</span>
xy


<span class="token comment"># 掐头去尾：$&#123;str:offset:-length&#125;</span>
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">:</span>1<span class="token operator">:-</span>1&#125;</span>
bcdefghijklmnopqrstuvwxy</code></pre>

<h3 id="查找替换"><a href="#查找替换" class="headerlink" title="查找替换"></a>查找替换</h3><p><img data-src="//img.to2b.cn/blog/ljk/1599050885616.png"></p>
<p><code>$&#123;str#*word&#125;</code> 查找 word 第一次出现的位置，删除其以及之前的部分</p>
<p><code>$&#123;str##*word&#125;</code> 贪婪模式，查找 word 最后一次出现的位置，删除其及其之前的部分</p>
<p><code>$&#123;str%word*&#125;</code> 查找 word 最后出现的位置，删除其及其之后的部分</p>
<p><code>$&#123;str%%word*&#125;</code> 查找 word 第一次出现的位置，删除其及其之后的部分</p>
<p><code>$&#123;str/pattern&#125;</code> 删除第一个匹配</p>
<p><code>$&#123;str//pattern&#125;</code> 删除所有匹配</p>
<h3 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h3><p><code>$&#123;str^^&#125;</code> 转大写</p>
<p><code>$&#123;str,,&#125;</code> 转小写</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">^^</span>&#125;</span>
ABCDEFGHIJKLMNOPQRSTUVWXYZ
lujinkai@Z510:~$ <span class="token builtin class-name">echo</span> <span class="token variable">$&#123;str<span class="token operator">,,</span>&#125;</span>
abcdefghijklmnopqrstuvwxyz</code></pre>

<h3 id="变量测试"><a href="#变量测试" class="headerlink" title="变量测试"></a>变量测试</h3><p><img data-src="//img.to2b.cn/blog/ljk/1599052693808.png"></p>
<p>变量测试点比较多，而且不怎么用，主要用 if 来判断测试，所以不用深究</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/shell/" rel="tag"><i class="fa fa-tag"></i> shell</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/expect/" rel="prev" title="expect">
                  <i class="fa fa-chevron-left"></i> expect
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/shell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/pushd%E5%92%8Cpopd/" rel="next" title="pushd和popd">
                  pushd和popd <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
