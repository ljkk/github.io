<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="系统日志将系统和应用发生的事件记录至日志中，以助于排错和分析使用： 日志记录的内容包括：  历史事件：事件、地点、人物、事件 日志级别：事件的关键程度 LogLevel  各种系统日志服务  sysklogd：CentOS 5 之前版本采用的日志管理系统服务 rsyslog：CentOS 6 以后版本的系统管理服务 多线程 UDP、TCP、SSL、TLS、RELP MySQL、PGSQL、Orac">
<meta property="og:type" content="article">
<meta property="og:title" content="日志服务管理">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="系统日志将系统和应用发生的事件记录至日志中，以助于排错和分析使用： 日志记录的内容包括：  历史事件：事件、地点、人物、事件 日志级别：事件的关键程度 LogLevel  各种系统日志服务  sysklogd：CentOS 5 之前版本采用的日志管理系统服务 rsyslog：CentOS 6 以后版本的系统管理服务 多线程 UDP、TCP、SSL、TLS、RELP MySQL、PGSQL、Orac">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1605012422975.png">
<meta property="article:published_time" content="2020-12-09T15:35:19.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.510Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="日志">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1605012422975.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/","path":"运维/日志/日志服务管理/","title":"日志服务管理"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>日志服务管理 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="nav-number">1.</span> <span class="nav-text">系统日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">常见日志文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsyslog"><span class="nav-number">2.</span> <span class="nav-text">rsyslog</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.2.</span> <span class="nav-text">启用网络日志服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logger-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">logger 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-journalctl"><span class="nav-number">2.4.</span> <span class="nav-text">日志管理工具 journalctl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-1%EF%BC%9A%E5%88%A9%E7%94%A8-mysql-%E5%AD%98%E5%82%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">实战案例 1：利用 mysql 存储日志信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-2%EF%BC%9A%E9%80%9A%E8%BF%87-loganalyzer-%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">4.</span> <span class="nav-text">实战案例 2：通过 loganalyzer 展示数据库中的日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logrotate-%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="nav-number">5.</span> <span class="nav-text">logrotate 日志转储</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="日志服务管理 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          日志服务管理
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 23:35:19" itemprop="dateCreated datePublished" datetime="2020-12-09T23:35:19+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h2><p>将系统和应用发生的事件记录至日志中，以助于排错和分析使用：</p>
<p>日志记录的内容包括：</p>
<ul>
<li>历史事件：事件、地点、人物、事件</li>
<li>日志级别：事件的关键程度 LogLevel</li>
</ul>
<p>各种系统日志服务</p>
<ul>
<li>sysklogd：CentOS 5 之前版本采用的日志管理系统服务</li>
<li>rsyslog：CentOS 6 以后版本的系统管理服务<ul>
<li>多线程</li>
<li>UDP、TCP、SSL、TLS、RELP</li>
<li>MySQL、PGSQL、Oracle 实现日志存储</li>
<li>强大的过滤器，可实现过滤记录日志信息中任意部分</li>
<li>自定义输出格式</li>
</ul>
</li>
<li>ELK：Elasticsearch + Logstash + Kibana</li>
</ul>
<h3 id="常见日志文件"><a href="#常见日志文件" class="headerlink" title="常见日志文件"></a>常见日志文件</h3><ul>
<li>&#x2F;var&#x2F;log&#x2F;secure：系统安全日志，文本格式，应周期性分析</li>
<li>&#x2F;var&#x2F;log&#x2F;btmp：当前系统上，用户的失败尝试登录相关的日志信息，二进制格式，lastb 命令进行查看</li>
<li>&#x2F;var&#x2F;log&#x2F;wtmp：当前系统上，用户正常登录系统的相关日志信息，二进制格式，last 命令可以查看</li>
<li>&#x2F;var&#x2F;log&#x2F;lastlog：每一个用户最近一次的登录信息，二进制格式，lastlog 命令可以查看</li>
<li>&#x2F;var&#x2F;log&#x2F;dmesg：CentOS7 之前版本系统引导过程中的日志信息，文本格式，开机后的硬件变化将不再记录专用命令 dmesg 查看，可持续记录硬件变化的情况</li>
<li>&#x2F;var&#x2F;log&#x2F;boot.log：系统服务启动的相关信息，文本格式</li>
<li>&#x2F;var&#x2F;log&#x2F;messages ：系统中大部分的信息</li>
<li>&#x2F;var&#x2F;log&#x2F;anaconda : anaconda 的日志</li>
</ul>
<h2 id="rsyslog"><a href="#rsyslog" class="headerlink" title="rsyslog"></a>rsyslog</h2><p>facility：设施，或者叫设备，从功能或程序上对日志进行归类</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">auth、authpriv、cron、daemon、ftp、kern、lpr、mail、news、security(auth)、user、uucp、syslog</span><br><span class="line"></span><br><span class="line">auth            <span class="comment"># pam产生的日志</span></span><br><span class="line">authpriv        <span class="comment"># ssh,ftp等登录信息的验证信息</span></span><br><span class="line">cron            <span class="comment"># 时间任务相关</span></span><br><span class="line">kern            <span class="comment"># 内核</span></span><br><span class="line">lpr             <span class="comment"># 打印</span></span><br><span class="line">mail            <span class="comment"># 邮件</span></span><br><span class="line">mark(syslog)    <span class="comment"># rsyslog服务内部的信息,时间标识</span></span><br><span class="line">news            <span class="comment"># 新闻组</span></span><br><span class="line">user            <span class="comment"># 用户程序产生的相关信息</span></span><br><span class="line">uucp            <span class="comment"># unix to unix copy, unix主机之间相关的通讯</span></span><br><span class="line"></span><br><span class="line">local0-local7 	<span class="comment"># 自定义的日志设施</span></span><br></pre></td></tr></table></figure>

<p>priority：优先级别，从低到高排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">debug、info、notice、warn(warning)、err(error)、crit(critical)、alert、emerg(panic)</span><br><span class="line"></span><br><span class="line">debug   <span class="comment"># 有调式信息的，日志信息最多</span></span><br><span class="line">info    <span class="comment"># 一般信息的日志，最常用</span></span><br><span class="line">notice  <span class="comment"># 最具有重要性的普通条件的信息</span></span><br><span class="line">warning <span class="comment"># 警告级别</span></span><br><span class="line">err     <span class="comment"># 错误级别，阻止某个功能或者模块不能正常工作的信息</span></span><br><span class="line">crit    <span class="comment"># 严重级别，阻止整个系统或者整个软件不能正常工作的信息</span></span><br><span class="line">alert   <span class="comment"># 需要立刻修改的信息</span></span><br><span class="line">emerg   <span class="comment"># 内核崩溃等严重信息</span></span><br><span class="line">none    <span class="comment"># 什么都不记录</span></span><br></pre></td></tr></table></figure>

<p>参看帮助： <code>man 3 syslog</code>，<code>man logger</code></p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>配置文件：&#x2F;etc&#x2F;rsyslog.conf 和 &#x2F;etc&#x2F;rsyslog.d&#x2F;*</p>
<p>&#x2F;etc&#x2F;rsyslog.conf 配置文件格式，由三部分组成：</p>
<ul>
<li>MODULES：相关模块配置</li>
<li>GLOBAL DIRECTIVES：全局配置</li>
<li>RULES：日志记录相关的规则配置</li>
</ul>
<p>RULES 配置格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设施.优先级; 设施.优先级; 设施.优先级...    目标</span></span><br><span class="line">facility.priority; facility.priority... target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># facility 格式：</span></span><br><span class="line">*	<span class="comment"># 所有的facility</span></span><br><span class="line">facility1,facility2,facility3,...	<span class="comment"># 指定的facility列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># priority 格式：</span></span><br><span class="line">*			<span class="comment"># 所有级别</span></span><br><span class="line">none		<span class="comment"># 没有级别，即不记录</span></span><br><span class="line">PRIORITY	<span class="comment"># 指定级别（含）以上的所有级别</span></span><br><span class="line">=PRIORITY	<span class="comment"># 仅记录指定级别的日志信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># target 格式：</span></span><br><span class="line">文件路径			<span class="comment"># 通常在/var/log/目录下，文件路径前的-表示异步写入</span></span><br><span class="line">用户				<span class="comment"># 将日志事件通知给指定的用户，*表示登录的所有用户</span></span><br><span class="line">日志服务器			<span class="comment"># @host：日志发送到指定的远程UDP日志服务器；@@host：日志发送到指定的远程TCP日志服务器</span></span><br><span class="line">管道				<span class="comment"># | command：转发给其他命令处理</span></span><br></pre></td></tr></table></figure>

<p>日志文件有很多，如：&#x2F;var&#x2F;log&#x2F;message、cron、secure 等，基本格式都是类似的，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事件产生的日期时间	主机	进程(pid)：事件内容</span><br></pre></td></tr></table></figure>

<p>范例：将 ssh 服务的日志记录到自定义的 local 的日志设备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改sshd的配置，然后 Service sshd reload 重启</span></span><br><span class="line">Vim /etc/ssh/sshd_config</span><br><span class="line">SyslogFacility local2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改rsyslog的配置，然后 Systemctl restart rsyslog 重启</span></span><br><span class="line">Vim /etc/rsyslog.conf</span><br><span class="line">Local2.* /var/log/sshd.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">Ssh登录后，查看/var/log/sshd.log有记录</span><br><span class="line"></span><br><span class="line"><span class="comment">#logger测试</span></span><br><span class="line">logger -p local2.info <span class="string">&quot;hello sshd&quot;</span></span><br><span class="line"><span class="built_in">tail</span> /var/log/sshd.log有记录</span><br></pre></td></tr></table></figure>

<h3 id="启用网络日志服务"><a href="#启用网络日志服务" class="headerlink" title="启用网络日志服务"></a>启用网络日志服务</h3><p>启用网络日志服务功能，可以将多个远程主机的日志，发送到集中的日志服务器，方便统一管理。</p>
<p>范例：启用网络日志功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos8</span></span><br><span class="line">module(load=<span class="string">&quot;imudp&quot;</span>)			<span class="comment"># udp</span></span><br><span class="line">input(<span class="built_in">type</span>=<span class="string">&quot;imudp&quot;</span> port=<span class="string">&quot;514&quot;</span>)</span><br><span class="line">module(load=<span class="string">&quot;imtcp&quot;</span>)			<span class="comment"># tcp</span></span><br><span class="line">input(<span class="built_in">type</span>=<span class="string">&quot;imtcp&quot;</span> port=<span class="string">&quot;514&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos6、7</span></span><br><span class="line"><span class="variable">$ModLoad</span> imudp			<span class="comment"># udp</span></span><br><span class="line"><span class="variable">$UDPServerRun</span> 514</span><br><span class="line"><span class="variable">$ModLoad</span> imtcp			<span class="comment"># tcp</span></span><br><span class="line"><span class="variable">$InputTCPServerRun</span> 514</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试：在客户端指定将日志发送到远程的TCP、UDP的日志服务器</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#vim /etc/rsyslog.conf</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none	/var/log/messages</span><br><span class="line">*.info;mail.none;authpriv.none;cron.none	@@10.0.0.18			<span class="comment"># tcp</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none	@10.0.0.18			<span class="comment"># udp</span></span><br></pre></td></tr></table></figure>

<h3 id="logger-命令"><a href="#logger-命令" class="headerlink" title="logger 命令"></a>logger 命令</h3><p>logger 命令可以往系统日志中写入信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger [options] [&lt;message&gt;]</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="variable">$logger</span> --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"> logger [options] [&lt;message&gt;]</span><br><span class="line"></span><br><span class="line">Enter messages into the system <span class="built_in">log</span>.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"> -i                       <span class="built_in">log</span> the logger <span class="built_in">command</span><span class="string">&#x27;s PID</span></span><br><span class="line"><span class="string">     --id[=&lt;id&gt;]          log the given &lt;id&gt;, or otherwise the PID</span></span><br><span class="line"><span class="string"> -f, --file &lt;file&gt;        log the contents of this file</span></span><br><span class="line"><span class="string"> -e, --skip-empty         do not log empty lines when processing files</span></span><br><span class="line"><span class="string">     --no-act             do everything except the write the log</span></span><br><span class="line"><span class="string"> -p, --priority &lt;prio&gt;    mark given message with this priority</span></span><br><span class="line"><span class="string">     --octet-count        use rfc6587 octet counting</span></span><br><span class="line"><span class="string">     --prio-prefix        look for a prefix on every line read from stdin</span></span><br><span class="line"><span class="string"> -s, --stderr             output message to standard error as well</span></span><br><span class="line"><span class="string"> -S, --size &lt;size&gt;        maximum size for a single message</span></span><br><span class="line"><span class="string"> -t, --tag &lt;tag&gt;          mark every line with this tag</span></span><br><span class="line"><span class="string"> -n, --server &lt;name&gt;      write to this remote syslog server</span></span><br><span class="line"><span class="string"> -P, --port &lt;port&gt;        use this port for UDP or TCP connection</span></span><br><span class="line"><span class="string"> -T, --tcp                use TCP only</span></span><br><span class="line"><span class="string"> -d, --udp                use UDP only</span></span><br><span class="line"><span class="string">     --rfc3164            use the obsolete BSD syslog protocol</span></span><br><span class="line"><span class="string">     --rfc5424[=&lt;snip&gt;]   use the syslog protocol (the default for remote);</span></span><br><span class="line"><span class="string">                            &lt;snip&gt; can be notime, or notq, and/or nohost</span></span><br><span class="line"><span class="string">     --sd-id &lt;id&gt;         rfc5424 structured data ID</span></span><br><span class="line"><span class="string">     --sd-param &lt;data&gt;    rfc5424 structured data name=value</span></span><br><span class="line"><span class="string">     --msgid &lt;msgid&gt;      set rfc5424 message id field</span></span><br><span class="line"><span class="string"> -u, --socket &lt;socket&gt;    write to this Unix socket</span></span><br><span class="line"><span class="string">     --socket-errors[=&lt;on|off|auto&gt;]</span></span><br><span class="line"><span class="string">                          print connection errors when using Unix sockets</span></span><br><span class="line"><span class="string">     --journald[=&lt;file&gt;]  write journald entry</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> -h, --help               display this help</span></span><br><span class="line"><span class="string"> -V, --version            display version</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more details see logger(1).</span></span><br></pre></td></tr></table></figure>

<h3 id="日志管理工具-journalctl"><a href="#日志管理工具-journalctl" class="headerlink" title="日志管理工具 journalctl"></a>日志管理工具 journalctl</h3><p>CentOS7 以后版本利用 Systemd 统一管理所有 Unit 的启动日志。带来的好处就是，可以只用 journalctl 一个命令，查看所有日志（内核日志和应用日志）</p>
<p>配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/systemd/journald.conf</span><br></pre></td></tr></table></figure>

<p>命令格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl [OPTIONS...] [MATCHES...]</span><br></pre></td></tr></table></figure>

<p>OPTIONS：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">--no-full, --full, -l</span><br><span class="line">  如果字段内容超长则以省略号(...)截断以适应列宽。</span><br><span class="line">  默认显示完整的字段内容(超长的部分换行显示或者被分页工具截断)。</span><br><span class="line">  老旧的 -l/--full 选项 仅用于撤销已有的 --no-full 选项，除此之外没有其他用处。</span><br><span class="line">-a, --all</span><br><span class="line">  完整显示所有字段内容， 即使其中包含不可打印字符或者字段内容超长。</span><br><span class="line">-f, --follow</span><br><span class="line">  只显示最新的日志项，并且不断显示新生成的日志项。 此选项隐含了 -n 选项。</span><br><span class="line">-e, --pager-end</span><br><span class="line">  在分页工具内立即跳转到日志的尾部。 此选项隐含了 -n1000 以确保分页工具不必缓存太多的日志行。 不过这个隐含的行数可以被明确设置的 -n 选项覆盖。 注意，此选项仅可用于 less(1) 分页器。</span><br><span class="line">-n, --lines=</span><br><span class="line">  限制显示最新的日志行数。 --pager-end 与 --follow 隐含了此选项。</span><br><span class="line">  此选项的参数：若为正整数则表示最大行数； 若为 <span class="string">&quot;all&quot;</span> 则表示不限制行数；</span><br><span class="line">  若不设参数则表示默认值10行。</span><br><span class="line">--no-tail</span><br><span class="line">  显示所有日志行， 也就是用于撤销已有的 --lines= 选项(即使与 -f 连用)。</span><br><span class="line">-r, --reverse</span><br><span class="line">  反转日志行的输出顺序， 也就是最先显示最新的日志。</span><br><span class="line">-o, --output=</span><br><span class="line">  控制日志的输出格式。 可以使用如下选项：</span><br><span class="line">  short</span><br><span class="line">    这是默认值， 其输出格式与传统的 syslog[1] 文件的格式相似， 每条日志一行。</span><br><span class="line">  short-iso</span><br><span class="line">    与 short 类似，只是将时间戳字段以 ISO 8601 格式显示。</span><br><span class="line">  short-precise</span><br><span class="line">    与 short 类似，只是将时间戳字段的秒数精确到微秒级别。</span><br><span class="line">  short-monotonic</span><br><span class="line">    与 short 类似，只是将时间戳字段的零值从内核启动时开始计算。</span><br><span class="line">  short-unix</span><br><span class="line">    与 short 类似，只是将时间戳字段显示为从<span class="string">&quot;UNIX时间原点&quot;</span>(1970-1-1 00:00:00 UTC)以来的秒数。 精确到微秒级别。</span><br><span class="line">  verbose</span><br><span class="line">    以结构化的格式显示每条日志的所有字段。</span><br><span class="line">  <span class="built_in">export</span></span><br><span class="line">    将日志序列化为二进制字节流(大部分依然是文本) 以适用于备份与网络传输(详见Journal Export Format[2] 文档)。</span><br><span class="line">  json</span><br><span class="line">    将日志项按照JSON数据结构格式化， 每条日志一行(详见 Journal JSON Format[3]文档)。</span><br><span class="line">  json-pretty</span><br><span class="line">    将日志项按照JSON数据结构格式化， 但是每个字段一行， 以便于人类阅读。</span><br><span class="line">  json-sse</span><br><span class="line">    将日志项按照JSON数据结构格式化，每条日志一行，但是用大括号包围， 以适应 Server-Sent Events[4] 的要求。</span><br><span class="line">  <span class="built_in">cat</span></span><br><span class="line">    仅显示日志的实际内容， 而不显示与此日志相关的任何元数据(包括时间戳)。</span><br><span class="line">--utc</span><br><span class="line">  以世界统一时间(UTC)表示时间</span><br><span class="line">--no-hostname</span><br><span class="line">  不显示来源于本机的日志消息的主机名字段。 此选项仅对 short 系列输出格式(见上文)有效。</span><br><span class="line">-x, --catalog</span><br><span class="line">  在日志的输出中增加一些解释性的短文本， 以帮助进一步说明日志的含义、问题的解决方案、支持论坛、 开发文档、以及其他任何内容。</span><br><span class="line">  并非所有日志都有这些额外的帮助文本， 详见 Message Catalog Developer Documentation[5] 文档。</span><br><span class="line">  注意，如果要将日志输出用于bug报告， 请不要使用此选项。</span><br><span class="line">-q, --quiet</span><br><span class="line">  当以普通用户身份运行时， 不显示任何警告信息与提示信息。例如：<span class="string">&quot;-- Logs begin at ...&quot;</span>, <span class="string">&quot;-- Reboot --&quot;</span></span><br><span class="line">-m, --merge</span><br><span class="line">  混合显示包括远程日志在内的所有可见日志。</span><br><span class="line">-b [ID][±offset], --boot=[ID][±offset]</span><br><span class="line">  显示特定于某次启动的日志， 这相当于添加了一个 <span class="string">&quot;_BOOT_ID=&quot;</span> 匹配条件。</span><br><span class="line">  如果参数为空(也就是 ID 与 ±offset 都未指定)， 则表示仅显示本次启动的日志。</span><br><span class="line">  如果省略了 ID ， 那么当 ±offset 是正数的时候， 将从日志头开始正向查找，否则(也就是为负数或零)将从日志尾开始反响查找。 举例来说， <span class="string">&quot;-b 1&quot;</span>表示按时间顺序排列最早的那次启动， <span class="string">&quot;-b 2&quot;</span>则表示在时间上第二早的那次启动； <span class="string">&quot;-b -0&quot;</span>表示最后一次启动， <span class="string">&quot;-b -1&quot;</span>表示在时间上第二近的那次启动， 以此类推。 如果 ±offset 也省略了， 那么相当于<span class="string">&quot;-b -0&quot;</span>， 除非本次启动不是最后一次启动(例如用--directory 指定了另外一台主机上的日志目录)。如果指定了32字符的 ID ， 那么表示以此 ID 所代表的那次启动为基准计算偏移量(±offset)， 计算方法同上。 换句话说， 省略 ID 表示以本次启动为基准计算偏移量(±offset)。</span><br><span class="line">--list-boots</span><br><span class="line">  列出每次启动的 序号(也就是相对于本次启动的偏移量)、32字符的ID、第一条日志的时间戳、最后一条日志的时间戳。</span><br><span class="line">-k, --dmesg</span><br><span class="line">  仅显示内核日志。隐含了 -b 选项以及 <span class="string">&quot;_TRANSPORT=kernel&quot;</span> 匹配项。</span><br><span class="line">-t, --identifier=SYSLOG_IDENTIFIER</span><br><span class="line">  仅显示 syslog[1] 识别符为 SYSLOG_IDENTIFIER 的日志项。</span><br><span class="line">  可以多次使用该选项以指定多个识别符。</span><br><span class="line">-u, --unit=UNIT|PATTERN</span><br><span class="line">  仅显示属于特定单元的日志。 也就是单元名称正好等于 UNIT 或者符合 PATTERN 模式的单元。 这相当于添加了一个 <span class="string">&quot;_SYSTEMD_UNIT=UNIT&quot;</span> 匹配项(对于 UNIT 来说)，或一组匹配项(对于 PATTERN 来说)。可以多次使用此选项以添加多个并列的匹配条件(相当于用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">--user-unit=</span><br><span class="line">  仅显示属于特定用户会话单元的日志。 相当于同时添加了 <span class="string">&quot;_SYSTEMD_USER_UNIT=&quot;</span> 与</span><br><span class="line"><span class="string">&quot;_UID=&quot;</span> 两个匹配条件。</span><br><span class="line">  可以多次使用此选项以添加多个并列的匹配条件(相当于用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">-p, --priority=</span><br><span class="line">  根据日志等级(包括等级范围)过滤输出结果。 日志等级数字与其名称之间的对应关系如下 (参见 syslog(3))： <span class="string">&quot;emerg&quot;</span> (0), <span class="string">&quot;alert&quot;</span> (1), <span class="string">&quot;crit&quot;</span> (2), <span class="string">&quot;err&quot;</span> (3),<span class="string">&quot;warning&quot;</span> (4), <span class="string">&quot;notice&quot;</span> (5), <span class="string">&quot;info&quot;</span> (6), <span class="string">&quot;debug&quot;</span> (7) 。</span><br><span class="line">  若设为一个单独的数字或日志等级名称， 则表示仅显示小于或等于此等级的日志(也就是重要程度等于或高于此等级的日志)。 若使用 FROM..TO.. 设置一个范围，则表示仅显示指定的等级范围内(含两端)的日志。 此选项相当于添加了 <span class="string">&quot;PRIORITY=&quot;</span>匹配条件。</span><br><span class="line">-c, --cursor=</span><br><span class="line">  从指定的游标(cursor)开始显示日志。</span><br><span class="line">  [提示]每条日志都有一个<span class="string">&quot;__CURSOR&quot;</span>字段，类似于该条日志的指纹。</span><br><span class="line">--after-cursor=</span><br><span class="line">  从指定的游标(cursor)之后开始显示日志。 如果使用了 --show-cursor 选项，则也会显示游标本身。</span><br><span class="line">--show-cursor</span><br><span class="line">  在最后一条日志之后显示游标， 类似下面这样，以<span class="string">&quot;--&quot;</span>开头：</span><br><span class="line">-- cursor: s=0639...</span><br><span class="line">  游标的具体格式是私有的(也就是没有公开的规范)， 并且会变化。</span><br><span class="line">-S, --since=, -U, --<span class="keyword">until</span>=</span><br><span class="line">  显示晚于指定时间(--since=)的日志、显示早于指定时间(--<span class="keyword">until</span>=)的日志。</span><br><span class="line">  参数的格式类似 <span class="string">&quot;2012-10-30 18:17:16&quot;</span> 这样。 如果省略了<span class="string">&quot;时:分:秒&quot;</span>部分，则相当于设为 <span class="string">&quot;00:00:00&quot;</span> 。 如果仅省略了<span class="string">&quot;秒&quot;</span>的部分则相当于设为 <span class="string">&quot;:00&quot;</span> 。如果省略了<span class="string">&quot;年-月-日&quot;</span>部分， 则相当于设为当前日期。 除了<span class="string">&quot;年-月-日 时:分:秒&quot;</span>格式，参数还可以进行如下设置：</span><br><span class="line">  (1)设为 <span class="string">&quot;yesterday&quot;</span>, <span class="string">&quot;today&quot;</span>, <span class="string">&quot;tomorrow&quot;</span>以表示那一天的零点(00:00:00)。</span><br><span class="line">  (2)设为 <span class="string">&quot;now&quot;</span> 以表示当前时间。</span><br><span class="line">  (3)可以在<span class="string">&quot;年-月-日 时:分:秒&quot;</span>前加上 <span class="string">&quot;-&quot;</span>(前移) 或 <span class="string">&quot;+&quot;</span>(后移)前缀以表示相对于当前时间的偏移。 关于时间与日期的详细规范， 参见systemd.time(7)</span><br><span class="line">-F, --field=</span><br><span class="line">  显示所有日志中某个字段的所有可能值。 [译者注]类似于SQL语句：<span class="string">&quot;SELECT DISTINCT 某字段 FROM 全部日志&quot;</span></span><br><span class="line">-N, --fields</span><br><span class="line">  输出所有日志字段的名称</span><br><span class="line">--system, --user</span><br><span class="line">  仅显示系统服务与内核的日志(--system)、 仅显示当前用户的日志(--user)。</span><br><span class="line">  如果两个选项都未指定，则显示当前用户的所有可见日志。</span><br><span class="line">-M, --machine=</span><br><span class="line">  显示来自于正在运行的、特定名称的本地容器的日志。 参数必须是一个本地容器的名称。</span><br><span class="line">-D DIR, --directory=DIR</span><br><span class="line">  仅显示来自于特定目录中的日志， 而不是默认的运行时和系统日志目录中的日志。</span><br><span class="line">--file=GLOB</span><br><span class="line">  GLOB 是一个可以包含<span class="string">&quot;?&quot;</span>与<span class="string">&quot;*&quot;</span>的文件路径匹配模式。 表示仅显示来自与指定的 GLOB模式匹配的文件中的日志， 而不是默认的运行时和系统日志目录中的日志。可以多次使用此选项以指定多个匹配模式(多个模式之间用<span class="string">&quot;OR&quot;</span>逻辑连接)。</span><br><span class="line">--root=ROOT</span><br><span class="line">  在对日志进行操作时， 将 ROOT 视为系统的根目录。 例如 --update-catalog 将会创建ROOT/var/lib/systemd/catalog/database</span><br><span class="line">--new-id128</span><br><span class="line">  此选项并不用于显示日志内容， 而是用于重新生成一个标识日志分类的 128-bit ID 。</span><br><span class="line">  此选项的目的在于 帮助开发者生成易于辨别的日志消息， 以方便调试。</span><br><span class="line">--header</span><br><span class="line">  此选项并不用于显示日志内容， 而是用于显示日志文件内部的头信息(类似于元数据)。</span><br><span class="line">--disk-usage</span><br><span class="line">  此选项并不用于显示日志内容，而是用于显示所有日志文件(归档文件与活动文件)的磁盘占用总量。</span><br><span class="line">--vacuum-size=, --vacuum-time=, --vacuum-files=</span><br><span class="line">  这些选项并不用于显示日志内容，而是用于清理日志归档文件(并不清理活动的日志文件)， 以释放磁盘空间。</span><br><span class="line">--vacuum-size= 可用于限制归档文件的最大磁盘使用量 (可以使用 <span class="string">&quot;K&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;T&quot;</span>后缀)；</span><br><span class="line">--vacuum-time= 可用于清除指定时间之前的归档 (可以使用 <span class="string">&quot;s&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;h&quot;</span>,<span class="string">&quot;days&quot;</span>, <span class="string">&quot;weeks&quot;</span>, <span class="string">&quot;months&quot;</span>, <span class="string">&quot;years&quot;</span> 后缀)；</span><br><span class="line">--vacuum-files= 可用于限制日志归档文件的最大数量。 注意，--vacuum-size= 对 --disk-usage的输出仅有间接效果， 因为 --disk-usage 输出的是归档日志与活动日志的总量。同样，--vacuum-files= 也未必一定会减少日志文件的总数，因为它同样仅作用于归档文件而不会删除活动的日志文件。此三个选项可以同时使用，以同时从三个维度去限制归档文件。若将某选项设为零，则表示取消此选项的限制。</span><br><span class="line">--list-catalog [128-bit-ID...]</span><br><span class="line">  简要列出日志分类信息， 其中包括对分类信息的简要描述。</span><br><span class="line">  如果明确指定了分类ID(128-bit-ID)， 那么仅显示指定的分类。</span><br><span class="line">--dump-catalog [128-bit-ID...]</span><br><span class="line">  详细列出日志分类信息 (格式与 .catalog 文件相同)。</span><br><span class="line">  如果明确指定了分类ID(128-bit-ID)， 那么仅显示指定的分类。</span><br><span class="line">--update-catalog</span><br><span class="line">  更新日志分类索引二进制文件。</span><br><span class="line">  每当安装、删除、更新了分类文件，都需要执行一次此动作。</span><br><span class="line">--setup-keys</span><br><span class="line">  此选项并不用于显示日志内容， 而是用于生成一个新的FSS(Forward Secure Sealing)密钥对。 此密钥对包含一个<span class="string">&quot;sealing key&quot;</span>与一个<span class="string">&quot;verification key&quot;</span>。<span class="string">&quot;sealing key&quot;</span>保存在本地日志目录中， 而<span class="string">&quot;verification key&quot;</span>则必须保存在其他地方。详见 journald.conf(5) 中的 Seal= 选项。</span><br><span class="line">--force</span><br><span class="line">  与 --setup-keys 连用， 表示即使已经配置了FSS(Forward Secure Sealing)密钥对，也要强制重新生成。</span><br><span class="line">--interval=</span><br><span class="line">  与 --setup-keys 连用，指定<span class="string">&quot;sealing key&quot;</span>的变化间隔。</span><br><span class="line">  较短的时间间隔会导致占用更多的CPU资源， 但是能够减少未检测的日志变化时间。</span><br><span class="line">  默认值是 15min</span><br><span class="line">--verify</span><br><span class="line">  检查日志文件的内在一致性。 如果日志文件在生成时开启了FSS特性， 并且使用</span><br><span class="line">--verify-key= 指定了FSS的<span class="string">&quot;verification key&quot;</span>，</span><br><span class="line">  那么，同时还将验证日志文件的真实性。</span><br><span class="line">--verify-key=</span><br><span class="line">  与 --verify 选项连用， 指定FSS的<span class="string">&quot;verification key&quot;</span></span><br><span class="line">--<span class="built_in">sync</span></span><br><span class="line">  要求日志守护进程将所有未写入磁盘的日志数据刷写到磁盘上，并且一直阻塞到刷写操作实际完成之后才返回。 因此该命令可以保证当它返回的时候，所有在调用此命令的时间点之前的日志， 已经全部安全的刷写到了磁盘中。</span><br><span class="line">--flush</span><br><span class="line">  要求日志守护进程 将 /run/log/journal 中的日志数据 刷写到 /var/log/journal 中(如果持久存储设备当前可用的话)。 此操作会一直阻塞到操作完成之后才会返回，因此可以确保在该命令返回时， 数据转移确实已经完成。</span><br><span class="line">  注意，此命令仅执行一个单独的、一次性的转移动作， 若没有数据需要转移，则此命令什么也不做， 并且也会返回一个表示操作已正确完成的返回值。</span><br><span class="line">--rotate</span><br><span class="line">  要求日志守护进程滚动日志文件。 此命令会一直阻塞到滚动完成之后才会返回。</span><br><span class="line">-h, --<span class="built_in">help</span></span><br><span class="line">  显示简短的帮助信息并退出。</span><br><span class="line">--version</span><br><span class="line">  显示简短的版本信息并退出。</span><br><span class="line">--no-pager</span><br><span class="line">  不将程序的输出内容管道(pipe)给分页程序</span><br></pre></td></tr></table></figure>

<p>范例：journalctl 用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所有日志（默认情况下 ，只保存本次启动的日志）</span></span><br><span class="line">journalctl</span><br><span class="line"><span class="comment">#查看内核日志（不显示应用日志）</span></span><br><span class="line">journalctl -k</span><br><span class="line"><span class="comment">#查看系统本次启动的日志</span></span><br><span class="line">journalctl -b</span><br><span class="line">journalctl -b -0</span><br><span class="line"><span class="comment">#查看上一次启动的日志（需更改设置）</span></span><br><span class="line">journalctl -b -1</span><br><span class="line"><span class="comment">#查看指定时间的日志</span></span><br><span class="line">journalctl --since=<span class="string">&quot;2017-10-30 18:10:30&quot;</span></span><br><span class="line">journalctl --since <span class="string">&quot;20 min ago&quot;</span></span><br><span class="line">journalctl --since yesterday</span><br><span class="line">journalctl --since <span class="string">&quot;2017-01-10&quot;</span> --<span class="keyword">until</span> <span class="string">&quot;2017-01-11 03:00&quot;</span></span><br><span class="line">journalctl --since 09:00 --<span class="keyword">until</span> <span class="string">&quot;1 hour ago&quot;</span></span><br><span class="line"><span class="comment">#显示尾部的最新10行日志</span></span><br><span class="line">journalctl -n</span><br><span class="line"><span class="comment">#显示尾部指定行数的日志</span></span><br><span class="line">journalctl -n 20</span><br><span class="line"><span class="comment">#实时滚动显示最新日志</span></span><br><span class="line">journalctl -f</span><br><span class="line"><span class="comment">#查看指定服务的日志</span></span><br><span class="line">journalctl /usr/lib/systemd/systemd</span><br><span class="line"><span class="comment">#查看指定进程的日志</span></span><br><span class="line">journalctl _PID=1</span><br><span class="line"><span class="comment">#查看某个路径的脚本的日志</span></span><br><span class="line">journalctl /usr/bin/bash</span><br><span class="line"><span class="comment">#查看指定用户的日志</span></span><br><span class="line">journalctl _UID=33 --since today</span><br><span class="line"><span class="comment">#查看某个 Unit 的日志</span></span><br><span class="line">journalctl -u nginx.service</span><br><span class="line">journalctl -u nginx.service --since today</span><br><span class="line"><span class="comment">#实时滚动显示某个 Unit 的最新日志</span></span><br><span class="line">journalctl -u nginx.service -f</span><br><span class="line"><span class="comment">#合并显示多个 Unit 的日志</span></span><br><span class="line">journalctl -u nginx.service -u php-fpm.service --since today</span><br><span class="line"><span class="comment">#查看指定优先级（及其以上级别）的日志，共有8级</span></span><br><span class="line">0: emerg</span><br><span class="line">1: alert</span><br><span class="line">2: crit</span><br><span class="line">3: err</span><br><span class="line">4: warning</span><br><span class="line">5: notice</span><br><span class="line">6: info</span><br><span class="line">7: debug</span><br><span class="line">journalctl -p err -b</span><br><span class="line"><span class="comment">#日志默认分页输出，--no-pager 改为正常的标准输出</span></span><br><span class="line">journalctl --no-pager</span><br><span class="line"><span class="comment">#日志管理journalctl</span></span><br><span class="line"><span class="comment">#以 JSON 格式（单行）输出</span></span><br><span class="line">journalctl -b -u nginx.service -o json</span><br><span class="line"><span class="comment">#以 JSON 格式（多行）输出，可读性更好</span></span><br><span class="line">journalctl -b -u nginx.serviceqq -o json-pretty</span><br><span class="line"><span class="comment">#显示日志占据的硬盘空间</span></span><br><span class="line">journalctl --disk-usage</span><br><span class="line"><span class="comment">#指定日志文件占据的最大空间</span></span><br><span class="line">journalctl --vacuum-size=1G</span><br><span class="line"><span class="comment">#指定日志文件保存多久</span></span><br><span class="line">journalctl --vacuum-time=1years</span><br></pre></td></tr></table></figure>

<h2 id="实战案例-1：利用-mysql-存储日志信息"><a href="#实战案例-1：利用-mysql-存储日志信息" class="headerlink" title="实战案例 1：利用 mysql 存储日志信息"></a>实战案例 1：利用 mysql 存储日志信息</h2><p>目标：将 rsyslog 收集的日志记录在 mysql 中</p>
<p>环境：两台主机</p>
<ol>
<li>rsyslog 日志服务器：10.0.0.71</li>
<li>mysql 数据库服务器：10.0.0.72</li>
</ol>
<p>实现：</p>
<ol>
<li>10.0.0.71 安装 rsyslog-mysql</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@c71 ~]<span class="variable">$yum</span> install rsyslog-mysql.x86_64</span><br><span class="line">[root@c71 ~]<span class="variable">$rpm</span> -ql rsyslog-mysql</span><br><span class="line">/usr/lib64/rsyslog/ommysql.so</span><br><span class="line">/usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql	<span class="comment"># sql文件</span></span><br><span class="line"><span class="comment"># 拷贝到数据库服务器</span></span><br><span class="line">[root@c71 ~]<span class="variable">$scp</span> /usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql root@10.0.0.72:/data</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>10.0.0.72 配置 mysql</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@c72 ~]<span class="variable">$mysql</span> -uroot -p123456</span><br><span class="line">...</span><br><span class="line">11:27:05(root@localhost) [(none)]&gt; <span class="built_in">source</span> /data/mysql-createDB.sql	<span class="comment"># 导入数据表</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Database changed</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"><span class="comment"># 创建rsyslog用户，提供给日志服务，用来连接数据库</span></span><br><span class="line">08:25:34(root@localhost) [(none)]&gt; CREATE USER <span class="string">&#x27;rsyslog&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> IDENTIFIED BY <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">08:25:39(root@localhost) [(none)]&gt; GRANT ALL ON *.* TO <span class="string">&#x27;rsyslog&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>10.0.0.71 修改 rsyslog 配置文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@c71 ~]<span class="variable">$vim</span> /etc/rsyslog.conf</span><br><span class="line">...</span><br><span class="line"><span class="comment"># 在MODULES下添加：</span></span><br><span class="line"><span class="variable">$ModLoad</span> ommysql</span><br><span class="line"><span class="comment"># 在RULES下添加：</span></span><br><span class="line"><span class="comment">#facility.priority	:ommysql:DBHOST,DBNAME,DBUSER, PASSWORD</span></span><br><span class="line">*.info				:ommysql:10.0.0.72,Syslog,rsyslog,123456</span><br><span class="line">...</span><br><span class="line">[root@c71 ~]<span class="variable">$systemctl</span> restart rsyslog.service</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>测试</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@c71 ~]<span class="variable">$logger</span> <span class="string">&quot;this is a test log&quot;</span></span><br><span class="line"></span><br><span class="line">[root@c72 ~]<span class="variable">$mysql</span> -uroot -p123456</span><br><span class="line">08:45:43(root@localhost) [(none)]&gt; <span class="keyword">select</span> Message from Syslog.SystemEvents order by <span class="built_in">id</span> desc <span class="built_in">limit</span> 1\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">Message: this is a <span class="built_in">test</span> <span class="built_in">log</span></span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="实战案例-2：通过-loganalyzer-展示数据库中的日志"><a href="#实战案例-2：通过-loganalyzer-展示数据库中的日志" class="headerlink" title="实战案例 2：通过 loganalyzer 展示数据库中的日志"></a>实战案例 2：通过 loganalyzer 展示数据库中的日志</h2><p>loganalyzer 是用 php 语言实现的日志管理系统,可将 MySQL 数据库的日志用丰富的 WEB 方式进行展示</p>
<p>官网: <a target="_blank" rel="noopener" href="https://loganalyzer.adiscon.com/">https://loganalyzer.adiscon.com</a></p>
<p>目标：通过 loganalyzer 展示数据库中的日志</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1605012422975.png"></p>
<h2 id="logrotate-日志转储"><a href="#logrotate-日志转储" class="headerlink" title="logrotate 日志转储"></a>logrotate 日志转储</h2><p>logrotate 程序是一个日志文件管理工具。用来把旧的日志文件删除，并创建新的日志文件，称为日志转储或滚动。可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过 cron 程序来执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@c71 ~]<span class="variable">$rpm</span> -ql logrotate</span><br><span class="line">/etc/cron.daily/logrotate					<span class="comment"># 计划任务</span></span><br><span class="line">/etc/logrotate.conf							<span class="comment"># 配置文件</span></span><br><span class="line">/etc/logrotate.d</span><br><span class="line">/etc/rwtab.d/logrotate</span><br><span class="line">/usr/sbin/logrotate							<span class="comment"># 程序</span></span><br><span class="line">/usr/share/doc/logrotate-3.8.6</span><br><span class="line">/usr/share/doc/logrotate-3.8.6/CHANGES</span><br><span class="line">/usr/share/doc/logrotate-3.8.6/COPYING</span><br><span class="line">/usr/share/man/man5/logrotate.conf.5.gz</span><br><span class="line">/usr/share/man/man8/logrotate.8.gz</span><br><span class="line">/var/lib/logrotate</span><br><span class="line">/var/lib/logrotate/logrotate.status			<span class="comment"># 日志文件</span></span><br></pre></td></tr></table></figure>

<p>配置文件主要参数如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">compress			<span class="comment"># 通过 gzip 压缩转储以后的日志</span></span><br><span class="line">nocompress			<span class="comment"># 不压缩</span></span><br><span class="line">copytruncate		<span class="comment"># 把当前日志备份并截断，即 拷贝原来的日志，然后把原日志清空</span></span><br><span class="line">nocopytruncate		<span class="comment"># 备份日志文件但是不截断，即	只拷贝原来的日志，但并不会在拷贝完后清空原日志</span></span><br><span class="line">create mode owner group		<span class="comment"># 转储文件，使用指定的权限、所有者、所属组创建新的日志文件。注意 能用create就不用copytruncate</span></span><br><span class="line">nocreate			<span class="comment"># 不建立新的日志文件，不知道这个选项的意义在哪里</span></span><br><span class="line">delaycompress		<span class="comment"># 和 compress 一起使用时，转储的日志文件到下一次转储时才压缩</span></span><br><span class="line">nodelaycompress		<span class="comment"># 覆盖 delaycompress 选项，转储同时压缩</span></span><br><span class="line">errors address		<span class="comment"># 专储时的错误信息发送到指定的 Email 地址</span></span><br><span class="line">ifempty				<span class="comment"># 即使是空文件也转储，此为默认选项</span></span><br><span class="line">notifempty			<span class="comment"># 如果是空文件的话，不转储</span></span><br><span class="line">mail address		<span class="comment"># 把转储的日志文件发送到指定的 E-mail 地址</span></span><br><span class="line">nomail				<span class="comment"># 转储时不发送日志文件</span></span><br><span class="line">olddir directory		<span class="comment"># 转储后的日志文件放入指定目录，必须和当前日志文件在同一个文件系统</span></span><br><span class="line">noolddir				<span class="comment"># 转储后的日志文件和当前日志文件放在同一个目录下</span></span><br><span class="line">prerotate/endscript		<span class="comment"># 在转储以前需要执行的命令，这两个关键字必须单独成行</span></span><br><span class="line">postrotate/endscript	<span class="comment"># 在转储以后需要执行的命令，这两个关键字必须单独成行</span></span><br><span class="line">daily		<span class="comment"># 指定转储周期为每天</span></span><br><span class="line">weekly		<span class="comment"># 指定转储周期为每周</span></span><br><span class="line">monthly		<span class="comment"># 指定转储周期为每月</span></span><br><span class="line">rotate count		<span class="comment"># 指定日志文件删除之前转储的次数，0 指没有备份，5 指保留 5 个备份</span></span><br><span class="line">tabooext [+] list	<span class="comment"># 让 logrotate 不转储指定扩展名的文件，缺省的扩展名是:.rpm-orig、.rpmsave、v 和 ~</span></span><br><span class="line">size size			<span class="comment"># 当日志文件到达指定的大小时才转储，bytes(缺省)及 KB 或 MB</span></span><br><span class="line">sharedscripts		<span class="comment"># 默认，对每个转储日志运行 prerotate 和 postrotate 脚本，日志文件的绝对路径作为第一个参数传递给脚本。 这意味着单个脚本可以针对与多个文件匹配的日志文件条目多次运行(例如/ var / log / news /\*.example)。 如果指定此项 sharedscripts，则无论有多少个日志与通配符模式匹配，脚本都只会运行一次</span></span><br><span class="line">nosharedscripts		<span class="comment"># 针对每一个转储的日志文件，都执行一次 prerotate 和 postrotate 脚本，此为默认值</span></span><br><span class="line">missingok			<span class="comment"># 如果日志不存在，不提示错误，继续处理下一个</span></span><br><span class="line">nomissingok			<span class="comment"># 如果日志不存在，提示错误，此为默认值</span></span><br><span class="line">dateext				<span class="comment"># 切换后的日志文件会附加上一个短横线和 YYYYMMDD 格式的日期，没有这个配置项会附加一个小数点加一个数字序号</span></span><br><span class="line">dateformat			<span class="comment"># 配合 dateext 使用可以为切割后的日志加上 YYYYMMDD 格式的日期，如 dateformat -%Y%m%d</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logrotate nginx log</span></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/logrotate.d/nginx &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">$&#123;wwwlogs_dir&#125;/*nginx.log &#123;</span></span><br><span class="line"><span class="string">  daily</span></span><br><span class="line"><span class="string">  rotate 5</span></span><br><span class="line"><span class="string">  missingok</span></span><br><span class="line"><span class="string">  dateext</span></span><br><span class="line"><span class="string">  compress</span></span><br><span class="line"><span class="string">  notifempty</span></span><br><span class="line"><span class="string">  sharedscripts</span></span><br><span class="line"><span class="string">  postrotate</span></span><br><span class="line"><span class="string">    [ -f /usr/local/nginx/run/nginx.pid ] &amp;&amp; kill -USR1 \`cat /usr/local/nginx/run/nginx.pid\`</span></span><br><span class="line"><span class="string">  endscript</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E6%97%A5%E5%BF%97/" rel="tag"><i class="fa fa-tag"></i> 日志</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/Redis/Redis/" rel="prev" title="Redis">
                  <i class="fa fa-chevron-left"></i> Redis
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" rel="next" title="文件共享服务">
                  文件共享服务 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
