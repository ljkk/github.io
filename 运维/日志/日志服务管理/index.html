<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.to2b.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.to2b.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="系统日志将系统和应用发生的事件记录至日志中，以助于排错和分析使用： 日志记录的内容包括：  历史事件：事件、地点、人物、事件 日志级别：事件的关键程度 LogLevel  各种系统日志服务  sysklogd：CentOS 5 之前版本采用的日志管理系统服务 rsyslog：CentOS 6 以后版本的系统管理服务 多线程 UDP、TCP、SSL、TLS、RELP MySQL、PGSQL、Orac">
<meta property="og:type" content="article">
<meta property="og:title" content="日志服务管理">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="系统日志将系统和应用发生的事件记录至日志中，以助于排错和分析使用： 日志记录的内容包括：  历史事件：事件、地点、人物、事件 日志级别：事件的关键程度 LogLevel  各种系统日志服务  sysklogd：CentOS 5 之前版本采用的日志管理系统服务 rsyslog：CentOS 6 以后版本的系统管理服务 多线程 UDP、TCP、SSL、TLS、RELP MySQL、PGSQL、Orac">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1605012422975.png">
<meta property="article:published_time" content="2020-12-09T15:35:19.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.510Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="日志">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1605012422975.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/","path":"运维/日志/日志服务管理/","title":"日志服务管理"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>日志服务管理 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="nav-number">1.</span> <span class="nav-text">系统日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">常见日志文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsyslog"><span class="nav-number">2.</span> <span class="nav-text">rsyslog</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E7%BD%91%E7%BB%9C%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.2.</span> <span class="nav-text">启用网络日志服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#logger-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.3.</span> <span class="nav-text">logger 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-journalctl"><span class="nav-number">2.4.</span> <span class="nav-text">日志管理工具 journalctl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-1%EF%BC%9A%E5%88%A9%E7%94%A8-mysql-%E5%AD%98%E5%82%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="nav-number">3.</span> <span class="nav-text">实战案例 1：利用 mysql 存储日志信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-2%EF%BC%9A%E9%80%9A%E8%BF%87-loganalyzer-%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">4.</span> <span class="nav-text">实战案例 2：通过 loganalyzer 展示数据库中的日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#logrotate-%E6%97%A5%E5%BF%97%E8%BD%AC%E5%82%A8"><span class="nav-number">5.</span> <span class="nav-text">logrotate 日志转储</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.to2b.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="日志服务管理 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          日志服务管理
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 23:35:19" itemprop="dateCreated datePublished" datetime="2020-12-09T23:35:19+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h2><p>将系统和应用发生的事件记录至日志中，以助于排错和分析使用：</p>
<p>日志记录的内容包括：</p>
<ul>
<li>历史事件：事件、地点、人物、事件</li>
<li>日志级别：事件的关键程度 LogLevel</li>
</ul>
<p>各种系统日志服务</p>
<ul>
<li>sysklogd：CentOS 5 之前版本采用的日志管理系统服务</li>
<li>rsyslog：CentOS 6 以后版本的系统管理服务<ul>
<li>多线程</li>
<li>UDP、TCP、SSL、TLS、RELP</li>
<li>MySQL、PGSQL、Oracle 实现日志存储</li>
<li>强大的过滤器，可实现过滤记录日志信息中任意部分</li>
<li>自定义输出格式</li>
</ul>
</li>
<li>ELK：Elasticsearch + Logstash + Kibana</li>
</ul>
<h3 id="常见日志文件"><a href="#常见日志文件" class="headerlink" title="常见日志文件"></a>常见日志文件</h3><ul>
<li>&#x2F;var&#x2F;log&#x2F;secure：系统安全日志，文本格式，应周期性分析</li>
<li>&#x2F;var&#x2F;log&#x2F;btmp：当前系统上，用户的失败尝试登录相关的日志信息，二进制格式，lastb 命令进行查看</li>
<li>&#x2F;var&#x2F;log&#x2F;wtmp：当前系统上，用户正常登录系统的相关日志信息，二进制格式，last 命令可以查看</li>
<li>&#x2F;var&#x2F;log&#x2F;lastlog：每一个用户最近一次的登录信息，二进制格式，lastlog 命令可以查看</li>
<li>&#x2F;var&#x2F;log&#x2F;dmesg：CentOS7 之前版本系统引导过程中的日志信息，文本格式，开机后的硬件变化将不再记录专用命令 dmesg 查看，可持续记录硬件变化的情况</li>
<li>&#x2F;var&#x2F;log&#x2F;boot.log：系统服务启动的相关信息，文本格式</li>
<li>&#x2F;var&#x2F;log&#x2F;messages ：系统中大部分的信息</li>
<li>&#x2F;var&#x2F;log&#x2F;anaconda : anaconda 的日志</li>
</ul>
<h2 id="rsyslog"><a href="#rsyslog" class="headerlink" title="rsyslog"></a>rsyslog</h2><p>facility：设施，或者叫设备，从功能或程序上对日志进行归类</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">auth、authpriv、cron、daemon、ftp、kern、lpr、mail、news、security<span class="token punctuation">(</span>auth<span class="token punctuation">)</span>、user、uucp、syslog

auth            <span class="token comment"># pam产生的日志</span>
authpriv        <span class="token comment"># ssh,ftp等登录信息的验证信息</span>
<span class="token function">cron</span>            <span class="token comment"># 时间任务相关</span>
kern            <span class="token comment"># 内核</span>
<span class="token function">lpr</span>             <span class="token comment"># 打印</span>
mail            <span class="token comment"># 邮件</span>
mark<span class="token punctuation">(</span>syslog<span class="token punctuation">)</span>    <span class="token comment"># rsyslog服务内部的信息,时间标识</span>
news            <span class="token comment"># 新闻组</span>
user            <span class="token comment"># 用户程序产生的相关信息</span>
uucp            <span class="token comment"># unix to unix copy, unix主机之间相关的通讯</span>

local0-local7 	<span class="token comment"># 自定义的日志设施</span></code></pre>

<p>priority：优先级别，从低到高排序</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">debug、info、notice、warn<span class="token punctuation">(</span>warning<span class="token punctuation">)</span>、err<span class="token punctuation">(</span>error<span class="token punctuation">)</span>、crit<span class="token punctuation">(</span>critical<span class="token punctuation">)</span>、alert、emerg<span class="token punctuation">(</span>panic<span class="token punctuation">)</span>

debug   <span class="token comment"># 有调式信息的，日志信息最多</span>
info    <span class="token comment"># 一般信息的日志，最常用</span>
notice  <span class="token comment"># 最具有重要性的普通条件的信息</span>
warning <span class="token comment"># 警告级别</span>
err     <span class="token comment"># 错误级别，阻止某个功能或者模块不能正常工作的信息</span>
crit    <span class="token comment"># 严重级别，阻止整个系统或者整个软件不能正常工作的信息</span>
alert   <span class="token comment"># 需要立刻修改的信息</span>
emerg   <span class="token comment"># 内核崩溃等严重信息</span>
none    <span class="token comment"># 什么都不记录</span></code></pre>

<p>参看帮助： <code>man 3 syslog</code>，<code>man logger</code></p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>配置文件：&#x2F;etc&#x2F;rsyslog.conf 和 &#x2F;etc&#x2F;rsyslog.d&#x2F;*</p>
<p>&#x2F;etc&#x2F;rsyslog.conf 配置文件格式，由三部分组成：</p>
<ul>
<li>MODULES：相关模块配置</li>
<li>GLOBAL DIRECTIVES：全局配置</li>
<li>RULES：日志记录相关的规则配置</li>
</ul>
<p>RULES 配置格式：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 设施.优先级; 设施.优先级; 设施.优先级...    目标</span>
facility.priority<span class="token punctuation">;</span> facility.priority<span class="token punctuation">..</span>. target


<span class="token comment"># facility 格式：</span>
*	<span class="token comment"># 所有的facility</span>
facility1,facility2,facility3,<span class="token punctuation">..</span>.	<span class="token comment"># 指定的facility列表</span>

<span class="token comment"># priority 格式：</span>
*			<span class="token comment"># 所有级别</span>
none		<span class="token comment"># 没有级别，即不记录</span>
PRIORITY	<span class="token comment"># 指定级别（含）以上的所有级别</span>
<span class="token operator">=</span>PRIORITY	<span class="token comment"># 仅记录指定级别的日志信息</span>

<span class="token comment"># target 格式：</span>
文件路径			<span class="token comment"># 通常在/var/log/目录下，文件路径前的-表示异步写入</span>
用户				<span class="token comment"># 将日志事件通知给指定的用户，*表示登录的所有用户</span>
日志服务器			<span class="token comment"># @host：日志发送到指定的远程UDP日志服务器；@@host：日志发送到指定的远程TCP日志服务器</span>
管道				<span class="token comment"># | command：转发给其他命令处理</span></code></pre>

<p>日志文件有很多，如：&#x2F;var&#x2F;log&#x2F;message、cron、secure 等，基本格式都是类似的，如下：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">事件产生的日期时间	主机	进程<span class="token punctuation">(</span>pid<span class="token punctuation">)</span>：事件内容</code></pre>

<p>范例：将 ssh 服务的日志记录到自定义的 local 的日志设备</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 修改sshd的配置，然后 Service sshd reload 重启</span>
Vim /etc/ssh/sshd_config
SyslogFacility local2

<span class="token comment"># 修改rsyslog的配置，然后 Systemctl restart rsyslog 重启</span>
Vim /etc/rsyslog.conf
Local2.* /var/log/sshd.log

<span class="token comment"># 测试</span>
Ssh登录后，查看/var/log/sshd.log有记录

<span class="token comment">#logger测试</span>
logger <span class="token parameter variable">-p</span> local2.info <span class="token string">"hello sshd"</span>
<span class="token function">tail</span> /var/log/sshd.log有记录</code></pre>

<h3 id="启用网络日志服务"><a href="#启用网络日志服务" class="headerlink" title="启用网络日志服务"></a>启用网络日志服务</h3><p>启用网络日志服务功能，可以将多个远程主机的日志，发送到集中的日志服务器，方便统一管理。</p>
<p>范例：启用网络日志功能</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># centos8</span>
module<span class="token punctuation">(</span>load<span class="token operator">=</span><span class="token string">"imudp"</span><span class="token punctuation">)</span>			<span class="token comment"># udp</span>
input<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">"imudp"</span> <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"514"</span><span class="token punctuation">)</span>
module<span class="token punctuation">(</span>load<span class="token operator">=</span><span class="token string">"imtcp"</span><span class="token punctuation">)</span>			<span class="token comment"># tcp</span>
input<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">"imtcp"</span> <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"514"</span><span class="token punctuation">)</span>

<span class="token comment"># centos6、7</span>
<span class="token variable">$ModLoad</span> imudp			<span class="token comment"># udp</span>
<span class="token variable">$UDPServerRun</span> <span class="token number">514</span>
<span class="token variable">$ModLoad</span> imtcp			<span class="token comment"># tcp</span>
<span class="token variable">$InputTCPServerRun</span> <span class="token number">514</span>


<span class="token comment"># 测试：在客户端指定将日志发送到远程的TCP、UDP的日志服务器</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment">#vim /etc/rsyslog.conf</span>
*.info<span class="token punctuation">;</span>mail.none<span class="token punctuation">;</span>authpriv.none<span class="token punctuation">;</span>cron.none	/var/log/messages
*.info<span class="token punctuation">;</span>mail.none<span class="token punctuation">;</span>authpriv.none<span class="token punctuation">;</span>cron.none	@@10.0.0.18			<span class="token comment"># tcp</span>
*.info<span class="token punctuation">;</span>mail.none<span class="token punctuation">;</span>authpriv.none<span class="token punctuation">;</span>cron.none	@10.0.0.18			<span class="token comment"># udp</span></code></pre>

<h3 id="logger-命令"><a href="#logger-命令" class="headerlink" title="logger 命令"></a>logger 命令</h3><p>logger 命令可以往系统日志中写入信息</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">logger <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>message<span class="token operator">></span><span class="token punctuation">]</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$logger</span> <span class="token parameter variable">--help</span>

Usage:
 logger <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>message<span class="token operator">></span><span class="token punctuation">]</span>

Enter messages into the system log.

Options:
 <span class="token parameter variable">-i</span>                       log the logger command's PID
     --id<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>id<span class="token operator">></span><span class="token punctuation">]</span>          log the given <span class="token operator">&lt;</span>id<span class="token operator">></span>, or otherwise the PID
 -f, <span class="token parameter variable">--file</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>        log the contents of this <span class="token function">file</span>
 -e, --skip-empty         <span class="token keyword">do</span> not log empty lines when processing files
     --no-act             <span class="token keyword">do</span> everything except the <span class="token function">write</span> the log
 -p, <span class="token parameter variable">--priority</span> <span class="token operator">&lt;</span>prio<span class="token operator">></span>    mark given message with this priority
     --octet-count        use rfc6587 octet counting
     --prio-prefix        <span class="token function">look</span> <span class="token keyword">for</span> a prefix on every line <span class="token builtin class-name">read</span> from stdin
 -s, <span class="token parameter variable">--stderr</span>             output message to standard error as well
 -S, <span class="token parameter variable">--size</span> <span class="token operator">&lt;</span>size<span class="token operator">></span>        maximum size <span class="token keyword">for</span> a single message
 -t, <span class="token parameter variable">--tag</span> <span class="token operator">&lt;</span>tag<span class="token operator">></span>          mark every line with this tag
 -n, <span class="token parameter variable">--server</span> <span class="token operator">&lt;</span>name<span class="token operator">></span>      <span class="token function">write</span> to this remote syslog server
 -P, <span class="token parameter variable">--port</span> <span class="token operator">&lt;</span>port<span class="token operator">></span>        use this port <span class="token keyword">for</span> UDP or TCP connection
 -T, <span class="token parameter variable">--tcp</span>                use TCP only
 -d, <span class="token parameter variable">--udp</span>                use UDP only
     <span class="token parameter variable">--rfc3164</span>            use the obsolete BSD syslog protocol
     --rfc5424<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>snip<span class="token operator">></span><span class="token punctuation">]</span>   use the syslog protocol <span class="token punctuation">(</span>the default <span class="token keyword">for</span> remote<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token operator">&lt;</span>snip<span class="token operator">></span> can be notime, or notq, and/or nohost
     --sd-id <span class="token operator">&lt;</span>id<span class="token operator">></span>         rfc5424 structured data ID
     --sd-param <span class="token operator">&lt;</span>data<span class="token operator">></span>    rfc5424 structured data <span class="token assign-left variable">name</span><span class="token operator">=</span>value
     <span class="token parameter variable">--msgid</span> <span class="token operator">&lt;</span>msgid<span class="token operator">></span>      <span class="token builtin class-name">set</span> rfc5424 message <span class="token function">id</span> field
 -u, <span class="token parameter variable">--socket</span> <span class="token operator">&lt;</span>socket<span class="token operator">></span>    <span class="token function">write</span> to this Unix socket
     --socket-errors<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>on<span class="token operator">|</span>off<span class="token operator">|</span>auto<span class="token operator">></span><span class="token punctuation">]</span>
                          print connection errors when using Unix sockets
     --journald<span class="token punctuation">[</span><span class="token operator">=</span><span class="token operator">&lt;</span>file<span class="token operator">></span><span class="token punctuation">]</span>  <span class="token function">write</span> journald entry

 -h, <span class="token parameter variable">--help</span>               display this <span class="token builtin class-name">help</span>
 -V, <span class="token parameter variable">--version</span>            display version

For <span class="token function">more</span> details see logger<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>.</code></pre>

<h3 id="日志管理工具-journalctl"><a href="#日志管理工具-journalctl" class="headerlink" title="日志管理工具 journalctl"></a>日志管理工具 journalctl</h3><p>CentOS7 以后版本利用 Systemd 统一管理所有 Unit 的启动日志。带来的好处就是，可以只用 journalctl 一个命令，查看所有日志（内核日志和应用日志）</p>
<p>配置文件：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">/etc/systemd/journald.conf</code></pre>

<p>命令格式：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">journalctl <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>MATCHES<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre>

<p>OPTIONS：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">--no-full, --full, <span class="token parameter variable">-l</span>
  如果字段内容超长则以省略号<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>截断以适应列宽。
  默认显示完整的字段内容<span class="token punctuation">(</span>超长的部分换行显示或者被分页工具截断<span class="token punctuation">)</span>。
  老旧的 -l/--full 选项 仅用于撤销已有的 --no-full 选项，除此之外没有其他用处。
-a, <span class="token parameter variable">--all</span>
  完整显示所有字段内容， 即使其中包含不可打印字符或者字段内容超长。
-f, <span class="token parameter variable">--follow</span>
  只显示最新的日志项，并且不断显示新生成的日志项。 此选项隐含了 <span class="token parameter variable">-n</span> 选项。
-e, --pager-end
  在分页工具内立即跳转到日志的尾部。 此选项隐含了 <span class="token parameter variable">-n1000</span> 以确保分页工具不必缓存太多的日志行。 不过这个隐含的行数可以被明确设置的 <span class="token parameter variable">-n</span> 选项覆盖。 注意，此选项仅可用于 less<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 分页器。
-n, <span class="token parameter variable">--lines</span><span class="token operator">=</span>
  限制显示最新的日志行数。 --pager-end 与 <span class="token parameter variable">--follow</span> 隐含了此选项。
  此选项的参数：若为正整数则表示最大行数； 若为 <span class="token string">"all"</span> 则表示不限制行数；
  若不设参数则表示默认值10行。
--no-tail
  显示所有日志行， 也就是用于撤销已有的 <span class="token parameter variable">--lines</span><span class="token operator">=</span> 选项<span class="token punctuation">(</span>即使与 <span class="token parameter variable">-f</span> 连用<span class="token punctuation">)</span>。
-r, <span class="token parameter variable">--reverse</span>
  反转日志行的输出顺序， 也就是最先显示最新的日志。
-o, <span class="token parameter variable">--output</span><span class="token operator">=</span>
  控制日志的输出格式。 可以使用如下选项：
  short
    这是默认值， 其输出格式与传统的 syslog<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 文件的格式相似， 每条日志一行。
  short-iso
    与 short 类似，只是将时间戳字段以 ISO <span class="token number">8601</span> 格式显示。
  short-precise
    与 short 类似，只是将时间戳字段的秒数精确到微秒级别。
  short-monotonic
    与 short 类似，只是将时间戳字段的零值从内核启动时开始计算。
  short-unix
    与 short 类似，只是将时间戳字段显示为从<span class="token string">"UNIX时间原点"</span><span class="token punctuation">(</span><span class="token number">1970</span>-1-1 00:00:00 UTC<span class="token punctuation">)</span>以来的秒数。 精确到微秒级别。
  verbose
    以结构化的格式显示每条日志的所有字段。
  <span class="token builtin class-name">export</span>
    将日志序列化为二进制字节流<span class="token punctuation">(</span>大部分依然是文本<span class="token punctuation">)</span> 以适用于备份与网络传输<span class="token punctuation">(</span>详见Journal Export Format<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 文档<span class="token punctuation">)</span>。
  json
    将日志项按照JSON数据结构格式化， 每条日志一行<span class="token punctuation">(</span>详见 Journal JSON Format<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>文档<span class="token punctuation">)</span>。
  json-pretty
    将日志项按照JSON数据结构格式化， 但是每个字段一行， 以便于人类阅读。
  json-sse
    将日志项按照JSON数据结构格式化，每条日志一行，但是用大括号包围， 以适应 Server-Sent Events<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> 的要求。
  <span class="token function">cat</span>
    仅显示日志的实际内容， 而不显示与此日志相关的任何元数据<span class="token punctuation">(</span>包括时间戳<span class="token punctuation">)</span>。
<span class="token parameter variable">--utc</span>
  以世界统一时间<span class="token punctuation">(</span>UTC<span class="token punctuation">)</span>表示时间
--no-hostname
  不显示来源于本机的日志消息的主机名字段。 此选项仅对 short 系列输出格式<span class="token punctuation">(</span>见上文<span class="token punctuation">)</span>有效。
-x, <span class="token parameter variable">--catalog</span>
  在日志的输出中增加一些解释性的短文本， 以帮助进一步说明日志的含义、问题的解决方案、支持论坛、 开发文档、以及其他任何内容。
  并非所有日志都有这些额外的帮助文本， 详见 Message Catalog Developer Documentation<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> 文档。
  注意，如果要将日志输出用于bug报告， 请不要使用此选项。
-q, <span class="token parameter variable">--quiet</span>
  当以普通用户身份运行时， 不显示任何警告信息与提示信息。例如：<span class="token string">"-- Logs begin at ..."</span>, <span class="token string">"-- Reboot --"</span>
-m, <span class="token parameter variable">--merge</span>
  混合显示包括远程日志在内的所有可见日志。
<span class="token parameter variable">-b</span> <span class="token punctuation">[</span>ID<span class="token punctuation">]</span><span class="token punctuation">[</span>±offset<span class="token punctuation">]</span>, <span class="token parameter variable">--boot</span><span class="token operator">=</span><span class="token punctuation">[</span>ID<span class="token punctuation">]</span><span class="token punctuation">[</span>±offset<span class="token punctuation">]</span>
  显示特定于某次启动的日志， 这相当于添加了一个 <span class="token string">"_BOOT_ID="</span> 匹配条件。
  如果参数为空<span class="token punctuation">(</span>也就是 ID 与 ±offset 都未指定<span class="token punctuation">)</span>， 则表示仅显示本次启动的日志。
  如果省略了 ID ， 那么当 ±offset 是正数的时候， 将从日志头开始正向查找，否则<span class="token punctuation">(</span>也就是为负数或零<span class="token punctuation">)</span>将从日志尾开始反响查找。 举例来说， <span class="token string">"-b 1"</span>表示按时间顺序排列最早的那次启动， <span class="token string">"-b 2"</span>则表示在时间上第二早的那次启动； <span class="token string">"-b -0"</span>表示最后一次启动， <span class="token string">"-b -1"</span>表示在时间上第二近的那次启动， 以此类推。 如果 ±offset 也省略了， 那么相当于<span class="token string">"-b -0"</span>， 除非本次启动不是最后一次启动<span class="token punctuation">(</span>例如用--directory 指定了另外一台主机上的日志目录<span class="token punctuation">)</span>。如果指定了32字符的 ID ， 那么表示以此 ID 所代表的那次启动为基准计算偏移量<span class="token punctuation">(</span>±offset<span class="token punctuation">)</span>， 计算方法同上。 换句话说， 省略 ID 表示以本次启动为基准计算偏移量<span class="token punctuation">(</span>±offset<span class="token punctuation">)</span>。
--list-boots
  列出每次启动的 序号<span class="token punctuation">(</span>也就是相对于本次启动的偏移量<span class="token punctuation">)</span>、32字符的ID、第一条日志的时间戳、最后一条日志的时间戳。
-k, <span class="token parameter variable">--dmesg</span>
  仅显示内核日志。隐含了 <span class="token parameter variable">-b</span> 选项以及 <span class="token string">"_TRANSPORT=kernel"</span> 匹配项。
-t, <span class="token parameter variable">--identifier</span><span class="token operator">=</span>SYSLOG_IDENTIFIER
  仅显示 syslog<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> 识别符为 SYSLOG_IDENTIFIER 的日志项。
  可以多次使用该选项以指定多个识别符。
-u, <span class="token parameter variable">--unit</span><span class="token operator">=</span>UNIT<span class="token operator">|</span>PATTERN
  仅显示属于特定单元的日志。 也就是单元名称正好等于 UNIT 或者符合 PATTERN 模式的单元。 这相当于添加了一个 <span class="token string">"_SYSTEMD_UNIT=UNIT"</span> 匹配项<span class="token punctuation">(</span>对于 UNIT 来说<span class="token punctuation">)</span>，或一组匹配项<span class="token punctuation">(</span>对于 PATTERN 来说<span class="token punctuation">)</span>。可以多次使用此选项以添加多个并列的匹配条件<span class="token punctuation">(</span>相当于用<span class="token string">"OR"</span>逻辑连接<span class="token punctuation">)</span>。
--user-unit<span class="token operator">=</span>
  仅显示属于特定用户会话单元的日志。 相当于同时添加了 <span class="token string">"_SYSTEMD_USER_UNIT="</span> 与
<span class="token string">"_UID="</span> 两个匹配条件。
  可以多次使用此选项以添加多个并列的匹配条件<span class="token punctuation">(</span>相当于用<span class="token string">"OR"</span>逻辑连接<span class="token punctuation">)</span>。
-p, <span class="token parameter variable">--priority</span><span class="token operator">=</span>
  根据日志等级<span class="token punctuation">(</span>包括等级范围<span class="token punctuation">)</span>过滤输出结果。 日志等级数字与其名称之间的对应关系如下 <span class="token punctuation">(</span>参见 syslog<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">))</span>： <span class="token string">"emerg"</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>, <span class="token string">"alert"</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>, <span class="token string">"crit"</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>, <span class="token string">"err"</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>,<span class="token string">"warning"</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>, <span class="token string">"notice"</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>, <span class="token string">"info"</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>, <span class="token string">"debug"</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> 。
  若设为一个单独的数字或日志等级名称， 则表示仅显示小于或等于此等级的日志<span class="token punctuation">(</span>也就是重要程度等于或高于此等级的日志<span class="token punctuation">)</span>。 若使用 FROM<span class="token punctuation">..</span>TO<span class="token punctuation">..</span> 设置一个范围，则表示仅显示指定的等级范围内<span class="token punctuation">(</span>含两端<span class="token punctuation">)</span>的日志。 此选项相当于添加了 <span class="token string">"PRIORITY="</span>匹配条件。
-c, <span class="token parameter variable">--cursor</span><span class="token operator">=</span>
  从指定的游标<span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>开始显示日志。
  <span class="token punctuation">[</span>提示<span class="token punctuation">]</span>每条日志都有一个<span class="token string">"__CURSOR"</span>字段，类似于该条日志的指纹。
--after-cursor<span class="token operator">=</span>
  从指定的游标<span class="token punctuation">(</span>cursor<span class="token punctuation">)</span>之后开始显示日志。 如果使用了 --show-cursor 选项，则也会显示游标本身。
--show-cursor
  在最后一条日志之后显示游标， 类似下面这样，以<span class="token string">"--"</span>开头：
-- cursor: <span class="token assign-left variable">s</span><span class="token operator">=</span>0639<span class="token punctuation">..</span>.
  游标的具体格式是私有的<span class="token punctuation">(</span>也就是没有公开的规范<span class="token punctuation">)</span>， 并且会变化。
-S, <span class="token parameter variable">--since</span><span class="token operator">=</span>, -U, <span class="token parameter variable">--until</span><span class="token operator">=</span>
  显示晚于指定时间<span class="token punctuation">(</span>--since<span class="token operator">=</span><span class="token punctuation">)</span>的日志、显示早于指定时间<span class="token punctuation">(</span>--until<span class="token operator">=</span><span class="token punctuation">)</span>的日志。
  参数的格式类似 <span class="token string">"2012-10-30 18:17:16"</span> 这样。 如果省略了<span class="token string">"时:分:秒"</span>部分，则相当于设为 <span class="token string">"00:00:00"</span> 。 如果仅省略了<span class="token string">"秒"</span>的部分则相当于设为 <span class="token string">":00"</span> 。如果省略了<span class="token string">"年-月-日"</span>部分， 则相当于设为当前日期。 除了<span class="token string">"年-月-日 时:分:秒"</span>格式，参数还可以进行如下设置：
  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>设为 <span class="token string">"yesterday"</span>, <span class="token string">"today"</span>, <span class="token string">"tomorrow"</span>以表示那一天的零点<span class="token punctuation">(</span>00:00:00<span class="token punctuation">)</span>。
  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>设为 <span class="token string">"now"</span> 以表示当前时间。
  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>可以在<span class="token string">"年-月-日 时:分:秒"</span>前加上 <span class="token string">"-"</span><span class="token punctuation">(</span>前移<span class="token punctuation">)</span> 或 <span class="token string">"+"</span><span class="token punctuation">(</span>后移<span class="token punctuation">)</span>前缀以表示相对于当前时间的偏移。 关于时间与日期的详细规范， 参见systemd.time<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
-F, <span class="token parameter variable">--field</span><span class="token operator">=</span>
  显示所有日志中某个字段的所有可能值。 <span class="token punctuation">[</span>译者注<span class="token punctuation">]</span>类似于SQL语句：<span class="token string">"SELECT DISTINCT 某字段 FROM 全部日志"</span>
-N, <span class="token parameter variable">--fields</span>
  输出所有日志字段的名称
--system, <span class="token parameter variable">--user</span>
  仅显示系统服务与内核的日志<span class="token punctuation">(</span>--system<span class="token punctuation">)</span>、 仅显示当前用户的日志<span class="token punctuation">(</span>--user<span class="token punctuation">)</span>。
  如果两个选项都未指定，则显示当前用户的所有可见日志。
-M, <span class="token parameter variable">--machine</span><span class="token operator">=</span>
  显示来自于正在运行的、特定名称的本地容器的日志。 参数必须是一个本地容器的名称。
<span class="token parameter variable">-D</span> DIR, <span class="token parameter variable">--directory</span><span class="token operator">=</span>DIR
  仅显示来自于特定目录中的日志， 而不是默认的运行时和系统日志目录中的日志。
<span class="token parameter variable">--file</span><span class="token operator">=</span>GLOB
  GLOB 是一个可以包含<span class="token string">"?"</span>与<span class="token string">"*"</span>的文件路径匹配模式。 表示仅显示来自与指定的 GLOB模式匹配的文件中的日志， 而不是默认的运行时和系统日志目录中的日志。可以多次使用此选项以指定多个匹配模式<span class="token punctuation">(</span>多个模式之间用<span class="token string">"OR"</span>逻辑连接<span class="token punctuation">)</span>。
<span class="token parameter variable">--root</span><span class="token operator">=</span>ROOT
  在对日志进行操作时， 将 ROOT 视为系统的根目录。 例如 --update-catalog 将会创建ROOT/var/lib/systemd/catalog/database
--new-id128
  此选项并不用于显示日志内容， 而是用于重新生成一个标识日志分类的 <span class="token number">128</span>-bit ID 。
  此选项的目的在于 帮助开发者生成易于辨别的日志消息， 以方便调试。
<span class="token parameter variable">--header</span>
  此选项并不用于显示日志内容， 而是用于显示日志文件内部的头信息<span class="token punctuation">(</span>类似于元数据<span class="token punctuation">)</span>。
--disk-usage
  此选项并不用于显示日志内容，而是用于显示所有日志文件<span class="token punctuation">(</span>归档文件与活动文件<span class="token punctuation">)</span>的磁盘占用总量。
--vacuum-size<span class="token operator">=</span>, --vacuum-time<span class="token operator">=</span>, --vacuum-files<span class="token operator">=</span>
  这些选项并不用于显示日志内容，而是用于清理日志归档文件<span class="token punctuation">(</span>并不清理活动的日志文件<span class="token punctuation">)</span>， 以释放磁盘空间。
--vacuum-size<span class="token operator">=</span> 可用于限制归档文件的最大磁盘使用量 <span class="token punctuation">(</span>可以使用 <span class="token string">"K"</span>, <span class="token string">"M"</span>, <span class="token string">"G"</span>, <span class="token string">"T"</span>后缀<span class="token punctuation">)</span>；
--vacuum-time<span class="token operator">=</span> 可用于清除指定时间之前的归档 <span class="token punctuation">(</span>可以使用 <span class="token string">"s"</span>, <span class="token string">"m"</span>, <span class="token string">"h"</span>,<span class="token string">"days"</span>, <span class="token string">"weeks"</span>, <span class="token string">"months"</span>, <span class="token string">"years"</span> 后缀<span class="token punctuation">)</span>；
--vacuum-files<span class="token operator">=</span> 可用于限制日志归档文件的最大数量。 注意，--vacuum-size<span class="token operator">=</span> 对 --disk-usage的输出仅有间接效果， 因为 --disk-usage 输出的是归档日志与活动日志的总量。同样，--vacuum-files<span class="token operator">=</span> 也未必一定会减少日志文件的总数，因为它同样仅作用于归档文件而不会删除活动的日志文件。此三个选项可以同时使用，以同时从三个维度去限制归档文件。若将某选项设为零，则表示取消此选项的限制。
--list-catalog <span class="token punctuation">[</span><span class="token number">128</span>-bit-ID<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
  简要列出日志分类信息， 其中包括对分类信息的简要描述。
  如果明确指定了分类ID<span class="token punctuation">(</span><span class="token number">128</span>-bit-ID<span class="token punctuation">)</span>， 那么仅显示指定的分类。
--dump-catalog <span class="token punctuation">[</span><span class="token number">128</span>-bit-ID<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
  详细列出日志分类信息 <span class="token punctuation">(</span>格式与 .catalog 文件相同<span class="token punctuation">)</span>。
  如果明确指定了分类ID<span class="token punctuation">(</span><span class="token number">128</span>-bit-ID<span class="token punctuation">)</span>， 那么仅显示指定的分类。
--update-catalog
  更新日志分类索引二进制文件。
  每当安装、删除、更新了分类文件，都需要执行一次此动作。
--setup-keys
  此选项并不用于显示日志内容， 而是用于生成一个新的FSS<span class="token punctuation">(</span>Forward Secure Sealing<span class="token punctuation">)</span>密钥对。 此密钥对包含一个<span class="token string">"sealing key"</span>与一个<span class="token string">"verification key"</span>。<span class="token string">"sealing key"</span>保存在本地日志目录中， 而<span class="token string">"verification key"</span>则必须保存在其他地方。详见 journald.conf<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> 中的 <span class="token assign-left variable">Seal</span><span class="token operator">=</span> 选项。
<span class="token parameter variable">--force</span>
  与 --setup-keys 连用， 表示即使已经配置了FSS<span class="token punctuation">(</span>Forward Secure Sealing<span class="token punctuation">)</span>密钥对，也要强制重新生成。
<span class="token parameter variable">--interval</span><span class="token operator">=</span>
  与 --setup-keys 连用，指定<span class="token string">"sealing key"</span>的变化间隔。
  较短的时间间隔会导致占用更多的CPU资源， 但是能够减少未检测的日志变化时间。
  默认值是 15min
<span class="token parameter variable">--verify</span>
  检查日志文件的内在一致性。 如果日志文件在生成时开启了FSS特性， 并且使用
--verify-key<span class="token operator">=</span> 指定了FSS的<span class="token string">"verification key"</span>，
  那么，同时还将验证日志文件的真实性。
--verify-key<span class="token operator">=</span>
  与 <span class="token parameter variable">--verify</span> 选项连用， 指定FSS的<span class="token string">"verification key"</span>
<span class="token parameter variable">--sync</span>
  要求日志守护进程将所有未写入磁盘的日志数据刷写到磁盘上，并且一直阻塞到刷写操作实际完成之后才返回。 因此该命令可以保证当它返回的时候，所有在调用此命令的时间点之前的日志， 已经全部安全的刷写到了磁盘中。
<span class="token parameter variable">--flush</span>
  要求日志守护进程 将 /run/log/journal 中的日志数据 刷写到 /var/log/journal 中<span class="token punctuation">(</span>如果持久存储设备当前可用的话<span class="token punctuation">)</span>。 此操作会一直阻塞到操作完成之后才会返回，因此可以确保在该命令返回时， 数据转移确实已经完成。
  注意，此命令仅执行一个单独的、一次性的转移动作， 若没有数据需要转移，则此命令什么也不做， 并且也会返回一个表示操作已正确完成的返回值。
<span class="token parameter variable">--rotate</span>
  要求日志守护进程滚动日志文件。 此命令会一直阻塞到滚动完成之后才会返回。
-h, <span class="token parameter variable">--help</span>
  显示简短的帮助信息并退出。
<span class="token parameter variable">--version</span>
  显示简短的版本信息并退出。
--no-pager
  不将程序的输出内容管道<span class="token punctuation">(</span>pipe<span class="token punctuation">)</span>给分页程序</code></pre>

<p>范例：journalctl 用法</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#查看所有日志（默认情况下 ，只保存本次启动的日志）</span>
journalctl
<span class="token comment">#查看内核日志（不显示应用日志）</span>
journalctl <span class="token parameter variable">-k</span>
<span class="token comment">#查看系统本次启动的日志</span>
journalctl <span class="token parameter variable">-b</span>
journalctl <span class="token parameter variable">-b</span> <span class="token parameter variable">-0</span>
<span class="token comment">#查看上一次启动的日志（需更改设置）</span>
journalctl <span class="token parameter variable">-b</span> <span class="token parameter variable">-1</span>
<span class="token comment">#查看指定时间的日志</span>
journalctl <span class="token parameter variable">--since</span><span class="token operator">=</span><span class="token string">"2017-10-30 18:10:30"</span>
journalctl <span class="token parameter variable">--since</span> <span class="token string">"20 min ago"</span>
journalctl <span class="token parameter variable">--since</span> yesterday
journalctl <span class="token parameter variable">--since</span> <span class="token string">"2017-01-10"</span> <span class="token parameter variable">--until</span> <span class="token string">"2017-01-11 03:00"</span>
journalctl <span class="token parameter variable">--since</span> 09:00 <span class="token parameter variable">--until</span> <span class="token string">"1 hour ago"</span>
<span class="token comment">#显示尾部的最新10行日志</span>
journalctl <span class="token parameter variable">-n</span>
<span class="token comment">#显示尾部指定行数的日志</span>
journalctl <span class="token parameter variable">-n</span> <span class="token number">20</span>
<span class="token comment">#实时滚动显示最新日志</span>
journalctl <span class="token parameter variable">-f</span>
<span class="token comment">#查看指定服务的日志</span>
journalctl /usr/lib/systemd/systemd
<span class="token comment">#查看指定进程的日志</span>
journalctl <span class="token assign-left variable">_PID</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#查看某个路径的脚本的日志</span>
journalctl /usr/bin/bash
<span class="token comment">#查看指定用户的日志</span>
journalctl <span class="token assign-left variable">_UID</span><span class="token operator">=</span><span class="token number">33</span> <span class="token parameter variable">--since</span> today
<span class="token comment">#查看某个 Unit 的日志</span>
journalctl <span class="token parameter variable">-u</span> nginx.service
journalctl <span class="token parameter variable">-u</span> nginx.service <span class="token parameter variable">--since</span> today
<span class="token comment">#实时滚动显示某个 Unit 的最新日志</span>
journalctl <span class="token parameter variable">-u</span> nginx.service <span class="token parameter variable">-f</span>
<span class="token comment">#合并显示多个 Unit 的日志</span>
journalctl <span class="token parameter variable">-u</span> nginx.service <span class="token parameter variable">-u</span> php-fpm.service <span class="token parameter variable">--since</span> today
<span class="token comment">#查看指定优先级（及其以上级别）的日志，共有8级</span>
<span class="token number">0</span>: emerg
<span class="token number">1</span>: alert
<span class="token number">2</span>: crit
<span class="token number">3</span>: err
<span class="token number">4</span>: warning
<span class="token number">5</span>: notice
<span class="token number">6</span>: info
<span class="token number">7</span>: debug
journalctl <span class="token parameter variable">-p</span> err <span class="token parameter variable">-b</span>
<span class="token comment">#日志默认分页输出，--no-pager 改为正常的标准输出</span>
journalctl --no-pager
<span class="token comment">#日志管理journalctl</span>
<span class="token comment">#以 JSON 格式（单行）输出</span>
journalctl <span class="token parameter variable">-b</span> <span class="token parameter variable">-u</span> nginx.service <span class="token parameter variable">-o</span> json
<span class="token comment">#以 JSON 格式（多行）输出，可读性更好</span>
journalctl <span class="token parameter variable">-b</span> <span class="token parameter variable">-u</span> nginx.serviceqq <span class="token parameter variable">-o</span> json-pretty
<span class="token comment">#显示日志占据的硬盘空间</span>
journalctl --disk-usage
<span class="token comment">#指定日志文件占据的最大空间</span>
journalctl --vacuum-size<span class="token operator">=</span>1G
<span class="token comment">#指定日志文件保存多久</span>
journalctl --vacuum-time<span class="token operator">=</span>1years</code></pre>

<h2 id="实战案例-1：利用-mysql-存储日志信息"><a href="#实战案例-1：利用-mysql-存储日志信息" class="headerlink" title="实战案例 1：利用 mysql 存储日志信息"></a>实战案例 1：利用 mysql 存储日志信息</h2><p>目标：将 rsyslog 收集的日志记录在 mysql 中</p>
<p>环境：两台主机</p>
<ol>
<li>rsyslog 日志服务器：10.0.0.71</li>
<li>mysql 数据库服务器：10.0.0.72</li>
</ol>
<p>实现：</p>
<ol>
<li>10.0.0.71 安装 rsyslog-mysql</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$yum</span> <span class="token function">install</span> rsyslog-mysql.x86_64
<span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$rpm</span> <span class="token parameter variable">-ql</span> rsyslog-mysql
/usr/lib64/rsyslog/ommysql.so
/usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql	<span class="token comment"># sql文件</span>
<span class="token comment"># 拷贝到数据库服务器</span>
<span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$scp</span> /usr/share/doc/rsyslog-8.24.0/mysql-createDB.sql root@10.0.0.72:/data</code></pre>

<ol start="2">
<li>10.0.0.72 配置 mysql</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@c72 ~<span class="token punctuation">]</span><span class="token variable">$mysql</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span>
<span class="token punctuation">..</span>.
<span class="token number">11</span>:27:05<span class="token punctuation">(</span>root@localhost<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token builtin class-name">source</span> /data/mysql-createDB.sql	<span class="token comment"># 导入数据表</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
Database changed
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
<span class="token comment"># 创建rsyslog用户，提供给日志服务，用来连接数据库</span>
08:25:34<span class="token punctuation">(</span>root@localhost<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> CREATE <span class="token environment constant">USER</span> <span class="token string">'rsyslog'</span>@<span class="token string">'10.0.0.%'</span> IDENTIFIED BY <span class="token string">"123456"</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
08:25:39<span class="token punctuation">(</span>root@localhost<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL ON *.* TO <span class="token string">'rsyslog'</span>@<span class="token string">'10.0.0.%'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span></code></pre>

<ol start="3">
<li>10.0.0.71 修改 rsyslog 配置文件</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$vim</span> /etc/rsyslog.conf
<span class="token punctuation">..</span>.
<span class="token comment"># 在MODULES下添加：</span>
<span class="token variable">$ModLoad</span> ommysql
<span class="token comment"># 在RULES下添加：</span>
<span class="token comment">#facility.priority	:ommysql:DBHOST,DBNAME,DBUSER, PASSWORD</span>
*.info				:ommysql:10.0.0.72,Syslog,rsyslog,123456
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$systemctl</span> restart rsyslog.service</code></pre>

<ol start="4">
<li>测试</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$logger</span> <span class="token string">"this is a test log"</span>

<span class="token punctuation">[</span>root@c72 ~<span class="token punctuation">]</span><span class="token variable">$mysql</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span>
08:45:43<span class="token punctuation">(</span>root@localhost<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> Message from Syslog.SystemEvents order by <span class="token function">id</span> desc limit <span class="token number">1</span><span class="token punctuation">\</span>G<span class="token punctuation">;</span>
*************************** <span class="token number">1</span>. row ***************************
Message: this is a <span class="token builtin class-name">test</span> log
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></code></pre>

<h2 id="实战案例-2：通过-loganalyzer-展示数据库中的日志"><a href="#实战案例-2：通过-loganalyzer-展示数据库中的日志" class="headerlink" title="实战案例 2：通过 loganalyzer 展示数据库中的日志"></a>实战案例 2：通过 loganalyzer 展示数据库中的日志</h2><p>loganalyzer 是用 php 语言实现的日志管理系统,可将 MySQL 数据库的日志用丰富的 WEB 方式进行展示</p>
<p>官网: <a target="_blank" rel="noopener" href="https://loganalyzer.adiscon.com/">https://loganalyzer.adiscon.com</a></p>
<p>目标：通过 loganalyzer 展示数据库中的日志</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1605012422975.png"></p>
<h2 id="logrotate-日志转储"><a href="#logrotate-日志转储" class="headerlink" title="logrotate 日志转储"></a>logrotate 日志转储</h2><p>logrotate 程序是一个日志文件管理工具。用来把旧的日志文件删除，并创建新的日志文件，称为日志转储或滚动。可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过 cron 程序来执行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@c71 ~<span class="token punctuation">]</span><span class="token variable">$rpm</span> <span class="token parameter variable">-ql</span> <span class="token function">logrotate</span>
/etc/cron.daily/logrotate					<span class="token comment"># 计划任务</span>
/etc/logrotate.conf							<span class="token comment"># 配置文件</span>
/etc/logrotate.d
/etc/rwtab.d/logrotate
/usr/sbin/logrotate							<span class="token comment"># 程序</span>
/usr/share/doc/logrotate-3.8.6
/usr/share/doc/logrotate-3.8.6/CHANGES
/usr/share/doc/logrotate-3.8.6/COPYING
/usr/share/man/man5/logrotate.conf.5.gz
/usr/share/man/man8/logrotate.8.gz
/var/lib/logrotate
/var/lib/logrotate/logrotate.status			<span class="token comment"># 日志文件</span></code></pre>

<p>配置文件主要参数如下：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">compress			<span class="token comment"># 通过 gzip 压缩转储以后的日志</span>
nocompress			<span class="token comment"># 不压缩</span>
copytruncate		<span class="token comment"># 把当前日志备份并截断，即 拷贝原来的日志，然后把原日志清空</span>
nocopytruncate		<span class="token comment"># 备份日志文件但是不截断，即	只拷贝原来的日志，但并不会在拷贝完后清空原日志</span>
create mode owner group		<span class="token comment"># 转储文件，使用指定的权限、所有者、所属组创建新的日志文件。注意 能用create就不用copytruncate</span>
nocreate			<span class="token comment"># 不建立新的日志文件，不知道这个选项的意义在哪里</span>
delaycompress		<span class="token comment"># 和 compress 一起使用时，转储的日志文件到下一次转储时才压缩</span>
nodelaycompress		<span class="token comment"># 覆盖 delaycompress 选项，转储同时压缩</span>
errors address		<span class="token comment"># 专储时的错误信息发送到指定的 Email 地址</span>
ifempty				<span class="token comment"># 即使是空文件也转储，此为默认选项</span>
notifempty			<span class="token comment"># 如果是空文件的话，不转储</span>
mail address		<span class="token comment"># 把转储的日志文件发送到指定的 E-mail 地址</span>
nomail				<span class="token comment"># 转储时不发送日志文件</span>
olddir directory		<span class="token comment"># 转储后的日志文件放入指定目录，必须和当前日志文件在同一个文件系统</span>
noolddir				<span class="token comment"># 转储后的日志文件和当前日志文件放在同一个目录下</span>
prerotate/endscript		<span class="token comment"># 在转储以前需要执行的命令，这两个关键字必须单独成行</span>
postrotate/endscript	<span class="token comment"># 在转储以后需要执行的命令，这两个关键字必须单独成行</span>
daily		<span class="token comment"># 指定转储周期为每天</span>
weekly		<span class="token comment"># 指定转储周期为每周</span>
monthly		<span class="token comment"># 指定转储周期为每月</span>
rotate count		<span class="token comment"># 指定日志文件删除之前转储的次数，0 指没有备份，5 指保留 5 个备份</span>
tabooext <span class="token punctuation">[</span>+<span class="token punctuation">]</span> list	<span class="token comment"># 让 logrotate 不转储指定扩展名的文件，缺省的扩展名是:.rpm-orig、.rpmsave、v 和 ~</span>
size size			<span class="token comment"># 当日志文件到达指定的大小时才转储，bytes(缺省)及 KB 或 MB</span>
sharedscripts		<span class="token comment"># 默认，对每个转储日志运行 prerotate 和 postrotate 脚本，日志文件的绝对路径作为第一个参数传递给脚本。 这意味着单个脚本可以针对与多个文件匹配的日志文件条目多次运行(例如/ var / log / news /\*.example)。 如果指定此项 sharedscripts，则无论有多少个日志与通配符模式匹配，脚本都只会运行一次</span>
nosharedscripts		<span class="token comment"># 针对每一个转储的日志文件，都执行一次 prerotate 和 postrotate 脚本，此为默认值</span>
missingok			<span class="token comment"># 如果日志不存在，不提示错误，继续处理下一个</span>
nomissingok			<span class="token comment"># 如果日志不存在，提示错误，此为默认值</span>
dateext				<span class="token comment"># 切换后的日志文件会附加上一个短横线和 YYYYMMDD 格式的日期，没有这个配置项会附加一个小数点加一个数字序号</span>
dateformat			<span class="token comment"># 配合 dateext 使用可以为切割后的日志加上 YYYYMMDD 格式的日期，如 dateformat -%Y%m%d</span>
<span class="token punctuation">..</span>.</code></pre>

<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># logrotate nginx log</span>
<span class="token function">cat</span> <span class="token operator">></span>/etc/logrotate.d/nginx <span class="token operator">&lt;&lt;</span><span class="token string">EOF
<span class="token variable">$&#123;wwwlogs_dir&#125;</span>/*nginx.log &#123;
  daily
  rotate 5
  missingok
  dateext
  compress
  notifempty
  sharedscripts
  postrotate
    [ -f /usr/local/nginx/run/nginx.pid ] &amp;&amp; kill -USR1 \<span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /usr/local/nginx/run/nginx.pid<span class="token punctuation">\</span><span class="token variable">`</span></span>
  endscript
&#125;
EOF</span></code></pre>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E6%97%A5%E5%BF%97/" rel="tag"><i class="fa fa-tag"></i> 日志</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/Redis/Redis/" rel="prev" title="Redis">
                  <i class="fa fa-chevron-left"></i> Redis
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/" rel="next" title="文件共享服务">
                  文件共享服务 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-1 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.to2b.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.to2b.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.to2b.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.to2b.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
