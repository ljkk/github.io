<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.to2b.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.to2b.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="安全技术和防火墙安全技术 入侵检测系统 入侵防御系统 防火墙   防水墙广泛意义上的防水墙：防水墙（Waterwall），与防火墙相对，是一种防止内部信息泄漏的安全产品。网络、外设接口、存储介质和打印机构成信息泄漏的全部途径。防水墙针对这四种泄密途径，在事前、事中、事后进行全面防护。其与防病毒产品、外部安全产品一起构成完整的网络安全体系。  防火墙的分类按保护范围分类：  主机防火墙：服务范围为当">
<meta property="og:type" content="article">
<meta property="og:title" content="iptables">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/iptables/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="安全技术和防火墙安全技术 入侵检测系统 入侵防御系统 防火墙   防水墙广泛意义上的防水墙：防水墙（Waterwall），与防火墙相对，是一种防止内部信息泄漏的安全产品。网络、外设接口、存储介质和打印机构成信息泄漏的全部途径。防水墙针对这四种泄密途径，在事前、事中、事后进行全面防护。其与防病毒产品、外部安全产品一起构成完整的网络安全体系。  防火墙的分类按保护范围分类：  主机防火墙：服务范围为当">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600500456338.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600505953650.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600484323103.png">
<meta property="article:published_time" content="2020-12-09T15:17:52.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.514Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="防火墙">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1600500456338.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/iptables/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/iptables/","path":"运维/防火墙/iptables/","title":"iptables"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>iptables | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E5%92%8C%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-number">1.</span> <span class="nav-text">安全技术和防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF"><span class="nav-number">1.1.</span> <span class="nav-text">安全技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.2.</span> <span class="nav-text">防火墙的分类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux-%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86"><span class="nav-number">2.</span> <span class="nav-text">Linux 防火墙的基本认识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.</span> <span class="nav-text">防火墙工具介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#netfilter-%E4%B8%AD%E4%BA%94%E4%B8%AA%E5%8B%BE%E5%AD%90%E5%87%BD%E6%95%B0%EF%BC%88hook%EF%BC%89"><span class="nav-number">2.2.</span> <span class="nav-text">netfilter 中五个勾子函数（hook）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iptables-%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-number">2.3.</span> <span class="nav-text">iptables 的组成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E4%B8%AD%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.1.</span> <span class="nav-text">内核中数据的传输流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#netfilter-%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.2.</span> <span class="nav-text">netfilter 完整流程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iptables"><span class="nav-number">3.</span> <span class="nav-text">iptables</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%84%E5%88%99-rule"><span class="nav-number">3.1.</span> <span class="nav-text">规则 rule</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.1.1.</span> <span class="nav-text">匹配条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%8A%A8%E4%BD%9C"><span class="nav-number">3.1.2.</span> <span class="nav-text">处理动作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iptables-%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99%E4%BD%BF%E8%A6%81%E8%80%83%E8%99%91"><span class="nav-number">3.1.3.</span> <span class="nav-text">iptables 添加规则使要考虑</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iptables-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">iptables 命令用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iptables-%E5%9F%BA%E6%9C%AC%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.3.</span> <span class="nav-text">iptables 基本匹配条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iptables-%E6%89%A9%E5%B1%95%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.</span> <span class="nav-text">iptables 扩展匹配条件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E6%89%A9%E5%B1%95"><span class="nav-number">3.4.1.</span> <span class="nav-text">隐式扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tcp-%E6%89%A9%E5%B1%95%E6%A8%A1%E5%9D%97-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">tcp 扩展模块 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#udp-%E6%89%A9%E5%B1%95%E6%A8%A1%E5%9D%97-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">udp 扩展模块 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#icmp-%E6%89%A9%E5%B1%95%E6%A8%A1%E5%9D%97-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.1.3.</span> <span class="nav-text">icmp 扩展模块 匹配条件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F%E6%89%A9%E5%B1%95"><span class="nav-number">3.4.2.</span> <span class="nav-text">显式扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#multiport-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">multiport 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#iprange-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">iprange 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#mac-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.3.</span> <span class="nav-text">mac 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#string-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.4.</span> <span class="nav-text">string 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#time-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.5.</span> <span class="nav-text">time 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#connlimit-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.6.</span> <span class="nav-text">connlimit 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#limit-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.7.</span> <span class="nav-text">limit 扩展 匹配条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#state-%E6%89%A9%E5%B1%95-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.4.2.8.</span> <span class="nav-text">state 扩展 匹配条件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.4.2.8.1.</span> <span class="nav-text">格式</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rule-%E4%BC%98%E5%8C%96"><span class="nav-number">3.5.</span> <span class="nav-text">rule 优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rule-%E4%BF%9D%E5%AD%98"><span class="nav-number">3.6.</span> <span class="nav-text">rule 保存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E9%98%B2%E7%81%AB%E5%A2%99"><span class="nav-number">3.7.</span> <span class="nav-text">网络防火墙</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FORWARD"><span class="nav-number">3.7.1.</span> <span class="nav-text">FORWARD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NAT"><span class="nav-number">3.7.2.</span> <span class="nav-text">NAT</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SNAT"><span class="nav-number">3.7.2.1.</span> <span class="nav-text">SNAT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MASQUERADE"><span class="nav-number">3.7.2.2.</span> <span class="nav-text">MASQUERADE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#DNAT"><span class="nav-number">3.7.2.3.</span> <span class="nav-text">DNAT</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#REDIRECT"><span class="nav-number">3.7.2.4.</span> <span class="nav-text">REDIRECT</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#firewalld-%E6%9C%8D%E5%8A%A1"><span class="nav-number">4.</span> <span class="nav-text">firewalld 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#zone"><span class="nav-number">4.1.</span> <span class="nav-text">zone</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#firewall-cmd"><span class="nav-number">4.2.</span> <span class="nav-text">firewall-cmd</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0"><span class="nav-number">5.</span> <span class="nav-text">练习</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.to2b.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/iptables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="iptables | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iptables
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 23:17:52" itemprop="dateCreated datePublished" datetime="2020-12-09T23:17:52+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E9%98%B2%E7%81%AB%E5%A2%99/" itemprop="url" rel="index"><span itemprop="name">防火墙</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="安全技术和防火墙"><a href="#安全技术和防火墙" class="headerlink" title="安全技术和防火墙"></a>安全技术和防火墙</h2><h3 id="安全技术"><a href="#安全技术" class="headerlink" title="安全技术"></a>安全技术</h3><ul>
<li>入侵检测系统</li>
<li>入侵防御系统</li>
<li>防火墙</li>
</ul>
<blockquote>
<p>防水墙<br>广泛意义上的防水墙：防水墙（Waterwall），与防火墙相对，是一种防止内部信息泄漏的安全产品。网络、外设接口、存储介质和打印机构成信息泄漏的全部途径。防水墙针对这四种泄密途径，在事前、事中、事后进行全面防护。其与防病毒产品、外部安全产品一起构成完整的网络安全体系。</p>
</blockquote>
<h3 id="防火墙的分类"><a href="#防火墙的分类" class="headerlink" title="防火墙的分类"></a>防火墙的分类</h3><p><strong>按保护范围分类：</strong></p>
<ul>
<li>主机防火墙：服务范围为当前一台主机</li>
<li>网络防火墙：服务范围为防火墙一侧的局域网</li>
</ul>
<p><strong>按实现方式划分：</strong></p>
<ul>
<li>硬件防火墙</li>
<li>软件防火墙</li>
</ul>
<p><strong>按网络协议划分：</strong></p>
<ul>
<li>网络层防火墙：OSI 模型下四层，又称为包过滤防火墙</li>
<li>应用层防火墙&#x2F;代理服务器：代理网关，OSI 模型七层</li>
</ul>
<p>现实生产环境中所使用的防火墙一般都是二者结合体，即先检查网络数据，通过之后再送到应用层去检查</p>
<h2 id="Linux-防火墙的基本认识"><a href="#Linux-防火墙的基本认识" class="headerlink" title="Linux 防火墙的基本认识"></a>Linux 防火墙的基本认识</h2><p>Linux 防火墙是由<a target="_blank" rel="noopener" href="https://netfilter.org/documentation/">Netfilter</a>组件提供的，Netfilter 工作在内核空间，集成在 linux 内核中</p>
<p>Netfilter 是 Linux 2.4.x 之后新一代的 Linux 防火墙机制，是 linux 内核的一个子系统。Netfilter 采用模块化设计，具有良好的可扩充性，提供扩展各种网络服务的结构化底层框架。Netfilter 与 IP 协议栈是无缝契合，并允许对数据报进行过滤、地址转换、处理等操作</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$grep</span> <span class="token parameter variable">-m</span> <span class="token number">10</span> NETFILTER /boot/config-4.18.0-193.el8.x86_64
<span class="token assign-left variable">CONFIG_NETFILTER</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_NETFILTER_ADVANCED</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_BRIDGE_NETFILTER</span><span class="token operator">=</span>m
<span class="token assign-left variable">CONFIG_NETFILTER_INGRESS</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_NETFILTER_NETLINK</span><span class="token operator">=</span>m
<span class="token assign-left variable">CONFIG_NETFILTER_FAMILY_BRIDGE</span><span class="token operator">=</span>y
<span class="token assign-left variable">CONFIG_NETFILTER_FAMILY_ARP</span><span class="token operator">=</span>y
<span class="token comment"># CONFIG_NETFILTER_NETLINK_ACCT is not set</span>
<span class="token assign-left variable">CONFIG_NETFILTER_NETLINK_QUEUE</span><span class="token operator">=</span>m
<span class="token assign-left variable">CONFIG_NETFILTER_NETLINK_LOG</span><span class="token operator">=</span>m</code></pre>

<h3 id="防火墙工具介绍"><a href="#防火墙工具介绍" class="headerlink" title="防火墙工具介绍"></a>防火墙工具介绍</h3><ul>
<li><p>iptables：工作在用户空间，用来编写规则，写好的规则被送往 netfilter，告诉内核如何去处理包</p>
</li>
<li><p>firewalld：CentOS7 引入</p>
</li>
<li><p>nftables：CentOS 8 新特性，2013 年末合并到 Linux 内核中，自 2014 年以来已在内核 3.13 中可用。</p>
<p>它重用了 netfilter 框架的许多部分，例如连接跟踪和 NAT 功能。它还保留了命名法和基本 iptables 设计<br>的几个部分，例如表，链和规则。就像 iptables 一样，表充当链的容器，并且链包含单独的规则，这些<br>规则可以执行操作，例如丢弃数据包，移至下一个规则或跳至新链。</p>
<p>从用户的角度来看，nftables 添加了一个名为 nft 的新工具，该工具替代了 iptables，arptables 和<br>ebtables 中的所有其他工具。从体系结构的角度来看，它还替换了内核中处理数据包过滤规则集运行时<br>评估的那些部分。</p>
<p>总之：nftables 应该是未来的主流，现在 iptables 还是要重点学习，firewalld 了解即可</p>
</li>
</ul>
<h3 id="netfilter-中五个勾子函数（hook）"><a href="#netfilter-中五个勾子函数（hook）" class="headerlink" title="netfilter 中五个勾子函数（hook）"></a>netfilter 中五个勾子函数（hook）</h3><p>netfilter 在内核的五个位置放了钩子函数（hook）：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING</code></pre>

<p>提示：从 Linux kernel 4.2 版以后，Netfilter 在 prerouting 前加了一个 ingress 勾子函数。可以使用这个新的入口挂钩来过滤来自第 2 层的流量，这个新挂钩比预路由要早，基本上是 tc 命令（流量控制工具）的替代品</p>
<h3 id="iptables-的组成"><a href="#iptables-的组成" class="headerlink" title="iptables 的组成"></a>iptables 的组成</h3><p>iptables 由五张 表（table） 组成：</p>
<ul>
<li>filter 表：过滤规则表，根据预定义的规则过滤符合条件的数据包,默认表</li>
<li>nat 表：network address translation 地址转换规则表；修改数据包中的源、目标 iP 和端口</li>
<li>mangle：修改数据标记位规则表</li>
<li>raw：关闭启用的连接跟踪机制，加快封包穿越防火墙速度</li>
<li>security：用于强制访问控制（MAC）网络规则，由 Linux 安全模块（如 SELinux）实现</li>
</ul>
<p>五张表的优先级：security –&gt;raw–&gt;mangle–&gt;nat–&gt;filter，我们重点研究后面四张表</p>
<p>每张表由若干功能类似的 链（chain）组成，每条链上有若干类似的 规则（rule）</p>
<p>表不能自定义，链可以自定义，但是 iptables 也内置了 5 种链，与 5 个钩子函数同名，内置链上每条过滤规则都调用与链同名的钩子函数。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING</code></pre>

<p><strong>注意：</strong>自定义的链不能直接添加到表中，只能作为 target 添加到内置链上，间接的实现添加到表中</p>
<h4 id="内核中数据的传输流程"><a href="#内核中数据的传输流程" class="headerlink" title="内核中数据的传输流程"></a>内核中数据的传输流程</h4><p>在每个 hook 放置若干表，按照表的优先级，依次执行表内的同名链上的规则，例如 INPUT 钩子函数会依次执行 mangle、nat、filter 表中的 INPUT 链上的规则。</p>
<p>标注：红色的表示钩子函数或者内置链，黄色的表示 table</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600500456338.png"></p>
<p>显然，内置链和内置表的关系：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600505953650.png"></p>
<h4 id="netfilter-完整流程"><a href="#netfilter-完整流程" class="headerlink" title="netfilter 完整流程"></a>netfilter 完整流程</h4><p><img data-src="//img.to2b.cn/blog/ljk/1600484323103.png"></p>
<h2 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h2><p>mysql：数据库中有表，表中有一条条的数据</p>
<p>iptables：表中有链，链上有一条条的规则</p>
<h3 id="规则-rule"><a href="#规则-rule" class="headerlink" title="规则 rule"></a>规则 rule</h3><p>规则由 匹配条件 和 处理动作组成，规则在链上的顺序即其检查时生效的顺序</p>
<h4 id="匹配条件"><a href="#匹配条件" class="headerlink" title="匹配条件"></a>匹配条件</h4><ul>
<li>基本匹配：IP，端口，TCP 的 Flags（SYN,ACK 等）</li>
<li>扩展匹配：调用 netfilter 中的模块，实现各种复杂匹配</li>
</ul>
<h4 id="处理动作"><a href="#处理动作" class="headerlink" title="处理动作"></a>处理动作</h4><p>处理动作称为 target，跳转目标，分为两种：内建的处理动作 和 自定义链。</p>
<p>常用的内建处理动作：</p>
<ul>
<li><p>ACCEPT：允许数据包通过</p>
</li>
<li><p>DROP：直接丢弃数据包，不给任何回应信息，这时候客户端会感觉自己的请求泥牛入海了，过了超时时间才会有反应</p>
</li>
<li><p>REJECT：拒绝数据包通过，必要时会给数据发送端一个响应的信息，客户端刚请求就会收到拒绝的信息</p>
</li>
<li><p>SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题</p>
</li>
<li><p>MASQUERADE：是 SNAT 的一种特殊形式，适用于动态的、临时会变的 ip 上</p>
</li>
<li><p>DNAT：目标地址转换</p>
</li>
<li><p>REDIRECT：在本机做端口映射</p>
</li>
<li><p>LOG：非中断 target，本身不拒绝和允许，放在拒绝和允许规则前，并将日志记在&#x2F;var&#x2F;log&#x2F;messages 系统日志中</p>
<ul>
<li>–log-level level 级别： debug、info、notice、warning、error、crit、alert、emerg</li>
<li>–log-prefix prefix 日志前缀，用于区别不同的日志，最多 29 个字符</li>
</ul>
</li>
</ul>
<h4 id="iptables-添加规则使要考虑"><a href="#iptables-添加规则使要考虑" class="headerlink" title="iptables 添加规则使要考虑"></a>iptables 添加规则使要考虑</h4><ol>
<li>要实现哪种功能：判断添加在哪张表上</li>
<li>报文流经的路径：判断添加在哪条链上</li>
<li>报文的流向：判断源和目的</li>
<li>匹配规则：业务需要</li>
</ol>
<h3 id="iptables-命令用法"><a href="#iptables-命令用法" class="headerlink" title="iptables 命令用法"></a>iptables 命令用法</h3><pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>-A<span class="token operator">|</span>-C<span class="token operator">|</span>-D<span class="token punctuation">&#125;</span> chain rule-specification
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-D</span> chain rulenum
ip6tables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>-A<span class="token operator">|</span>-C<span class="token operator">|</span>-D<span class="token punctuation">&#125;</span> chain rule-specification
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-I</span> chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span> rule-specification
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-R</span> chain rulenum rule-specification
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-S</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span>
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>-F<span class="token operator">|</span>-L<span class="token operator">|</span>-Z<span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-N</span> chain
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-X</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span>
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-P</span> chain target
iptables <span class="token punctuation">[</span>-t table<span class="token punctuation">]</span> <span class="token parameter variable">-E</span> old-chain-name new-chain-name

<span class="token comment"># 补充说明</span>
rule-specification <span class="token operator">=</span> <span class="token punctuation">[</span>matches<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>target<span class="token punctuation">]</span>
match <span class="token operator">=</span> <span class="token parameter variable">-m</span> matchname <span class="token punctuation">[</span>per-match-options<span class="token punctuation">]</span>
target <span class="token operator">=</span> <span class="token parameter variable">-j</span> targetname <span class="token punctuation">[</span>per-target-options<span class="token punctuation">]</span></code></pre>

<ul>
<li><p>-t：指定表，默认 filter 表</p>
</li>
<li><p>-A：以 append 的方式添加 rule，iptables 添加 rule 后会立马生效</p>
</li>
<li><p>-I：以 insert 的方式添加 rule</p>
</li>
<li><p>-C：检查 rule 是否存在</p>
</li>
<li><p>-D ：删除 rule，可以通过 指明规则序号 或 指明规则本身 两种方式</p>
</li>
<li><p>-R：replace，替换指定链上的指定规则编号</p>
</li>
<li><p>-S：打印指定链上的所有 rule，不指定链则打印表中所有 rule</p>
</li>
<li><p>-L：list, 列出指定链上的所有规则，不指定链则列出表中所有 rule</p>
</li>
<li><p>-F：flush，清空指定的链</p>
</li>
<li><p>-Z：zero，置零。每条 rule 都有两个计数器</p>
<ul>
<li>匹配到的报文数</li>
<li>匹配到的所有报文的大小之和</li>
</ul>
</li>
<li><p>-N：new, 自定义一条新的链</p>
</li>
<li><p>-X：delete，删除自定义的空的链</p>
</li>
<li><p>-P：Policy，设置默认策略；对 filter 表中的链而言，其默认策略有：ACCEPT：接受, DROP：丢弃</p>
</li>
<li><p>-E：重命名自定义链，引用计数不为 0 的自定义链不能够被重命名，也不能被删除</p>
</li>
</ul>
<p>参数：</p>
<ul>
<li>-m：match</li>
<li>-j：jump target</li>
</ul>
<p>其他选项：</p>
<ul>
<li>-v：verbose，显示更详细的信息</li>
<li>-n：numeric，数字输出。IP 地址和端口会以数字的形式打印</li>
<li>-w：</li>
<li>-W：</li>
<li>-x：扩展数字。显示包和字节计数器的精确值，代替用 K,M,G 表示的约数。 这个选项仅能用于 -L 命令。</li>
<li><code>--line-numbers</code>：当列表显示规则时，在每个规则的前面加上行号，与该规则在链中的位置相对应，这个常用</li>
<li>–modprobe&#x3D;command：</li>
</ul>
<h3 id="iptables-基本匹配条件"><a href="#iptables-基本匹配条件" class="headerlink" title="iptables 基本匹配条件"></a>iptables 基本匹配条件</h3><p><font color=red>注意：当一条规则中有多个匹配条件时，这多个匹配条件之间，默认存在”与”的关系。</font>也就是说当一条规则中存在多个匹配条件时，报文必须同时满足这些条件，才算做被规则匹配</p>
<p>无需加载模块，由 iptables&#x2F;netfilter 自行提供，! 是取反的意思</p>
<table>
<thead>
<tr>
<th>基本匹配条件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>[!] -s address[&#x2F;mask][,…]</td>
<td>源地址</td>
</tr>
<tr>
<td>[!] -d address[&#x2F;mask][,…]</td>
<td>目标地址</td>
</tr>
<tr>
<td>[!] -p protocol</td>
<td>指定协议，tcp、udp、icmp 等，可以指定哪些协议参考&#x2F;etc&#x2F;protocols，<br/>还可以使用数字 0，相当于 all，匹配所有协议</td>
</tr>
<tr>
<td>[!] -i inter_name</td>
<td>in interface，报文流入的接口；只能应用于数据报文流入环节，<br/>只应用于 INPUT、FORWARD、PREROUTING 链</td>
</tr>
<tr>
<td>[!] -o inter_name</td>
<td>out interface，报文流出的接口；只能应用于数据报文流出的环节，<br/>只应用于 FORWARD、OUTPUT、POSTROUTING 链</td>
</tr>
</tbody></table>
<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 添加规则，并指定规则号：禁止10.0.0.6的ping请求</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment">#iptables -I INPUT 2 -s 10.0.0.6 -p icmp -j REJECT</span></code></pre>

<h3 id="iptables-扩展匹配条件"><a href="#iptables-扩展匹配条件" class="headerlink" title="iptables 扩展匹配条件"></a>iptables 扩展匹配条件</h3><p>需要加载扩展模块（&#x2F;usr&#x2F;lib64&#x2F;xtables&#x2F;*）方可生效，扩展模块可以使用 man 命令查看，扩展匹配条件分为 隐式扩展 和 显式扩展</p>
<h4 id="隐式扩展"><a href="#隐式扩展" class="headerlink" title="隐式扩展"></a>隐式扩展</h4><p>iptables 在使用 -p 指定了特定协议时，可以省略协议同名扩展，直接写扩展匹配条件即可，这类扩展就是隐式扩展，例如 tcp、udp、icmp</p>
<h5 id="tcp-扩展模块-匹配条件"><a href="#tcp-扩展模块-匹配条件" class="headerlink" title="tcp 扩展模块 匹配条件"></a>tcp 扩展模块 匹配条件</h5><ul>
<li><p>[!] –sport port[:port]：匹配 tcp 报文的源端口或端口范围</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例：</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> OUTPUT <span class="token parameter variable">-d</span> <span class="token number">192.168</span>.1.146 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--sport</span> <span class="token number">22</span>:25 <span class="token parameter variable">-j</span> REJECT</code></pre>
</li>
<li><p>[!] –dport port[:port]：匹配 tcp 报文的目标端口或端口范围</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.146 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span>:25 <span class="token parameter variable">-j</span> REJECT</code></pre>
</li>
<li><p>[!] –tcp-flags mask comp：</p>
<ul>
<li>mask： 需检查的标志位列表，用,分隔 , 例如 SYN,ACK,FIN,RST</li>
<li>comp：在 mask 列表中必须为 1 的标志位列表，无指定则必须为 0，用,分隔 tcp 协议的扩展选项</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例：</span>
<span class="token comment"># 要检查的标志位为SYN,ACK,FIN,RST四个，其中SYN必须为1，余下的必须为0，第一次握手</span>
--tcp-flags SYN,ACK,FIN,RST SYN
<span class="token comment"># 以上写法可以简写</span>
 <span class="token parameter variable">--syn</span></code></pre></li>
</ul>
<h5 id="udp-扩展模块-匹配条件"><a href="#udp-扩展模块-匹配条件" class="headerlink" title="udp 扩展模块 匹配条件"></a>udp 扩展模块 匹配条件</h5><ul>
<li>[!] –sport port[:port]：匹配报文的源端口或端口范围</li>
<li>[!] –dport port[:port]：匹配报文的目标端口或端口范围</li>
</ul>
<h5 id="icmp-扩展模块-匹配条件"><a href="#icmp-扩展模块-匹配条件" class="headerlink" title="icmp 扩展模块 匹配条件"></a>icmp 扩展模块 匹配条件</h5><ul>
<li>[!] –icmp-type {type[&#x2F;code]|typename}：<ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/itcomputer/p/4939399.html">type&#x2F;code</a><ul>
<li>0&#x2F;0 echo-reply icmp 应答</li>
<li>8&#x2F;0 echo-request icmp 请求</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例：不允许其他人ping我，而我可以ping其他人</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-m</span> icmp --icmp-type <span class="token number">8</span> <span class="token parameter variable">-j</span> REJECT</code></pre>

<h4 id="显式扩展"><a href="#显式扩展" class="headerlink" title="显式扩展"></a>显式扩展</h4><p>必须使用-m 指定使用的扩展，下面是常用的显式扩展：</p>
<h5 id="multiport-扩展-匹配条件"><a href="#multiport-扩展-匹配条件" class="headerlink" title="multiport 扩展 匹配条件"></a>multiport 扩展 匹配条件</h5><p>以离散方式定义多端口匹配,最多指定 15 个端口</p>
<ul>
<li>[!] –sports port[,port|,port:port]…：指定多个源端口</li>
<li>[!] –dports port[,port|,port:port]…：指定多个目标端口</li>
<li>[!] –ports port[,port|,port:port]…：指定多个源或目标端口</li>
</ul>
<h5 id="iprange-扩展-匹配条件"><a href="#iprange-扩展-匹配条件" class="headerlink" title="iprange 扩展 匹配条件"></a>iprange 扩展 匹配条件</h5><p>指明连续的（但一般不是整个网络）ip 地址范围</p>
<ul>
<li>[!] –src-range from[-to] 源 IP 地址范围</li>
<li>[!] –dst-range from[-to] 目标 IP 地址范围</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> iprange --src-range <span class="token number">192.168</span>.1.127-192.168.1.146 <span class="token parameter variable">-j</span> DROP</code></pre>

<h5 id="mac-扩展-匹配条件"><a href="#mac-扩展-匹配条件" class="headerlink" title="mac 扩展 匹配条件"></a>mac 扩展 匹配条件</h5><p>指定源 MAC 地址,，适用于：PREROUTING, FORWARD，INPUT chains<br>注意不能指定目标 MAC 地址，因为无法指定，也没有意义</p>
<ul>
<li>[!] –mac-source XX:XX:XX:XX:XX:XX</li>
</ul>
<h5 id="string-扩展-匹配条件"><a href="#string-扩展-匹配条件" class="headerlink" title="string 扩展 匹配条件"></a>string 扩展 匹配条件</h5><p>对报文中的应用层数据做字符串模式匹配检测</p>
<ul>
<li>–algo {bm|kmp}：字符串匹配算法</li>
<li>–from offset：开始偏移</li>
<li>–to offset：结束偏移</li>
<li>[!] –string pattern：模式匹配要检测的字符串</li>
<li>[!] –hex-string pattern：模式匹配要检测的字符串，16 进制格式</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例</span>
iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--sport</span> <span class="token number">80</span> <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> bm <span class="token parameter variable">--from</span> <span class="token number">62</span> <span class="token parameter variable">--string</span> <span class="token string">"google"</span> <span class="token parameter variable">-j</span> REJECT</code></pre>

<h5 id="time-扩展-匹配条件"><a href="#time-扩展-匹配条件" class="headerlink" title="time 扩展 匹配条件"></a>time 扩展 匹配条件</h5><p>注意：CentOS 8 此模块有问题</p>
<p>根据将报文到达的时间与指定的时间范围进行匹配</p>
<ul>
<li>–datestart YYYY[-MM[-DD[Thh[:mm[:ss]]]]] 日期</li>
<li>–datestop YYYY[-MM[-DD[Thh[:mm[:ss]]]]]</li>
<li>–timestart hh:mm[:ss] 时间</li>
<li>–timestop hh:mm[:ss]</li>
<li>[!] –monthdays day[,day…] 每个月的几号</li>
<li>[!] –weekdays day[,day…] 星期几，1 – 7 分别表示星期一到星期日</li>
<li>–kerneltz：内核时区（当地时间），非常不建议使用</li>
</ul>
<h5 id="connlimit-扩展-匹配条件"><a href="#connlimit-扩展-匹配条件" class="headerlink" title="connlimit 扩展 匹配条件"></a>connlimit 扩展 匹配条件</h5><p>对每 IP 所能够发起并发连接数做限制；可防止 Dos（Denial of Service，拒绝服务）攻击</p>
<ul>
<li>–connlimit-upto N：连接的数量小于等于 N 时匹配</li>
<li>–connlimit-above N：连接的数量大于 N 时匹配</li>
</ul>
<h5 id="limit-扩展-匹配条件"><a href="#limit-扩展-匹配条件" class="headerlink" title="limit 扩展 匹配条件"></a><a target="_blank" rel="noopener" href="https://www.zsythink.net/archives/1564">limit 扩展 匹配条件</a></h5><p>”令牌桶“算法，对 报文到达速率 进行限制，即限制单位时间内流入的包的数量</p>
<p>–limit-burst N：前 N 个包不限制，</p>
<p>–limit N[&#x2F;second|&#x2F;minute|&#x2F;hour|&#x2F;day]：单位时间内通过 N 个包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 范例：下面两条规则配合使用，限制每分钟ping10次，即每6秒ping一次</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-m</span> limit --limit-burst <span class="token number">3</span> <span class="token parameter variable">--limit</span> <span class="token number">10</span>/minute <span class="token parameter variable">-j</span> ACCEPT
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> REJECT</code></pre>

<h5 id="state-扩展-匹配条件"><a href="#state-扩展-匹配条件" class="headerlink" title="state 扩展 匹配条件"></a>state 扩展 匹配条件</h5><p>state 直译为 状态，state 模块可以让 iptables 实现”连接追踪“机制，英文名是 conntrack 机制。<br>简单说就是追踪本机的请求和相应之间的状态。</p>
<p>state 扩展实现“连接追踪”需要依赖 nf_conntrack_ipv4 等内核模块，可以通过 modprobe 命令手动把所需内核模块加载到内存中，但实际上没有这个必要，因为 iptables 会自动加载所需内核模块</p>
<p>state 模块有 5 中状态：<strong>NEW、ESTABLISHED、RELATED、INVALID、UNTRACKED</strong></p>
<ul>
<li>NEW：新发出请求；只要连接追踪信息库（&#x2F;proc&#x2F;net&#x2F;nf_conntrack）中不存在此连接的相关信息条目，就识别为第一次发出的请求</li>
<li>ESTABLISHED：NEW 状态之后，连接追踪信息库中为其建立的条目失效之前期间内所进行的通信状态</li>
<li>RELATED：新发起的但与已有连接相关联的连接，如：ftp 协议中的数据连接与命令连接之间的关系</li>
<li>INVALID：无效的连接，如 flag 标记不正确</li>
<li>UNTRACKED：未进行追踪的连接，如：raw 表中关闭追踪</li>
</ul>
<p>注意：state 模块的状态和 TCP 的状态没有关系，对于 state 模块而言，只要两台机器在”你来我往”的通信，就算建立起了连接。所以在 TCP&#x2F;IP 协议中，UDP 和 ICMP 是没有连接状态的，而在 state 模块中，所有的协议都是有连接状态的</p>
<p><strong>查看连接追踪信息库：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /proc/net/nf_conntrack</code></pre>

<p><strong>调整连接追踪功能所能够容纳的最大连接数量：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用sysctl修改</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /proc/sys/net/netfilter/nf_conntrack_max
<span class="token number">65536</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /proc/sys/net/nf_conntrack_max
<span class="token number">65536</span></code></pre>

<p><strong>查看目前连接跟踪有多少条目：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@4710419222 ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /proc/sys/net/netfilter/nf_conntrack_count
<span class="token number">28</span>
<span class="token punctuation">[</span>root@4710419222 ~<span class="token punctuation">]</span><span class="token variable">$cat</span> /proc/net/nf_conntrack <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
<span class="token number">28</span></code></pre>

<p><strong>不同的协议的连接追踪时长：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@4710419222 ~<span class="token punctuation">]</span><span class="token variable">$ll</span> /proc/sys/net/netfilter/ <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">timeout</span></code></pre>

<p><strong>说明：</strong></p>
<ul>
<li>当服务器连接多于最大连接数时，报错 ：<code>kernel: ip_conntrack: table full, dropping packet</code>,并且导致建立 TCP 连接很慢</li>
<li>各种状态超时后，链接会从表中删除</li>
</ul>
<p>连接过多的解决方法有两个：</p>
<ol>
<li><p>加大 nf_conntrack_max 值</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/sysctl.conf
net.nf_conntrack_max <span class="token operator">=</span> <span class="token number">393216</span>
net.netfilter.nf_conntrack_max <span class="token operator">=</span> <span class="token number">393216</span></code></pre>
</li>
<li><p>降低 tcp 各种状态的超时时间</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/sysctl.conf
net.netfilter.nf_conntrack_tcp_timeout_established <span class="token operator">=</span> <span class="token number">300</span>
net.netfilter.nf_conntrack_tcp_timeout_time_wait <span class="token operator">=</span> <span class="token number">120</span>
net.netfilter.nf_conntrack_tcp_timeout_close_wait <span class="token operator">=</span> <span class="token number">60</span>
net.netfilter.nf_conntrack_tcp_timeout_fin_wait <span class="token operator">=</span> <span class="token number">120</span>

iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-nvL</span></code></pre></li>
</ol>
<h6 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h6><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token parameter variable">--state</span> state,state<span class="token punctuation">..</span>.</code></pre>

<p>范例：不允许 10.0.0.79 访问本机，但是本机能访问 10.0.0.79</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$iptables</span> <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED <span class="token parameter variable">-j</span> ACCEPT
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$iptables</span> <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.79 <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> NEW <span class="token parameter variable">-j</span> REJECT</code></pre>

<h3 id="rule-优化"><a href="#rule-优化" class="headerlink" title="rule 优化"></a>rule 优化</h3><ol>
<li><p>安全放行所有入站和出站的状态为 ESTABLISHED 状态连接,建议放在第一条，效率更高</p>
</li>
<li><p>谨慎放行入站的新请求</p>
</li>
<li><p>有特殊目的限制访问功能，要在放行规则之前加以拒绝</p>
</li>
<li><p>同类规则（访问同一应用，比如：http ），匹配范围小的放在前面，用于特殊处理</p>
</li>
<li><p>不同类的规则（访问不同应用，一个是 http，另一个是 mysql ），匹配范围大的放在前面，效率更高</p>
</li>
</ol>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.6 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">3306</span> <span class="token parameter variable">-j</span> REJECT
<span class="token parameter variable">-s</span> <span class="token number">172.16</span>.0.0/16 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> REJECT</code></pre>

<ol start="6">
<li><p>应该将那些可由一条规则能够描述的多个规则合并为一条,减少规则数量,提高检查效率</p>
</li>
<li><p>设置默认策略，建议白名单（只放行特定连接）</p>
</li>
<li><p>iptables -P，不建议，容易出现“自杀现象”</p>
</li>
<li><p>规则的最后定义规则做为默认策略，推荐使用，放在最后一条</p>
</li>
</ol>
<h3 id="rule-保存"><a href="#rule-保存" class="headerlink" title="rule 保存"></a>rule 保存</h3><p>使用 iptables 命令定义的规则，，其生效期限为 kernel 存活期限，即重启失效</p>
<p><strong>持久保存规则：</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># CentOS6 将规则覆盖保存至/etc/sysconfig/iptables文件中</span>
<span class="token function">service</span> iptables save

<span class="token comment"># CentOS7、8</span>
iptables-save <span class="token operator">></span> <span class="token function">file</span></code></pre>

<p><strong>加载规则：</strong></p>
<p>CentOS6 自动从&#x2F;etc&#x2F;sysconfig&#x2F;iptables 重新载入规则</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> iptables restart</code></pre>

<p>CentOS7、8</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables-restore <span class="token operator">&lt;</span> <span class="token function">file</span></code></pre>

<ul>
<li>-n：noflush，清除原有规则</li>
<li>-t：–test，仅分析生成规则集，但不提交</li>
</ul>
<p><strong>开机自动重载规则</strong></p>
<p>CentOS6 只要设置 iptables 开机自启，然后关机前使用保存规则即可</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">chkconfig</span> iptables on
<span class="token function">service</span> iptables save		<span class="token comment"># 注意：如果不保存，关机就没了</span></code></pre>

<p>CentOS7、8 有两种方式</p>
<p>方法一：将自动载入规则的命令写入开机自启脚本&#x2F;etc&#x2F;rc.d&#x2F;rc.local 文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将自动载入规则的命令写入开机自启脚本/etc/rc.d/rc.local文件</span>
<span class="token function">vim</span> /etc/rc.d/rc.local
iptables-restore <span class="token operator">&lt;</span> /<span class="token environment constant">PATH</span>/FROM/IPTABLES_RULES_FILE

<span class="token comment"># 关机前保存规则</span>
iptables-save <span class="token operator">></span> /etc/sysconfig/iptables</code></pre>

<p>方法二：使用 iptables-services</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装软件</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment">#yum -y install iptables-services</span>

<span class="token comment"># 设置开机启动</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment">#systemctl enable iptables.service</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token comment">#systemctl mask firewalld.service nftables.service</span>

<span class="token comment"># 保存规则到文件，iptables.init 来自 iptables-services</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span>$/usr/libexec/iptables/iptables.init save
iptables: Saving firewall rules to /etc/sysconfig/iptables:<span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
<span class="token comment"># 或者</span>
<span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$iptables</span>-save <span class="token operator">></span> /etc/sysconfig/iptables</code></pre>

<h3 id="网络防火墙"><a href="#网络防火墙" class="headerlink" title="网络防火墙"></a>网络防火墙</h3><h4 id="FORWARD"><a href="#FORWARD" class="headerlink" title="FORWARD"></a>FORWARD</h4><p>利用 filter 表的 FORWARD 链,可以充当网络防火墙</p>
<ol>
<li>请求 - 响应报文均会经由 FORWARD 链，要注意规则的方向性</li>
<li>如果要启用 conntrack 机制，建议将双方状态为 ESTABLISHED 的报文直接放行</li>
</ol>
<p>[实验：FORWARD 链实现内外网络的流量控制](16.1 实验 FORWARD 链实现内外网络的流量控制.md)</p>
<h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a><a target="_blank" rel="noopener" href="http://www.zsythink.net/archives/1764">NAT</a></h4><p>客户机和服务器都在局域网中，躲在防火墙后面，通过路由器连接网络。</p>
<p>NAT 是地址转换表，表中规则的常用 target：</p>
<ul>
<li>SNAT：负责将局域网 IP 转成公网 IP，S 是源地址的意思，适用于固定的公网 IP</li>
<li>MASQUERADE：相较与 SNAT，MASQUERADE 适用于动态的公网 IP，如：拨号网络</li>
<li>DNAT：负责将公网 IP 转成局域网 IP，D 是目标地址的意思；</li>
<li>REDIRECT：</li>
</ul>
<p>这么说有些抽象，我们看下面的例子：</p>
<h5 id="SNAT"><a href="#SNAT" class="headerlink" title="SNAT"></a>SNAT</h5><p>我本机的 IP 是 172.16.135.189&#x2F;16，对外的公网 IP 是 39.164.140.134，当我访问互联网中的网站时，防火墙负责将 172.16.135.189 转成 39.164.140.134，等返回数据的时候，再把 39.164.140.134 转成 172.16.135.189。</p>
<p>有一个问题，局域网中的 ip 成百上千，大家对外的公网 IP 却都是 39.164.140.134，如果多台主机同时访问同一网站，路由器是如何做到准确的转发消息呢？<br>答案是对目标 IP 相同的请求分别绑定不同的端口号，例如 PC1 和 PC2 两台主机同时访问网站 <a href="http://lujinkai.cn，防火墙会把PC1的IP转成39.164.140.134:1234，把PC2的IP转成39.164.140.134:2345（1234和2345是随便写的，只要两个端口不一样就行）">http://lujinkai.cn，防火墙会把PC1的IP转成39.164.140.134:1234，把PC2的IP转成39.164.140.134:2345（1234和2345是随便写的，只要两个端口不一样就行）</a></p>
<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">172.16</span>.0.0/16 <span class="token parameter variable">-j</span> SNAT --to-source <span class="token number">39.164</span>.140.134</code></pre>

<ul>
<li>–to-source：将报文的源 IP 修改为公网 IP</li>
</ul>
<p>SNAT 中隐含了另一个技术：PNAT，即自动分配端口，只不过我们不单独说它。</p>
<h5 id="MASQUERADE"><a href="#MASQUERADE" class="headerlink" title="MASQUERADE"></a>MASQUERADE</h5><p>如果家里拨号上网，外网 IP 不固定，可以使用 MASQUERADE</p>
<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.1.0/24 <span class="token parameter variable">-j</span> MASQUERADE</code></pre>

<p>可以把 MASQUERADE 理解为动态的、自动化的 SNAT，如果没有动态 SNAT 的需求，没有必要使 MASQUERADE，因为 SNAT 更加高效。</p>
<h5 id="DNAT"><a href="#DNAT" class="headerlink" title="DNAT"></a>DNAT</h5><p><a target="_blank" rel="noopener" href="http://lujinkai.cn/">http://lujinkai.cn</a> 网站的 IP 是 47.105.171.233，这个公网 IP 的后面可能是一台服务器，也可能是服务器集群，总之无论有多少服务器，防火墙外的人看不出来。当我访问去访问网站时，阿里云的防火墙会将 39.164.140.134 转成局域网 IP，然后将请求转发到真实的服务器。</p>
<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos8 ~<span class="token punctuation">]</span><span class="token variable">$iptables</span> <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-d</span> <span class="token number">192.168</span>.248.2 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> DNAT --to-destination <span class="token number">10.0</span>.0.175:80</code></pre>

<ul>
<li>–to-destination：将报文的目标地址修改为内网 IP，并指定端口号</li>
</ul>
<h5 id="REDIRECT"><a href="#REDIRECT" class="headerlink" title="REDIRECT"></a>REDIRECT</h5><p>DNAT 可以对 IP 和端口进行映射，REDIRECT 只能应用在本机，对本机的端口进行映射，比如将本机的 80 端口映射到 8080 端口上，当别的机器访问本机的 80 端口时，报文会被重定向到本机的 8080 端口上，此时本机只需要监听 8080 端口，不需要监听 80 端口</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> REDIRECT --to-ports <span class="token number">8080</span></code></pre>

<ul>
<li>–to-ports：端口转换</li>
</ul>
<p>REDIRECT 规则只能定义在 PREROUTING 链或者 OUTPUT 链中</p>
<h2 id="firewalld-服务"><a href="#firewalld-服务" class="headerlink" title="firewalld 服务"></a>firewalld 服务</h2><p>CentOS6 不支持 firewalld，CentOS8 支持 firewalld，但是官方推荐使用 ntf，所有 firewalld 了解即可。</p>
<p>在 iptables 的基础上，预定义了一些链（zone）和服务，以下以 CentOS7 中的 firewalld 为例：</p>
<h3 id="zone"><a href="#zone" class="headerlink" title="zone"></a>zone</h3><table>
<thead>
<tr>
<th>zone 名称</th>
<th>默认配置</th>
</tr>
</thead>
<tbody><tr>
<td>trusted</td>
<td>允许所有流量</td>
</tr>
<tr>
<td>home</td>
<td>拒绝除和传出流量相关的，以及 ssh,mdsn,ipp-client,samba-client,dhcpv6-client 预定义服务之外其它所有传入流量</td>
</tr>
<tr>
<td>internal</td>
<td>和 home 相同</td>
</tr>
<tr>
<td>work</td>
<td>拒绝除和传出流量相关的，以及 ssh,ipp-client,dhcpv6-client 预定义服务之外的其它所有传入流量</td>
</tr>
<tr>
<td>public</td>
<td>拒绝除和传出流量相关的，以及 ssh,dhcpv6-client 预定义服务之外的其它所有传入流量，新加的网卡默认属于 public zone</td>
</tr>
<tr>
<td>external</td>
<td>拒绝除和传出流量相关的，以及 ssh 预定义服务之外的其它所有传入流量，属于 external zone 的传出 ipv4 流量的源地址将被伪装为传出网卡的地址。</td>
</tr>
<tr>
<td>dmz</td>
<td>拒绝除和传出流量相关的，以及 ssh 预定义服务之外的其它所有传入流量</td>
</tr>
<tr>
<td>block</td>
<td>拒绝除和传出流量相关的所有传入流量</td>
</tr>
<tr>
<td>drop</td>
<td>拒绝除和传出流量相关的所有传入流量（甚至不以 ICMP 错误进行回应）</td>
</tr>
</tbody></table>
<h3 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h3><p>firewall-cmd 是 firewalld 的命令行工具。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">..</span>.<span class="token punctuation">]</span></code></pre>

<p>常见选项：</p>
<ul>
<li>–get-zones：列出所有可用区域</li>
<li>–get-default-zone：查询默认区域</li>
<li>–set-default-zone&#x3D;<ZONE> ：设置默认区域</li>
<li>–get-active-zones：列出当前正使用的区域</li>
<li>–add-source&#x3D;<CIDR>[–zone&#x3D;<ZONE>]：添加源地址的流量到指定区域，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–remove-source&#x3D;<CIDR> [–zone&#x3D;<ZONE>]：从指定区域删除源地址的流量，如无–zone&#x3D; 选项，使用默认区域</li>
<li>–add-interface&#x3D;<INTERFACE>[–zone&#x3D;<ZONE>]：添加来自于指定接口的流量到特定区域，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–change-interface&#x3D;<INTERFACE>[–zone&#x3D;<ZONE>]：改变指定接口至新的区域，如果无–zone&#x3D;选项，使用默认区域</li>
<li>–add-service&#x3D;<SERVICE> [–zone&#x3D;<ZONE>]：允许服务的流量通过，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–add-port&#x3D;&lt;PORT&#x2F;PROTOCOL&gt;[–zone&#x3D;<ZONE>]：允许指定端口和协议的流量，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–remove-service&#x3D;<SERVICE> [–zone&#x3D;<ZONE>]：从区域中删除指定服务，禁止该服务流量，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–remove-port&#x3D;&lt;PORT&#x2F;PROTOCOL&gt;[–zone&#x3D;<ZONE>]：从区域中删除指定端口和协议，禁止该端口的流量，如果无–zone&#x3D; 选项，使用默认区域</li>
<li>–reload：删除当前运行时配置，应用加载永久配置</li>
<li>–list-services：查看开放的服务</li>
<li>–list-ports：查看开放的端口</li>
<li>–list-all [–zone&#x3D;<ZONE>]：列出指定区域的所有配置信息，包括接口，源地址，端口，服务等，如果无–zone&#x3D; 选项，使用默认区域</li>
</ul>
<p>范例：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#查看默认zone</span>
firewall-cmd --get-default-zone
<span class="token comment">#默认zone设为dmz</span>
firewall-cmd --set-default-zone<span class="token operator">=</span>dmz
<span class="token comment">#在internal zone中增加源地址192.168.0.0/24的永久规则</span>
firewall-cmd <span class="token parameter variable">--permanent</span> <span class="token parameter variable">--zone</span><span class="token operator">=</span>internal --add-source<span class="token operator">=</span><span class="token number">192.168</span>.0.0/24
<span class="token comment">#在internal zone中增加协议mysql的永久规则</span>
firewall-cmd <span class="token parameter variable">--permanent</span> <span class="token parameter variable">--zone</span><span class="token operator">=</span>internal --add-service<span class="token operator">=</span>mysql
<span class="token comment">#加载新规则以生效</span>
firewall-cmd <span class="token parameter variable">--reload</span></code></pre>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" rel="tag"><i class="fa fa-tag"></i> 防火墙</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/system-config-kickstart/" rel="prev" title="system-config-kickstart">
                  <i class="fa fa-chevron-left"></i> system-config-kickstart
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/OpenVPN/OpenVPN/" rel="next" title="OpenVPN">
                  OpenVPN <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-1 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.to2b.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.to2b.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.to2b.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.to2b.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
