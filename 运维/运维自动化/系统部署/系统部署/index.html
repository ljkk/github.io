<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.lujinkai.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.lujinkai.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="系统安装过程Linux 安装过程 加载 boot loader 加载启动安装菜单 加载内核和 initrd 文件 加载根系统 运行 anaconda 的安装向导  isolinux 目录下安装相关文件1234567891011121314151617181920# 将光盘挂载到&#x2F;mnt&#x2F;sro目录下[root@centos8 mnt]$mount &#x2F;dev&#x2F;sr0 &#x2F;mnt&#x2F;sr0&#x2F;mount:">
<meta property="og:type" content="article">
<meta property="og:title" content="系统部署">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="系统安装过程Linux 安装过程 加载 boot loader 加载启动安装菜单 加载内核和 initrd 文件 加载根系统 运行 anaconda 的安装向导  isolinux 目录下安装相关文件1234567891011121314151617181920# 将光盘挂载到&#x2F;mnt&#x2F;sro目录下[root@centos8 mnt]$mount &#x2F;dev&#x2F;sr0 &#x2F;mnt&#x2F;sr0&#x2F;mount:">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600091290280.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600169193361.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600181464577.png">
<meta property="og:image" content="http://img.to2b.cn/blog/ljk/1600182537433.png">
<meta property="article:published_time" content="2020-12-09T15:08:04.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.514Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="PXE">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.to2b.cn/blog/ljk/1600091290280.png">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/","path":"运维/运维自动化/系统部署/系统部署/","title":"系统部署"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>系统部署 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">系统安装过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux-%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B"><span class="nav-number">1.1.</span> <span class="nav-text">Linux 安装过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#isolinux-%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.1.</span> <span class="nav-text">isolinux 目录下安装相关文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E8%8F%9C%E5%8D%95%E7%9A%84%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="nav-number">1.1.2.</span> <span class="nav-text">安装菜单的内核参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"><span class="nav-number">1.1.3.</span> <span class="nav-text">常见内核参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E7%9A%84%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.</span> <span class="nav-text">自动安装的应答文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#kickstart-%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.1.</span> <span class="nav-text">kickstart 文件格式说明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%AE%B5"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">命令段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E5%8C%85%E6%AE%B5"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">程序包段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E6%AE%B5"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">脚本段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#kickstart-%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA"><span class="nav-number">1.2.2.</span> <span class="nav-text">kickstart 文件创建</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E5%BC%95%E5%AF%BC-U-%E7%9B%98"><span class="nav-number">2.</span> <span class="nav-text">制作引导 U 盘</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DHCP"><span class="nav-number">3.</span> <span class="nav-text">DHCP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">DHCP 工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP-%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.</span> <span class="nav-text">DHCP 实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DHCP-%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E7%BB%84%E6%88%90"><span class="nav-number">3.2.1.</span> <span class="nav-text">DHCP 相关文件组成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DHCP-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.2.2.</span> <span class="nav-text">DHCP 服务器配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dhclient-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.2.3.</span> <span class="nav-text">dhclient 命令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TFTP"><span class="nav-number">4.</span> <span class="nav-text">TFTP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-TFTP"><span class="nav-number">4.1.</span> <span class="nav-text">安装和使用 TFTP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-PXE-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="nav-number">5.</span> <span class="nav-text">利用 PXE 实现自动化安装部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-CentOS8-%E4%B8%8A%E5%AE%9E%E7%8E%B0-PXE-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85-CentOS6%E3%80%817%E3%80%818"><span class="nav-number">5.1.</span> <span class="nav-text">在 CentOS8 上实现 PXE 自动化安装 CentOS6、7、8</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8-cobbler-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="nav-number">6.</span> <span class="nav-text">利用 cobbler 实现自动安装</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.lujinkai.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.lujinkai.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="系统部署 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          系统部署
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 23:08:04" itemprop="dateCreated datePublished" datetime="2020-12-09T23:08:04+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">运维自动化</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">系统部署</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="系统安装过程"><a href="#系统安装过程" class="headerlink" title="系统安装过程"></a>系统安装过程</h2><h3 id="Linux-安装过程"><a href="#Linux-安装过程" class="headerlink" title="Linux 安装过程"></a>Linux 安装过程</h3><ol>
<li>加载 boot loader</li>
<li>加载启动安装菜单</li>
<li>加载内核和 initrd 文件</li>
<li>加载根系统</li>
<li>运行 anaconda 的安装向导</li>
</ol>
<h4 id="isolinux-目录下安装相关文件"><a href="#isolinux-目录下安装相关文件" class="headerlink" title="isolinux 目录下安装相关文件"></a>isolinux 目录下安装相关文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将光盘挂载到/mnt/sro目录下</span></span><br><span class="line">[root@centos8 mnt]<span class="variable">$mount</span> /dev/sr0 /mnt/sr0/</span><br><span class="line">mount: /mnt/sr0: WARNING: device write-protected, mounted read-only.</span><br><span class="line"><span class="comment"># 查看isolinux目录下的文件</span></span><br><span class="line">[root@centos8 isolinux]<span class="variable">$ll</span> /mnt/sr0/isolinux/</span><br><span class="line">total 72859</span><br><span class="line">-r--r--r--. 1 root root     2048 Jun  8 18:08 boot.cat</span><br><span class="line">-r--r--r--. 1 root root       84 Jun  8 17:26 boot.msg</span><br><span class="line">-r--r--r--. 1 root root      293 Jun  8 17:26 grub.conf</span><br><span class="line">-r--r--r--. 2 root root 65114136 Jun  8 17:25 initrd.img</span><br><span class="line">-r--r--r--. 1 root root    38912 Jun  8 17:26 isolinux.bin</span><br><span class="line">-r--r--r--. 1 root root     3075 Jun  8 17:26 isolinux.cfg</span><br><span class="line">-r--r--r--. 1 root root   116096 Nov  8  2019 ldlinux.c32</span><br><span class="line">-r--r--r--. 1 root root   180700 Nov  8  2019 libcom32.c32</span><br><span class="line">-r--r--r--. 1 root root    22804 Nov  8  2019 libutil.c32</span><br><span class="line">-r--r--r--. 1 root root   182704 May 12  2019 memtest</span><br><span class="line">-r--r--r--. 1 root root      186 Jul 30  2019 splash.png</span><br><span class="line">-r--r--r--. 1 root root     2885 Jun  8 18:08 TRANS.TBL</span><br><span class="line">-r--r--r--. 1 root root    26788 Nov  8  2019 vesamenu.c32</span><br><span class="line">-r-xr-xr-x. 2 root root  8913656 May  8 07:07 vmlinuz</span><br></pre></td></tr></table></figure>

<ul>
<li>boot.cat: 相当于 grub 的第一阶段</li>
<li>isolinux.bin：光盘引导程序，在 mkisofs 的选项中需要明确给出文件路径，这个文件属于 SYSLINUX 项目</li>
<li>isolinux.cfg：启动菜单的配置文件，当光盘启动后（即运行 isolinux.bin），会自动去找 isolinux.cfg 文件</li>
<li>vesamenu.c32：是光盘启动后的启动菜单图形界面，也属于 SYSLINUX 项目，menu.c32 提供纯文本的菜单</li>
<li>memtest：内存检测程序</li>
<li>splash.png：光盘启动菜单界面的背景图</li>
<li>vmlinuz：是内核映像</li>
<li>initrd.img：ramfs 文件</li>
</ul>
<h4 id="安装菜单的内核参数"><a href="#安装菜单的内核参数" class="headerlink" title="安装菜单的内核参数"></a>安装菜单的内核参数</h4><p>安装光盘的启动菜单配置文件：isolinux&#x2F;isolinux.cfg，每个 label 就是一个菜单项，主菜单或者二级菜单。</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600091290280.png"></p>
<p>isolinux.cfg 中部分内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认使用vesamenu.c32：图形化菜单界面。menu.32提供纯文本的菜单</span></span><br><span class="line">default vesamenu.c32</span><br><span class="line"><span class="comment"># 默认等待时间，单位是十分之一秒</span></span><br><span class="line"><span class="built_in">timeout</span> 600</span><br><span class="line"><span class="comment"># 标题</span></span><br><span class="line">menu title CentOS Linux 8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 菜单选项</span></span><br><span class="line">label linux</span><br><span class="line">  menu label ^Install CentOS Linux 8 <span class="comment"># 菜单标签</span></span><br><span class="line">  kernel vmlinuz <span class="comment"># 加载的内核，这里是相对路径</span></span><br><span class="line">  <span class="comment"># 向内核传递参数，除了菜单文件指定，在安装界面还可以tab键后 手动输入，常见内核参数见下表</span></span><br><span class="line">  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS-8-2-2004-x86_64-dvd quiet</span><br><span class="line"></span><br><span class="line"><span class="comment"># menu begin 设置Troubleshooting的二级菜单 开始</span></span><br><span class="line">menu begin ^Troubleshooting</span><br><span class="line">  menu title Troubleshooting</span><br><span class="line"></span><br><span class="line"><span class="comment"># menu begin 和 menu begin end 之间的内容，属于二级菜单</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># menu begin 设置二级菜单 结束</span></span><br><span class="line">menu end</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="常见内核参数"><a href="#常见内核参数" class="headerlink" title="常见内核参数"></a>常见内核参数</h4><ul>
<li><p>text：指定文本方式的安装界面</p>
</li>
<li><p>rescue：进入救援模式</p>
</li>
<li><p>inst.repo&#x3D;path：指定安装源文件的路径，可以是以下格式</p>
<p><strong>Centos 6：</strong></p>
<ul>
<li>DVD drive repo&#x3D;cdrom :device</li>
<li>Hard Drive repo&#x3D;hd:device&#x2F;path</li>
<li>HTTP Server repo&#x3D;<a target="_blank" rel="noopener" href="http://host/path">http://host/path</a></li>
<li>HTTPS Server repo&#x3D;<a target="_blank" rel="noopener" href="https://host/path">https://host/path</a></li>
<li>FTP Server repo&#x3D;<a href="ftp://username:password@host/path">ftp://username:password@host/path</a></li>
<li>NFS Server repo&#x3D;nfs:server:&#x2F;path</li>
<li>ISO images on an NFS Server repo&#x3D;nfsiso:server:&#x2F;path<br><strong>Centos 7：</strong></li>
<li>Any CD&#x2F;DVD drive inst.repo&#x3D;cdrom</li>
<li>Hard Drive inst.repo&#x3D;hd:device:&#x2F;path</li>
<li>HTTP Server inst.repo&#x3D;<a target="_blank" rel="noopener" href="http://host/path">http://host/path</a></li>
<li>HTTPS Server inst.repo&#x3D;<a target="_blank" rel="noopener" href="https://host/path">https://host/path</a></li>
<li>FTP Server inst.repo&#x3D;<a href="ftp://username:password@host/path">ftp://username:password@host/path</a></li>
<li>NFS Server inst.repo&#x3D;nfs:[options:]server:&#x2F;path</li>
</ul>
</li>
<li><p>inst.ks&#x3D;path：指定自动化安装应答文件路径，例如</p>
<ul>
<li>inst.ks&#x3D;<a target="_blank" rel="noopener" href="http://192.168.8.8/ksdir/ks8.cfg">http://192.168.8.8/ksdir/ks8.cfg</a></li>
<li>DVD drive：inst.ks&#x3D;cdrom:&#x2F;PATH&#x2F;TO&#x2F;KICKSTART_FILE</li>
<li>Hard drive：inst.ks&#x3D;hd:device:&#x2F;directory&#x2F;KICKSTART_FILE</li>
<li>HTTP server：inst.ks&#x3D;<a href="http://host:port/path/to/KICKSTART_FILE">http://host:port/path/to/KICKSTART_FILE</a></li>
<li>FTP server：inst.ks&#x3D;<a href="ftp://host:port/path/to/KICKSTART_FILE">ftp://host:port/path/to/KICKSTART_FILE</a></li>
<li>HTTPS server：inst.ks&#x3D;<a href="https://host:port/path/to/KICKSTART_FILE">https://host:port/path/to/KICKSTART_FILE</a></li>
<li>NFS server：inst.ks&#x3D;nfs:host:&#x2F;path&#x2F;to&#x2F;KICKSTART_FILE</li>
</ul>
</li>
<li><p>ip&#x3D; : 指定 IP 地址信息，例如</p>
<ul>
<li>ip&#x3D;dhcp 自动获取</li>
<li>id&#x3D;eth0:dhcp 指定网卡接口</li>
<li>ip&#x3D;ip::gateway:netmask:hostname:interface:none 静态 IP</li>
</ul>
</li>
</ul>
<p>注意：安装程序的引导参数都使用 inst. 作为前缀。目前这个前缀是可选的，例如 inst.ks&#x3D; 和 ks&#x3D; 的效果完全一样。但预期在未来会强制使用 inst. 前缀。</p>
<h3 id="自动安装的应答文件"><a href="#自动安装的应答文件" class="headerlink" title="自动安装的应答文件"></a>自动安装的应答文件</h3><p>实现自动化安装前，需要制作对应的应答文件，称为 kickstart 文件，用于保存安装过程中的需要指定的选项</p>
<p>如果是图形化手动一步步安装，系统会自动生成应答文件：&#x2F;root&#x2F;anaconda-ks.cfg</p>
<p>kickstart 文件格式的官方说明：<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/s1-kickstart2-options">centos6</a>、<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-syntax">centos7</a>、<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_an_advanced_rhel_installation/index">centos8</a></p>
<h4 id="kickstart-文件格式说明"><a href="#kickstart-文件格式说明" class="headerlink" title="kickstart 文件格式说明"></a>kickstart 文件格式说明</h4><p>kickstart 文件主要包括三个部分：命令段、程序包段、脚本段</p>
<h5 id="命令段"><a href="#命令段" class="headerlink" title="命令段"></a>命令段</h5><p>指明各种安装前配置，如键盘类型等</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>keyboard</td>
<td>设定键盘类型</td>
</tr>
<tr>
<td>lang</td>
<td>语言类型</td>
</tr>
<tr>
<td>zerombr</td>
<td>清除 mbr</td>
</tr>
<tr>
<td>clearpart</td>
<td>清除分区</td>
</tr>
<tr>
<td>part</td>
<td>创建分区</td>
</tr>
<tr>
<td>rootpw</td>
<td>指明 root 的密码</td>
</tr>
<tr>
<td>timezone</td>
<td>时区</td>
</tr>
<tr>
<td>text</td>
<td>文本安装界面</td>
</tr>
<tr>
<td>network</td>
<td>指定网络设置</td>
</tr>
<tr>
<td>firewall</td>
<td>设置防火墙设置</td>
</tr>
<tr>
<td>selinux</td>
<td>设置 selinux 设置</td>
</tr>
<tr>
<td>reboot</td>
<td>安装完自动重启</td>
</tr>
<tr>
<td>user</td>
<td>安装完成后为系统创建新用户</td>
</tr>
<tr>
<td>url</td>
<td>指明安装源</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<h5 id="程序包段"><a href="#程序包段" class="headerlink" title="程序包段"></a>程序包段</h5><p>%packages：指定要安装的程序包组或程序包、指定不安装的程序包等。以%end 结尾。范例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%packages</span><br><span class="line">@^environment group  # 环境包组，如：@^minimal-environment</span><br><span class="line">@group_name  # 程序包组</span><br><span class="line">package  # 程序包</span><br><span class="line">-package # 不安装的程序包</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<h5 id="脚本段"><a href="#脚本段" class="headerlink" title="脚本段"></a>脚本段</h5><ul>
<li>%pre: 安装前脚本，%end 结尾</li>
<li>%post: 安装后脚本，%end 结尾</li>
</ul>
<p>范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%post</span><br><span class="line">useradd mage</span><br><span class="line"><span class="built_in">echo</span> magedu | passwd --stdin mage &amp;&gt; /dev/null</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul>
<li><p>%addon：安装插件，%end 结尾，范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%addon com_redhat_kdump --<span class="built_in">enable</span> --reserve-mb=128</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%addon org_fedora_oscap</span><br><span class="line">content-type = datastream</span><br><span class="line">content-url = http://www.example.com/scap/testing_ds.xml</span><br><span class="line">datastream-id = scap_example.com_datastream_testing</span><br><span class="line">xccdf-id = scap_example.com_cref_xccdf.xml</span><br><span class="line">profile =  xccdf_example.com_profile_my_profile</span><br><span class="line">fingerprint = 240f2f18222faa98856c3b4fc50c4195</span><br><span class="line">%end</span><br></pre></td></tr></table></figure>
</li>
<li><p>%anaconda：控制安装系统的用户界面的行为。此部分必须放在 kickstart 文件的末尾。目前，在%anaconda 部分中，pwplicy 是唯一可以使用的命令，范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置密码策略，要求root密码至少为10个字符长，并严格禁止与此要求不匹配的密码</span></span><br><span class="line">%anaconda</span><br><span class="line">pwpolicy root --minlen=10 --strict</span><br><span class="line">%end</span><br></pre></td></tr></table></figure></li>
</ul>
<p>注意：CentOS6、7、8 的 kickstart 文件格式不尽相同，不可混用</p>
<h4 id="kickstart-文件创建"><a href="#kickstart-文件创建" class="headerlink" title="kickstart 文件创建"></a>kickstart 文件创建</h4><ul>
<li>可使用创建工具：system-config-kickstart ，注意：此方法 CentOS 8 不再支持</li>
<li>CentOS 安装完后，会根据当前系统的安装过程，自动生成一个 kickstart 文件：&#x2F;root&#x2F;anaconda-ks.cfg，可以根据此文件修改并生成新配置</li>
</ul>
<p>推荐使用第二种方式，手动编辑，最后使用 ksvalidator（来自于 pykickstart 包） 工具检查一下文件格式是否有语法错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]$yum install pykickstart.noarch</span><br><span class="line">[root@centos8 ~]$ksvalidator ./anaconda-ks.cfg</span><br></pre></td></tr></table></figure>

<h2 id="制作引导-U-盘"><a href="#制作引导-U-盘" class="headerlink" title="制作引导 U 盘"></a>制作引导 U 盘</h2><p>制作应答文件、修改 iso 的启动菜单配置文件 isolinux.cfg，然后把 iso 制作成引导 U 盘，就可以实现半自动化安装。</p>
<p>应答文件可以放在 iso 中，也可以放在 http 服务器，只需要在 isolinux.cfg 中配置好 ks&#x3D;path 即可。</p>
<h2 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h2><p>主机获取网络配置可以通过两种方式：</p>
<ul>
<li>静态指定</li>
<li>动态获取<ul>
<li>bootp：boot protocol，IP 与 MAC 一一静态对应</li>
<li>dhcp：增强的 bootp，IP 与 MAC 既可以静态绑定，也可以动态分配</li>
</ul>
</li>
</ul>
<h3 id="DHCP-工作原理"><a href="#DHCP-工作原理" class="headerlink" title="DHCP 工作原理"></a>DHCP 工作原理</h3><p>DHCP: Dynamic Host Configuration Protocol，动态主机配置协议。基于 UDP 协议，DHCP Server 默认 67 端口号，DHCP Client 默认 68（ipv4）和 546（ipv6）端口号。</p>
<p>主要用途：</p>
<ul>
<li>用于内部网络和网络服务供应商自动分配 IP 地址给用户</li>
<li>用于内部网络管理员作为对所有电脑作集中管理的手段</li>
<li>自动化安装系统</li>
<li>解决 IPV4 资源不足问题</li>
</ul>
<h3 id="DHCP-实现"><a href="#DHCP-实现" class="headerlink" title="DHCP 实现"></a>DHCP 实现</h3><p>实现 DHCP 服务的软件：</p>
<ul>
<li>dhcp（centos7） 或 dhcp server（centos8）</li>
<li>dnsmasq：小型服务软件，可以提供 dhcp 和 dns 服务</li>
</ul>
<h4 id="DHCP-相关文件组成"><a href="#DHCP-相关文件组成" class="headerlink" title="DHCP 相关文件组成"></a>DHCP 相关文件组成</h4><p><strong>dhcp 或 dhcp server 包文件组成：</strong></p>
<ul>
<li>&#x2F;usr&#x2F;sbin&#x2F;dhcpd：dhcp 服务主程序</li>
<li>&#x2F;etc&#x2F;dhcp&#x2F;dhcpd.conf：dhcp 服务配置文件</li>
<li>&#x2F;usr&#x2F;share&#x2F;doc&#x2F;dhcp-server&#x2F;dhcpd.conf.example：dhcp 服务配置范例文件</li>
<li>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;dhcpd.service：dhcp 服务 service 文件</li>
<li>&#x2F;var&#x2F;lib&#x2F;dhcpd&#x2F;dhcpd.leases：DHCP 服务器日志，记录了地址分配记录</li>
</ul>
<p><strong>dhcp-client 客户端包：</strong></p>
<ul>
<li>&#x2F;usr&#x2F;sbin&#x2F;dhclient：客户端程序</li>
<li>&#x2F;var&#x2F;lib&#x2F;dhclient&#x2F;dhclient.leases：DHCP 客户端日志，</li>
</ul>
<h4 id="DHCP-服务器配置文件"><a href="#DHCP-服务器配置文件" class="headerlink" title="DHCP 服务器配置文件"></a>DHCP 服务器配置文件</h4><p>帮助参考：man 5 dhcpd.conf</p>
<p>dhcpd.conf 配置信息： subnet 网段设置； host 主机设置。 范例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">option domain-name <span class="string">&quot;magedu.org&quot;</span>; <span class="comment"># 分配给用户域名，就是/etc/resolve.conf中的domain</span></span><br><span class="line"><span class="comment"># 分配给用户DNS，就是/etc/resolve.conf中的nameserver</span></span><br><span class="line">option domain-name-servers 180.76.76.76, 223.6.6.6;</span><br><span class="line"><span class="comment"># 默认租约时间，以秒为单位，十分钟，五分钟就要续约，所以一般我们需要把这个值调长一些</span></span><br><span class="line">default-lease-time 600;</span><br><span class="line">max-lease-time 7200;    <span class="comment"># 最长续约时间，两个小时</span></span><br><span class="line">log-facility local7; <span class="comment"># 日志类型，具体什么含义后面的日志章节会详细学习，这里先不用管它</span></span><br><span class="line"><span class="comment"># 网段设置</span></span><br><span class="line">subnet 10.0.0.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 10.0.0.10 10.0.0.100;   <span class="comment"># ip 范围</span></span><br><span class="line">  range 10.0.0.110 10.0.0.200;    <span class="comment"># ip 范围</span></span><br><span class="line">  option routers 10.0.0.2;    <span class="comment"># 路由</span></span><br><span class="line">  <span class="comment"># 提供引导文件的服务器IP地址，一般是一个tftp服务器。与pxe自动化安装有关</span></span><br><span class="line">  next-server 10.0.0.8;</span><br><span class="line">  <span class="comment"># 指明引导文件名称：pxelinux.0</span></span><br><span class="line">  filename <span class="string">&quot;pxelinux.0&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 主机设置，DHCP服务器给指定主机分配固定IP</span></span><br><span class="line">host testclient &#123;</span><br><span class="line">  hardware ethernet 00:0c:29:33:b4:1a;</span><br><span class="line">  fixed-address 10.0.0.106;  <span class="comment"># 指定ip，与MAC地址绑定</span></span><br><span class="line">  default-lease-time 86400;</span><br><span class="line">  max-lease-time 864000;</span><br><span class="line">  option routers 10.0.0.254;</span><br><span class="line">  option domain-name-servers 114.114.114.114,8.8.8.8 ;</span><br><span class="line">  option domain-name <span class="string">&quot;magedu.net&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="dhclient-命令"><a href="#dhclient-命令" class="headerlink" title="dhclient 命令"></a>dhclient 命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dhclient -d  <span class="comment"># 强制dhclient作为前台进程运行</span></span><br><span class="line">dhclient -l  <span class="comment"># 尝试获得一次租约</span></span><br><span class="line">dhclient -r  <span class="comment"># 释放当前租约并停止正在运行的DHCP客户端</span></span><br></pre></td></tr></table></figure>

<h2 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h2><p>OpenSSH 服务中，我们学习了 SFTP 是安全版的 FTP，而 TFTP 是简化版的 FTP：</p>
<ol>
<li><p>FTP 基于 TCP、TFTP 基于 UDP</p>
</li>
<li><p>FTP 支持账号登录，TFTP 不支持账号登录</p>
</li>
<li><p>FTP 使用 2 个端口：TCP 端口 21，是个侦听端口；TCP 端口 20 或更高 TCP 端口 1024 以上用于源连接。</p>
<p>FTP 仅使用一个具有停止和等待模式的端口：端口：69&#x2F;udp</p>
</li>
<li><p>FTP 有许多可以执行的命令（get，put，ls，dir，lcd）并且可以列出目录等<br>TFTP 只有 5 个指令可以执行（rrq，wrq，data，ack，error）</p>
</li>
</ol>
<h3 id="安装和使用-TFTP"><a href="#安装和使用-TFTP" class="headerlink" title="安装和使用 TFTP"></a>安装和使用 TFTP</h3><p>服务器包 tftp-server：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="variable">$dnf</span> -y install tftp-server  <span class="comment"># 安装dftp服务器包</span></span><br><span class="line">[root@centos8 ~]<span class="variable">$rpm</span> -ql tftp-server</span><br><span class="line">/usr/lib/.build-id</span><br><span class="line">/usr/lib/.build-id/8c</span><br><span class="line">/usr/lib/.build-id/8c/6921a9fb21d66da4fb299d516bce9ee6afea34</span><br><span class="line">/usr/lib/systemd/system/tftp.service <span class="comment"># tftp service文件</span></span><br><span class="line">/usr/lib/systemd/system/tftp.socket  <span class="comment"># tftp socket文件</span></span><br><span class="line">/usr/sbin/in.tftpd      <span class="comment"># tftp主程序</span></span><br><span class="line">/usr/share/doc/tftp-server</span><br><span class="line">/usr/share/doc/tftp-server/CHANGES</span><br><span class="line">/usr/share/doc/tftp-server/README</span><br><span class="line">/usr/share/doc/tftp-server/README.security</span><br><span class="line">/usr/share/man/man8/in.tftpd.8.gz</span><br><span class="line">/usr/share/man/man8/tftpd.8.gz</span><br><span class="line">/var/lib/tftpboot  <span class="comment"># TFTP服务数据目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务并设置开机自启</span></span><br><span class="line">[root@centos8 ~]<span class="variable">$systemctl</span> <span class="built_in">enable</span> --now tftp.service</span><br><span class="line">[root@centos8 ~]<span class="variable">$ss</span> -ntulp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备测试文件</span></span><br><span class="line">[root@centos8 ~]<span class="variable">$cd</span> /var/lib/tftpboot/</span><br><span class="line">[root@centos8 tftpboot]<span class="variable">$echo</span> <span class="string">&#x27;hello tftp&#x27;</span> &gt; test.txt</span><br></pre></td></tr></table></figure>

<p>客户端包 tftp：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#yum -y install tftp</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#tftp 10.0.0.8</span></span><br><span class="line">tftp&gt; ?</span><br><span class="line">tftp-hpa 5.2</span><br><span class="line">Commands may be abbreviated.  Commands are:</span><br><span class="line"></span><br><span class="line">connect         connect to remote tftp</span><br><span class="line">mode            <span class="built_in">set</span> file transfer mode</span><br><span class="line">put             send file</span><br><span class="line">get             receive file</span><br><span class="line">quit            <span class="built_in">exit</span> tftp</span><br><span class="line">verbose         toggle verbose mode</span><br><span class="line">trace           toggle packet tracing</span><br><span class="line">literal         toggle literal mode, ignore <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> file name</span><br><span class="line">status          show current status</span><br><span class="line">binary          <span class="built_in">set</span> mode to octet</span><br><span class="line">ascii           <span class="built_in">set</span> mode to netascii</span><br><span class="line">rexmt           <span class="built_in">set</span> per-packet transmission <span class="built_in">timeout</span></span><br><span class="line"><span class="built_in">timeout</span>         <span class="built_in">set</span> total retransmission <span class="built_in">timeout</span></span><br><span class="line">?               <span class="built_in">print</span> <span class="built_in">help</span> information</span><br><span class="line"><span class="built_in">help</span>            <span class="built_in">print</span> <span class="built_in">help</span> information</span><br><span class="line">tftp&gt; get test.txt  <span class="comment"># 注意，目录不能get，ftp也不行</span></span><br><span class="line">tftp&gt; quit</span><br><span class="line">[root@centos7 ~]<span class="comment">#ll test.txt</span></span><br><span class="line">-rw-r--r--. 1 root root 12 Sep 15 19:12 test.txt</span><br><span class="line">[root@centos7 ~]<span class="comment">#cat test.txt</span></span><br><span class="line">hello tftp</span><br></pre></td></tr></table></figure>

<h2 id="利用-PXE-实现自动化安装部署"><a href="#利用-PXE-实现自动化安装部署" class="headerlink" title="利用 PXE 实现自动化安装部署"></a>利用 PXE 实现自动化安装部署</h2><p>PXE：Preboot Excution Environment，预启动执行环境，是由 Intel 公司研发，基于 Client&#x2F;Server 的网络模式。</p>
<p>Intel PXE 规范定义了一些机制和协议，可让 PXE 设备使用其网络接口卡 (NIC) 来查找<strong>位于网络服务器上的引导程序</strong>。在 PXE 规范中，这些程序被称为“网络引导程序”(NBP)。</p>
<p><font style="background:#ccc">复习：MBR 硬盘的 0 号扇区的前 446 个字符是主引导程序 BootLoader，作用是查找和装载可引导的操作系统。</font><br>NBP 类似 BootLoader，只不过 NMP 是在网络中查找配置文件，根据配置文件引导系统。</p>
<p>syslinux 是一个启动加载器集合，支持从硬盘、光盘或通过 PXE 的网络引导启动系统，支持 ext4、FAT 等文件系统。Server 安装 syslinux 后，会在&#x2F;usr&#x2F;share&#x2F;syslinux 目录下生成很多文件，其中 pxelinux.0 就是 NBP，pxelinux.cfg 就是配置文件。</p>
<p>PXE 启动工作原理：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600169193361.png"></p>
<h3 id="在-CentOS8-上实现-PXE-自动化安装-CentOS6、7、8"><a href="#在-CentOS8-上实现-PXE-自动化安装-CentOS6、7、8" class="headerlink" title="在 CentOS8 上实现 PXE 自动化安装 CentOS6、7、8"></a>在 CentOS8 上实现 PXE 自动化安装 CentOS6、7、8</h3><p>安装前准备：</p>
<ul>
<li>关闭 Vmware 软件中的 DHCP 服务，设置为基于 NAT 模式</li>
<li>关闭 CentOS 8 的防火墙和 SELINUX</li>
<li>确保 CentOS 8 的 IP 是静态指定，不是 DHCP 获取</li>
<li>使用 1G 以下内存的主机安装 CentOS 7，8 会提示空间不足，建议 2G 以上</li>
</ul>
<ol>
<li>安装相关软件包并启动</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#dnf -y install dhcp-server tftp-server httpd syslinux-nonlinux</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#systemctl enable --now httpd tftp dhcpd</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置 DHCP 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">option domain-name <span class="string">&quot;magedu.org&quot;</span>;</span><br><span class="line">option domain-name-servers 180.76.76.76, 223.6.6.6;</span><br><span class="line">default-lease-time 600;</span><br><span class="line">max-lease-time 7200;</span><br><span class="line">log-facility local7;</span><br><span class="line">subnet 10.0.0.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  range 10.0.0.10 10.0.0.100;</span><br><span class="line">  range 10.0.0.110 10.0.0.200;</span><br><span class="line">  option routers 10.0.0.2;</span><br><span class="line">  next-server 10.0.0.8;</span><br><span class="line">  filename <span class="string">&quot;pxelinux.0&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置 TFTP 服务，参考上文</li>
<li>准备 yum 源和相关目录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]<span class="comment">#mkdir -pv /var/www/html/centos/&#123;6,7,8&#125;/os/x86_64/</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/sr0 /var/www/html/centos/6/os/x86_64/</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/sr1 /var/www/html/centos/8/os/x86_64/</span></span><br><span class="line">[root@centos8 ~]<span class="comment">#mount /dev/sr2 /var/www/html/centos/7/os/x86_64/</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>准备应答文件</li>
</ol>
<p>centos6：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考 14.1 CentOS6、7、8应答文件.md</span></span><br></pre></td></tr></table></figure>

<p>centos7：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考 14.1 CentOS6、7、8应答文件.md</span></span><br></pre></td></tr></table></figure>

<p>centos8：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考 14.1 CentOS6、7、8应答文件.md</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>准备 PXE 启动相关文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 tftpboot]<span class="variable">$mkdir</span> /var/lib/tftpboot/centos&#123;6,7,8&#125;</span><br><span class="line">[root@centos8 centos]<span class="variable">$pwd</span></span><br><span class="line">/var/www/html/centos</span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> 6/os/x86_64/isolinux/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/centos6/</span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> 7/os/x86_64/isolinux/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/centos7/</span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> 8/os/x86_64/isolinux/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/centos8/</span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> /usr/share/syslinux/&#123;pxelinux.0,menu.c32&#125; /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"><span class="comment">#以下三个文件是CentOS8安装所必须文件，CentOS6，7则不需要</span></span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> 8/os/x86_64/isolinux/&#123;ldlinux.c32,libcom32.c32,libutil.c32&#125; /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成安装菜单文件</span></span><br><span class="line">[root@centos8 centos]<span class="variable">$mkdir</span> /var/lib/tftpboot/pxelinux.cfg</span><br><span class="line">[root@centos8 centos]<span class="variable">$cp</span> 8/os/x86_64/isolinux/&#123;ldlinux.c32,libcom32.c32,libutil.c32&#125; /var/lib/tftpboot/</span><br><span class="line"></span><br><span class="line"><span class="comment">#最终目录结构如下</span></span><br><span class="line">[root@centos8 centos]<span class="variable">$cd</span> /var/lib/tftpboot/</span><br><span class="line">[root@centos8 tftpboot]<span class="variable">$tree</span></span><br><span class="line">.</span><br><span class="line">├── centos6</span><br><span class="line">│   ├── initrd.img</span><br><span class="line">│   └── vmlinuz</span><br><span class="line">├── centos7</span><br><span class="line">│   ├── initrd.img</span><br><span class="line">│   └── vmlinuz</span><br><span class="line">├── centos8</span><br><span class="line">│   ├── initrd.img</span><br><span class="line">│   └── vmlinuz</span><br><span class="line">├── ldlinux.c32</span><br><span class="line">├── libcom32.c32</span><br><span class="line">├── libutil.c32</span><br><span class="line">├── menu.c32</span><br><span class="line">├── pxelinux.0</span><br><span class="line">└── pxelinux.cfg</span><br><span class="line">    └── default</span><br><span class="line"></span><br><span class="line">4 directories, 12 files</span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>准备启动菜单文件</p>
<p>修改&#x2F;var&#x2F;lib&#x2F;tftpboot&#x2F;pxelinux.cfg&#x2F;default</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">default menu.c32</span><br><span class="line"><span class="built_in">timeout</span> 600</span><br><span class="line">menu title Install CentOS Linux</span><br><span class="line"></span><br><span class="line">label linux8</span><br><span class="line"> menu label Auto Install CentOS Linux ^8</span><br><span class="line"> kernel centos8/vmlinuz</span><br><span class="line"> append initrd=centos8/initrd.img inst.ks=http://10.0.0.8/ks/centos8.cfg</span><br><span class="line"></span><br><span class="line">label linux7</span><br><span class="line"> menu label Auto Install CentOS Linux ^7</span><br><span class="line"> kernel centos7/vmlinuz</span><br><span class="line"> append initrd=centos7/initrd.img inst.ks=http://10.0.0.8/ks/centos7.cfg</span><br><span class="line"></span><br><span class="line">label linux6</span><br><span class="line"> menu label Auto Install CentOS Linux ^6</span><br><span class="line"> kernel centos6/vmlinuz</span><br><span class="line"> append initrd=centos6/initrd.img inst.ks=http://10.0.0.8/ks/centos6.cfg</span><br><span class="line"></span><br><span class="line">label manual</span><br><span class="line"> menu label ^Manual Install CentOS Linux 8.0</span><br><span class="line"> kernel centos8/vmlinuz</span><br><span class="line"> append initrd=centos8/initrd.img inst.repo=http://10.0.0.8/centos/8/os/x86_64/</span><br><span class="line"></span><br><span class="line">label rescue</span><br><span class="line"> menu label ^Rescue a CentOS Linux system 8</span><br><span class="line"> kernel centos8/vmlinuz</span><br><span class="line"> append initrd=centos8/initrd.img inst.repo=http://10.0.0.8/centos/8/os/x86_64/ rescue</span><br><span class="line"></span><br><span class="line">label <span class="built_in">local</span></span><br><span class="line"> menu default</span><br><span class="line"> menu label Boot from ^<span class="built_in">local</span> drive</span><br><span class="line"> localboot 0xffff</span><br></pre></td></tr></table></figure>

<ol start="8">
<li><p>新准备一台主机，设置网卡引导，可看到看启动菜单，并实现自动安装</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600181464577.png"></p>
<p>安装成功：</p>
<p><img data-src="//img.to2b.cn/blog/ljk/1600182537433.png"></p>
</li>
</ol>
<h2 id="利用-cobbler-实现自动安装"><a href="#利用-cobbler-实现自动安装" class="headerlink" title="利用 cobbler 实现自动安装"></a>利用 cobbler 实现自动安装</h2>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.lujinkai.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/PXE/" rel="tag"><i class="fa fa-tag"></i> PXE</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/ulimit/" rel="prev" title="ulimit">
                  <i class="fa fa-chevron-left"></i> ulimit
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/CentOS6%E3%80%817%E3%80%818kickstart%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6/" rel="next" title="CentOS6、7、8kickstart应答文件">
                  CentOS6、7、8kickstart应答文件 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.lujinkai.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.lujinkai.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.lujinkai.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.lujinkai.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
