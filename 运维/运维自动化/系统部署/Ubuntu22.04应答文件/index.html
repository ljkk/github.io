<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="32x32" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="icon" type="image/png" sizes="16x16" href="//img.to2b.cn/blog/ljk/1607154764582.png">
  <link rel="mask-icon" href="//img.to2b.cn/blog/ljk/1607154764582.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//s1.to2b.cn/libs/fontawesome-free/5.15.4/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lujinkai.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.16.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":10},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"KN3H1V8A6V","apiKey":"c5d73d0dde2dd770ce49b505f938553d","indexName":"hexo","hits":{"per_page":20,"labels":{"input_placeholder":"Search for Posts","hits_empty":"We did not find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}}}}</script><script src="/js/config.js"></script>

    <meta name="description" content="转载：http:&#x2F;&#x2F;hmli.ustc.edu.cn&#x2F;doc&#x2F;linux&#x2F;ubuntu-autoinstall&#x2F;index.html 前言Ubuntu 22.04下的PXE自动无人值守安装配置服务设置，原文内容比较简单，基本为翻译的 Ubuntu 22.04官方手册 。   服务端提供PXE自动安装服务的信息： 提供DHCPD服务的网卡：enp2s0IP：192.168.22.254掩码：255.">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu22.04应答文件">
<meta property="og:url" content="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/Ubuntu22.04%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6/index.html">
<meta property="og:site_name" content="LJKのBlog">
<meta property="og:description" content="转载：http:&#x2F;&#x2F;hmli.ustc.edu.cn&#x2F;doc&#x2F;linux&#x2F;ubuntu-autoinstall&#x2F;index.html 前言Ubuntu 22.04下的PXE自动无人值守安装配置服务设置，原文内容比较简单，基本为翻译的 Ubuntu 22.04官方手册 。   服务端提供PXE自动安装服务的信息： 提供DHCPD服务的网卡：enp2s0IP：192.168.22.254掩码：255.">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-12-09T15:08:52.000Z">
<meta property="article:modified_time" content="2023-05-29T08:58:05.514Z">
<meta property="article:author" content="像方便面一样的男子">
<meta property="article:tag" content="PXE">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/Ubuntu22.04%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/Ubuntu22.04%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6/","path":"运维/运维自动化/系统部署/Ubuntu22.04应答文件/","title":"Ubuntu22.04应答文件"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Ubuntu22.04应答文件 | LJKのBlog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LJKのBlog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">学无止境</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AMD64-x86-64-%E6%9E%B6%E6%9E%84%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">AMD64(x86_64)架构网络安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEDHPC-x2F-bootp%E5%92%8Ctftp%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.</span> <span class="nav-text">设置DHPC&#x2F;bootp和tftp服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E7%A8%8B%E5%BA%8F%E5%92%8C%E9%85%8D%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">提供引导加载程序和配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E5%8C%85"><span class="nav-number">2.2.1.</span> <span class="nav-text">设置所需要的包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85WEB%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.2.2.</span> <span class="nav-text">安装WEB服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F%E7%8B%AC%E7%AB%8B%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.2.3.</span> <span class="nav-text">模式独立设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA-UEFI-%E5%BC%95%E5%AF%BC%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.4.</span> <span class="nav-text">为 UEFI 引导设置文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">自动化服务器安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8E-debian-installer-%E9%A2%84%E7%BD%AE%E5%AE%89%E8%A3%85%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">3.2.</span> <span class="nav-text">与 debian-installer 预置安装的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-number">3.3.</span> <span class="nav-text">提供自动安装配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%9C%9F%E6%AD%A3%E7%9A%84%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="nav-number">3.4.</span> <span class="nav-text">运行真正的自动安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">3.5.</span> <span class="nav-text">快速开始</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-number">3.6.</span> <span class="nav-text">创建自动安装配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E7%8E%B0%E6%9C%89-preseed-%E6%96%87%E4%BB%B6"><span class="nav-number">3.7.</span> <span class="nav-text">转换现有 preseed 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.8.</span> <span class="nav-text">自动安装配置文件的结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">3.9.</span> <span class="nav-text">错误处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AA%E6%9D%A5%E5%8F%AF%E8%83%BD%E7%9A%84%E6%96%B9%E5%90%91"><span class="nav-number">3.10.</span> <span class="nav-text">未来可能的方向</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-number">4.</span> <span class="nav-text">自动安装快速入门</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="nav-number">5.</span> <span class="nav-text">自动服务器安装配置文件参考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E6%A0%BC%E5%BC%8F-Overall-format"><span class="nav-number">5.1.</span> <span class="nav-text">整体格式(Overall format)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%A6%81-Schema"><span class="nav-number">5.2.</span> <span class="nav-text">概要(Schema)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%88%97%E8%A1%A8-Command-lists"><span class="nav-number">5.3.</span> <span class="nav-text">命令列表(Command lists)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B6%E7%BA%A7%E5%85%B3%E9%94%AE%E5%AD%97-Top-level-keys"><span class="nav-number">5.4.</span> <span class="nav-text">顶级关键字(Top-level keys)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">6.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="像方便面一样的男子"
      src="//img.to2b.cn/blog/ljk/1607154764582.png">
  <p class="site-author-name" itemprop="name">像方便面一样的男子</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">340</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ljkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ljkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://blog.lujinkai.cn/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/Ubuntu22.04%E5%BA%94%E7%AD%94%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="//img.to2b.cn/blog/ljk/1607154764582.png">
      <meta itemprop="name" content="像方便面一样的男子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LJKのBlog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Ubuntu22.04应答文件 | LJKのBlog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ubuntu22.04应答文件
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-12-09 23:08:52" itemprop="dateCreated datePublished" datetime="2022-12-09T23:08:52+08:00">2022-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-29 16:58:05" itemprop="dateModified" datetime="2023-05-29T16:58:05+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">运维</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">运维自动化</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BF%90%E7%BB%B4/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96/%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">系统部署</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>转载：<a target="_blank" rel="noopener" href="http://hmli.ustc.edu.cn/doc/linux/ubuntu-autoinstall/index.html">http://hmli.ustc.edu.cn/doc/linux/ubuntu-autoinstall/index.html</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>Ubuntu 22.04下的PXE自动无人值守安装配置服务设置，原文内容比较简单，基本为翻译的 <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs">Ubuntu 22.04官方手册</a> 。</p>
<ul>
<li><ul>
<li><p>服务端提供PXE自动安装服务的信息：</p>
<p>提供DHCPD服务的网卡：enp2s0IP：192.168.22.254掩码：255.255.255.0</p>
</li>
</ul>
</li>
<li><ul>
<li><p>客户端（目标对象）网络启动引导的信息：</p>
<p>安装系统名：Cleint1采用DHCP协议引导的网卡：enp1s0MAC地址：08:00:20:0A:0C:01自身IP：192.168.22.1网关IP：192.168.22.254掩码：255.255.255.0DNS：202.38.64.7</p>
</li>
</ul>
</li>
</ul>
<p>下述带有 <strong>1.、2.</strong> 编号的才是实际执行的步骤，其他都是介绍。</p>
<h1 id="AMD64-x86-64-架构网络安装"><a href="#AMD64-x86-64-架构网络安装" class="headerlink" title="AMD64(x86_64)架构网络安装"></a>AMD64(x86_64)架构网络安装</h1><p>AMD64（也称为x86_64）架构的系统启动既可以采用 <strong>UEFI</strong> 也可以采用传统 <strong>legacy</strong> (“BIOS”) 模式（很多系统可以被配置为采用其中任一模式启动）。确切的细节取决于系统固件，但两种模式都支持 <strong>PXE(“Preboot eXecution Environment”)</strong> 规范，使得可以通过网络来提供启动器引导加载程序启动主机。</p>
<p>两种模式的网络启动实时服务器安装程序的过程相似，如下所示：</p>
<ul>
<li>待安装机器启动，并定向到网络启动。</li>
<li><strong>DHCP&#x2F;bootp</strong> 服务器告诉机器它的网络配置以及从哪里获取引导加载程序。</li>
<li>机器的固件通过 <strong>tftp</strong> 协议下载引导加载程序并执行它。</li>
<li>引导加载程序通过 <strong>tftp</strong> 协议下载配置，告诉它在哪里下载内核(<strong>kernel</strong>)、 <strong>ramdisk</strong> 和内核命令行以使用。</li>
<li><strong>ramdisk</strong> 查看内核命令行以了解如何配置网络以及从何处下载服务器 <strong>ISO</strong> 操作系统安装镜像文件。</li>
<li><strong>ramdisk</strong> 下载操作系统 <strong>ISO</strong> 并将其安装为循环设备。</li>
<li>从此时起，安装遵循与操作系统 <strong>ISO</strong> 在本地块设备上相同的路径。</li>
</ul>
<p><strong>UEFI</strong> 和传统模式之间的区别在于：在 <strong>UEFI</strong> 模式下，引导加载程序是 <strong>EFI</strong> 可执行文件，经过签名以便安全引导 <strong>SecureBoot</strong> 接受，而在传统模式下，它是 <strong>PXELINUX</strong> 。大多数 <strong>DHCP&#x2F;bootp</strong> 服务器可以配置为为特定机器提供正确的引导加载程序。</p>
<h2 id="设置DHPC-x2F-bootp和tftp服务"><a href="#设置DHPC-x2F-bootp和tftp服务" class="headerlink" title="设置DHPC&#x2F;bootp和tftp服务"></a>设置DHPC&#x2F;bootp和tftp服务</h2><p>有几种可用的 <strong>DHCP&#x2F;bootp</strong> 和 <strong>tftp</strong> 协议实现。本文档将简要介绍如何配置 <strong>dnsmasq</strong> 服务（相比配置 <strong>isc-dhcp-server</strong> 与 <strong>tftpd</strong> 简单的多）以执行这两个角色。</p>
<ol>
<li><p>创建存放为客户端提供 <strong>tftp</strong> 服务所需要的文件的目录 <em>&#x2F;srv&#x2F;tftp</em> ：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /srv/tftp</code></pre>
</li>
<li><p>安装 <strong>dnsmasq</strong> 包，执行命令：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> dnsmasq </code></pre>
</li>
<li><p>设置文件 <em>&#x2F;etc&#x2F;dnsmasq.conf.d&#x2F;pxe.conf</em> ，其内容：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#设置本服务器提供DHCP服务的网卡 </span>
<span class="token assign-left variable">interface</span><span class="token operator">=</span>enp2s0,lo bind-interfaces 
<span class="token comment">#提供DHCP服务的网卡,开始IP,结束IP </span>
dhcp-range<span class="token operator">=</span>enp2s0,192.168.22.1,192.168.22.254 dhcp-boot<span class="token operator">=</span>pxelinux.0 
<span class="token comment">#设置采用UEFI模式 dhcp-match=set:efi-x86_64,option:client-arch,7 dhcp-boot=tag:efi-x86_64,bootx64.efi </span>
<span class="token comment">#启用tftp服务 enable-tftp </span>
<span class="token comment">#设置tftp服务目录 tftp-root=/srv/tftp </span>
<span class="token comment">#设定将要网络安装的MAC地址为08:00:20:0A:0C:01的主机名为Client1，IP为192.168.22.1 </span>
dhcp-host<span class="token operator">=</span>08:00:20:0A:0C:01,Client1,192.168.22.1 
<span class="token comment">#设定将要网络安装的MAC地址为08:00:20:0A:0C:02的主机名为Client2，IP为192.168.22.2 </span>
dhcp-host<span class="token operator">=</span>08:00:20:0A:0C:02,Client2,192.168.22.2 </code></pre>

<p>上面 <strong>enp2s0</strong> 为对客户端安装服务时使用的网卡名（与客户端启动网络安装服务的网卡在同一网络）。</p>
</li>
<li><p>重启 <strong>dnsmasq</strong> 服务，执行命令：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">systemctl restart dnsmasq</code></pre></li>
</ol>
<h2 id="提供引导加载程序和配置"><a href="#提供引导加载程序和配置" class="headerlink" title="提供引导加载程序和配置"></a>提供引导加载程序和配置</h2><h3 id="设置所需要的包"><a href="#设置所需要的包" class="headerlink" title="设置所需要的包"></a>设置所需要的包</h3><ol>
<li><p>安装对应包</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> cd-boot-images-amd64</code></pre>
</li>
<li><p>生成软链接 <code>/srv/tftp/boot-amd64</code>指向 <code>/usr/share/cd-boot-images-amd64</code> ：</p>
<blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/cd-boot-images-amd64 /srv/tftp/boot-amd64</code></pre></blockquote>
</li>
</ol>
<h3 id="安装WEB服务"><a href="#安装WEB服务" class="headerlink" title="安装WEB服务"></a>安装WEB服务</h3><p>安装时，需要通过 <strong>HTTP</strong> 协议下载所需文件，为此需要配置 <strong>WEB</strong> 服务。</p>
<p>安装所需要包，并重新启动服务：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> apache2 
systemctl restart apache2</code></pre>

<p>或者不用上述 <strong>apache</strong> 服务，如python3支持http模块，则可直接执行下述命令启动简易 <strong>WEB</strong> 服务：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-m</span> http.server <span class="token number">80</span></code></pre>

<h3 id="模式独立设置"><a href="#模式独立设置" class="headerlink" title="模式独立设置"></a>模式独立设置</h3><ol>
<li><p>针对该次使用 <strong>Ubuntu 22.04 server</strong> 版（代号： <strong>jammy</strong> ），建议有些配置文件放置在目录 <em>&#x2F;var&#x2F;www&#x2F;html&#x2F;jammy</em> 下，为此先生成该目录：</p>
<p><code>mkdir /var/www/html/jammy </code></p>
</li>
<li><p>下载所需要的操作系统 <strong>Live ISO</strong> 镜像到目录 <em>&#x2F;var&#x2F;www&#x2F;html</em> ：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /var/www/html/jammy
<span class="token function">wget</span> http://mirrors.ustc.edu.cn/ubuntu-releases/jammy/ubuntu-22.04.1-live-server-amd64.iso</code></pre>
</li>
<li><p>挂载该ISO文件：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> <span class="token parameter variable">-o</span> loop /var/www/html/jammy/ubuntu-22.04.1-live-server-amd64.iso /mnt </code></pre>
</li>
<li><p>将内核和 <strong>initrd</strong> 从其中复制到 <strong>dnsmasq</strong> 中设置的 <strong>tftp</strong> 的位置：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /mnt/casper/<span class="token punctuation">&#123;</span>vmlinuz,initrd<span class="token punctuation">&#125;</span> /srv/tftp/</code></pre></li>
</ol>
<h3 id="为-UEFI-引导设置文件"><a href="#为-UEFI-引导设置文件" class="headerlink" title="为 UEFI 引导设置文件"></a>为 <strong>UEFI</strong> 引导设置文件</h3><ol>
<li><p>将签名的 shim 二进制文件复制到位：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> download shim-signed
dpkg-deb --fsys-tarfile shim-signed*deb <span class="token operator">|</span> <span class="token function">tar</span> x ./usr/lib/shim/shimx64.efi.signed <span class="token parameter variable">-O</span> <span class="token operator">></span> /srv/tftp/bootx64.efi</code></pre>
</li>
<li><p>将签名的 grub 二进制文件复制到位：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> download grub-efi-amd64-signed
dpkg-deb --fsys-tarfile grub-efi-amd64-signed*deb <span class="token operator">|</span> <span class="token function">tar</span> x ./usr/lib/grub/x86_64-efi-signed/grubnetx64.efi.signed <span class="token parameter variable">-O</span> <span class="token operator">></span> /srv/tftp/grubx64.efi</code></pre>
</li>
<li><p>Grub 还需要在 tftp 上可用的字体：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> download grub-common
dpkg-deb --fsys-tarfile grub-common*deb <span class="token operator">|</span> <span class="token function">tar</span> x ./usr/share/grub/unicode.pf2 <span class="token parameter variable">-O</span> <span class="token operator">></span> /srv/tftp/unicode.pf2</code></pre>
</li>
<li><p>生成文件 <em><code>/srv/tftp/grub/grub.cfg</code></em> ，内容为：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"0"</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token keyword">if</span> loadfont unicode <span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">set</span> <span class="token assign-left variable">gfxmode</span><span class="token operator">=</span>auto
  <span class="token builtin class-name">set</span> <span class="token assign-left variable">locale_dir</span><span class="token operator">=</span><span class="token variable">$prefix</span>/locale
  <span class="token builtin class-name">set</span> <span class="token assign-left variable">lang</span><span class="token operator">=</span>en_US
<span class="token keyword">fi</span>
terminal_output gfxterm

<span class="token builtin class-name">set</span> <span class="token assign-left variable">menu_color_normal</span><span class="token operator">=</span>white/black
<span class="token builtin class-name">set</span> <span class="token assign-left variable">menu_color_highlight</span><span class="token operator">=</span>black/light-gray
<span class="token keyword">if</span> background_color <span class="token number">44,0</span>,30<span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">clear</span>
<span class="token keyword">fi</span>

<span class="token keyword">function</span> <span class="token function-name function">gfxmode</span> <span class="token punctuation">&#123;</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">gfxpayload</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;1&#125;</span>"</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$&#123;1&#125;</span>"</span> <span class="token operator">=</span> <span class="token string">"keep"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">set</span> <span class="token assign-left variable">vt_handoff</span><span class="token operator">=</span>vt.handoff<span class="token operator">=</span><span class="token number">7</span>
        <span class="token keyword">else</span>
                <span class="token builtin class-name">set</span> <span class="token assign-left variable">vt_handoff</span><span class="token operator">=</span>
        <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>

<span class="token builtin class-name">set</span> <span class="token assign-left variable">linux_gfx_mode</span><span class="token operator">=</span>keep

<span class="token builtin class-name">export</span> linux_gfx_mode

menuentry <span class="token string">'Ubuntu 22.04.1'</span> <span class="token punctuation">&#123;</span>
        gfxmode <span class="token variable">$linux_gfx_mode</span>
        linux /vmlinuz <span class="token variable">$vt_handoff</span> <span class="token assign-left variable">ip</span><span class="token operator">=</span>dhcp <span class="token assign-left variable">url</span><span class="token operator">=</span>http://192.168.22.254/jammy/ubuntu-22.04.1-live-server-amd64.iso autoinstall <span class="token assign-left variable">ds</span><span class="token operator">=</span>nocloud-net<span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>http://192.168.22.254/jammy/ ---
        <span class="token comment">#注意上面最后面有三个-</span>
        initrd /initrd
<span class="token punctuation">&#125;</span></code></pre>

<p>备注：</p>
<ul>
<li>linux &#x2F;vmlinuz 行的 <em><code>ds=nocloud-net;s=http</code></em> 部分的“;”前面有个转义符“”，最后有三个“-”</li>
<li>上述配置非常简单。PXELINUX有很多选项，可以在 <a target="_blank" rel="noopener" href="https://wiki.syslinux.org/wiki/index.php?title=PXELINUX">https://wiki.syslinux.org/wiki/index.php?title=PXELINUX</a> 查阅其文档以获取更多信息。</li>
</ul>
</li>
</ol>
<h1 id="自动化服务器安装"><a href="#自动化服务器安装" class="headerlink" title="自动化服务器安装"></a>自动化服务器安装</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>从 <strong>20.04</strong> 版起，服务器安装程序支持一种新的操作模式：自动安装（简称 <strong>autoinstall</strong> ），此功能也被称为无人值守、甩手或预置安装。</p>
<p>自动安装使得用户可以通过提前配置自动安装配置文件回答所有这些安装配置问题，并让安装过程无需任何交互即可自行运行，适合批量安装多台主机。</p>
<h2 id="与-debian-installer-预置安装的区别"><a href="#与-debian-installer-预置安装的区别" class="headerlink" title="与 debian-installer 预置安装的区别"></a>与 <strong>debian-installer</strong> 预置安装的区别</h2><p><strong>preseeds</strong> 是基于 <strong>debian-installer</strong> （又名 <strong>d-i</strong> ）自动化安装程序的方法。</p>
<p>Ubuntu新 <strong>autoinstall</strong> 方式的自动安装主要在以下方面不同于 <strong>preseeds</strong> ：</p>
<ul>
<li><p>格式完全不同（ <strong>cloud-init config</strong> 格式，通常是 <strong>yaml</strong> 格式，vs <strong>debconf-set-selections</strong> 格式）</p>
</li>
<li><p>当一个问题的答案不存在于 <strong>preseeds</strong> 中时， <strong>d-i</strong> 停止执行并要求用户输入。 <strong>autoinstalls</strong> 自动安装不是这样的：默认情况下，如果有任何自动安装配置，安装程序会为任何未回答的问题采用默认设置（如没有默认设置则失败）。</p>
<p>用户可以将配置中的特定部分指定为“交互式”，这意味着安装程序仍会停止并询问这些部分。</p>
</li>
</ul>
<h2 id="提供自动安装配置"><a href="#提供自动安装配置" class="headerlink" title="提供自动安装配置"></a>提供自动安装配置</h2><p>自动安装配置是通过 <strong>cloud-init</strong> 配置提供的，几乎无限灵活。在大多数情况下，最简单的方法是通过 <strong>nocloud</strong> 数据源提供用户数据。</p>
<p>自动安装配置应在配置中的关键字 <strong>autoinstall</strong> 下提供，如：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#cloud-config</span>
autoinstall:
  version: <span class="token number">1</span>
  <span class="token punctuation">..</span>.</code></pre>

<h2 id="运行真正的自动安装"><a href="#运行真正的自动安装" class="headerlink" title="运行真正的自动安装"></a>运行真正的自动安装</h2><p>即使找到完全非交互式的自动安装配置，服务器安装程序也会在写入磁盘之前要求确认，除非内核命令行上存在自动安装关键字 <strong>autoinstall</strong> 。这是为了避免意外创建一个U盘，结果该U盘会在主机启动时重新格式化它插入的机器。许多自动安装将通过 <strong>netboot</strong> 完成，其中内核命令行由 <strong>netboot</strong> 配置控制 —— 只需记住将自动安装放在那里！</p>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>如只是想试试看，可以参看页面 <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/autoinstall-quickstart">https://ubuntu.com/server/docs/install/autoinstall-quickstart</a> 。</p>
<h2 id="创建自动安装配置"><a href="#创建自动安装配置" class="headerlink" title="创建自动安装配置"></a>创建自动安装配置</h2><p>当服务器安装好Ubuntu操作系统时，会在安装好后的服务器上创建一个可用于重复安装的自动安装文件 <em><code>/var/log/installer/autoinstall-user-data</code></em> ，这可用于做后续需要的文件 <em>user-data</em> 的模板。</p>
<h2 id="转换现有-preseed-文件"><a href="#转换现有-preseed-文件" class="headerlink" title="转换现有 preseed 文件"></a>转换现有 <strong>preseed</strong> 文件</h2><p>如已经有了Debian系统的 <strong>preseed</strong> 文件，可利用自动安装生成器 <a target="_blank" rel="noopener" href="https://snapcraft.io/autoinstall-generator?_ga=2.223897308.698614161.1664162991-1711338095.1646124381">autoinstall-generator</a> <strong>snap</strong> 包（snap 是一种包管理器，可用于安装远程snap包）可以帮助将该预置数据转换为自动安装文件。</p>
<p>安装 <strong>autoinstall-generator</strong> 包，执行：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">snap <span class="token function">install</span> autoinstall-generator</code></pre>

<p>将 <strong>preseed</strong> 文件转换为自动安装格式的基本用法为：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">autoinstall-generator my-preseed.txt my-cloud-config.yaml <span class="token parameter variable">--cloud</span></code></pre>

<p>有关详细信息，请 <a target="_blank" rel="noopener" href="https://discourse.ubuntu.com/t/autoinstall-generator-tool-to-help-with-creation-of-autoinstall-files-based-on-preseed/21334?_ga=2.35077545.964202620.1664022245-197937644.1660466546">参阅</a> 。</p>
<h2 id="自动安装配置文件的结构"><a href="#自动安装配置文件的结构" class="headerlink" title="自动安装配置文件的结构"></a>自动安装配置文件的结构</h2><p>自动安装配置的完整说明参见：<a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/autoinstall-reference">https://ubuntu.com/server/docs/install/autoinstall-reference</a> 。</p>
<p>从技术上讲，虽然配置未定义为文本格式，但 <strong>cloud-init</strong> 配置通常以 <strong>YAML</strong> 形式提供，这是本文档使用的语法。</p>
<p>一个最小的配置是：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">identity</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> hostname
    <span class="token key atrule">username</span><span class="token punctuation">:</span> username
    <span class="token key atrule">password</span><span class="token punctuation">:</span> $crypted_pass</code></pre>

<p>含有更多特性的配置为：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">reporting</span><span class="token punctuation">:</span>
    <span class="token key atrule">hook</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> webhook
        <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.com/endpoint/path
<span class="token key atrule">early-commands</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ping <span class="token punctuation">-</span>c1 198.162.1.1
<span class="token key atrule">locale</span><span class="token punctuation">:</span> en_US
<span class="token key atrule">keyboard</span><span class="token punctuation">:</span>
    <span class="token key atrule">layout</span><span class="token punctuation">:</span> gb
    <span class="token key atrule">variant</span><span class="token punctuation">:</span> dvorak
<span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">network</span><span class="token punctuation">:</span>
        <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
            <span class="token key atrule">enp0s25</span><span class="token punctuation">:</span>
               <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> yes
            <span class="token key atrule">enp3s0</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">enp4s0</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">bonds</span><span class="token punctuation">:</span>
            <span class="token key atrule">bond0</span><span class="token punctuation">:</span>
                <span class="token key atrule">dhcp4</span><span class="token punctuation">:</span> yes
                <span class="token key atrule">interfaces</span><span class="token punctuation">:</span>
                    <span class="token punctuation">-</span> enp3s0
                    <span class="token punctuation">-</span> enp4s0
                <span class="token key atrule">parameters</span><span class="token punctuation">:</span>
                    <span class="token key atrule">mode</span><span class="token punctuation">:</span> active<span class="token punctuation">-</span>backup
                    <span class="token key atrule">primary</span><span class="token punctuation">:</span> enp3s0
<span class="token key atrule">proxy</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//squid.internal<span class="token punctuation">:</span>3128/
<span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">primary</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>default<span class="token punctuation">]</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//repo.internal/
    <span class="token key atrule">sources</span><span class="token punctuation">:</span>
        <span class="token key atrule">my-ppa.list</span><span class="token punctuation">:</span>
            <span class="token key atrule">source</span><span class="token punctuation">:</span> <span class="token string">"deb http://ppa.launchpad.net/curtin-dev/test-archive/ubuntu $RELEASE main"</span>
            <span class="token key atrule">keyid</span><span class="token punctuation">:</span> B59D 5F15 97A5 04B7 E230  6DCA 0620 BBCF 0368 3F77
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">layout</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> lvm
<span class="token key atrule">identity</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> hostname
    <span class="token key atrule">username</span><span class="token punctuation">:</span> username
    <span class="token key atrule">password</span><span class="token punctuation">:</span> $crypted_pass
<span class="token key atrule">ssh</span><span class="token punctuation">:</span>
    <span class="token key atrule">install-server</span><span class="token punctuation">:</span> yes
    <span class="token key atrule">authorized-keys</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $key
    <span class="token key atrule">allow-pw</span><span class="token punctuation">:</span> no
<span class="token key atrule">snaps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> go
      <span class="token key atrule">channel</span><span class="token punctuation">:</span> 1.14/stable
      <span class="token key atrule">classic</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">debconf-selections</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    bind9      bind9/run-resolvconf    boolean false</span>
<span class="token key atrule">packages</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> libreoffice
    <span class="token punctuation">-</span> dns<span class="token punctuation">-</span>server^
<span class="token key atrule">user-data</span><span class="token punctuation">:</span>
    <span class="token key atrule">disable_root</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">late-commands</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> sed <span class="token punctuation">-</span>ie 's/GRUB_TIMEOUT=.<span class="token important">*/GRUB_TIMEOUT=30/'</span> /target/etc/default/grub
<span class="token key atrule">error-commands</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> tar c /var/log/installer <span class="token punctuation">|</span> nc 192.168.0.1 1000</code></pre>

<p>许多关键字和值一般直接对应于安装程序提出的问题（例如键盘选择），请参阅相关资料。</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>安装过程中的进度及出错信息，可以通过报告 <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/autoinstall-reference#reporting">reporting</a> 关键字设定的系统获取。此外，当发生致命错误时，将执行错误命令 <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/autoinstall-reference#error-commands">error-commands</a> 并将回溯打印到控制台，然后服务器等待人为交互式干预。</p>
<h2 id="未来可能的方向"><a href="#未来可能的方向" class="headerlink" title="未来可能的方向"></a>未来可能的方向</h2><p>可能希望扩展磁盘的 <strong>match specs</strong> （匹配规范）以涵盖选择磁盘的其他方式。</p>
<h1 id="自动安装快速入门"><a href="#自动安装快速入门" class="headerlink" title="自动安装快速入门"></a>自动安装快速入门</h1><p><strong>cloud-init</strong> 使用以下三种数据并对其进行操作。</p>
<ul>
<li>用户数据 <strong>user-data</strong> ：包含执行无人值守自动安装所需的指令，如要安装的软件包、分区布局、网络配置等。</li>
<li>元数据 <strong>meta-data</strong> ：包括与特定数据源关联的数据，如可以包括服务器名称和实例ID等。</li>
<li>供应商数据 <strong>vendor-data</strong> ：由组织（如，云提供商）提供的，包括可以自定义镜像以更好地适应镜像运行环境的信息，该种数据为可选。</li>
</ul>
<ol>
<li><p>设置用户数据文件 <em><code>/var/www/html/jammy/user-data</code></em> （可以采用文件 <em><code>/var/log/installer/autoinstall-user-data</code></em> 为模板修改），其内容为：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#cloud-config</span>
<span class="token key atrule">autoinstall</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">late-commands</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mkdir /target/root/.ssh <span class="token important">&amp;&amp;</span> echo "ssh<span class="token punctuation">-</span>rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDZUS2FXGm2yK09Tv0biWIwLszp0TPGzB2u1PD/QXCGPimLOmEP2xAFJbgwzeXlgfnj01LP7BD65lidSPd68WwaUsNHdlikfwf9iRdlSXxNg+PVueY2KPHRzgQ5omtAzJFUUnHKIOSH/Ozo9tmwrs4tZc4CNpx44InvgQY3yeKfhqvVn2O+WazirNlGsFRcpMcjLJjZ+U2OfMGM4l0soSDJKJTKoaHmV0XpIOA2iqfQmOgFDZExqmjc8Vj/1hTBvTzyhgMPlzkDz28UsuBT3U+RZiZJokPtXks5mnVkVYzQvOkln3r0+bmOX0Q4qDg2HhinSpGXAZGln1PKH3AFU7StMIg6e1Lb8AMNHNxWBR61uXIwJJw3dcP6Sy3N4Gq3WW+hkVsHJgZRD+dPQNRwMHIY1CIfBtB9TySKpwNwSAeXiBPFoYgAi0RlbrdHLpjDl9LxK/vyZ1gvGSumtU9IM01EZWfXfCKoMX68ljIaVsHHhHbqIXSS7AjaEsJO+ss8nQU= root@ubuntu22<span class="token punctuation">-</span>server.hanhai22.ustc.edu.cn" <span class="token punctuation">></span>/target/root/.ssh/authorized_keys
  <span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">disable_components</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token key atrule">geoip</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">preserve_sources_list</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">primary</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> amd64
      <span class="token punctuation">-</span> i386
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//mirrors.ustc.edu.cn/ubuntu
    <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> default
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//ports.ubuntu.com/ubuntu<span class="token punctuation">-</span>ports
  <span class="token key atrule">drivers</span><span class="token punctuation">:</span>
    <span class="token key atrule">install</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">identity</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> Client1.hanhai.scc.ustc.edu.cn
    <span class="token key atrule">password</span><span class="token punctuation">:</span> $6$dIUrqz$MJN/0cc47EFl8OJBsbxm/o37ScqlZtXb8r63rGa0JLnbwpYQSLrCq7qgEcOAJc6RlkNbIicK6VlPPK402FD7wMQv.sHqNIl1
    <span class="token key atrule">realname</span><span class="token punctuation">:</span> hmli
    <span class="token key atrule">username</span><span class="token punctuation">:</span> hmli
  <span class="token key atrule">kernel</span><span class="token punctuation">:</span>
    <span class="token key atrule">package</span><span class="token punctuation">:</span> linux<span class="token punctuation">-</span>generic
  <span class="token key atrule">keyboard</span><span class="token punctuation">:</span>
    <span class="token key atrule">layout</span><span class="token punctuation">:</span> us
    <span class="token key atrule">toggle</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">variant</span><span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token key atrule">locale</span><span class="token punctuation">:</span> en_US.UTF<span class="token punctuation">-</span><span class="token number">8</span>
  <span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
      <span class="token key atrule">enp1s0</span><span class="token punctuation">:</span>
        <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 192.168.22.1/24
        <span class="token key atrule">gateway4</span><span class="token punctuation">:</span> 192.168.22.254
        <span class="token key atrule">nameservers</span><span class="token punctuation">:</span>
          <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> 202.38.64.7
          <span class="token key atrule">search</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> ustc.edu.cn
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">ssh</span><span class="token punctuation">:</span>
    <span class="token key atrule">allow-pw</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">authorized-keys</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token key atrule">install-server</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">ptable</span><span class="token punctuation">:</span> gpt
<span class="token comment">#      serial: c9d3b07e01624ab69df6</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /dev/vda
      <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">''</span>
      <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> disk
      <span class="token key atrule">id</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>vda
    <span class="token punctuation">-</span> <span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>vda
      <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">999292928</span>
      <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock
      <span class="token key atrule">flag</span><span class="token punctuation">:</span> boot
      <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
      <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">fstype</span><span class="token punctuation">:</span> fat32
      <span class="token key atrule">volume</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">0</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> format
      <span class="token key atrule">id</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>vda
      <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">1902116864</span>
      <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock
      <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token string">''</span>
      <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
      <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">fstype</span><span class="token punctuation">:</span> ext4
      <span class="token key atrule">volume</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">1</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> format
      <span class="token key atrule">id</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">device</span><span class="token punctuation">:</span> disk<span class="token punctuation">-</span>vda
      <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">18571329536</span>
      <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock
      <span class="token key atrule">flag</span><span class="token punctuation">:</span> <span class="token string">''</span>
      <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">grub_device</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
      <span class="token key atrule">id</span><span class="token punctuation">:</span> partition<span class="token punctuation">-</span><span class="token number">2</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>vg
      <span class="token key atrule">devices</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> partition<span class="token punctuation">-</span><span class="token number">2</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> lvm_volgroup
      <span class="token key atrule">id</span><span class="token punctuation">:</span> lvm_volgroup<span class="token punctuation">-</span><span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>lv
      <span class="token key atrule">volgroup</span><span class="token punctuation">:</span> lvm_volgroup<span class="token punctuation">-</span><span class="token number">0</span>
      <span class="token key atrule">size</span><span class="token punctuation">:</span> 10737418240B
      <span class="token key atrule">wipe</span><span class="token punctuation">:</span> superblock
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> lvm_partition
      <span class="token key atrule">id</span><span class="token punctuation">:</span> lvm_partition<span class="token punctuation">-</span><span class="token number">0</span>
    <span class="token punctuation">-</span> <span class="token key atrule">fstype</span><span class="token punctuation">:</span> ext4
      <span class="token key atrule">volume</span><span class="token punctuation">:</span> lvm_partition<span class="token punctuation">-</span><span class="token number">0</span>
      <span class="token key atrule">preserve</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> format
      <span class="token key atrule">id</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">2</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
      <span class="token key atrule">device</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">2</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> mount
      <span class="token key atrule">id</span><span class="token punctuation">:</span> mount<span class="token punctuation">-</span><span class="token number">2</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /boot
      <span class="token key atrule">device</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">1</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> mount
      <span class="token key atrule">id</span><span class="token punctuation">:</span> mount<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /boot/efi
      <span class="token key atrule">device</span><span class="token punctuation">:</span> format<span class="token punctuation">-</span><span class="token number">0</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> mount
      <span class="token key atrule">id</span><span class="token punctuation">:</span> mount<span class="token punctuation">-</span><span class="token number">0</span>
  <span class="token key atrule">updates</span><span class="token punctuation">:</span> security</code></pre>

<p>备注：late-commands 等中的字符串在传递给执行安装的主机时，有些特殊字符串需要特殊处理。</p>
</li>
<li><p>生成所需要的文件 <em>meta-data</em> （空文件即可），执行命令：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> /var/www/html/jammy/meta-data</code></pre>
</li>
<li><p>供应商数据文件 <em>vendor-data</em> 非必需，可不管。</p>
</li>
<li><p>确保目录 <em>&#x2F;var&#x2F;www&#x2F;html&#x2F;jammy&#x2F;</em> 下的文件对所有人可读：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+r /var/www/html/jammy/</code></pre></li>
</ol>
<p>上述各项含义参见： <a target="_blank" rel="noopener" href="https://hmli.ustc.edu.cn/doc/linux/ubuntu-autoinstall/ubuntu-autoinstall.html#reference">自动服务器安装配置文件参考</a> 。</p>
<p>备注：做好上述工作后，同一子网内的客户机启动采用PXE引导时，即可自动安装配置所需要的系统。</p>
<h1 id="自动服务器安装配置文件参考"><a href="#自动服务器安装配置文件参考" class="headerlink" title="自动服务器安装配置文件参考"></a>自动服务器安装配置文件参考</h1><h2 id="整体格式-Overall-format"><a href="#整体格式-Overall-format" class="headerlink" title="整体格式(Overall format)"></a>整体格式(Overall format)</h2><p>自动安装 <strong>autoinstall</strong> 文件是 <strong>YAML</strong> 格式的。在顶层，它必须是包含本文档中描述的关键字 <strong>key</strong> 的映射。无法识别的关键字将被忽略。</p>
<h2 id="概要-Schema"><a href="#概要-Schema" class="headerlink" title="概要(Schema)"></a>概要(Schema)</h2><p>自动安装配置在使用前会根据 <strong>JSON</strong> 模式进行转换并进行验证。</p>
<h2 id="命令列表-Command-lists"><a href="#命令列表-Command-lists" class="headerlink" title="命令列表(Command lists)"></a>命令列表(Command lists)</h2><p>几个配置关键字是要执行的命令列表。每个命令可以是字符串（在这种情况下通过 <code>sh -c</code> 执行）或列表，在这种情况下直接执行。任何以非零返回码退出的命令都被视为错误并中止安装（错误命令除外，它被忽略）。</p>
<h2 id="顶级关键字-Top-level-keys"><a href="#顶级关键字-Top-level-keys" class="headerlink" title="顶级关键字(Top-level keys)"></a>顶级关键字(Top-level keys)</h2><ul>
<li><p>version</p>
<ul>
<li><p>名称：版本</p>
</li>
<li><p>类型：整型</p>
</li>
<li><p>默认值：无</p>
<p>为将来不同版本准备的版本信息，目前只能为 <strong>1</strong> 。</p>
</li>
</ul>
</li>
<li><p>interactive-sections</p>
<ul>
<li><p>名称：交互式部分</p>
</li>
<li><p>类型：字符串列表</p>
</li>
<li><p>默认值：[]</p>
<p>仍然显示在用户界面 <strong>UI</strong> 中的配置键列表，如：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">interactive-sections</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> network
<span class="token key atrule">identity</span><span class="token punctuation">:</span>
 <span class="token key atrule">username</span><span class="token punctuation">:</span> ubuntu
 <span class="token key atrule">password</span><span class="token punctuation">:</span> $crypted_pass</code></pre>

<p>交互式操作，将在网络屏幕上停止并允许用户更改默认值。如果为交互式部分提供了值，则将其用作默认值。</p>
<p>可以使用特殊的块名称 “*” 来指示安装程序应该询问所有常见问题——在这种情况下，文件 <code>autoinstall.yaml </code>根本不是真正的“自动安装”文件，而只是一种用于更改用户界面中的默认值的文件。</p>
<p>并非所有配置关键字都对应于用户界面中的屏幕。该文档指示给定块是否可以交互。</p>
<p>如果有任何交互块，则忽略报告关键字 <strong>reporting</strong> 。</p>
</li>
</ul>
</li>
<li><p>early-commands</p>
<ul>
<li><p>名称：早期命令</p>
</li>
<li><p>默认值：无</p>
</li>
<li><p>是否可交互：不可</p>
<p>安装程序启动后立即调用的shell命令列表，特别是在执行探测块和网络设备操作之前执行。自动安装配置在 <em>&#x2F;autoinstall.yaml</em> 中可用（不管它是如何被提供），并且在早期命令 <strong>early-commands</strong> 运行后将重新读取该文件，以允许它们在必要时更改配置。</p>
</li>
</ul>
</li>
<li><p>locale</p>
<p>名称：语言环境</p>
<p>类型：字符串</p>
<p>默认值：en_US.UTF-8</p>
<p>是否可交互：可，对于任何块中是的话，总是可以交互</p>
<p>为已安装系统配置的语言环境。</p>
</li>
<li><p>refresh-installer</p>
<ul>
<li>名称：更新安装</li>
<li>类型：映射</li>
<li>默认值：参见下面</li>
<li>是否可交互：可</li>
</ul>
<p>控制安装程序在继续之前是否更新到给定频道 channel 中可用的新版本。</p>
<p>映射包含关键字：</p>
<ul>
<li><p>update</p>
<ul>
<li>名称：更新</li>
<li>类型：布尔型</li>
<li>默认值：无</li>
</ul>
<p>控制是否执行系统更新。</p>
</li>
<li><p>channel</p>
<ul>
<li>名称：频道、通道</li>
<li>类型：字符串</li>
<li>默认值：stable&#x2F;ubuntu-$REL</li>
</ul>
<p>用于检查系统更新的频道。</p>
</li>
</ul>
</li>
<li><p>keyboard</p>
<ul>
<li>名称：键盘</li>
<li>类型：映射，参见下面</li>
<li>默认值：US English keyboard</li>
<li>是否可交互：可</li>
</ul>
<p>任何附属键盘的布局。通常自动安装的系统根本没有键盘，在这种情况下，此处使用的值无关紧要。</p>
<p>映射的关键字对应于 <em>&#x2F;etc&#x2F;default&#x2F;keyboard</em> 配置文件中的设置。有关更多详细信息，请参阅其手册页。</p>
<p>映射包含关键字：</p>
<ul>
<li><p>layout</p>
<ul>
<li>名称：布局</li>
<li>类型：字符串</li>
<li>默认值：us</li>
</ul>
<p>对应于键盘 <strong>XKBLAYOUT</strong> 设置。</p>
</li>
<li><p>variant</p>
<ul>
<li><p>名称：变种</p>
</li>
<li><p>类型：字符串</p>
</li>
<li><p>默认值：””</p>
</li>
</ul>
<p>对应于键盘 <strong>XKBVARIANT</strong> 设置。</p>
</li>
<li><p>toggle</p>
<ul>
<li>名称：切换</li>
<li>类型：字符串或null</li>
<li>默认值：null</li>
</ul>
<p>对应于 <strong>grp</strong> 值: 来自键盘 <strong>XKBOPTIONS</strong> 设置的选项的值。可接受的值是（但请注意，安装程序不会验证这些）：caps_toggle、toggle、rctrl_toggle、rshift_toggle、rwin_toggle、menu_toggle、alt_shift_toggle、ctrl_shift_toggle、ctrl_alt_toggle、alt_caps_toggle、lctrl_lshift_toggle、lalt_toggle、lctrl_toggle、lwinshift_toggle</p>
</li>
</ul>
<p>与20.04 GA一起发布的 <strong>subiquity</strong> 版本由于一个bug不接受该字段为null。</p>
</li>
<li><p>network</p>
<ul>
<li>名称：网络</li>
<li>类型：netplan-format映射，参看下面</li>
<li>默认值：用于DHCP协议的名字为eth<em>en</em>的网卡</li>
<li>是否可交互：可</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://netplan.io/reference?_ga=2.114730432.698614161.1664162991-1711338095.1646124381">netplan</a> 格式的网络配置。将在安装期间以及已安装的系统中应用。默认是解释安装媒介的配置，它在名称匹配 <strong>“eth*”</strong> 或 <strong>“en*”</strong> 的任何网卡上运行 <strong>DHCPv4</strong> 请求，并随后禁用任何未获取到IP地址的网卡。</p>
<p>例如，要在特定网卡 <strong>enp0s31f6</strong> 上运行 <strong>dhcp6</strong> 请求：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">network</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
    <span class="token key atrule">enp0s31f6</span><span class="token punctuation">:</span>
      <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> yes</code></pre>

<p>请注意，由于一个错误，随 <strong>20.04 GA</strong> 发布的 <strong>subiquity</strong> 版本强制您使用额外的 <strong>“network:”</strong> 关键字编写此代码，如下所示：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">network</span><span class="token punctuation">:</span>
<span class="token comment">#多了上一层network:</span>
  <span class="token key atrule">network</span><span class="token punctuation">:</span>
    <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
      <span class="token key atrule">enp0s31f6</span><span class="token punctuation">:</span>
        <span class="token key atrule">dhcp6</span><span class="token punctuation">:</span> yes</code></pre>

<p>更高版本也支持此语法（以实现兼容性），但如果可以确定采用修复后的新版本，则应使用前者（无需使用额外的 <strong>“network:”</strong> 关键字）。</p>
</li>
<li><p>proxy</p>
<ul>
<li>名称：代理</li>
<li>类型：URL或null</li>
<li>默认值：null</li>
<li>是否可交互：可</li>
</ul>
<p>在安装期间以及在目标系统中为 <strong>apt</strong> 和 <strong>snapd</strong> 配置的代理，以便访问网络。</p>
</li>
<li><p>apt</p>
<ul>
<li>名称：APT高级包管理工具</li>
<li>类型：映射</li>
<li>默认值：参看下面</li>
<li>是否可交互：可</li>
</ul>
<p>APT配置，在安装期间和引导到目标系统后都使用。</p>
<p>这使用与 <a target="_blank" rel="noopener" href="https://curtin.readthedocs.io/en/latest/topics/apt_source.html">https://curtin.readthedocs.io/en/latest/topics/apt_source.html</a> 中描述的 <strong>curtin</strong> (the curt installer) 安装格式相同的格式，但有一个扩展：关键字 <strong>geoip</strong> 控制是否完成地理IP(geoip)查找。</p>
<p>默认值为：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">preserve_sources_list</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">primary</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>i386<span class="token punctuation">,</span> amd64<span class="token punctuation">]</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"http://archive.ubuntu.com/ubuntu"</span>
        <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>default<span class="token punctuation">]</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> <span class="token string">"http://ports.ubuntu.com/ubuntu-ports"</span>
    <span class="token key atrule">geoip</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>

<p>如关键字 <strong>geoip</strong> 为 <strong>true</strong> 并且要使用的镜像源是默认值（ <strong><a target="_blank" rel="noopener" href="http://archive.ubuntu.com/ubuntu">http://archive.ubuntu.com/ubuntu</a></strong> 或 <strong><a target="_blank" rel="noopener" href="http://ports.ubuntu.com/ubuntu-ports">http://ports.ubuntu.com/ubuntu-ports</a></strong> 等），则向 <strong><a target="_blank" rel="noopener" href="https://geoip.ubuntu.com/lookup">https://geoip.ubuntu.com/lookup</a></strong> 发出请求，并且将使用的镜像URI更改为 <strong><a target="_blank" rel="noopener" href="http://cc.archive.ubuntu.com/ubuntu">http://CC.archive.ubuntu.com/ubuntu</a></strong> , 其中 <strong>CC</strong> 是查找返回的国家代码（或类似的端口，对于中国为 <strong>CN</strong> ），这将使用所在国家区域的源，提升网络更新速度。如果此部分不是交互式的，则请求会在10秒后超时。</p>
<p>任何提供的配置都会与默认配置合并，而不是替换它。</p>
<p>如果您只想设置镜像源，请使用如下配置：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">primary</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">arches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>default<span class="token punctuation">]</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> YOUR_MIRROR_GOES_HERE</code></pre>

<p>增加一个 <strong>PPA</strong> 源：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">sources</span><span class="token punctuation">:</span>
        <span class="token key atrule">curtin-ppa</span><span class="token punctuation">:</span>
            <span class="token key atrule">source</span><span class="token punctuation">:</span> ppa<span class="token punctuation">:</span>curtin<span class="token punctuation">-</span>dev/test<span class="token punctuation">-</span>archive</code></pre>
</li>
<li><p>storage</p>
<ul>
<li>名称：存储</li>
<li>类型：映射，参看下面</li>
<li>默认值：对于单块硬盘为 <strong>lvm</strong> ，对于多块硬盘则无默认值</li>
<li>是否可交互：可</li>
</ul>
<p>存储配置是一个复杂的话题，自动安装文件中所需配置的描述也可能很复杂。安装程序支持“布局layouts”，即表达常见配置的简单方法。</p>
<ul>
<li><p>支持的布局</p>
<p>目前支持的布局就两种，分别是逻辑卷模式 <strong>lvm</strong> 和直通模式 <strong>direct</strong> 。</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> lvm
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> direct</code></pre>

<p>默认情况下，这些将安装到系统中容量最大的磁盘，但您可以提供匹配规范（“match: {}”，见下文）来指示要使用的磁盘：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> lvm
    <span class="token key atrule">match</span><span class="token punctuation">:</span>
      <span class="token key atrule">serial</span><span class="token punctuation">:</span> CT*
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> disk
    <span class="token key atrule">match</span><span class="token punctuation">:</span>
      <span class="token key atrule">ssd</span><span class="token punctuation">:</span> yes</code></pre>

<p>（可以用“match: {}”来匹配任意磁盘）</p>
<p>默认采用 <strong>lvm</strong> 。</p>
</li>
<li><p>基于动作的配置</p>
<p>为了获得完全的灵活性，安装程序允许使用一种语法完成存储配置，该语法是 <strong>curtin</strong> 支持的语法的超集，在 <a target="_blank" rel="noopener" href="https://curtin.readthedocs.io/en/latest/topics/storage.html">https://curtin.readthedocs.io/en/latest/topics/storage.html</a> 中进行了描述。</p>
<p>如果使用 <strong>layout</strong> 功能配置磁盘，则不会使用 <strong>config</strong> 部分。</p>
<p>除了将操作列表放在关键字 <strong>config</strong> 下之外， <a target="_blank" rel="noopener" href="https://curtin.readthedocs.io/en/latest/topics/config.html#grub">grub</a> 和 <a target="_blank" rel="noopener" href="https://curtin.readthedocs.io/en/latest/topics/config.html#swap">swap</a> curtin配置项也可以放在此处。因此存储部分可能如下所示：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">swap</span><span class="token punctuation">:</span>
        <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> disk
          <span class="token key atrule">id</span><span class="token punctuation">:</span> disk0
          <span class="token key atrule">serial</span><span class="token punctuation">:</span> ADATA_SX8200PNP_XXXXXXXXXXX
        <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
          <span class="token punctuation">...</span></code></pre>

<p>Curtin语法的扩展围绕磁盘选择和分区&#x2F;逻辑卷大小调整。</p>
</li>
<li><p>磁盘选择扩展</p>
<p>Curtin支持通过串行（如 <em>Crucial_CT512MX100SSD1_14250C57FECE</em> ）或路径（如 <em>&#x2F;dev&#x2F;sdc</em> ）识别磁盘，服务器安装程序也支持这一点。安装程序还支持磁盘操作上的 <strong>match spec</strong> ，支持更灵活的匹配。</p>
<p>存储配置中的操作按照它们在自动安装文件中的顺序进行处理。任何磁盘操作都会被分配一个匹配的磁盘——如果有多个磁盘，则从一组未分配的磁盘中任意选择，如果没有未分配的匹配磁盘，则会导致安装失败。</p>
<p>匹配规范支持以下关键字： - <strong>model: foo</strong> ：匹配 <strong>udev</strong> 中 <strong>ID_VENDOR&#x3D;foo</strong> 的磁盘，支持通配符 - <strong>path: foo</strong> ：匹配 <strong>udev</strong> 中 <strong>DEVPATH&#x3D;foo</strong> 的磁盘，支持通配符（通配符支持将此与直接在磁盘操作中指定 <strong>path: foo</strong> 区分开来） - <strong>serial: foo</strong> ：匹配 <strong>udev</strong> 中 <strong>ID_SERIAL&#x3D;foo</strong> 的磁盘，支持通配符（通配符支持将此与直接在磁盘操作中指定 <strong>serial: foo</strong> 区分开来） - <strong>ssd: yes|no</strong> ：匹配是或不是 <strong>SSD</strong> 的磁盘（相对于机械硬盘） - <strong>size: largest|smallest</strong> ：如果有多个匹配项，则取最大或最小的磁盘而不是任意一个（在 20.06.1 版本中添加了对最小 <strong>smallest</strong> 的支持）</p>
<p>因此，例如，要匹配任意磁盘，只需：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> disk
  <span class="token key atrule">id</span><span class="token punctuation">:</span> disk0</code></pre>

<p>匹配容量最大的SSD硬盘：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> disk
  <span class="token key atrule">id</span><span class="token punctuation">:</span> big<span class="token punctuation">-</span>fast<span class="token punctuation">-</span>disk
  <span class="token key atrule">match</span><span class="token punctuation">:</span>
    <span class="token key atrule">ssd</span><span class="token punctuation">:</span> yes
    <span class="token key atrule">size</span><span class="token punctuation">:</span> largest</code></pre>

<p>匹配希捷Seagate硬盘：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> disk
  <span class="token key atrule">id</span><span class="token punctuation">:</span> data<span class="token punctuation">-</span>disk
  <span class="token key atrule">match</span><span class="token punctuation">:</span>
    <span class="token key atrule">model</span><span class="token punctuation">:</span> Seagate</code></pre>
</li>
<li><p>分区&#x2F;逻辑卷扩展</p>
<p>curtin中的分区或逻辑卷的大小指定为字节数。自动安装配置更加灵活：</p>
<ul>
<li>您可以使用安装程序用户界面中支持的“1G”、“512M”语法指定大小</li>
<li>您可以将大小指定为包含磁盘（或RAID）的百分比，例如“50%”</li>
<li>对于为特定设备指定的最后一个分区，您可以将大小指定为“-1”以指示该分区应填充剩余空间。</li>
</ul>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
  <span class="token key atrule">id</span><span class="token punctuation">:</span> boot<span class="token punctuation">-</span>partition
  <span class="token key atrule">device</span><span class="token punctuation">:</span> root<span class="token punctuation">-</span>disk
  <span class="token key atrule">size</span><span class="token punctuation">:</span> 10%
<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
  <span class="token key atrule">id</span><span class="token punctuation">:</span> root<span class="token punctuation">-</span>partition
  <span class="token key atrule">size</span><span class="token punctuation">:</span> 20G
<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> partition
  <span class="token key atrule">id</span><span class="token punctuation">:</span> data<span class="token punctuation">-</span>partition
  <span class="token key atrule">device</span><span class="token punctuation">:</span> root<span class="token punctuation">-</span>disk
  <span class="token key atrule">size</span><span class="token punctuation">:</span> <span class="token number">-1</span></code></pre></li>
</ul>
</li>
<li><p>identity</p>
<ul>
<li>名称：身份</li>
<li>类型：映射，参看下面</li>
<li>默认值：无</li>
<li>是否可交互：可</li>
</ul>
<p>配置系统的初始用户。这是唯一必须存在的配置关键字（除非存在用户数据部分，在这种情况下它是可选的）。</p>
<p>可以包含关键字的映射，所有关键字都采用字符串值：</p>
<ul>
<li>realname：实际名</li>
<li>username：用户名</li>
<li>hostname： 主机名</li>
<li>password：密码，加密的。这是与 sudo 一起使用时所必需的，即使配置了 SSH 访问。</li>
</ul>
</li>
<li><p>ssh</p>
<ul>
<li>名称： <strong>SSH</strong> 服务</li>
<li>类型：映射，参看下面</li>
<li>默认值：参看下面</li>
<li>是否可交互：可</li>
</ul>
<p>为已安装的系统配置 <strong>SSH</strong> 服务。可以包含关键字的映射：</p>
<ul>
<li><p>install-server</p>
<ul>
<li>名称：安装 <strong>SSH</strong> 服务</li>
<li>类型：布尔型</li>
<li>默认值：false，不安装</li>
</ul>
<p>是否安装 <strong>OpenSSH</strong> 服务。</p>
</li>
<li><p>authorized-keys</p>
<ul>
<li>名称： <strong>SSH</strong> 认证公钥</li>
<li>类型：字符串列表</li>
<li>默认值：[]</li>
</ul>
<p>要安装在初始用户帐户中的 SSH 公钥列表，方便其他主机采用密钥通过 <strong>SSH</strong> 访问该主机。</p>
</li>
<li><p>allow-pw</p>
<ul>
<li>名称：是否允许密码</li>
<li>类型：布尔型</li>
<li>默认值：当 <strong>authorized_keys</strong> 为空时为真 <strong>true</strong> ，否则为否 <strong>false</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>snaps</p>
<ul>
<li>名称：snap包</li>
<li>类型：列表</li>
<li>默认值：不安装其他snap</li>
<li>是否可交互：可</li>
</ul>
<p>要安装的snap包列表。每个snap都表示为具有必需的关键字 <strong>name</strong> 和可选的关键字 <strong>chanel</strong> （默认为 <strong>stable</strong> ）和 <strong>classic</strong> （经典默认为 <strong>false</strong> ）的映射。如：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">snaps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> etcd
      <span class="token key atrule">channel</span><span class="token punctuation">:</span> edge
      <span class="token key atrule">classic</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></code></pre>
</li>
<li><p>debconf-selections</p>
<ul>
<li>名称：采用 <strong>debconf</strong> 设置包选择</li>
<li>类型：字符串</li>
<li>默认值：无</li>
<li>是否可交互：否</li>
</ul>
<p>安装程序将使用 <strong>debconf</strong> 设置选择值更新目标。用户需要熟悉软件包 <strong>debconf</strong> 选项。</p>
</li>
<li><p>packages</p>
<ul>
<li>名称：软件包</li>
<li>类型：列表</li>
<li>默认值：无软件包</li>
<li>是否可交互：否</li>
</ul>
<p>要安装到目标系统中的软件包列表。更准确地说，是传递给命令 <code>apt-get install</code> 的字符串列表，因此这包括任务选择（ <strong>dns-server^</strong> ）和安装特定版本的包（ <strong>my-package&#x3D;1-1</strong> ）。</p>
</li>
<li><p>late-commands</p>
<ul>
<li>名称：后期命令</li>
<li>类型：命令列表</li>
<li>默认值：无命令</li>
<li>是否可交互：否</li>
</ul>
<p>在安装成功完成并安装任何更新和软件包之后运行的 Shell 命令，就在系统重新启动之前。它们在安装程序环境中运行，已安装的系统安装在目录 <em>&#x2F;target</em> 。您可以运行 <code>curtin in-target -- $shell_command</code> （使用20.04 GA发布的subiquity安装程序版本，采用 <strong>curtin</strong> 格式，您需要将其指定为 <code>curtin in-target --target=/target -- $shell_command</code> ）以在目标系统中运行（类似了解如何在 <strong>d-i preseed&#x2F;late_command</strong> 中使用简单的目标内）。</p>
</li>
<li><p>error-commands</p>
<ul>
<li>名称：出错处理命令</li>
<li>类型：命令列表</li>
<li>默认值：无命令</li>
<li>是否可交互：否</li>
</ul>
<p>安装失败后运行的Shell命令。它们在安装程序环境中运行，并且目标系统（或安装程序设法配置的尽可能多的系统）将安装在目录 <em>&#x2F;target</em> 。日志将在实时会话中的目录 <em>&#x2F;var&#x2F;log&#x2F;installer</em> 中可用。</p>
</li>
<li><p>reporting</p>
<ul>
<li>名称：报告</li>
<li>类型：映射</li>
<li>默认值： <strong>type: print</strong> ，导致tty1和任何已配置的串行控制台上的输出</li>
<li>是否可交互：否</li>
</ul>
<p>安装程序支持向各种目的地报告进度。请注意，如果有任何交互部分，则忽略此部分；它仅适用于全自动安装。</p>
<p>配置，实际上实现，与<a target="_blank" rel="noopener" href="https://curtin.readthedocs.io/en/latest/topics/reporting.html">curtin使用</a>的90%相同。</p>
<p>配置中报告映射中的每个键都定义了一个目标，其中子关键字 <strong>type</strong> 是以下之一：</p>
<p>（原文在该处有 <strong>The rsyslog reporter does not yet exist</strong> ，没理解为什么在这个位置说这个，也不清楚什么含义）</p>
<ul>
<li><strong>print</strong> ：在tty1和任何配置的串行控制台上打印进度信息。没有其他配置。</li>
<li><strong>rsyslog</strong> ：通过rsyslog报告进度。目标键指定将输出发送到何处。</li>
<li><strong>webhook</strong> ：通过将JSON报告发布到 URL 来报告进度。接受与curtin相同的配置。</li>
<li><strong>none</strong> ：不报告进度。仅对禁止默认输出有用。</li>
</ul>
<p>例子：</p>
<p>默认配置：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">reporting</span><span class="token punctuation">:</span>
 <span class="token key atrule">builtin</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> print</code></pre>

<p>输出到 <strong>rsyslog</strong> ：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">reporting</span><span class="token punctuation">:</span>
 <span class="token key atrule">central</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> rsyslog
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> @192.168.0.1</code></pre>

<p>抑制默认输出：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">reporting</span><span class="token punctuation">:</span>
 <span class="token key atrule">builtin</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> none</code></pre>

<p>输出到 <strong>curtin</strong> 样式的 <strong>webhook</strong> ：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">reporting</span><span class="token punctuation">:</span>
 <span class="token key atrule">hook</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> webhook
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.com/endpoint/path
  <span class="token key atrule">consumer_key</span><span class="token punctuation">:</span> <span class="token string">"ck_foo"</span>
  <span class="token key atrule">consumer_secret</span><span class="token punctuation">:</span> <span class="token string">"cs_foo"</span>
  <span class="token key atrule">token_key</span><span class="token punctuation">:</span> <span class="token string">"tk_foo"</span>
  <span class="token key atrule">token_secret</span><span class="token punctuation">:</span> <span class="token string">"tk_secret"</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span> INFO</code></pre>
</li>
<li><p>user-data</p>
<ul>
<li>名称：用户数据</li>
<li>类型：映射</li>
<li>默认值：{}</li>
<li>是否可交互：否</li>
</ul>
<p>提供 <strong>cloud-init</strong> 用户数据，它将与安装程序生成的用户数据 <strong>user-data</strong> 合并。如果您提供此信息，则无需提供身份 ** identity** 部分（但您有责任确保您可以登录到已安装的系统！）。</p>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li>网络启动： <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/netboot-amd64">https://ubuntu.com/server/docs/install/netboot-amd64</a></li>
<li>自动安装： <a target="_blank" rel="noopener" href="https://ubuntu.com/server/docs/install/autoinstall">https://ubuntu.com/server/docs/install/autoinstall</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160536339.png" alt="像方便面一样的男子 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="//img.to2b.cn/blog/ljk/1607160019009.png" alt="像方便面一样的男子 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/PXE/" rel="tag"><i class="fa fa-tag"></i> PXE</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E8%BF%90%E7%BB%B4/%E5%9F%BA%E7%A1%80/%E5%8A%A0%E5%AF%86%E5%92%8C%E5%AE%89%E5%85%A8/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" rel="prev" title="加密和安全">
                  <i class="fa fa-chevron-left"></i> 加密和安全
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Golang/slice/" rel="next" title="slice">
                  slice <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18016600号-3 </a>
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">像方便面一样的男子</span>
</div>

    </div>
  </footer>

  
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="//s1.to2b.cn/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="//s1.to2b.cn/libs/lozad.js/1.16.0/lozad.min.js"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="//s1.to2b.cn/libs/algoliasearch/4.11.0/algoliasearch-lite.umd.min.js"></script>
<script src="//s1.to2b.cn/libs/instantsearch.js/4.36.0/instantsearch.production.min.js"></script><script src="/js/third-party/search/algolia-search.js"></script>






  





</body>
</html>
